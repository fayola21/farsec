<title>Issue 28566 -   chromium -    Security: Crash when opening a corrupted GIF image - Project Hosting on Google Code</title> <pre> Platform tested: Chromium 4.0.252.0 (32323) on Linux 32bit    Repeatable: unfortunately no.. it happened only once with this file... but   maybe stack-trace will be helpful for image parser gurus.    Demo: <a href="http://alt.swiecki.net/j/cr/pic1.gif">http://alt.swiecki.net/j/cr/pic1.gif</a>    Stack trace:    Program received signal SIGSEGV  Segmentation fault.  [Switching to Thread 0xb3fffb90 (LWP 19867)]  0x08d4b583 in WebCore::GIFImageDecoder::haveDecodedRow (this=0x63c2fe38    frameIndex=0        rowBuffer=0x14acd540 &quot;��_��__��_��__��_��__��_��__��_��__��_��__��_��__&quot;  '��_��__' &lt;repeats 18 times&gt;  &quot;��_��__#��_��__��_��__��_��__  bb��_��__��_��__��_��__��_��__��_��__��_��__��_��__��_��__��_��__��_��__��_��__8l8l&quot;        rowEnd=0x14acd5d9 &quot;&quot;  rowNumber=1  repeatCount=1    writeTransparentPixels=false)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/platform/image-  decoders/ImageDecoder.h:166  166	/build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/platform/image-decoders/ImageDecoder.h:   No such file or directory.  	in /build/buildd/chromium-browser-  4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/platform/image-decoders/ImageDecoder.h  (gdb) bt  #0  0x08d4b583 in WebCore::GIFImageDecoder::haveDecodedRow   (this=0x63c2fe38  frameIndex=0        rowBuffer=0x14acd540 &quot;��_��__��_��__��_��__��_��__��_��__��_��__��_��__&quot;  '��_��__' &lt;repeats 18 times&gt;  &quot;��_��__#��_��__��_��__��_��__  bb��_��__��_��__��_��__��_��__��_��__��_��__��_��__��_��__��_��__��_��__��_��__8l8l&quot;        rowEnd=0x14acd5d9 &quot;&quot;  rowNumber=1  repeatCount=1    writeTransparentPixels=false)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/platform/image-  decoders/ImageDecoder.h:166  #1  0x08d4c3f7 in GIFImageReader::output_row (this=0x63c637f8)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/platform/image-  decoders/gif/GIFImageReader.cpp:163  #2  0x08d4c7e0 in GIFImageReader::do_lzw (this=0x63c637f8  q=0x63c6e389 &quot;&quot;)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/platform/image-  decoders/gif/GIFImageReader.cpp:351  #3  0x08d4cd58 in GIFImageReader::read (this=0x63c637f8        buf=0x63c6e488 &quot;��_��__V��_��__235v^2335��_��__&quot;__��_��__��_��__��_��__��_��__aa023&gt;234t��_��__��_��__��_��__  215{215O��_��__u9��_��__��_��__��_��__Aa235t��_��__035dPg026a207035iv��_��__��_��__��_��__203��_��__}w027mtRd��_��__  205236��_��__027��_��__5��_��__/��_��__020BBt5224Q210��_��__��_��__��_��__}214Q��_��__037177��_��__Q6220210!  ��_��__��_��__��_��__`003%5��_��__215c��_��__d221^025��_��__h��_��__i032��_��__  024$J��_��__M(223205z]230��_��__z032��_��__��_��__��_��__O004��_��__'��_��__a$036��_��__214}��_��__5��_��__��_��__212 b��_��__  234? .��_��__��_��__P1n��_��__&quot;2158��_��__h226g&lt;��_��__��_��__#m8T223��_��__Ek��_��__V��_��__D��_��__211ySn032r��_��__  016Y1212)fpI&quot;...  len=33476        query=WebCore::GIFImageDecoder::GIFFullQuery  haltAtFrame=1)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/platform/image-  decoders/gif/GIFImageReader.cpp:441  #4  0x08d4bea7 in WebCore::GIFImageDecoder::decode (this=0x63c2fe38        query=WebCore::GIFImageDecoder::GIFFullQuery  haltAtFrame=1)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/platform/image-  decoders/gif/GIFImageDecoder.cpp:51  #5  0x08d4c02d in WebCore::GIFImageDecoder::frameBufferAtIndex   (this=0x63c2fe38  index=0)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/platform/image-  decoders/gif/GIFImageDecoder.cpp:178  #6  0x08d43d40 in WebCore::ImageSource::createFrameAtIndex   (this=0x63c2fb80  index=0)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/platform/graphics/ImageSource.cpp:128  ---Type &lt;return&gt; to continue  or q &lt;return&gt; to quit---  #7  0x08d33ea2 in WebCore::BitmapImage::cacheFrame (this=0x63c2fb70    index=0)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/platform/graphics/BitmapImage.cpp:121  #8  0x08d343ff in WebCore::BitmapImage::frameAtIndex (this=0x63c2fb70    index=0)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/platform/graphics/BitmapImage.cpp:208  #9  0x08d34438 in WebCore::BitmapImage::nativeImageForCurrentFrame   (this=0x63c2fb70)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/platform/graphics/BitmapImage.h:155  #10 0x08d2be5a in WebCore::BitmapImage::draw (this=0x63c2fb70    ctxt=0xb3ffebc4        dstRect=@0xb3ffd3f8  srcRect=@0xb3ffd3e8    compositeOp=WebCore::CompositeSourceOver)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/platform/graphics/skia/ImageSkia.cpp:41  8  #11 0x08d413aa in WebCore::GraphicsContext::drawImage (this=0xb3ffebc4    image=0x63c2fb70        dest=@0xb3ffd44c  src=@0xb3ffd43c  op=WebCore::CompositeSourceOver    useLowQualityScale=false)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/platform/graphics/GraphicsContext.cpp:4  56  #12 0x08d414ef in WebCore::GraphicsContext::drawImage (this=0xb3ffebc4    image=0x63c2fb70        dest=@0xb3ffd524  srcRect=@0xb3ffd488  op=WebCore::CompositeSourceOver        useLowQualityScale=false)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/platform/graphics/GraphicsContext.cpp:3  26  #13 0x08d416c1 in WebCore::GraphicsContext::drawImage (this=0xb3ffebc4    image=0x63c2fb70        r=@0xb3ffd524  op=WebCore::CompositeSourceOver    useLowQualityScale=&lt;value optimized out&gt;)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/platform/graphics/GraphicsContext.cpp:3  16  #14 0x08dd03ba in WebCore::RenderImage::paintReplaced (this=0xb43eecc0    paintInfo=@0xb3ffd654        tx=8  ty=48)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/---Type &lt;return&gt; to continue  or q &lt;return&gt; to   quit---  WebCore/rendering/RenderImage.cpp:427  #15 0x08dfeec9 in WebCore::RenderReplaced::paint (this=0xb43eecc0    paintInfo=@0xb3ffd654  tx=8        ty=48)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/rendering/RenderReplaced.cpp:145  #16 0x08d88746 in WebCore::InlineBox::paint (this=0xb43eeeac    paintInfo=@0xb3ffd6b4  tx=8  ty=8)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/rendering/InlineBox.cpp:180  #17 0x08d8caa5 in WebCore::InlineFlowBox::paint (this=0xb43eed8c    paintInfo=@0xb3ffd76c  tx=8        ty=8)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/rendering/InlineFlowBox.cpp:676    #18 0x08e27a42 in WebCore::RootInlineBox::paint (this=0xb43eed8c    paintInfo=@0xb3ffd76c  tx=8        ty=8)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/rendering/RootInlineBox.cpp:165  #19 0x08de3928 in WebCore::RenderLineBoxList::paint (this=0xb43eebf8    renderer=0xb43eeb90        paintInfo=@0xb3ffd90c  tx=8  ty=8)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/rendering/RenderLineBoxList.cpp:204  #20 0x08d9e641 in WebCore::RenderBlock::paintContents (this=0xb43eeb90    paintInfo=@0xb3ffd90c        tx=8  ty=8)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/rendering/RenderBlock.cpp:1626  #21 0x08da322f in WebCore::RenderBlock::paintObject (this=0xb43eeb90    paintInfo=@0xb3ffd90c  tx=8        ty=8)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/rendering/RenderBlock.cpp:1715  #22 0x08d979a1 in WebCore::RenderBlock::paint (this=0xb43eeb90    paintInfo=@0xb3ffd90c  tx=8  ty=8)  ---Type &lt;return&gt; to continue  or q &lt;return&gt; to quit---      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/rendering/RenderBlock.cpp:1519  #23 0x08d9e4c2 in WebCore::RenderBlock::paintChildren (this=0xb43eeb1c    paintInfo=@0xb3ffda0c        tx=8  ty=8)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/rendering/RenderBlock.cpp:1652  #24 0x08da322f in WebCore::RenderBlock::paintObject (this=0xb43eeb1c    paintInfo=@0xb3ffda0c  tx=8        ty=8)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/rendering/RenderBlock.cpp:1715  #25 0x08d979a1 in WebCore::RenderBlock::paint (this=0xb43eeb1c    paintInfo=@0xb3ffda0c  tx=8  ty=8)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/rendering/RenderBlock.cpp:1519    #26 0x08d9e4c2 in WebCore::RenderBlock::paintChildren (this=0xb43eea00    paintInfo=@0xb3ffdcd0        tx=0  ty=0)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/rendering/RenderBlock.cpp:1652  #27 0x08da322f in WebCore::RenderBlock::paintObject (this=0xb43eea00    paintInfo=@0xb3ffdcd0  tx=0        ty=0)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/rendering/RenderBlock.cpp:1715  #28 0x08d979a1 in WebCore::RenderBlock::paint (this=0xb43eea00    paintInfo=@0xb3ffdcd0  tx=0  ty=0)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/rendering/RenderBlock.cpp:1519    #29 0x08de0761 in WebCore::RenderLayer::paintLayer (this=0xb43eea74    rootLayer=0xb43ee958        p=0xb3ffebc4  paintDirtyRect=@0xb3ffe1ac    paintRestriction=WebCore::PaintRestrictionNone        paintingRoot=0x0  overlapTestRequests=0xb3ffe01c  paintFlags=&lt;value   optimized out&gt;)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/rendering/RenderLayer.cpp:2239  ---Type &lt;return&gt; to continue  or q &lt;return&gt; to quit---  #30 0x08de012f in WebCore::RenderLayer::paintLayer (this=0xb43ee958    rootLayer=0xb43ee958        p=0xb3ffebc4  paintDirtyRect=@0xb3ffe1ac    paintRestriction=WebCore::PaintRestrictionNone        paintingRoot=0x0  overlapTestRequests=0xb3ffe01c  paintFlags=&lt;value   optimized out&gt;)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/rendering/RenderLayer.cpp:2264  #31 0x08de0855 in WebCore::RenderLayer::paint (this=0xb43ee958    p=0xb3ffebc4        damageRect=@0xb3ffe1ac  paintRestriction=WebCore::PaintRestrictionNone    paintingRoot=0x0)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/rendering/RenderLayer.cpp:2043    #32 0x08d02b5b in WebCore::FrameView::paintContents (this=0xb43d5568    p=0xb3ffebc4        rect=@0xb3ffe1ac)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/page/FrameView.cpp:1699  #33 0x08d71b5c in WebCore::ScrollView::paint (this=0xb43d5568    context=0xb3ffebc4        rect=@0xb3ffe370)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/platform/ScrollView.cpp:793  #34 0x08e2621e in WebCore::RenderWidget::paint (this=0xa66cc40    paintInfo=@0xb3ffe36c  tx=286        ty=0)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/rendering/RenderWidget.cpp:265  #35 0x08dcc285 in WebCore::RenderFrameSet::paint (this=0xa66cafc    paintInfo=@0xb3ffe36c  tx=0        ty=0)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/rendering/RenderFrameSet.cpp:140  #36 0x08d9e4c2 in WebCore::RenderBlock::paintChildren (this=0xa66c9e0    paintInfo=@0xb3ffe630        tx=0  ty=0)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/rendering/RenderBlock.cpp:1652  ---Type &lt;return&gt; to continue  or q &lt;return&gt; to quit---  #37 0x08da322f in WebCore::RenderBlock::paintObject (this=0xa66c9e0    paintInfo=@0xb3ffe630  tx=0        ty=0)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/rendering/RenderBlock.cpp:1715  #38 0x08d979a1 in WebCore::RenderBlock::paint (this=0xa66c9e0    paintInfo=@0xb3ffe630  tx=0  ty=0)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/rendering/RenderBlock.cpp:1519  #39 0x08de0761 in WebCore::RenderLayer::paintLayer (this=0xa66ca54    rootLayer=0xa66c938        p=0xb3ffebc4  paintDirtyRect=@0xb3ffeb0c    paintRestriction=WebCore::PaintRestrictionNone        paintingRoot=0x0  overlapTestRequests=0xb3ffe97c  paintFlags=&lt;value   optimized out&gt;)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/rendering/RenderLayer.cpp:2239  #40 0x08de012f in WebCore::RenderLayer::paintLayer (this=0xa66c938    rootLayer=0xa66c938        p=0xb3ffebc4  paintDirtyRect=@0xb3ffeb0c    paintRestriction=WebCore::PaintRestrictionNone        paintingRoot=0x0  overlapTestRequests=0xb3ffe97c  paintFlags=&lt;value   optimized out&gt;)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/rendering/RenderLayer.cpp:2264  #41 0x08de0855 in WebCore::RenderLayer::paint (this=0xa66c938    p=0xb3ffebc4        damageRect=@0xb3ffeb0c  paintRestriction=WebCore::PaintRestrictionNone    paintingRoot=0x0)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/rendering/RenderLayer.cpp:2043  #42 0x08d02b5b in WebCore::FrameView::paintContents (this=0xa6af030    p=0xb3ffebc4        rect=@0xb3ffeb0c)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/page/FrameView.cpp:1699  #43 0x08d71b5c in WebCore::ScrollView::paint (this=0xa6af030    context=0xb3ffebc4  rect=@0xb3ffebac)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebCore/platform/ScrollView.cpp:793  #44 0x08aeb13e in WebKit::WebFrameImpl::paint (this=0xb43cc170    canvas=0x14ab4868    ---Type &lt;return&gt; to continue  or q &lt;return&gt; to quit---      rect=@0xb3ffec2c)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/third_party/WebKit/WebKit/chromium/src/WebFrameImpl.cpp:1568  #45 0x0854a11d in RenderWidget::PaintRect (this=0xb43c7690    rect=@0xb3ffed64  canvas=0x14ab4868)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/chrome/renderer/render_widget.cc:384  #46 0x0854e4ad in RenderWidget::DoDeferredPaint (this=0xb43c7690)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/chrome/renderer/render_widget.cc:432  #47 0x0854e832 in RenderWidget::CallDoDeferredPaint (this=0xb43c7690)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/chrome/renderer/render_widget.cc:391  #48 0x085d3819 in MessageLoop::RunTask (this=0xb3fff2d4  task=0x623a9568)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/base/message_loop.cc:320  #49 0x085d38f6 in MessageLoop::DeferOrRunPendingTask (this=0xb3fff2d4    pending_task=@0x0)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/base/message_loop.cc:328  #50 0x085d3b1a in MessageLoop::DoWork (this=0xb3fff2d4)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/base/message_loop.cc:435  #51 0x085d5ed8 in base::MessagePumpDefault::Run (this=0xa1f1380    delegate=0xb3fff2d4)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/base/message_pump_default.cc:23  #52 0x085d4085 in MessageLoop::RunInternal (this=0xb3fff2d4)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/base/message_loop.cc:205  #53 0x085d41e6 in MessageLoop::Run (this=0xb3fff2d4)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/base/message_loop.c---Type &lt;return&gt; to continue  or q &lt;return&gt; to   quit---  c:155  #54 0x085fb4b7 in base::Thread::ThreadMain (this=0xa309e58)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/base/thread.cc:153  #55 0x085e2101 in ThreadFunc (closure=0xa309e58)      at /build/buildd/chromium-browser-4.0.252.0~svn20091118r32323/build-  tree/src/base/platform_thread_posix.cc:26  #56 0xb76f24fb in start_thread () from /lib/tls/i686/cmov/libpthread.so.0  #57 0xb71e9e5e in clone () from /lib/tls/i686/cmov/libc.so.6   </pre>
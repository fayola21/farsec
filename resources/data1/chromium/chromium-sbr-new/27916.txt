<title>Issue 27916 -   chromium -    Bounds error in skAlphaRuns causes renderer hang - Project Hosting on Google Code</title> <pre> This loop is the cause of all of the fuzzer hangs I've encountered. The   following code path causes the render process to spin in an infinite loop   due to a bounds error. I'm still trying to figure out the cause and   security implications of the boundary error.    In SkAlphaRuns::add()  the sum of x + middleCount can exceed the length   SkAlphaRuns buffer. When this happens  the code gets stuck in an infinite   loop because n is set to zero at the run terminator  which means that runs   never moves forward and middleCount never gets decremented.     third_party/skia/src/core/SkAlphaRuns.cpp (inside SkAlphaRuns::add)        if (middleCount)      {          SkAlphaRuns::Break(runs  alpha  x  middleCount);          alpha += x;          runs += x;          x = 0;          do {              alpha[0] = SkToU8(alpha[0] + maxValue);              int n = runs[0];              SkASSERT(n &lt;= middleCount);              alpha += n;              runs += n;              middleCount -= n;          } while (middleCount &gt; 0);          SkDEBUGCODE(this-&gt;validate();)      }      We have to fix the same problem in SkAlphaRuns::Break()  which is called by SkAlphaRuns::add().     third_party/skia/src/core/SkAlphaRuns.cpp        for (;;)      {          int n = runs[0];          SkASSERT(n &gt; 0);            if (x &lt; n)          {              alpha[x] = alpha[0];              runs[0] = SkToS16(x);              runs[x] = SkToS16(n - x);              break;          }          x -= n;          if (x &lt;= 0)              break;            runs += n;          alpha += n;      }   </pre>
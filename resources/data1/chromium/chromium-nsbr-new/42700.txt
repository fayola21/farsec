<title>Issue 42700 -   chromium -    We get repaint invalidations wrong on programmatic scroll (affects 375) - Project Hosting on Google Code</title> <pre> We fail these new tests from <a href="http://trac.webkit.org/changeset/57971:">http://trac.webkit.org/changeset/57971:</a>  fast/repaint/fixed-child-move-after-scroll.html  fast/repaint/fixed-child-of-fixed-move-after-scroll.html  fast/repaint/fixed-child-of-transformed-move-after-scroll.html    we aren't repainting after the scroll happens.  Stack of what I think should be invalidating us:    #0  WebKit::ChromeClientImpl::invalidateWindow (this=0x7fffed38a4c0) at third_party/WebKit/WebKit/chromium/src/ChromeClientImpl.cpp:486  #1  0x0000000000bca768 in WebCore::Chrome::invalidateWindow (this=0x7fffed3e87e0  updateRect=...  immediate=false) at third_party/WebKit/WebCore/page/Chrome.cpp:72  #2  0x0000000000caa989 in WebCore::ScrollView::scrollContents (this=0x7ffff7f27dc0  scrollDelta=...) at third_party/WebKit/WebCore/platform/ScrollView.cpp:529  #3  0x0000000000ca9690 in WebCore::ScrollView::valueChanged (this=0x7ffff7f27dc0  scrollbar=0x7fffe8ea49c0) at third_party/WebKit/WebCore/platform/ScrollView.cpp:295  #4  0x0000000000c04f97 in WebCore::FrameView::valueChanged (this=0x7ffff7f27dc0  bar=0x7fffe8ea49c0) at third_party/WebKit/WebCore/page/FrameView.cpp:1599  #5  0x0000000000cb005f in WebCore::Scrollbar::setCurrentPos (this=0x7fffe8ea49c0  pos=200) at third_party/WebKit/WebCore/platform/Scrollbar.cpp:295  #6  0x0000000000caf566 in WebCore::Scrollbar::setValue (this=0x7fffe8ea49c0  v=200) at third_party/WebKit/WebCore/platform/Scrollbar.cpp:103  #7  0x0000000000caa6a6 in WebCore::ScrollView::updateScrollbars (this=0x7ffff7f27dc0  desiredOffset=...) at third_party/WebKit/WebCore/platform/ScrollView.cpp:491  #8  0x0000000000ca993e in WebCore::ScrollView::setScrollPosition (this=0x7ffff7f27dc0  scrollPoint=...) at third_party/WebKit/WebCore/platform/ScrollView.cpp:340  #9  0x0000000000bd5c40 in WebCore::ScrollView::scrollBy (this=0x7ffff7f27dc0  s=...) at third_party/WebKit/WebCore/platform/ScrollView.h:155  #10 0x0000000000bd4961 in WebCore::DOMWindow::scrollBy (this=0x7fffe8e96000  x=0  y=200) at third_party/WebKit/WebCore/page/DOMWindow.cpp:1224  #11 0x00000000011530d1 in scrollByCallback (args=...) at out/Debug/obj/gen/webcore/bindings/V8DOMWindow.cpp:2588  #12 0x0000000000669088 in HandleApiCallHelper&lt;false&gt; (args=...) at v8/src/builtins.cc:1004  #13 0x0000000000666ed1 in Builtin_Impl_HandleApiCall (args=...) at v8/src/builtins.cc:1021  #14 0x0000000000666eaa in Builtin_HandleApiCall (args=...) at v8/src/builtins.cc:1020    I think we should be generating an invalidation here  instead we call notimplemented().  My initial guess is that <a href="http://trac.webkit.org/changeset/55675">http://trac.webkit.org/changeset/55675</a> is wrong.    Another possibility is that we should be calling FrameView::scrollPositionChanged() at some point  which is how the patch in <a href="/p/chromium/source/detail?r=57971">r57971</a> seems to have been trying to fix it.  I don't know which is right.    Since this is on the 375 branch and could lead to incorrect painting in some circumstances (like on the tests) marking as P1 pending further investigation. </pre>
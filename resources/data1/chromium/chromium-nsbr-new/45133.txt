<title>Issue 45133 -   chromium -    Mem leak with ExtensionMessageService::DispatchEventToRenderers - Project Hosting on Google Code</title> <pre> Reasonably consistent failure on linux valgrind since <a href="/p/chromium/source/detail?r=48204">r48204</a>. No obvious blame candidate from     <a href="http://build.chromium.org/buildbot/memory/builders/Linux%20Tests%20(valgrind)(1)/builds/4628">http://build.chromium.org/buildbot/memory/builders/Linux%20Tests%20(valgrind)(1)/builds/4628</a>    ERROR:root:FAIL! There were 2 errors:  ERROR:root:Leak_DefinitelyLost  Command: /b/slave/chromium-rel-linux-valgrind-tests-1/build/src/sconsbuild/Release/chrome --no-first-run --no-default-browser-check --test-type=ui --enable-file-  cookies --testing-channel=ChromeTestingInterface:25229.2 --noerrdialogs --homepage=about:blank --disable-web-resources --user-data-  dir=/tmp/org.chromium.yRHb0g/test_user_data --metrics-recording-only --enable-logging --test-name=LayoutPluginTester.UnloadNoCrash --allow-file-access-from-files  762 (44 direct  718 indirect) bytes in 1 blocks are definitely lost in loss record 6 712 of 6 914    operator new(unsigned int) (/tmp/scripts/valgrind-memcheck/coregrind/m_replacemalloc/vg_replace_malloc.c:269)    __gnu_cxx::new_allocator&lt;std::_Rb_tree_node&lt;std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;    std::allocator&lt;int&gt; &gt; &gt; &gt; &gt;::allocate(unsigned int  void const*) (/usr/include/c++/4.2/ext/new_allocator.h:91)    std::_Rb_tree&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt;  std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;  std::allocator&lt;int&gt; &gt; &gt;  std::_Select1st&lt;std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;  std::allocator&lt;int&gt; &gt; &gt; &gt;  std::less&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; &gt;  std::allocator&lt;std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;    std::allocator&lt;int&gt; &gt; &gt; &gt; &gt;::_M_get_node() (/usr/include/c++/4.2/bits/stl_tree.h:367)    std::_Rb_tree&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt;  std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;  std::allocator&lt;int&gt; &gt; &gt;  std::_Select1st&lt;std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;  std::allocator&lt;int&gt; &gt; &gt; &gt;  std::less&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; &gt;  std::allocator&lt;std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;    std::allocator&lt;int&gt; &gt; &gt; &gt; &gt;::_M_create_node(std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;    std::allocator&lt;int&gt; &gt; &gt; const&amp;) (/usr/include/c++/4.2/bits/stl_tree.h:376)    std::_Rb_tree&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt;  std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;  std::allocator&lt;int&gt; &gt; &gt;  std::_Select1st&lt;std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;  std::allocator&lt;int&gt; &gt; &gt; &gt;  std::less&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; &gt;  std::allocator&lt;std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;    std::allocator&lt;int&gt; &gt; &gt; &gt; &gt;::_M_insert(std::_Rb_tree_node_base*  std::_Rb_tree_node_base*  std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;  std::allocator&lt;int&gt; &gt; &gt; const&amp;) (/usr/include/c++/4.2/bits/stl_tree.h:838)    std::_Rb_tree&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt;  std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;  std::allocator&lt;int&gt; &gt; &gt;  std::_Select1st&lt;std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;  std::allocator&lt;int&gt; &gt; &gt; &gt;  std::less&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; &gt;  std::allocator&lt;std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;    std::allocator&lt;int&gt; &gt; &gt; &gt; &gt;::_M_insert_unique(std::_Rb_tree_iterator&lt;std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; const    std::set&lt;int  std::less&lt;int&gt;  std::allocator&lt;int&gt; &gt; &gt; &gt;  std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; const  std::set&lt;int    std::less&lt;int&gt;  std::allocator&lt;int&gt; &gt; &gt; const&amp;) (/usr/include/c++/4.2/bits/stl_tree.h:1021)    std::map&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt;  std::set&lt;int  std::less&lt;int&gt;  std::allocator&lt;int&gt; &gt;    std::less&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; &gt;  std::allocator&lt;std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;  std::allocator&lt;int&gt; &gt; &gt; &gt; &gt;::insert(std::_Rb_tree_iterator&lt;std::pair&lt;std::basic_string&lt;char    std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;  std::allocator&lt;int&gt; &gt; &gt; &gt;  std::pair&lt;std::basic_string&lt;char    std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;  std::allocator&lt;int&gt; &gt; &gt; const&amp;) (/usr/include/c++/4.2/bits/stl_map.h:427)    std::map&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt;  std::set&lt;int  std::less&lt;int&gt;  std::allocator&lt;int&gt; &gt;    std::less&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; &gt;  std::allocator&lt;std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;  std::allocator&lt;int&gt; &gt; &gt; &gt; &gt;::operator[](std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const&amp;) (/usr/include/c++/4.2/bits/stl_map.h:350)    ExtensionMessageService::DispatchEventToRenderers(std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; const&amp;  std::basic_string&lt;char    std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; const&amp;  bool  GURL const&amp;) (/b/slave/chromium-rel-linux-valgrind-  builder/build/src/chrome/browser/extensions/extension_message_service.cc:464)    DispatchEvent(Profile*  char const*  std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt;) (/b/slave/chromium-rel-linux-valgrind-  builder/build/src/chrome/browser/extensions/extension_browser_event_router.cc:71)    ExtensionBrowserEventRouter::TabSelectedAt(TabContents*  TabContents*  int  bool) (/b/slave/chromium-rel-linux-valgrind-  builder/build/src/chrome/browser/extensions/extension_browser_event_router.cc:298)    TabStripModel::ChangeSelectedContentsFrom(TabContents*  int  bool) (/b/slave/chromium-rel-linux-valgrind-  builder/build/src/chrome/browser/tabs/tab_strip_model.cc:899)    TabStripModel::InsertTabContentsAt(int  TabContents*  bool  bool  bool) (/b/slave/chromium-rel-linux-valgrind-  builder/build/src/chrome/browser/tabs/tab_strip_model.cc:151)    TabStripModel::InsertTabContentsAt(int  TabContents*  bool  bool) (/b/slave/chromium-rel-linux-valgrind-  builder/build/src/./chrome/browser/tabs/tab_strip_model.h:366)    TabStripModel::AddTabContents(TabContents*  int  bool  unsigned int  bool) (/b/slave/chromium-rel-linux-valgrind-  builder/build/src/chrome/browser/tabs/tab_strip_model.cc:504)    Browser::AddTabWithURL(GURL const&amp;  GURL const&amp;  unsigned int  int  int  SiteInstance*  std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt;   const&amp;) (/b/slave/chromium-rel-linux-valgrind-builder/build/src/chrome/browser/browser.cc:860)    BrowserInit::LaunchWithProfile::OpenTabsInBrowser(Browser*  bool  std::vector&lt;BrowserInit::LaunchWithProfile::Tab    std::allocator&lt;BrowserInit::LaunchWithProfile::Tab&gt; &gt; const&amp;) (/b/slave/chromium-rel-linux-valgrind-builder/build/src/chrome/browser/browser_init.cc:740)    BrowserInit::LaunchWithProfile::OpenURLsInBrowser(Browser*  bool  std::vector&lt;GURL  std::allocator&lt;GURL&gt; &gt; const&amp;) (/b/slave/chromium-rel-linux-valgrind-  builder/build/src/chrome/browser/browser_init.cc:692)    BrowserInit::LaunchWithProfile::ProcessLaunchURLs(bool  std::vector&lt;GURL  std::allocator&lt;GURL&gt; &gt; const&amp;) (/b/slave/chromium-rel-linux-valgrind-  builder/build/src/chrome/browser/browser_init.cc:639)    BrowserInit::LaunchWithProfile::Launch(Profile*  bool) (/b/slave/chromium-rel-linux-valgrind-builder/build/src/chrome/browser/browser_init.cc:500)    BrowserInit::LaunchBrowser(CommandLine const&amp;  Profile*  std::basic_string&lt;wchar_t  std::char_traits&lt;wchar_t&gt;  std::allocator&lt;wchar_t&gt; &gt; const&amp;  bool  int*)   (/b/slave/chromium-rel-linux-valgrind-builder/build/src/chrome/browser/browser_init.cc:387)    BrowserInit::ProcessCmdLineImpl(CommandLine const&amp;  std::basic_string&lt;wchar_t  std::char_traits&lt;wchar_t&gt;  std::allocator&lt;wchar_t&gt; &gt; const&amp;  bool  Profile*  int*    BrowserInit*) (/b/slave/chromium-rel-linux-valgrind-builder/build/src/chrome/browser/browser_init.cc:1034)    BrowserInit::Start(CommandLine const&amp;  std::basic_string&lt;wchar_t  std::char_traits&lt;wchar_t&gt;  std::allocator&lt;wchar_t&gt; &gt; const&amp;  Profile*  int*)   (/b/slave/chromium-rel-linux-valgrind-builder/build/src/./chrome/browser/browser_init.h:40)    BrowserMain(MainFunctionParams const&amp;) (/b/slave/chromium-rel-linux-valgrind-builder/build/src/chrome/browser/browser_main.cc:1247)    ChromeMain (/b/slave/chromium-rel-linux-valgrind-builder/build/src/chrome/app/chrome_dll_main.cc:830)    main (/b/slave/chromium-rel-linux-valgrind-builder/build/src/chrome/app/chrome_exe_main_gtk.cc:50) </pre>
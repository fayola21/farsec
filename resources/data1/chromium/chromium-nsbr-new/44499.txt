<title>Issue 44499 -   chromium -    WidgetWin::GetWidget() should check the HWND is really a WidgetWin - Project Hosting on Google Code</title> <pre> WidgetWin::GetWidget(HWND hwnd) is used to retrieve a WidgetWin out of a HWND.  It is called by the focus manager notably  when processing event keys.    Thw WidgetWin instance is associated to the HWND through the HWND  GWLP_USERDATA value. We reinterpret cast that value to a WidgetWin*.  We do check that the HWND it is at least a WindowImpl (WidgetWin derives  from WindowImpl)  but not that the HWND is actually associated to a WindowImpl.    So that method would be reinterpreting cast to the wrong type if called  with a pure WindowImpl.    In order to check that the HWND is associated with a WidgetWin  we would  probably need to use a custom base name for the WidgetWin class (see  ClassRegistrar::RetrieveClassName() in window_impl.cc). Which would  probably break scrips (probably used by tests)  according to the comment at  the top of window_impl.cc </pre>
<title>Issue 33237 -   chromium -    regression: DNS prefetch enable being called on wrong thread (or else DCHECK is wrong). - Project Hosting on Google Code</title> <pre> I just got the following stack trace leading to a DCHECK as I opened the   options dialog in a debug build:     	chrome.dll!DebugUtil::BreakDebugger()  Line 222	C++   	chrome.dll!logging::LogMessage::~LogMessage()  Line 566	C++  &gt;	chrome.dll!chrome_browser_net::EnableDnsPrefetch(bool enable=true)    Line 65	C++   	chrome.dll!`anonymous   namespace'::PrivacySection::NotifyPrefChanged(const   std::basic_string&lt;wchar_t std::char_traits&lt;wchar_t&gt; std::allocator&lt;wchar_t&gt;   &gt; * pref_name=0x00000000)  Line 732 + 0xa bytes	C++   	chrome.dll!OptionsPageView::ViewHierarchyChanged(bool is_add=true    views::View * parent=0x0e9c5770  views::View * child=0x09e56f98)  Line 35 +   0x15 bytes	C++   	chrome.dll!views::View::ViewHierarchyChangedImpl(bool   register_accelerators=true  bool is_add=true  views::View *   parent=0x0e9c5770  views::View * child=0x09e56f98)  Line 704 + 0x1f bytes	  C++   	chrome.dll!views::View::PropagateAddNotifications(views::View *   parent=0x0e9c5770  views::View * child=0x09e56f98)  Line 648	C++   	chrome.dll!views::View::AddChildView(int index=0x00000001    views::View * v=0x09e56f98)  Line 550	C++   	chrome.dll!views::View::AddChildView(views::View * v=0x09e56f98)    Line 530	C++   	chrome.dll!views::GridLayout::AddViewState(views::ViewState *   view_state=0x0e9c6848)  Line 964	C++   	chrome.dll!views::GridLayout::AddView(views::View *   view=0x09e56f98  int col_span=0x00000001  int row_span=0x00000001    views::GridLayout::Alignment h_align=FILL  views::GridLayout::Alignment   v_align=FILL  int pref_width=0x00000000  int pref_height=0x00000000)  Line   758	C++   	chrome.dll!views::GridLayout::AddView(views::View *   view=0x09e56f98  int col_span=0x00000001  int row_span=0x00000001    views::GridLayout::Alignment h_align=FILL  views::GridLayout::Alignment   v_align=FILL)  Line 743	C++   	chrome.dll!views::GridLayout::AddView(views::View *   view=0x09e56f98  int col_span=0x00000001  int row_span=0x00000001)  Line   738	C++   	chrome.dll!views::GridLayout::AddView(views::View *   view=0x09e56f98)  Line 731	C++   	chrome.dll!AdvancedContentsView::InitControlLayout()  Line 1367	C++   	chrome.dll!OptionsPageView::ViewHierarchyChanged(bool is_add=true    views::View * parent=0x09cad688  views::View * child=0x09c43e80)  Line 34 +   0x12 bytes	C++   	chrome.dll!views::View::ViewHierarchyChangedImpl(bool   register_accelerators=true  bool is_add=true  views::View *   parent=0x09cad688  views::View * child=0x09c43e80)  Line 704 + 0x1f bytes	  C++   	chrome.dll!views::View::PropagateAddNotifications(views::View *   parent=0x09cad688  views::View * child=0x09c43e80)  Line 648	C++   	chrome.dll!views::View::PropagateAddNotifications(views::View *   parent=0x09cad688  views::View * child=0x09c43e80)  Line 646 + 0x1b bytes	  C++   	chrome.dll!views::View::PropagateAddNotifications(views::View *   parent=0x09cad688  views::View * child=0x09c43e80)  Line 646 + 0x1b bytes	  C++   	chrome.dll!views::View::PropagateAddNotifications(views::View *   parent=0x09cad688  views::View * child=0x09c43e80)  Line 646 + 0x1b bytes	  C++   	chrome.dll!views::View::AddChildView(int index=0x00000000    views::View * v=0x09c43e80)  Line 550	C++   	chrome.dll!views::View::AddChildView(views::View * v=0x09c43e80)    Line 530	C++   	chrome.dll!views::GridLayout::AddViewState(views::ViewState *   view_state=0x0a469518)  Line 964	C++   	chrome.dll!views::GridLayout::AddView(views::View *   view=0x09c43e80  int col_span=0x00000001  int row_span=0x00000001    views::GridLayout::Alignment h_align=FILL  views::GridLayout::Alignment   v_align=FILL  int pref_width=0x00000000  int pref_height=0x00000000)  Line   758	C++   	chrome.dll!views::GridLayout::AddView(views::View *   view=0x09c43e80  int col_span=0x00000001  int row_span=0x00000001    views::GridLayout::Alignment h_align=FILL  views::GridLayout::Alignment   v_align=FILL)  Line 743	C++   	chrome.dll!views::GridLayout::AddView(views::View *   view=0x09c43e80  int col_span=0x00000001  int row_span=0x00000001)  Line   738	C++   	chrome.dll!views::GridLayout::AddView(views::View *   view=0x09c43e80)  Line 731	C++   	chrome.dll!AdvancedPageView::InitControlLayout()  Line 134	C++   	chrome.dll!OptionsPageView::ViewHierarchyChanged(bool is_add=true    views::View * parent=0x09cac9d8  views::View * child=0x09cad688)  Line 34 +   0x12 bytes	C++   	chrome.dll!views::View::ViewHierarchyChangedImpl(bool   register_accelerators=true  bool is_add=true  views::View *   parent=0x09cac9d8  views::View * child=0x09cad688)  Line 704 + 0x1f bytes	  C++   	chrome.dll!views::View::PropagateAddNotifications(views::View *   parent=0x09cac9d8  views::View * child=0x09cad688)  Line 648	C++   	chrome.dll!views::View::AddChildView(int index=0x00000000    views::View * v=0x09cad688)  Line 550	C++   	chrome.dll!views::View::AddChildView(views::View * v=0x09cad688)    Line 530	C++   	chrome.dll!views::NativeTabbedPaneWin::DoSelectTabAt(int   index=0x00000002  unsigned char invoke_listener='')  Line 309	C++   	chrome.dll!views::NativeTabbedPaneWin::SelectTabAt(int   index=0x00000002)  Line 154	C++   	chrome.dll!views::TabbedPane::SelectTabAt(int index=0x00000002)    Line 53 + 0x19 bytes	C++   	chrome.dll!OptionsWindowView::ShowOptionsPage(OptionsPage   page=OPTIONS_PAGE_ADVANCED  OptionsGroup   highlight_group=OPTIONS_GROUP_NONE)  Line 141	C++   	chrome.dll!ShowOptionsWindow(OptionsPage page=0xffffffff    OptionsGroup highlight_group=OPTIONS_GROUP_NONE  Profile *   profile=0x031d24b0)  Line 246	C++   	chrome.dll!Browser::OpenOptionsDialog()  Line 1306 + 0x10 bytes	C++   	chrome.dll!Browser::ExecuteCommandWithDisposition(int   id=0x00009c4f  WindowOpenDisposition disposition=CURRENT_TAB)  Line 1594 +   0x8 bytes	C++   	chrome.dll!Browser::ExecuteCommand(int id=0x00009c4f)  Line 1643	  C++   	chrome.dll!ToolbarView::ExecuteCommand(int command_id=0x00009c4f)    Line 306 + 0x1c bytes	C++   	chrome.dll!menus::SimpleMenuModel::ActivatedAt(int   index=0x0000000e)  Line 135 + 0x32 bytes	C++   	chrome.dll!views::NativeMenuWin::MenuHostWindow::OnMenuCommand(int   position=0x0000000e  HMENU__ * menu=0x25440adf)  Line 126 + 0x13 bytes	C++   	  chrome.dll!views::NativeMenuWin::MenuHostWindow::ProcessWindowMessage(HWND_  _ * window=0x000b0cf0  unsigned int message=0x00000126  unsigned int   w_param=0x0000000e  long l_param=0x25440adf  long * l_result=0x0032df0c)    Line 254	C++   	  chrome.dll!views::NativeMenuWin::MenuHostWindow::MenuHostWindowProc(HWND__   * window=0x000b0cf0  unsigned int message=0x00000126  unsigned int   w_param=0x0000000e  long l_param=0x25440adf)  Line 281 + 0x22 bytes	C++   	user32.dll!76ad8807() 	   	[Frames below may be incorrect and/or missing  no symbols loaded   for user32.dll]	   	user32.dll!76ad8962() 	   	user32.dll!76ad8911() 	   	user32.dll!76ad8aad() 	   	user32.dll!76ad8b00() 	   	chrome.dll!views::AcceleratorHandler::Dispatch(const tagMSG &amp;   msg={...})  Line 57 + 0xc bytes	C++   	chrome.dll!base::MessagePumpForUI::ProcessMessageHelper(const   tagMSG &amp; msg={...})  Line 360 + 0x21 bytes	C++   	chrome.dll!base::MessagePumpForUI::ProcessNextWindowsMessage()    Line 336 + 0xc bytes	C++   	chrome.dll!base::MessagePumpForUI::DoRunLoop()  Line 205 + 0x8   bytes	C++   	  chrome.dll!base::MessagePumpWin::RunWithDispatcher(base::MessagePump::Deleg  ate * delegate=0x0032f298  base::MessagePumpWin::Dispatcher *   dispatcher=0x0032e258)  Line 52 + 0xf bytes	C++   	chrome.dll!MessageLoop::RunInternal()  Line 201	C++   	chrome.dll!MessageLoop::RunHandler()  Line 178	C++   	chrome.dll!MessageLoopForUI::Run(base::MessagePumpWin::Dispatcher *   dispatcher=0x0032e258)  Line 604	C++   	chrome.dll!`anonymous namespace'::RunUIMessageLoop(BrowserProcess *   browser_process=0x03045b30)  Line 167	C++   	chrome.dll!BrowserMain(const MainFunctionParams &amp; parameters={...})    Line 993 + 0x11 bytes	C++   	chrome.dll!ChromeMain(HINSTANCE__ * instance=0x01250000    sandbox::SandboxInterfaceInfo * sandbox_info=0x0032fb58  wchar_t *   command_line=0x00352e64)  Line 748 + 0xc bytes	C++   	chrome.exe!MainDllLoader::Launch(HINSTANCE__ * instance=0x01250000    sandbox::SandboxInterfaceInfo * sbox_info=0x0032fb58)  Line 176 + 0x1d   bytes	C++   	chrome.exe!wWinMain(HINSTANCE__ * instance=0x01250000  HINSTANCE__   * __formal=0x00000000  HINSTANCE__ * __formal=0x00000000  HINSTANCE__ *   __formal=0x00000000)  Line 48 + 0x10 bytes	C++   	chrome.exe!__tmainCRTStartup()  Line 263 + 0x2c bytes	C   	chrome.exe!wWinMainCRTStartup()  Line 182	C   	kernel32.dll!76e8e4a5() 	   	ntdll.dll!7733cfed() 	   	ntdll.dll!7733d1ff() 	        The critical DCHECK is on line 64 of debug_global.cc:    void EnableDnsPrefetch(bool enable) {    DCHECK(ChromeThread::CurrentlyOn(ChromeThread::IO));    dns_prefetch_enabled = enable;  }      Note that this was called on the main ui thread (which explains why the   DCHECK fired).    Eric identified this as a regression relating to   <a href="http://codereview.chromium.org/553026/diff/6048/6060">http://codereview.chromium.org/553026/diff/6048/6060</a>     </pre>
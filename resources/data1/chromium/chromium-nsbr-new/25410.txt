<title>Issue 25410 -   chromium -    Garbled characters are showed when logging in www.paipai.com. We may need to decode the HTTP headers of response according to current region info from OS - Project Hosting on Google Code</title> <pre>   1. Start Chrome  2. Goto  <a href="http://www.paipai.com/promote/2009/09/jianguo60/?PTAG=10008.16.2">http://www.paipai.com/promote/2009/09/jianguo60/?PTAG=10008.16.2</a>  3. Click the link ��_�_��__��_��_��_��_to login  4. When successfully logging in  the username after &quot;_��_��_��_��___��_��_&quot; show garbled   characters      The username after &quot;_��_��_��_��___��_��_&quot; should display right Chinese character name.   See attached snapshots    Browsers tested:  IE 6:  OK  IE 7:  OK  IE 8:  OK  Firefox 3.5.3: FAIL  Chrome 3/4: FAIL  Safari 4: can not login    The following is problem analysis    After looking the page source  found the following script codes under tag   &lt;div class=&quot;head&quot;&gt;    PP.head.showWelcome = function (){      var userName=$getCookie(&quot;hs&quot;)?  $getCookie(&quot;hs&quot;).replace(/[0 1]/d+/[0 1]// &quot;&quot;):&quot;&quot;;      var strUsername = &quot;&quot;;      var strLink = &quot;&quot;;      if(userName){          strUsername = &quot;_��_��_��_��___��_��__��_&quot;+userName+&quot;��__��_&quot;;          strLink = '&lt;a href=&quot;<a href="http://member.paipai.com/cgi-">http://member.paipai.com/cgi-</a>  bin/c2cUser_LoginOut&quot; class=&quot;blue&quot;&gt;[_��_��_��_��__]&lt;/a&gt;';          $E(&quot;headLogin&quot;).innerHTML= strUsername+strLink;      }  };    According to var userName=$getCookie(&quot;hs&quot;)?  $getCookie(&quot;hs&quot;).replace(/[0 1]/d+/[0 1]// &quot;&quot;):&quot;&quot;;  the username was   from cookie.    After analyzing all http headers of the page  I found the following http   headers from the response of <a href="http://member.paipai.com/cgi-bin/ptlogin?">http://member.paipai.com/cgi-bin/ptlogin?</a>  loginfrom=18.    HTTP/1.1 200 OK  Server	nginx  Date	Wed  21 Oct 2009 16:23:38 GMT  Content-Type	text/html  Transfer-Encoding	chunked  Connection	keep-alive  Keep-Alive	timeout=8  Set-Cookie	uin=578724295; EXPIRES=Sat  19 Oct 2019 16:23:38 GMT;   PATH=/; DOMAIN=paipai.com;  Set-Cookie	skey=@rLomBmJ7n; PATH=/; DOMAIN=paipai.com;  Set-Cookie	hs=1%2F0%2F1%2F��__��_��_��_; PATH=/; DOMAIN=paipai.com;  Set-Cookie	mp=0%3A0%3A0%3A0%3A0%3A0%3A0%3A0%3A0%3A0%3A0%3A0; PATH=/;   DOMAIN=paipai.com;  Set-Cookie	returnurl=; EXPIRES=Thursday  30-Sep-03 12:00:00 GMT;   PATH=/; DOMAIN=paipai.com;  Set-Cookie	referurl=; EXPIRES=Thursday  30-Sep-03 12:00:00 GMT;   PATH=/; DOMAIN=member.paipai.com;    You can see the &quot;hs&quot; value is 1%2F0%2F1%2F��__��_��_��_  so var userName=getCookie(&quot;hs&quot;).replace(/[0 1]/d+/[0 1]// &quot;&quot;)=��_��_�_��_��_��__��_��_��_��_.   The charcodes of userName is 210(0xD2)  187(0xBB)  198(0xC6)  164(0xA4)    192(0xC0)  199(0xC7).  The site is Chinese site  and the GBK codes of the right username:&quot;_�ѕ�__单�__&quot;     are also 0xD2 0xBB  0xC6  0xA4  0xC0  0xC7.    So the bug is because www.paipai.com wrote GKB encoding data in HTTP &quot;Set-  Cookie&quot; header of response. Chrome could not identify the GBK encoding   contents  but IE did.  Since when HTTP headers of response are coming  there is no any information   to help browser to know the right encoding of headers of HTTP response   itself. I doubted that IE was able to identify the GBK encoding is because   it might use the region info of OS as encoding information to decode the   headers of HTTP response. So I changed my region from China to US  then IE   also show Garbled charsets.    According to the problem analysis  Chrome may need to decode the headers of   HTTP response according to current region info of OS.       </pre>
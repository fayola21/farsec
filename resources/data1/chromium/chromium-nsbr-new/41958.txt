<title>Issue 41958 -   chromium -    HttpNetworkSessionTest.FlushOnNetworkChange (net_unittests) fails under ThreadSanitizer on Mac - Project Hosting on Google Code</title> <pre> See the bot log at  <a href="http://build.chromium.org/buildbot/memory/builders/Chromium%20Mac%20(tsan)/builds/4887/steps/valgrind%20test:%20net/logs/stdio:">http://build.chromium.org/buildbot/memory/builders/Chromium%20Mac%20(tsan)/builds/4887/steps/valgrind%20test:%20net/logs/stdio:</a>  =======================================================================  [----------] 1 test from HttpNetworkSessionTest  [ RUN      ] HttpNetworkSessionTest.FlushOnNetworkChange  [25271:1291:0417/201959:3149729209775989:FATAL:../net/socket/socket_test_util.h(247)]  Check failed: next_index_ &lt; data_providers_.size().  Backtrace:    ../base/test/test_suite.h:162: Failure  Failed  [25271:1291:0417/201959:3149729209775989:FATAL:../net/socket/socket_test_util.h(247)]  Check failed: next_index_ &lt; data_providers_.size().  Backtrace:        [ FATAL ] gtest/include/gtest/internal/gtest-port.h:1029::  pthread_mutex_destroy(&amp;mutex_)failed with error 16  /b/slave/chromium-dbg-mac-tsan/build/src/xcodebuild/Debug/../../../src/tools/valgrind/../../third_party/valgrind/mac/bin/valgrind-tsan.sh:  line 24: 25271 Killed                  $EXTRACT_DIR/bin/valgrind  --tool=tsan &quot;$@&quot;  20:20:00 common.py [INFO] process ended  did not time out  20:20:00 common.py [INFO] collecting result code  =======================================================================    Error 16 is EBUSY  i.e. pthread_mutex_destroy is trying to destroy some  gTest-specific unlocked lock after the fatal error in the test. </pre>
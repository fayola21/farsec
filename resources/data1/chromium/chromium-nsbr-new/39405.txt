<title>Issue 39405 -   chromium -    geolocation arbitrator may get destroyed on wrong thread - Project Hosting on Google Code</title> <pre> if last ref count goes out on the UI thread  then the arbitrator can be   deleted on the wrong thread.  e.g.     	chrome.dll!DebugUtil::BreakDebugger()  Line 222	C++   	chrome.dll!logging::LogMessage::~LogMessage()  Line 572	C++   	chrome.dll!GeolocationArbitratorImpl::~GeolocationArbitratorImpl()    Line 81	C++   	chrome.dll!GeolocationArbitratorImpl::`scalar deleting destructor'()  +   0x16 bytes	C++   	chrome.dll!base::RefCounted&lt;GeolocationArbitrator&gt;::Release()  Line   93 + 0x3b bytes	C++   	  chrome.dll!scoped_refptr&lt;GeolocationArbitrator&gt;::~scoped_refptr&lt;Geoloc  ationArbitrator&gt;()  Line 239	C++  &gt;	  chrome.dll!GeolocationPermissionContext::~GeolocationPermissionContext  ()  Line 114 + 0xb bytes	C++   	chrome.dll!GeolocationPermissionContext::`scalar deleting   destructor'()  + 0x16 bytes	C++   	  chrome.dll!base::RefCountedThreadSafe&lt;GeolocationPermissionContext ba  se::DefaultRefCountedThreadSafeTraits&lt;GeolocationPermissionContext&gt;   &gt;::DeleteInternal(GeolocationPermissionContext * x=0x0481e7c0)  Line   146 + 0x3e bytes	C++   	  chrome.dll!base::DefaultRefCountedThreadSafeTraits&lt;GeolocationPermissi  onContext&gt;::Destruct(GeolocationPermissionContext * x=0x0481e7c0)    Line 112 + 0x9 bytes	C++   	  chrome.dll!base::RefCountedThreadSafe&lt;GeolocationPermissionContext ba  se::DefaultRefCountedThreadSafeTraits&lt;GeolocationPermissionContext&gt;   &gt;::Release()  Line 140 + 0x21 bytes	C++   	  chrome.dll!scoped_refptr&lt;GeolocationPermissionContext&gt;::~scoped_refptr  &lt;GeolocationPermissionContext&gt;()  Line 239	C++   	chrome.dll!`anonymous   namespace'::GeolocationConfirmInfoBarDelegate::~GeolocationConfirmInfo  BarDelegate()  + 0x24 bytes	C++   	chrome.dll!`anonymous   namespace'::GeolocationConfirmInfoBarDelegate::`scalar deleting   destructor'()  + 0x16 bytes	C++   	chrome.dll!`anonymous   namespace'::GeolocationConfirmInfoBarDelegate::InfoBarClosed()  Line 51   + 0x3e bytes	C++   	chrome.dll!InfoBar::Close()  Line 163 + 0x1b bytes	C++   	chrome.dll!InfoBar::AnimationEnded(const Animation *   animation=0x05505a80)  Line 237	C++   	chrome.dll!Animation::Stop()  Line 88 + 0x1b bytes	C++   	chrome.dll!Animation::Step()  Line 131	C++   	chrome.dll!Animation::Run()  Line 134 + 0xf bytes	C++   	chrome.dll!DispatchToMethod&lt;Animation void (__thiscall   Animation::*)(void)&gt;(Animation * obj=0x05505a80  void (void)*   method=0x5b10ebf0  const Tuple0 &amp; arg={...})  Line 412 + 0x8 bytes	  C++   	chrome.dll!base::BaseTimer&lt;Animation 1&gt;::TimerTask::Run()  Line 159   + 0x1c bytes	C++   	chrome.dll!MessageLoop::RunTask(Task * task=0x05eaa1b0)  Line 329   + 0xf bytes	C++   	chrome.dll!MessageLoop::DeferOrRunPendingTask(const   MessageLoop::PendingTask &amp; pending_task={...})  Line 340	C++   	chrome.dll!MessageLoop::DoDelayedWork(base::Time *   next_delayed_work_time=0x00cd6328)  Line 472	C++   	chrome.dll!base::MessagePumpForUI::DoRunLoop()  Line 214 + 0x24   bytes	C++   	  chrome.dll!base::MessagePumpWin::RunWithDispatcher(base::MessagePum  p::Delegate * delegate=0x003df060  base::MessagePumpWin::Dispatcher *   dispatcher=0x003de3f4)  Line 52 + 0xf bytes	C++   	chrome.dll!MessageLoop::RunInternal()  Line 201	C++   	chrome.dll!MessageLoop::RunHandler()  Line 178	C++   	  chrome.dll!MessageLoopForUI::Run(base::MessagePumpWin::Dispatcher *   dispatcher=0x003de3f4)  Line 613	C++   	chrome.dll!`anonymous   namespace'::RunUIMessageLoop(BrowserProcess *   browser_process=0x00cd2200)  Line 173	C++   	chrome.dll!BrowserMain(const MainFunctionParams &amp; parameters={...})    Line 1092 + 0x11 bytes	C++   	chrome.dll!ChromeMain(HINSTANCE__ * instance=0x00ef0000    sandbox::SandboxInterfaceInfo * sandbox_info=0x003df920  wchar_t *   command_line=0x00843078)  Line 807 + 0xc bytes	C++   	chrome.exe!MainDllLoader::Launch(HINSTANCE__ *   instance=0x00ef0000  sandbox::SandboxInterfaceInfo *   sbox_info=0x003df920)  Line 195 + 0x1d bytes	C++   	chrome.exe!wWinMain(HINSTANCE__ * instance=0x00ef0000    HINSTANCE__ * __formal=0x00000000  HINSTANCE__ *   __formal=0x00000000  HINSTANCE__ * __formal=0x00000000)  Line 46 +   0x10 bytes	C++   	chrome.exe!__tmainCRTStartup()  Line 263 + 0x2c bytes	C   	chrome.exe!wWinMainCRTStartup()  Line 182	C   </pre>
<title>Issue 25841 -   chromium -    Data race on vfptr in ipc/ipc_sync_channel_unittest.cc - Project Hosting on Google Code</title> <pre> Worker class joins the ipc_thread_ in its destructor.  This results in a data race on vfptr.  See <a href="http://code.google.com/p/data-race-test/wiki/PopularDataRaces">http://code.google.com/p/data-race-test/wiki/PopularDataRaces</a> for the details.    If we don't subclass Worker  this data race is benign.  However  we do subclass it a few times.    That means a wrong method may be called in a test if the data race happens.  For example  if someone calls OnAnswerDelay() after the main thread entered the ~Worker()   the Worker::OnAnswerDelay() will be called regardless of whether we override this method in a subclass.    This may result in flaky tests.    This data race was found using ThreadSanitizer  ( <a href="http://dev.chromium.org/developers/how-tos/using-valgrind/threadsanitizer">http://dev.chromium.org/developers/how-tos/using-valgrind/threadsanitizer</a> )  The sample report is attached.  The report shows that a read from vfptr may happen after the re-write on entering ~Worker(). </pre>
<title>Issue 36194 -   chromium -    X509UserCertResourceHandler triggers a DCHECK in IOBuffer - Project Hosting on Google Code</title> <pre> I hit a DCHECK while working with a PHP script that returns an X.509 certificate to the client.   X509UserCertResourceHandler is trying to allocate an IOBuffer with capacity zero  which is illegal.    What triggers this seems to be the following combination of response headers:      Content-Type: application/x-x509-user-cert      Content-Disposition: attachment; filename=ClientCertificate.cer  If I take out either of those headers  the problem goes away.    #0  0x07427994 in logging::LogMessage::~LogMessage (this=0xb02a63a0) at   /Volumes/Chromium/src/base/logging.cc:587  #1  0x0778f80a in net::IOBuffer::IOBuffer (this=0x19f54220  buffer_size=0) at   /Volumes/Chromium/src/net/base/io_buffer.cc:12  #2  0x071915cb in X509UserCertResourceHandler::AssembleResource (this=0x19fc2170) at   /Volumes/Chromium/src/chrome/browser/renderer_host/x509_user_cert_resource_handler.cc:91  #3  0x07191782 in X509UserCertResourceHandler::OnResponseCompleted (this=0x19fc2170  request_id=60    urs=@0xb02a6610  sec_info=@0xb02a67b8) at   /Volumes/Chromium/src/chrome/browser/renderer_host/x509_user_cert_resource_handler.cc:84  #4  0x07107c42 in BufferedResourceHandler::CompleteResponseStarted (this=0x19f507d0  request_id=60    in_complete=false) at   /Volumes/Chromium/src/chrome/browser/renderer_host/buffered_resource_handler.cc:381  #5  0x071090ed in BufferedResourceHandler::OnResponseStarted (this=0x19f507d0  request_id=60    response=0x19fc1230) at   /Volumes/Chromium/src/chrome/browser/renderer_host/buffered_resource_handler.cc:85  #6  0x07157b70 in ResourceDispatcherHost::CompleteResponseStarted (this=0x15e0c0  request=0xa58800) at   /Volumes/Chromium/src/chrome/browser/renderer_host/resource_dispatcher_host.cc:1052  #7  0x07157c14 in ResourceDispatcherHost::OnResponseStarted (this=0x15e0c0  request=0xa58800) at   /Volumes/Chromium/src/chrome/browser/renderer_host/resource_dispatcher_host.cc:1012  #8  0x0770a235 in URLRequest::ResponseStarted (this=0xa58800) at   /Volumes/Chromium/src/net/url_request/url_request.cc:369  #9  0x07722859 in URLRequestJob::NotifyHeadersComplete (this=0xba8c00) at   /Volumes/Chromium/src/net/url_request/url_request_job.cc:425  #10 0x0771a077 in URLRequestHttpJob::NotifyHeadersComplete (this=0xba8c00) at   /Volumes/Chromium/src/net/url_request/url_request_http_job.cc:586  #11 0x0771a0ed in URLRequestHttpJob::SaveNextCookie (this=0xba8c00) at   /Volumes/Chromium/src/net/url_request/url_request_http_job.cc:747  #12 0x0771a3ce in URLRequestHttpJob::SaveCookiesAndNotifyHeadersComplete (this=0xba8c00) at   /Volumes/Chromium/src/net/url_request/url_request_http_job.cc:739  #13 0x0771a45d in URLRequestHttpJob::OnStartCompleted (this=0xba8c00  result=0) at   /Volumes/Chromium/src/net/url_request/url_request_http_job.cc:498  #14 0x0771c6c3 in DispatchToMethod&lt;URLRequestHttpJob  void (URLRequestHttpJob::*)(int)  int&gt;   (obj=0xba8c00  method={__pfn = 0x771a3d8 &lt;URLRequestHttpJob::OnStartCompleted(int)&gt;  __delta = 0}    arg=@0xb02a712c) at tuple.h:422  #15 0x0771c72e in CallbackImpl&lt;URLRequestHttpJob  void (URLRequestHttpJob::*)(int)  Tuple1&lt;int&gt;   &gt;::RunWithParams (this=0xba8db0  params=@0xb02a712c) at task.h:564  #16 0x0777e6d8 in CallbackRunner&lt;Tuple1&lt;int&gt; &gt;::Run&lt;int&gt; (this=0xba8db0  a=@0xb02a7304) at task.h:529  #17 0x0767d1f0 in net::HttpCache::Transaction::DoCallback (this=0x19fc3d80  rv=0) at   /Volumes/Chromium/src/net/http/http_cache_transaction.cc:609  #18 0x0767d2b8 in net::HttpCache::Transaction::HandleResult (this=0x19fc3d80  rv=0) at   /Volumes/Chromium/src/net/http/http_cache_transaction.cc:615  #19 0x07682a63 in net::HttpCache::Transaction::DoLoop (this=0x19fc3d80  result=0) at   /Volumes/Chromium/src/net/http/http_cache_transaction.cc:749  #20 0x07682a8c in net::HttpCache::Transaction::OnIOComplete (this=0x19fc3d80  result=0) at   /Volumes/Chromium/src/net/http/http_cache_transaction.cc:1766  #21 0x0768608b in DispatchToMethod&lt;net::HttpCache::Transaction  void (net::HttpCache::Transaction::*)(int)    int&gt; (obj=0x19fc3d80  method={__pfn = 0x7682a74 &lt;net::HttpCache::Transaction::OnIOComplete(int)&gt;  __delta   = 0}  arg=@0xb02a83fc) at tuple.h:422  #22 0x076860ba in CallbackImpl&lt;net::HttpCache::Transaction  void (net::HttpCache::Transaction::*)(int)    Tuple1&lt;int&gt; &gt;::RunWithParams (this=0x19fc3e6c  params=@0xb02a83fc) at task.h:564  #23 0x0777e6d8 in CallbackRunner&lt;Tuple1&lt;int&gt; &gt;::Run&lt;int&gt; (this=0x19fc3e6c  a=@0xb02a85d4) at   task.h:529  #24 0x0768a52c in net::HttpNetworkTransaction::DoCallback (this=0x19fc61b0  rv=0) at   /Volumes/Chromium/src/net/http/http_network_transaction.cc:416  #25 0x07693777 in net::HttpNetworkTransaction::OnIOComplete (this=0x19fc61b0  result=1461) at   /Volumes/Chromium/src/net/http/http_network_transaction.cc:422  #26 0x07694ffd in DispatchToMethod&lt;net::HttpNetworkTransaction  void (net::HttpNetworkTransaction::*)(int)    int&gt; (obj=0x19fc61b0  method={__pfn = 0x7693744 &lt;net::HttpNetworkTransaction::OnIOComplete(int)&gt;  __delta   = 0}  arg=@0xb02a866c) at tuple.h:422  #27 0x0769502c in CallbackImpl&lt;net::HttpNetworkTransaction  void (net::HttpNetworkTransaction::*)(int)    Tuple1&lt;int&gt; &gt;::RunWithParams (this=0x19fc61e0  params=@0xb02a866c) at task.h:564  #28 0x0777e6d8 in CallbackRunner&lt;Tuple1&lt;int&gt; &gt;::Run&lt;int&gt; (this=0x19fc61e0  a=@0xb02a86b4) at   task.h:529  #29 0x076a0cec in net::HttpStreamParser::OnIOComplete (this=0x19fb7ac0  result=1461) at   /Volumes/Chromium/src/net/http/http_stream_parser.cc:122   </pre>
<title>Issue 27316 -   chromium -    Memory leak in WebMessagePortChannelImpl::postMessage on mac - Project Hosting on Google Code</title> <pre> From   <a href="http://build.chromium.org/buildbot/waterfall/builders/Chromium%20Mac%20UI%2">http://build.chromium.org/buildbot/waterfall/builders/Chromium%20Mac%20UI%2</a>  0(valgrind)(1)/builds/513/steps/valgrind%20test:%20ui/logs/stdio    40 bytes in 1 blocks are definitely lost in loss record 2 375 of 4 157    operator new(unsigned long) (sers/chrome-bot/valgrind-10880-  redzone/coregrind/m_replacemalloc/vg_replace_malloc.c:220)    CancelableTask* NewRunnableMethod&lt;WebMessagePortChannelImpl  void   (WebMessagePortChannelImpl::*)(WebKit::WebString const&amp;    WebKit::WebVector&lt;WebKit::WebMessagePortChannel*&gt;*)  WebKit::WebString    WebKit::WebVector&lt;WebKit::WebMessagePortChannel*&gt;*&gt;(WebMessagePortChannelIm  pl*  void (WebMessagePortChannelImpl::*)(WebKit::WebString const&amp;    WebKit::WebVector&lt;WebKit::WebMessagePortChannel*&gt;*)  WebKit::WebString   const&amp;  WebKit::WebVector&lt;WebKit::WebMessagePortChannel*&gt;* const&amp;)   (task.h:314)    WebMessagePortChannelImpl::postMessage(WebKit::WebString const&amp;    WebKit::WebVector&lt;WebKit::WebMessagePortChannel*&gt;*)   (webmessageportchannel_impl.cc:83)      WebCore::PlatformMessagePortChannel::postMessageToRemote(WTF::PassOwnPtr&lt;We  bCore::MessagePortChannel::EventData&gt;) (/b/slave/chromium-rel-mac-valgrind-  ui-1/build/src/webkit/api/src/PlatformMessagePortChannel.cpp:193)      WebCore::MessagePortChannel::postMessageToRemote(WTF::PassOwnPtr&lt;WebCore::M  essagePortChannel::EventData&gt;) (/b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/webkit/api/src/PlatformMessagePortChannel.cpp:80)      WebCore::MessagePort::postMessage(WTF::PassRefPtr&lt;WebCore::SerializedScript  Value&gt;  WTF::Vector&lt;WTF::RefPtr&lt;WebCore::MessagePort&gt;  1ul&gt; const*  int&amp;)   (/b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/third_party/WebKit/WebCore/WebCore.gyp/../dom/MessagePort.cpp:9  2)    WebCore::V8Custom::v8MessagePortPostMessageCallback(v8::Arguments const&amp;)   (/b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/third_party/WebKit/WebCore/WebCore.gyp/../bindings/v8/custom/V8  MessagePortCustom.cpp:88)    v8::internal::Builtin_HandleApiCall(v8::internal::Arguments)   (builtins.cc:383)    0x1477818A    0x1478AD84    0x147871B8    0x147798E1    v8::internal::Invoke(bool    v8::internal::Handle&lt;v8::internal::JSFunction&gt;    v8::internal::Handle&lt;v8::internal::Object&gt;  int  v8::internal::Object***    bool*) (execution.cc:99)      v8::internal::Execution::Call(v8::internal::Handle&lt;v8::internal::JSFunction  &gt;  v8::internal::Handle&lt;v8::internal::Object&gt;  int    v8::internal::Object***  bool*) (execution.cc:129)    v8::Function::Call(v8::Handle&lt;v8::Object&gt;  int  v8::Handle&lt;v8::Value&gt;*)   (api.cc:2384)      WebCore::V8WorkerContextEventListener::callListenerFunction(WebCore::Script  ExecutionContext*  v8::Handle&lt;v8::Value&gt;  WebCore::Event*)   (/b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/third_party/WebKit/WebCore/WebCore.gyp/../bindings/v8/V8WorkerC  ontextEventListener.cpp:142)      WebCore::V8AbstractEventListener::invokeEventHandler(WebCore::ScriptExecuti  onContext*  WebCore::Event*  v8::Handle&lt;v8::Value&gt;) (/b/slave/chromium-rel-  mac-valgrind-ui-  1/build/src/third_party/WebKit/WebCore/WebCore.gyp/../bindings/v8/V8Abstrac  tEventListener.cpp:144)      WebCore::V8WorkerContextEventListener::handleEvent(WebCore::ScriptExecution  Context*  WebCore::Event*) (/b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/third_party/WebKit/WebCore/WebCore.gyp/../bindings/v8/V8WorkerC  ontextEventListener.cpp:81)    WebCore::EventTarget::fireEventListeners(WebCore::Event*)   (/b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/third_party/WebKit/WebCore/WebCore.gyp/../dom/EventTarget.cpp:2  97)    WebCore::EventTarget::dispatchEvent(WTF::PassRefPtr&lt;WebCore::Event&gt;)   (/b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/third_party/WebKit/WebCore/WebCore.gyp/../dom/EventTarget.cpp:2  62)      WebKit::WebWorkerImpl::postMessageToWorkerContextTask(WebCore::ScriptExecut  ionContext*  WebKit::WebWorkerImpl*  WebCore::String const&amp;    WTF::PassOwnPtr&lt;WTF::Vector&lt;WTF::OwnPtr&lt;WebCore::MessagePortChannel&gt;  1ul&gt;   &gt;) (/b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/webkit/api/src/WebWorkerImpl.cpp:93)    WebCore::GenericWorkerTask3&lt;WebKit::WebWorkerImpl*    WebKit::WebWorkerImpl*  WebCore::String  WebCore::String const&amp;    WTF::Vector&lt;WTF::OwnPtr&lt;WebCore::MessagePortChannel&gt;  1ul&gt;*    WTF::PassOwnPtr&lt;WTF::Vector&lt;WTF::OwnPtr&lt;WebCore::MessagePortChannel&gt;  1ul&gt;   &gt; &gt;::performTask(WebCore::ScriptExecutionContext*)   (GenericWorkerTask.h:152)      WebCore::WorkerRunLoop::Task::performTask(WebCore::ScriptExecutionContext*)   (/b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/third_party/WebKit/WebCore/WebCore.gyp/../workers/WorkerRunLoop  .cpp:197)    WebCore::WorkerRunLoop::runInMode(WebCore::WorkerContext*    WebCore::ModePredicate const&amp;) (/b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/third_party/WebKit/WebCore/WebCore.gyp/../workers/WorkerRunLoop  .cpp:164)    WebCore::WorkerRunLoop::run(WebCore::WorkerContext*) (/b/slave/chromium-  rel-mac-valgrind-ui-  1/build/src/third_party/WebKit/WebCore/WebCore.gyp/../workers/WorkerRunLoop  .cpp:133)    WebCore::WorkerThread::runEventLoop() (/b/slave/chromium-rel-mac-  valgrind-ui-  1/build/src/third_party/WebKit/WebCore/WebCore.gyp/../workers/WorkerThread.  cpp:154)    WebCore::DedicatedWorkerThread::runEventLoop() (/b/slave/chromium-rel-  mac-valgrind-ui-  1/build/src/third_party/WebKit/WebCore/WebCore.gyp/../workers/DedicatedWork  erThread.cpp:66)    WebCore::WorkerThread::workerThread() (/b/slave/chromium-rel-mac-  valgrind-ui-  1/build/src/third_party/WebKit/WebCore/WebCore.gyp/../workers/WorkerThread.  cpp:134)    WebCore::WorkerThread::workerThreadStart(void*) (/b/slave/chromium-rel-  mac-valgrind-ui-  1/build/src/third_party/WebKit/WebCore/WebCore.gyp/../workers/WorkerThread.  cpp:111)    WTF::threadEntryPoint(void*) (/b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/third_party/WebKit/JavaScriptCore/JavaScriptCore.gyp/../wtf/Thr  eading.cpp:64)   </pre>
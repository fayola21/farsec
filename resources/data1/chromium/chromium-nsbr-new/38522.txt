<title>Issue 38522 -   chromium -    BrowserTest.RestorePinnedTabs causes assertion on mac - Project Hosting on Google Code</title> <pre> I just added BrowserTest.RestorePinnedTabs and it seems to tickle an assertion on Mac. I'm marking   as flakey for now:    [ RUN      ] BrowserTest.RestorePinnedTabs  [16018:263:0318/095531:298289654968268:ERROR:/b/slave/chromium-dbg-mac-  builder/build/src/chrome/browser/first_run.cc(118)] Not implemented reached in static bool   FirstRun::ProcessMasterPreferences(const FilePath&amp;  const FilePath&amp;  FirstRun::MasterPrefs*)  [16018:19719:0318/095531:298289660786582:INFO:/b/slave/chromium-dbg-mac-  builder/build/src/chrome/browser/net/dns_global.cc(430)] DNS Prefetch service started  [16018:263:0318/095531:298289705712737:INFO:/b/slave/chromium-dbg-mac-  builder/build/src/chrome/browser/bookmarks/bookmark_model.cc(145)] Loading bookmarks  [16018:263:0318/095531:298289767817821:INFO:/b/slave/chromium-dbg-mac-  builder/build/src/chrome/browser/history/history.cc(723)] History backend finished loading  [16018:18951:0318/095531:298289775291279:INFO:/b/slave/chromium-dbg-mac-  builder/build/src/chrome/browser/important_file_writer.cc(70)] successfully saved   /private/var/folders/Dv/DvuOAgCiHqe-M55O-YhHlU+++TM/-Tmp-  /org.chromium.QtHFsD/test_user_data/Default/Bookmarks  [16018:263:0318/095531:298290013436627:INFO:/b/slave/chromium-dbg-mac-  builder/build/src/net/socket/ssl_test_util.cc(197)] Trying to launch python ...  /b/slave/chromium-dbg-mac6-tests-3/build/src/third_party/tlslite/tlslite/utils/cryptomath.py:9:   DeprecationWarning: the sha module is deprecated; use the hashlib module instead    import sha  /b/slave/chromium-dbg-mac6-tests-3/build/src/third_party/tlslite/tlslite/mathtls.py:7:   DeprecationWarning: the md5 module is deprecated; use hashlib instead    import md5  /b/pylibs/zope/__init__.py:19: UserWarning: Module twisted was already imported from   /b/pylibs/twisted/__init__.pyc  but   /System/Library/Frameworks/Python.framework/Versions/2.6/Extras/lib/python is being added to   sys.path    import pkg_resources  /b/pylibs/zope/__init__.py:19: UserWarning: Module zope was already imported from   /b/pylibs/zope/__init__.pyc  but   /System/Library/Frameworks/Python.framework/Versions/2.6/Extras/lib/python is being added to   sys.path    import pkg_resources  [16018:263:0318/095532:298291017361101:INFO:/b/slave/chromium-dbg-mac-  builder/build/src/net/socket/ssl_test_util.cc(213)] Started on port 1337  [16018:18951:0318/095532:298291018231934:INFO:/b/slave/chromium-dbg-mac-  builder/build/src/chrome/browser/extensions/extensions_service.cc(1017)] Loading single extension   from app  [16018:263:0318/095532:298291041269958:INFO:/b/slave/chromium-dbg-mac-  builder/build/src/chrome/browser/extensions/extensions_service.cc(491)] Sending EXTENSION_LOADED  Got EXTENSION_LOADED notification.  [16018:18951:0318/095532:298291041535887:INFO:/b/slave/chromium-dbg-mac-  builder/build/src/chrome/browser/important_file_writer.cc(70)] successfully saved   /private/var/folders/Dv/DvuOAgCiHqe-M55O-YhHlU+++TM/-Tmp-  /org.chromium.QtHFsD/test_user_data/Default/Preferences  [16018:263:0318/095532:298291041701713:INFO:/b/slave/chromium-dbg-mac-  builder/build/src/chrome/browser/extensions/extension_browsertest.cc(235)] All ExtensionHosts   loaded  [16018:19719:0318/095532:298291149111827:INFO:/b/slave/chromium-dbg-mac-  builder/build/src/chrome/browser/renderer_host/buffered_resource_handler.cc(208)] To buffer:   http://localhost:1337/empty.html  [16018:19719:0318/095532:298291149802170:INFO:/b/slave/chromium-dbg-mac-  builder/build/src/chrome/browser/renderer_host/buffered_resource_handler.cc(140)] Finished   buffering http://localhost:1337/empty.html  LEAK: 4 WebCoreNode  [16018:27395:0318/095532:298291166873912:INFO:/b/slave/chromium-dbg-mac-  builder/build/src/chrome/browser/history/history_backend.cc(340)] Adding page   http://localhost:1337/empty.html  [16018:19719:0318/095532:298291336745016:INFO:/b/slave/chromium-dbg-mac-  builder/build/src/chrome/browser/renderer_host/buffered_resource_handler.cc(208)] To buffer:   http://localhost:1337/favicon.ico  [16018:19719:0318/095532:298291337518062:INFO:/b/slave/chromium-dbg-mac-  builder/build/src/chrome/browser/renderer_host/buffered_resource_handler.cc(140)] Finished   buffering http://localhost:1337/favicon.ico  [16018:19719:0318/095532:298291346130357:INFO:/b/slave/chromium-dbg-mac-  builder/build/src/chrome/browser/renderer_host/buffered_resource_handler.cc(208)] To buffer:   http://localhost:1337/empty.html  [16018:19719:0318/095532:298291348139274:INFO:/b/slave/chromium-dbg-mac-  builder/build/src/chrome/browser/renderer_host/buffered_resource_handler.cc(140)] Finished   buffering http://localhost:1337/empty.html  [16018:27395:0318/095533:298291444780702:INFO:/b/slave/chromium-dbg-mac-  builder/build/src/chrome/browser/history/history_backend.cc(340)] Adding page   http://localhost:1337/empty.html  [16018:19719:0318/095533:298291521377191:INFO:/b/slave/chromium-dbg-mac-  builder/build/src/chrome/browser/renderer_host/buffered_resource_handler.cc(208)] To buffer:   http://localhost:1337/favicon.ico  [16018:19719:0318/095533:298291523449583:INFO:/b/slave/chromium-dbg-mac-  builder/build/src/chrome/browser/renderer_host/buffered_resource_handler.cc(140)] Finished   buffering http://localhost:1337/favicon.ico  [16018:263:0318/095533:298291593107082:INFO:/b/slave/chromium-dbg-mac-  builder/build/src/chrome/browser/renderer_host/render_view_host.cc(1111)] Failed Provisional Load:   chrome://newtab/  error_code: -3 is_main_frame: 1 showing_repost_interstitial: 0  LEAK: 4 WebCoreNode  [16018:263:0318/095533:298291926090089:FATAL:/b/slave/chromium-dbg-mac-  builder/build/src/base/message_loop.cc(324)] Check failed: nestable_tasks_allowed_.   ../base/test/test_suite.h:162: Failure  Failed  [16018:263:0318/095533:298291926090089:FATAL:/b/slave/chromium-dbg-mac-  builder/build/src/base/message_loop.cc(324)] Check failed: nestable_tasks_allowed_.   Backtrace:  	0   browser_tests                       0x008db8a0 StackTrace::StackTrace() + 32  	1   browser_tests                       0x008f2797 logging::LogMessage::~LogMessage() + 743  	2   browser_tests                       0x008f7191 MessageLoop::RunTask(Task*) + 173  	3   browser_tests                       0x008f741f   MessageLoop::ProcessNextDelayedNonNestableTask() + 109  	4   browser_tests                       0x008f743d MessageLoop::DoIdleWork() + 17  	5   browser_tests                       0x008bfd8a   base::MessagePumpCFRunLoopBase::RunIdleWork() + 74  	6   browser_tests                       0x008bfdcf   base::MessagePumpCFRunLoopBase::PreWaitObserver(__CFRunLoopObserver*  unsigned long  void*) + 23  	7   CoreFoundation                      0x93f83892 __CFRunLoopDoObservers + 1186  	8   CoreFoundation                      0x93f403e2 __CFRunLoopRun + 1154  	9   CoreFoundation                      0x93f3f864 CFRunLoopRunSpecific + 452  	10  CoreFoundation                      0x93f3f691 CFRunLoopRunInMode + 97  	11  HIToolbox                           0x97850f0c RunCurrentEventLoopInMode + 392  	12  HIToolbox                           0x97850cc3 ReceiveNextEventCommon + 354  	13  HIToolbox                           0x97850b48 BlockUntilNextEventMatchingListInMode +   81  	14  AppKit                              0x9524aac5 _DPSNextEvent + 847  	15  AppKit                              0x9524a306 -[NSApplication   nextEventMatchingMask:untilDate:inMode:dequeue:] + 156  	16  AppKit                              0x95427c56 -[NSButtonCell performClick:] + 983  	17  browser_tests                       0x001f0842 BrowserWindowCocoa::Close() + 170  	18  browser_tests                       0x0014db4e Browser::CloseFrame() + 30  	19  browser_tests                       0x0015c33e void DispatchToMethod&lt;Browser  void   (Browser::*)()&gt;(Browser*  void (Browser::*)()  Tuple0 const&amp;) + 56  	20  browser_tests                       0x0015c391   ScopedRunnableMethodFactory&lt;Browser&gt;::RunnableMethod&lt;void (Browser::*)()  Tuple0&gt;::Run() + 81  	21  browser_tests                       0x008f71c0 MessageLoop::RunTask(Task*) + 220  	22  browser_tests                       0x008f78a5   MessageLoop::DeferOrRunPendingTask(MessageLoop::PendingTask const&amp;) + 53  	23  browser_tests                       0x008f7b35 MessageLoop::DoWork() + 253  	24  browser_tests                       0x008bfe40   base::MessagePumpCFRunLoopBase::RunWork() + 74  	25  browser_tests                       0x008bfe85   base::MessagePumpCFRunLoopBase::RunWorkSource(void*) + 23  	26  CoreFoundation                      0x93f42761 __CFRunLoopDoSources0 + 1201  	27  CoreFoundation                      0x93f4038f __CFRunLoopRun + 1071  	28  CoreFoundation                      0x93f3f864 CFRunLoopRunSpecific + 452  	29  CoreFoundation                      0x93f3f691 CFRunLoopRunInMode + 97  	30  HIToolbox                           0x97850f0c RunCurrentEventLoopInMode + 392  	31  HIToolbox                           0x97850cc3 ReceiveNextEventCommon + 354  	32  HIToolbox                           0x97850b48 BlockUntilNextEventMatchingListInMode +   81  	33  AppKit                              0x9524aac5 _DPSNextEvent + 847  	34  AppKit                              0x9524a306 -[NSApplication   nextEventMatchingMask:untilDate:inMode:dequeue:] + 156  	35  AppKit                              0x95427c56 -[NSButtonCell performClick:] + 983  	36  browser_tests                       0x001f0842 BrowserWindowCocoa::Close() + 170  	37  browser_tests                       0x00152517 Browser::CloseWindow() + 61  	38  browser_tests                       0x000034c8   InProcessBrowserTest::RunTestOnMainThreadLoop() + 642  	39  browser_tests                       0x000061aa void   DispatchToMethod&lt;InProcessBrowserTest  void (InProcessBrowserTest::*)()&gt;(InProcessBrowserTest*    void (InProcessBrowserTest::*)()  Tuple0 const&amp;) + 56  	40  browser_tests                       0x000061e5 RunnableMethod&lt;InProcessBrowserTest    void (InProcessBrowserTest::*)()  Tuple0&gt;::Run() + 57  	41  browser_tests                       0x008f71c0 MessageLoop::RunTask(Task*) + 220  	42  browser_tests                       0x008f78a5   MessageLoop::DeferOrRunPendingTask(MessageLoop::PendingTask const&amp;) + 53  	43  browser_tests                       0x008f7b35 MessageLoop::DoWork() + 253  	44  browser_tests                       0x008bfe40   base::MessagePumpCFRunLoopBase::RunWork() + 74  	45  browser_tests                       0x008bfe85   base::MessagePumpCFRunLoopBase::RunWorkSource(void*) + 23  	46  CoreFoundation                      0x93f428cb __CFRunLoopDoSources0 + 1563  	47  CoreFoundation                      0x93f4038f __CFRunLoopRun + 1071  	48  CoreFoundation                      0x93f3f864 CFRunLoopRunSpecific + 452  	49  CoreFoundation                      0x93f3f691 CFRunLoopRunInMode + 97  	50  HIToolbox                           0x97850f0c RunCurrentEventLoopInMode + 392  	51  HIToolbox                           0x97850cc3 ReceiveNextEventCommon + 354  	52  HIToolbox                           0x97850b48 BlockUntilNextEventMatchingListInMode +   81  	53  AppKit                              0x9524aac5 _DPSNextEvent + 847  	54  AppKit                              0x9524a306 -[NSApplication   nextEventMatchingMask:untilDate:inMode:dequeue:] + 156  	55  AppKit                              0x9520c49f -[NSApplication run] + 821  	56  browser_tests                       0x008bf982   base::MessagePumpNSApplication::DoRun(base::MessagePump::Delegate*) + 130  	57  browser_tests                       0x008bff71   base::MessagePumpCFRunLoopBase::Run(base::MessagePump::Delegate*) + 175  	58  browser_tests                       0x008f82ac MessageLoop::RunInternal() + 212  	59  browser_tests                       0x008f82c7 MessageLoop::RunHandler() + 17  	60  browser_tests                       0x008f832b MessageLoop::Run() + 35  	61  browser_tests                       0x0016e9e5 (anonymous   namespace)::RunUIMessageLoop(BrowserProcess*) + 19   </pre>
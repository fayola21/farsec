<title>Issue 26478 -   chromium -    Data race on reference counter in StorageAreaImpl (WebKit) - Project Hosting on Google Code</title> <pre> This data race was found using ThreadSanitizer  <a href="http://dev.chromium.org/developers/how-tos/using-valgrind/threadsanitizer">http://dev.chromium.org/developers/how-tos/using-valgrind/threadsanitizer</a>  Please note that the previous data race found on ref. counter was the   cause of a top crasher (see <a href="http://crbug.com/18488">http://crbug.com/18488</a>).    This data race can be proved using RaceChecker class  (see <a href="http://code.google.com/p/data-race-test/wiki/RaceCheckerClass">http://code.google.com/p/data-race-test/wiki/RaceCheckerClass</a> )      1. Apply the attached patch     * adds RaceChecker class files into third_party/WebKit/...      * adds dependencies for these files     * puts RaceChecker calls into JavaScriptCore/wtf/RefCounted.h       under m_racecheck condition (set to &quot;true&quot; if &quot;do_racecheck()&quot; is   called)     * adds do_racecheck() call to StorageAreaImpl  2. gclient runhooks --force &amp;&amp; hammer -C build ui_tests  3. RACECHECKER=2   RACECHECKER_SLEEP_MS=100 ./sconsbuild/Debug/ui_tests --gtest_filter=&quot;*Storage*&quot;    [==========] Running 3 tests from 1 test case.  [----------] Global test environment set-up.  [----------] 3 tests from DOMStorageTest  [ RUN      ] DOMStorageTest.DOMStorageLayoutTests  RACECHECKER: write at 0x7fe5dc09aa28  RACECHECKER: write at 0x7fe5dc09aa28  RACECHECKER: write at 0x7fe5dc09aa28  Race found between these points  === writer:   sconsbuild/Debug/chrome[0x19c7cb4]  sconsbuild/Debug/chrome[0x1e67fc5]  ...  sconsbuild/Debug/chrome[0x120e11e]  sconsbuild/Debug/chrome[0x1213e97]  === writer:   sconsbuild/Debug/chrome[0x19c7dac]  sconsbuild/Debug/chrome[0x19df8a1]  ...  sconsbuild/Debug/chrome[0x205a68d]  sconsbuild/Debug/chrome[0x2291587]  /lib/libpthread.so.0[0x7fe5e45f03f7]  /lib/libc.so.6(clone+0x6d)[0x7fe5e2fe8b4d]    Sample ThreadSanitizer report is also attached. </pre>
<title>Issue 40242 -   chromium -    Data race on boolean in WebDataService::WebDataRequest - Project Hosting on Google Code</title> <pre> This data race was detected by ThreadSanitizer (see <a href="http://www.chromium.org/developers/how-tos/using-valgrind/threadsanitizer">http://www.chromium.org/developers/how-tos/using-valgrind/threadsanitizer</a> )    Here is the example of the report:  <a href="http://build.chromium.org/buildbot/memory/builders/Linux%20Tests%20(tsan)/builds/3414/steps/valgrind%20test:%20unit/logs/stdio">http://build.chromium.org/buildbot/memory/builders/Linux%20Tests%20(tsan)/builds/3414/steps/valgrind%20test:%20unit/logs/stdio</a>    WARNING: Possible data race during write of size 1 at 0xAF99B90: {{{      T0 (locks held: {L6487  L6488}):      #0  WebDataService::WebDataRequest::Cancel() chrome/browser/webdata/web_data_service.cc:1028      #1  WebDataService::CancelRequest(int) chrome/browser/webdata/web_data_service.cc:100      #2  PersonalDataManager::CancelPendingQuery(int*) chrome/browser/autofill/personal_data_manager.cc:535      #3  PersonalDataManager::LoadCreditCards() chrome/browser/autofill/personal_data_manager.cc:482      #4  PersonalDataManager::Refresh() chrome/browser/autofill/personal_data_manager.cc:552      #5  PersonalDataManager::SetProfiles(...) chrome/browser/autofill/personal_data_manager.cc:295      #6  PersonalDataManagerTest_SetProfiles_Test::TestBody() chrome/browser/autofill/personal_data_manager_unittest.cc:141      #7  testing::Test::Run() testing/gtest/src/gtest.cc:2095    Concurrent read(s) happened at (OR AFTER) these points:     T500 (Chrome_DBThread) (locks held: {}):      #0  WebDataService::WebDataRequest::IsCancelled() const chrome/browser/webdata/web_data_service.cc:1023      #1  WebDataService::GetCreditCardsImpl(WebDataService::WebDataRequest*) chrome/browser/webdata/web_data_service.cc:936      #2  void DispatchToMethod&lt;...&gt;(...) base/tuple.h:422      #3  RunnableMethod&lt;...&gt;::Run() base/task.h:296      #4  MessageLoop::RunTask(Task*) base/message_loop.cc:329      #5  MessageLoop::DeferOrRunPendingTask(MessageLoop::PendingTask const&amp;) base/message_loop.cc:337      #6  MessageLoop::DoWork() base/message_loop.cc:444      #7  base::MessagePumpDefault::Run(base::MessagePump::Delegate*) base/message_pump_default.cc:23      #8  MessageLoop::RunInternal() base/message_loop.cc:205      #9  MessageLoop::RunHandler() base/message_loop.cc:177    Location 0xAF99B90 is 16 bytes inside a block starting at 0xAF99B80 of size 28 allocated by T0 from heap:      #0  operator new(unsigned int) /usr/lib/libstdc++.so.6.0.9      #1  WebDataService::GetCreditCards(WebDataServiceConsumer*) chrome/browser/webdata/web_data_service.cc:219      #2  PersonalDataManager::LoadCreditCards() chrome/browser/autofill/personal_data_manager.cc:484      #3  PersonalDataManager::Refresh() chrome/browser/autofill/personal_data_manager.cc:552      #4  PersonalDataManager::SetProfiles(...) chrome/browser/autofill/personal_data_manager.cc:295      #5  PersonalDataManagerTest_SetProfiles_Test::TestBody() chrome/browser/autofill/personal_data_manager_unittest.cc:121      #6  testing::Test::Run() testing/gtest/src/gtest.cc:2095  }}}    See <a href="http://code.google.com/p/data-race-test/wiki/PopularDataRaces#Notification">http://code.google.com/p/data-race-test/wiki/PopularDataRaces#Notification</a> for the description why this is a data race.  This data race is probably easy to fix using CancellationFlag class defined in base/cancellation_flag.h </pre>
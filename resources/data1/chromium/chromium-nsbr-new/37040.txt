<title>Issue 37040 -   chromium -    buffer overflow line 80 xdg_user_dir_lookup Matt Parsons - Project Hosting on Google Code</title> <pre> I believe I have found a buffer overflow in the third party c file   xdg_user_dir_lookup.c.   This could be a potential buffer overflow if the   variable config file is greater than 512 bytes.   Strcpy is a vulnerable   function to buffer overflows.         C:chromiumtrunkhomechrome-  svntarballchromiumsrcbasethird_partyxdg_user_dirs  xdg_user_dir_lookup    LINE 80                /**   * xdg_user_dir_lookup_with_fallback:   * @type: a string specifying the type of directory   * @fallback: value to use if the directory isn't specified by the user   * @returns: a newly allocated absolute pathname   *   * Looks up a XDG user directory of the specified type.   * Example of types are &quot;DESKTOP&quot; and &quot;DOWNLOAD&quot;.   *   * In case the user hasn't specified any directory for the specified   * type the value returned is @fallback.   *   * The return value is newly allocated and must be freed with   * free(). The return value is never NULL if @fallback != NULL  unless   * out of memory.   **/  static char *  xdg_user_dir_lookup_with_fallback (const char *type  const char *fallback)  {    FILE *file;    char *home_dir  *config_home  *config_file;    char buffer[512];    char *user_dir;    char *p  *d;    int len;    int relative;        home_dir = getenv (&quot;HOME&quot;);      if (home_dir == NULL)      goto error;      config_home = getenv (&quot;XDG_CONFIG_HOME&quot;);    if (config_home == NULL || config_home[0] == 0)      {        config_file = (char*) malloc (strlen (home_dir) + strlen   (&quot;/.config/user-dirs.dirs&quot;) + 1);        if (config_file == NULL)          goto error;          strcpy (config_file  home_dir);        strcat (config_file  &quot;/.config/user-dirs.dirs&quot;);      }    else      {        config_file = (char*) malloc (strlen (config_home) + strlen (&quot;/user-  dirs.dirs&quot;) + 1);        if (config_file == NULL)          goto error;          strcpy (config_file  config_home);        strcat (config_file  &quot;/user-dirs.dirs&quot;);      }      file = fopen (config_file  &quot;r&quot;);    free (config_file);    if (file == NULL)      goto error;      user_dir = NULL;    while (fgets (buffer  sizeof (buffer)  file))      {        /* Remove newline at end */        len = strlen (buffer);        if (len &gt; 0 &amp;&amp; buffer[len-1] == 'n')  	buffer[len-1] = 0;          Matt Parsons  MSM  CISSP  315-559-3588 Blackberry  817-294-3789 Home office   &quot;Do Good and Fear No Man&quot;    Fort Worth  Texas  A.K.A The Keyboard Cowboy  <a href="mailto:mparsons1980@gmail.com">mailto:mparsons1980@gmail.com</a>  <a href="http://www.parsonsisconsulting.com">http://www.parsonsisconsulting.com</a>  <a href="http://www.o2-ounceopen.com/o2-power-users/">http://www.o2-ounceopen.com/o2-power-users/</a>  <a href="http://www.linkedin.com/in/parsonsconsulting">http://www.linkedin.com/in/parsonsconsulting</a>  <a href="http://parsonsisconsulting.blogspot.com/">http://parsonsisconsulting.blogspot.com/</a>  <a href="http://www.vimeo.com/8939668">http://www.vimeo.com/8939668</a>                              </pre>
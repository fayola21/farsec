<title>Issue 28765 -   chromium -    TCMalloc reports under ThreadSanitizer - Project Hosting on Google Code</title> <pre> <a href="http://build.chromium.org/buildbot/waterfall/builders/Linux%20Tests%20(tsan">http://build.chromium.org/buildbot/waterfall/builders/Linux%20Tests%20(tsan</a>  )/builds/1091/steps/valgrind%20test:%20base/logs/stdio    They look like this:  18:30:39 tsan_analyze.py [ERROR]  ==28428== INFO: T42 has been created by T0 at this point: {{{  ==28428==     #0  clone /lib/tls/i686/cmov/libc-2.7.so  ==28428==     #1  pthread_create@@GLIBC_2.1 /lib/tls/i686/cmov/libpthread-  2.7.so  ==28428==     #2  pthread_create@* /home/chrome-bot/valgrind-  10880/tsan/ts_valgrind_intercepts.c:556  ==28428==     #3  (anonymous namespace)::CreateThread(unsigned int  bool    PlatformThread::Delegate*  unsigned long*) /b/slave/chromium-rel-linux-  valgrind-builder/build/src/base/platform_thread_posix.cc:93  ==28428==     #4  PlatformThread::Create(unsigned int    PlatformThread::Delegate*  unsigned long*) /b/slave/chromium-rel-linux-  valgrind-builder/build/src/base/platform_thread_posix.cc:105  ==28428==     #5  base::SimpleThread::Start() /b/slave/chromium-rel-linux-  valgrind-builder/build/src/base/simple_thread.cc:16  ==28428==     #6  base::DelegateSimpleThreadPool::Start()   /b/slave/chromium-rel-linux-valgrind-  builder/build/src/base/simple_thread.cc:62  ==28428==     #7  SimpleThreadTest_ThreadPool_Test::TestBody()   /b/slave/chromium-rel-linux-valgrind-  builder/build/src/base/simple_thread_unittest.cc:146  ==28428==     #8  testing::Test::Run() /b/slave/chromium-rel-linux-  valgrind-builder/build/src/testing/gtest/src/gtest.cc:2099  ==28428==     #9  testing::internal::TestInfoImpl::Run() /b/slave/chromium-  rel-linux-valgrind-builder/build/src/testing/gtest/src/gtest.cc:2318  ==28428==     #10 testing::TestCase::Run() /b/slave/chromium-rel-linux-  valgrind-builder/build/src/testing/gtest/src/gtest.cc:2426  ==28428==     #11 testing::internal::UnitTestImpl::RunAllTests()   /b/slave/chromium-rel-linux-valgrind-  builder/build/src/testing/gtest/src/gtest.cc:4026  ==28428==     #12 testing::UnitTest::Run() /b/slave/chromium-rel-linux-  valgrind-builder/build/src/testing/gtest/src/gtest.cc:3694  ==28428==     #13 TestSuite::Run() /b/slave/chromium-rel-linux-valgrind-  builder/build/src/base/test/test_suite.h:123  ==28428==     #14 main /b/slave/chromium-rel-linux-valgrind-  builder/build/src/base/test/run_all_unittests.cc:10  ==28428== }}}  ==28428== INFO: T43 has been created by T0 at this point: {{{  ==28428==     #0  clone /lib/tls/i686/cmov/libc-2.7.so  ==28428==     #1  pthread_create@@GLIBC_2.1 /lib/tls/i686/cmov/libpthread-  2.7.so  ==28428==     #2  pthread_create@* /home/chrome-bot/valgrind-  10880/tsan/ts_valgrind_intercepts.c:556  ==28428==     #3  (anonymous namespace)::CreateThread(unsigned int  bool    PlatformThread::Delegate*  unsigned long*) /b/slave/chromium-rel-linux-  valgrind-builder/build/src/base/platform_thread_posix.cc:93  ==28428==     #4  PlatformThread::Create(unsigned int    PlatformThread::Delegate*  unsigned long*) /b/slave/chromium-rel-linux-  valgrind-builder/build/src/base/platform_thread_posix.cc:105  ==28428==     #5  base::SimpleThread::Start() /b/slave/chromium-rel-linux-  valgrind-builder/build/src/base/simple_thread.cc:16  ==28428==     #6  base::DelegateSimpleThreadPool::Start()   /b/slave/chromium-rel-linux-valgrind-  builder/build/src/base/simple_thread.cc:62  ==28428==     #7  SimpleThreadTest_ThreadPool_Test::TestBody()   /b/slave/chromium-rel-linux-valgrind-  builder/build/src/base/simple_thread_unittest.cc:146  ==28428==     #8  testing::Test::Run() /b/slave/chromium-rel-linux-  valgrind-builder/build/src/testing/gtest/src/gtest.cc:2099  ==28428==     #9  testing::internal::TestInfoImpl::Run() /b/slave/chromium-  rel-linux-valgrind-builder/build/src/testing/gtest/src/gtest.cc:2318  ==28428==     #10 testing::TestCase::Run() /b/slave/chromium-rel-linux-  valgrind-builder/build/src/testing/gtest/src/gtest.cc:2426  ==28428==     #11 testing::internal::UnitTestImpl::RunAllTests()   /b/slave/chromium-rel-linux-valgrind-  builder/build/src/testing/gtest/src/gtest.cc:4026  ==28428==     #12 testing::UnitTest::Run() /b/slave/chromium-rel-linux-  valgrind-builder/build/src/testing/gtest/src/gtest.cc:3694  ==28428==     #13 TestSuite::Run() /b/slave/chromium-rel-linux-valgrind-  builder/build/src/base/test/test_suite.h:123  ==28428==     #14 main /b/slave/chromium-rel-linux-valgrind-  builder/build/src/base/test/run_all_unittests.cc:10  ==28428== }}}  ==28428== WARNING: Possible data race during read of size 4 at 0x8DC9204:   {{{  ==28428==    T42 (locks held: {}):  ==28428==     #0    tcmalloc::ThreadCache::DeleteCache(tcmalloc::ThreadCache*)   /b/slave/chromium-rel-linux-valgrind-  builder/build/src/third_party/tcmalloc/tcmalloc/src/thread_cache.cc:434  ==28428==     #1  tcmalloc::ThreadCache::DestroyThreadCache(void*)   /b/slave/chromium-rel-linux-valgrind-  builder/build/src/third_party/tcmalloc/tcmalloc/src/thread_cache.cc:425  ==28428==     #2  __nptl_deallocate_tsd /lib/tls/i686/cmov/libpthread-  2.7.so  ==28428==     #3  start_thread /lib/tls/i686/cmov/libpthread-2.7.so  ==28428==   Concurrent write(s) happened at (OR AFTER) these points:  ==28428==    T43 (locks held: {}):  ==28428==     #0    tcmalloc::ThreadCache::DeleteCache(tcmalloc::ThreadCache*)   /b/slave/chromium-rel-linux-valgrind-  builder/build/src/third_party/tcmalloc/tcmalloc/src/thread_cache.cc:434  ==28428==     #1  tcmalloc::ThreadCache::DestroyThreadCache(void*)   /b/slave/chromium-rel-linux-valgrind-  builder/build/src/third_party/tcmalloc/tcmalloc/src/thread_cache.cc:425  ==28428==     #2  __nptl_deallocate_tsd /lib/tls/i686/cmov/libpthread-  2.7.so  ==28428==     #3  start_thread /lib/tls/i686/cmov/libpthread-2.7.so  ==28428== }}} </pre>
<title>Issue 42880 -   chromium -    Leak in ExtensionMessageService on Mac - Project Hosting on Google Code</title> <pre> <a href="http://build.chromium.org/buildbot/memory/builders/Chromium%20Mac%20UI%20(v">http://build.chromium.org/buildbot/memory/builders/Chromium%20Mac%20UI%20(v</a>  algrind)(2)/builds/2781/steps/valgrind%20test:%20ui/logs/stdio    14:57:03 memcheck_analyze.py [ERROR] FAIL! There were 1 errors:   14:58:29 memcheck_analyze.py [ERROR] Leak_DefinitelyLost  Command: /b/slave/chromium-rel-mac-valgrind-ui-  2/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromium --no-  first-run --no-default-browser-check --test-type=ui --enable-file-cookies -  -testing-channel=ChromeTestingInterface:49425.28 --noerrdialogs --  homepage=about:blank --disable-web-resources --user-data-  dir=/private/var/folders/Tf/TfOs8gm+HkuQrkICa3LquE+++TM/-Tmp-  /org.chromium.4h4f3B/test_user_data --metrics-recording-only --enable-  logging --test-name=NPAPITester.FLAKY_Arguments --allow-file-access-from-  files  756 (44 direct  712 indirect) bytes in 1 blocks are definitely lost in loss   record 5 873 of 6 168    operator new(unsigned long) (mp/vg-bins/scripts/valgrind-  memcheck/coregrind/m_replacemalloc/vg_replace_malloc.c:276)      __gnu_cxx::new_allocator&lt;std::_Rb_tree_node&lt;std::pair&lt;std::basic_string&lt;cha  r  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; const  std::set&lt;int    std::less&lt;int&gt;  std::allocator&lt;int&gt; &gt; &gt; &gt; &gt;::allocate(unsigned long  void   const*) (ext/new_allocator.h:88)    std::_Rb_tree&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt;  std::pair&lt;std::basic_string&lt;char    std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; const  std::set&lt;int    std::less&lt;int&gt;  std::allocator&lt;int&gt; &gt; &gt;    std::_Select1st&lt;std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;    std::allocator&lt;int&gt; &gt; &gt; &gt;  std::less&lt;std::basic_string&lt;char    std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; &gt;    std::allocator&lt;std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;    std::allocator&lt;int&gt; &gt; &gt; &gt; &gt;::_M_get_node() (stl_tree.h:356)    std::_Rb_tree&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt;  std::pair&lt;std::basic_string&lt;char    std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; const  std::set&lt;int    std::less&lt;int&gt;  std::allocator&lt;int&gt; &gt; &gt;    std::_Select1st&lt;std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;    std::allocator&lt;int&gt; &gt; &gt; &gt;  std::less&lt;std::basic_string&lt;char    std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; &gt;    std::allocator&lt;std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;    std::allocator&lt;int&gt; &gt; &gt; &gt;   &gt;::_M_create_node(std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;    std::allocator&lt;int&gt; &gt; &gt; const&amp;) (stl_tree.h:365)    std::_Rb_tree&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt;  std::pair&lt;std::basic_string&lt;char    std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; const  std::set&lt;int    std::less&lt;int&gt;  std::allocator&lt;int&gt; &gt; &gt;    std::_Select1st&lt;std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;    std::allocator&lt;int&gt; &gt; &gt; &gt;  std::less&lt;std::basic_string&lt;char    std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; &gt;    std::allocator&lt;std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;    std::allocator&lt;int&gt; &gt; &gt; &gt; &gt;::_M_insert(std::_Rb_tree_node_base*    std::_Rb_tree_node_base*  std::pair&lt;std::basic_string&lt;char    std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; const  std::set&lt;int    std::less&lt;int&gt;  std::allocator&lt;int&gt; &gt; &gt; const&amp;) (stl_tree.h:789)    std::_Rb_tree&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt;  std::pair&lt;std::basic_string&lt;char    std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; const  std::set&lt;int    std::less&lt;int&gt;  std::allocator&lt;int&gt; &gt; &gt;    std::_Select1st&lt;std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;    std::allocator&lt;int&gt; &gt; &gt; &gt;  std::less&lt;std::basic_string&lt;char    std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; &gt;    std::allocator&lt;std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;    std::allocator&lt;int&gt; &gt; &gt; &gt;   &gt;::insert_unique(std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;    std::allocator&lt;int&gt; &gt; &gt; const&amp;) (stl_tree.h:887)    std::_Rb_tree&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt;  std::pair&lt;std::basic_string&lt;char    std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; const  std::set&lt;int    std::less&lt;int&gt;  std::allocator&lt;int&gt; &gt; &gt;    std::_Select1st&lt;std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;    std::allocator&lt;int&gt; &gt; &gt; &gt;  std::less&lt;std::basic_string&lt;char    std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; &gt;    std::allocator&lt;std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;    std::allocator&lt;int&gt; &gt; &gt; &gt;   &gt;::insert_unique(std::_Rb_tree_iterator&lt;std::pair&lt;std::basic_string&lt;char    std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; const  std::set&lt;int    std::less&lt;int&gt;  std::allocator&lt;int&gt; &gt; &gt; &gt;    std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;    std::allocator&lt;int&gt; &gt; &gt; const&amp;) (stl_tree.h:923)    std::map&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt;  std::set&lt;int  std::less&lt;int&gt;  std::allocator&lt;int&gt;   &gt;  std::less&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; &gt;  std::allocator&lt;std::pair&lt;std::basic_string&lt;char    std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; const  std::set&lt;int    std::less&lt;int&gt;  std::allocator&lt;int&gt; &gt; &gt; &gt;   &gt;::insert(std::_Rb_tree_iterator&lt;std::pair&lt;std::basic_string&lt;char    std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; const  std::set&lt;int    std::less&lt;int&gt;  std::allocator&lt;int&gt; &gt; &gt; &gt;    std::pair&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const  std::set&lt;int  std::less&lt;int&gt;    std::allocator&lt;int&gt; &gt; &gt; const&amp;) (stl_map.h:384)    std::map&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt;  std::set&lt;int  std::less&lt;int&gt;  std::allocator&lt;int&gt;   &gt;  std::less&lt;std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; &gt;  std::allocator&lt;std::pair&lt;std::basic_string&lt;char    std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; const  std::set&lt;int    std::less&lt;int&gt;  std::allocator&lt;int&gt; &gt; &gt; &gt;   &gt;::operator[](std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const&amp;) (stl_map.h:339)    ExtensionMessageService::DispatchEventToRenderers(std::basic_string&lt;char    std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; const&amp;    std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt;   const&amp;  bool  GURL const&amp;) (extension_message_service.cc:464)    DispatchEvent(Profile*  char const*  std::basic_string&lt;char    std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt;)   (extension_browser_event_router.cc:92)    ExtensionBrowserEventRouter::TabClosingAt(TabContents*  int)   (extension_browser_event_router.cc:284)    TabStripModel::InternalCloseTab(TabContents*  int  bool)   (tab_strip_model.cc:806)    TabStripModel::InternalCloseTabs(std::vector&lt;int  std::allocator&lt;int&gt; &gt;    bool) (tab_strip_model.cc:797)    TabStripModel::CloseAllTabs() (tab_strip_model.cc:257)    Browser::CloseAllTabs() (browser.h:318)    Browser::OnWindowClosing() (browser.cc:721)    -[BrowserWindowController windowShouldClose:]   (browser_window_controller.mm:426)    -[NSWindow _document:shouldClose:contextInfo:]    -[NSWindow __close]    -[NSWindow _close:]    -[NSApplication sendAction:to:from:]    -[BrowserCrApplication sendAction:to:from:]   (chrome_browser_application_mac.mm:290)    -[NSControl sendAction:to:]    -[NSCell _sendActionFrom:]    -[NSButtonCell performClick:]    BrowserWindowCocoa::Close() (browser_window_cocoa.mm:96)    Browser::CloseWindow() (browser.cc:1100)    Browser::ExecuteCommandWithDisposition(int  WindowOpenDisposition)   (browser.cc:1773)    Browser::ExecuteCommand(int) (browser.cc:1938)  Suppression:  {     &lt;insert_a_suppression_name_here&gt;     Memcheck:Leak     fun:_Znw*       fun:_ZN9__gnu_cxx13new_allocatorISt13_Rb_tree_nodeISt4pairIKSsSt3setIiSt4le  ssIiESaIiEEEEE8allocateEmPKv       fun:_ZNSt8_Rb_treeISsSt4pairIKSsSt3setIiSt4lessIiESaIiEEESt10_Select1stIS7_  ES3_ISsESaIS7_EE11_M_get_nodeEv       fun:_ZNSt8_Rb_treeISsSt4pairIKSsSt3setIiSt4lessIiESaIiEEESt10_Select1stIS7_  ES3_ISsESaIS7_EE14_M_create_nodeERKS7_       fun:_ZNSt8_Rb_treeISsSt4pairIKSsSt3setIiSt4lessIiESaIiEEESt10_Select1stIS7_  ES3_ISsESaIS7_EE9_M_insertEPSt18_Rb_tree_node_baseSE_RKS7_       fun:_ZNSt8_Rb_treeISsSt4pairIKSsSt3setIiSt4lessIiESaIiEEESt10_Select1stIS7_  ES3_ISsESaIS7_EE13insert_uniqueERKS7_       fun:_ZNSt8_Rb_treeISsSt4pairIKSsSt3setIiSt4lessIiESaIiEEESt10_Select1stIS7_  ES3_ISsESaIS7_EE13insert_uniqueESt17_Rb_tree_iteratorIS7_ERKS7_       fun:_ZNSt3mapISsSt3setIiSt4lessIiESaIiEES1_ISsESaISt4pairIKSsS4_EEE6insertE  St17_Rb_tree_iteratorIS8_ERKS8_       fun:_ZNSt3mapISsSt3setIiSt4lessIiESaIiEES1_ISsESaISt4pairIKSsS4_EEEixERS7_       fun:_ZN23ExtensionMessageService24DispatchEventToRenderersERKSsS1_bRK4GURL     fun:_ZL13DispatchEventP7ProfilePKcSs     fun:_ZN27ExtensionBrowserEventRouter12TabClosingAtEP11TabContentsi     fun:_ZN13TabStripModel16InternalCloseTabEP11TabContentsib     fun:_ZN13TabStripModel17InternalCloseTabsESt6vectorIiSaIiEEb     fun:_ZN13TabStripModel12CloseAllTabsEv     fun:_ZN7Browser12CloseAllTabsEv     fun:_ZN7Browser15OnWindowClosingEv     fun:-[BrowserWindowController windowShouldClose:]     fun:-[NSWindow _document:shouldClose:contextInfo:]     fun:-[NSWindow __close]     fun:-[NSWindow _close:]     fun:-[NSApplication sendAction:to:from:]  }   </pre>
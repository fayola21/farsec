<title>Issue 44463 -   chromium -    ChromeFrame: crash in third party DLLs due to firing WebBrowser Events out of order - Project Hosting on Google Code</title> <pre> Product: ChromeFrame  Stack Signature: NDRCContextBinding-1EFA51  New Signature Label: NDRCContextBinding  New Signature Hash: a12e7ce0_6e1b77a0_b93c702b_b32820e9_06cf5315    Report link: http://go/crash/reportdetail?reportid=4a08b9d231a049a0    Meta information:  Product Name: ChromeFrame  Product Version: 5.0.375.49  Report ID: 4a08b9d231a049a0  Report Time: 2010/05/18 13:27:55  Tue  Uptime: 4 sec  Cumulative Uptime: 0 sec  OS Name: Windows NT  OS Version: 6.1.7100   CPU Architecture: x86  CPU Info: GenuineIntel family 6 model 15 stepping 11    Stack Trace:    Thread 0  0x778f8244 [ntdll.dll] +0x00048244 KiFastSystemCallRet  0x778f7bbb [ntdll.dll] +0x00047bbb ZwWaitForMultipleObjects  0x75c86877 [KERNELBASE.dll] +0x00006877 GetCurrentProcess  0x7602f089 [kernel32.dll] +0x0004f089 WaitForMultipleObjectsExImplementation  0x75f266a7 [user32.dll] +0x000166a7 RealMsgWaitForMultipleObjectsEx  0x76250d24 [iertutil.dll] +0x00160d24 CIsoMalloc::GetNextArtifact(_IsoEnumeration unsigned   char void * unsigned long * _IsoArtifact * *)  0x76254886 [iertutil.dll] +0x00164886 IsoManagerThreadZero_WindowsPump(bool)  0x66985212 [ieframe.dll] +0x00115212 LCIEStartAsTabProcess(unsigned short * int)  0x00e01326 [iexplore.exe] +0x00001326   0x00e0129d [iexplore.exe] +0x0000129d   0x760310db [kernel32.dll] +0x000510db BaseThreadInitThunk  0x77911e9d [ntdll.dll] +0x00061e9d __RtlUserThreadStart  0x77911e70 [ntdll.dll] +0x00061e70 _RtlUserThreadStart      Thread 3  0x778f8244 [ntdll.dll] +0x00048244 KiFastSystemCallRet  0x778f7bbb [ntdll.dll] +0x00047bbb ZwWaitForMultipleObjects  0x75c86877 [KERNELBASE.dll] +0x00006877 GetCurrentProcess  0x7602f089 [kernel32.dll] +0x0004f089 WaitForMultipleObjectsExImplementation  0x7602f209 [kernel32.dll] +0x0004f209 WaitForMultipleObjects  0x7624ffc5 [iertutil.dll] +0x0015ffc5   CForeignProcessToCurrentProcessMessaging::_vThreadProc()  0x7625480d [iertutil.dll] +0x0016480d   CForeignProcessToCurrentProcessMessaging::_sThreadProc(void *)  0x760310db [kernel32.dll] +0x000510db BaseThreadInitThunk  0x77911e9d [ntdll.dll] +0x00061e9d __RtlUserThreadStart  0x77911e70 [ntdll.dll] +0x00061e70 _RtlUserThreadStart    Thread 4  0x778f8244 [ntdll.dll] +0x00048244 KiFastSystemCallRet  0x778f7bbb [ntdll.dll] +0x00047bbb ZwWaitForMultipleObjects  0x75c86877 [KERNELBASE.dll] +0x00006877 GetCurrentProcess  0x7602f089 [kernel32.dll] +0x0004f089 WaitForMultipleObjectsExImplementation  0x75f266a7 [user32.dll] +0x000166a7 RealMsgWaitForMultipleObjectsEx  0x76250d24 [iertutil.dll] +0x00160d24 CIsoMalloc::GetNextArtifact(_IsoEnumeration unsigned   char void * unsigned long * _IsoArtifact * *)  0x762547b8 [iertutil.dll] +0x001647b8 IsoManagerThreadNonzero_WindowsPump(void *)  0x760310db [kernel32.dll] +0x000510db BaseThreadInitThunk  0x77911e9d [ntdll.dll] +0x00061e9d __RtlUserThreadStart  0x77911e70 [ntdll.dll] +0x00061e70 _RtlUserThreadStart    Thread 5 *CRASHED*  0x77570076 [rpcrt4.dll] +0x00040076 NDRCContextBinding  0x77570050 [rpcrt4.dll] +0x00040050 NDR_MINICOMPUTE_QUEUE::EndContextIfNecessary()  0x775c6817 [rpcrt4.dll] +0x00096817 NdrClientCall2  0x771bf714 [advapi32.dll] +0x0005f714 BaseRegCloseKey  0x76059a60 [kernel32.dll] +0x00079a60 zzz_AsmCodeRange_End  0x6debf5c3 [IEShims.dll] +0x0001f5c3 NS_RedirectRegistry::APIHook_RegCloseKey(HKEY__ *)  0x10011563 [askBar.dll] +0x00011563   0x10011623 [askBar.dll] +0x00011623   0x100188ec [askBar.dll] +0x000188ec   0x10019ca3 [askBar.dll] +0x00019ca3   0x1001946d [askBar.dll] +0x0001946d   0x10014a35 [askBar.dll] +0x00014a35   0x100030fe [askBar.dll] +0x000030fe   0x1000e5f6 [askBar.dll] +0x0000e5f6   0x1000758b [askBar.dll] +0x0000758b   0x100074f6 [askBar.dll] +0x000074f6   0x6694cf35 [ieframe.dll] +0x000dcf35 EnumInvokeCallback(IUnknown * long)  0x66993a01 [ieframe.dll] +0x00123a01 EnumConnectionPointSinks(IConnectionPoint * _GUID   const * _GUID const * long (*)(IUnknown * long) long)  0x66993986 [ieframe.dll] +0x00123986 IConnectionPoint_InvokeIndirect  0x66993ce5 [ieframe.dll] +0x00123ce5 IConnectionPoint_InvokeWithCancel  0x66993c93 [ieframe.dll] +0x00123c93 DoInvokeParamHelper(IUnknown * IConnectionPoint * int   * void * * long unsigned int ...)  0x66994347 [ieframe.dll] +0x00124347 FireEvent_DocumentComplete  0x6693f751 [ieframe.dll] +0x000cf751   CBaseBrowser2::_FireDocumentComplete(_ITEMIDLIST_ABSOLUTE * IHTMLWindow2 * unsigned long)  0x66a729a2 [ieframe.dll] +0x002029a2 CBaseBrowser2::FireDocumentCompleteEvent()  0x6476d017 [npchrome_frame.dll] - chrome_active_document.cc:734   ChromeActiveDocument::UpdateNavigationState(IPC::NavigationInfo const &amp;)  0x6476cc30 [npchrome_frame.dll] - chrome_active_document.cc:567   ChromeActiveDocument::OnNavigationStateChanged(int int IPC::NavigationInfo const &amp;)  0x64763b4e [npchrome_frame.dll] - ipc_message_utils.h:991   IPC::MessageWithTuple&lt;Tuple3&lt;int int IPC::NavigationInfo&gt;   &gt;::Dispatch&lt;ChromeFrameDelegateImpl void (   ChromeFrameDelegateImpl::*)(int int IPC::NavigationInfo const &amp;)&gt;(IPC::Message const   * ChromeFrameDelegateImpl * void ( ChromeFrameDelegateImpl::*)(int int IPC::NavigationInfo   const &amp;))  0x6476398d [npchrome_frame.dll] - chrome_frame_delegate.cc:51   ChromeFrameDelegateImpl::OnMessageReceived(IPC::Message const &amp;)  0x64789e3e [npchrome_frame.dll] - task.h:296   RunnableMethod&lt;ChromeFrameAutomationClient void (   ChromeFrameAutomationClient::*)(IPC::Message const &amp;) Tuple1&lt;IPC::Message&gt; &gt;::Run()  0x6476135a [npchrome_frame.dll] - chrome_frame_delegate.h:185   TaskMarshallerThroughWindowsMessages&lt;ChromeFrameAutomationClient&gt;::ExecuteTask(unsigned   int unsigned int long int &amp;)  0x6475e658 [npchrome_frame.dll] - chrome_frame_automation.h:209   ChromeFrameAutomationClient::ProcessWindowMessage(HWND__ * unsigned int unsigned   int long long &amp; unsigned long)  0x6473f141 [npchrome_frame.dll] - atlwin.h:3081   ATL::CWindowImplBaseT&lt;ATL::CWindow ATL::CWinTraits&lt;1442840576 0&gt; &gt;::WindowProc(HWND__   * unsigned int unsigned int long)  0x75f2c6c1 [user32.dll] +0x0001c6c1 InternalCallWinProc  0x75f2c799 [user32.dll] +0x0001c799 UserCallWinProcCheckWow  0x75f2cdc8 [user32.dll] +0x0001cdc8 DispatchMessageWorker  0x75f2ce9c [user32.dll] +0x0001ce9c DispatchMessageW  0x66948fe7 [ieframe.dll] +0x000d8fe7 _TraceTabThreadPerfAction(tagMSG const *)  0x6697ebc3 [ieframe.dll] +0x0010ebc3 LCIETab_ThreadProc(void *)  0x762546f4 [iertutil.dll] +0x001646f4 CIsoScope::SubscriptionManager()  0x760310db [kernel32.dll] +0x000510db BaseThreadInitThunk  0x77911e9d [ntdll.dll] +0x00061e9d __RtlUserThreadStart  0x77911e70 [ntdll.dll] +0x00061e70 _RtlUserThreadStart      Thread 31  0x778f8244 [ntdll.dll] +0x00048244 KiFastSystemCallRet  0x778f755b [ntdll.dll] +0x0004755b ZwRemoveIoCompletion  0x75c8f698 [KERNELBASE.dll] +0x0000f698 GetQueuedCompletionStatus  0x64cc9a59 [GoogleToolbarDynamic_32_78F32466E61F1EEC.dll] - thread_pool.cc:279   ThreadPool::ThreadProc(int)  0x64c2b637 [GoogleToolbarDynamic_32_78F32466E61F1EEC.dll] - async_job.h:478   AsyncJobWithParams&lt;void TypeList&lt;long NullType&gt; ParamTuple1&lt;void * long&gt; &gt;::Run()  0x64cc8acc [GoogleToolbarDynamic_32_78F32466E61F1EEC.dll] - thread_pool.cc:42   ThreadPool::InternalThread::ThreadMain()  0x64bd3592 [GoogleToolbarDynamic_32_78F32466E61F1EEC.dll] - thread.h:78   ThreadBase::fnWrapper(void *)  0x64d0b855 [GoogleToolbarDynamic_32_78F32466E61F1EEC.dll] - threadex.c:348   _callthreadstartex  0x64d0b8fa [GoogleToolbarDynamic_32_78F32466E61F1EEC.dll] - threadex.c:326 _threadstartex  0x760310db [kernel32.dll] +0x000510db BaseThreadInitThunk  0x77911e9d [ntdll.dll] +0x00061e9d __RtlUserThreadStart  0x77911e70 [ntdll.dll] +0x00061e70 _RtlUserThreadStart      Thread 41  0x778f8244 [ntdll.dll] +0x00048244 KiFastSystemCallRet  0x778f7bdb [ntdll.dll] +0x00047bdb NtWaitForSingleObject  0x75c8179b [KERNELBASE.dll] +0x0000179b WaitForSingleObjectEx  0x7602ef62 [kernel32.dll] +0x0004ef62 WaitForSingleObjectExImplementation  0x7602ef11 [kernel32.dll] +0x0004ef11 WaitForSingleObject  0x647854e5 [npchrome_frame.dll] - waitable_event_win.cc:63   base::WaitableEvent::TimedWait(base::TimeDelta const &amp;)  0x6478890b [npchrome_frame.dll] - message_pump_default.cc:46   base::MessagePumpDefault::Run(base::MessagePump::Delegate *)  0x6478437e [npchrome_frame.dll] - message_loop.cc:205 MessageLoop::RunInternal()  0x64784303 [npchrome_frame.dll] - message_loop.cc:177 MessageLoop::RunHandler()  0x647842de [npchrome_frame.dll] - message_loop.cc:155 MessageLoop::Run()  0x647857d6 [npchrome_frame.dll] - thread.cc:133 base::Thread::Run(MessageLoop *)  0x64785853 [npchrome_frame.dll] - thread.cc:156 base::Thread::ThreadMain()  0x64748112 [npchrome_frame.dll] - platform_thread_win.cc:26 `anonymous   namespace'::ThreadFunc(void *)  0x760310db [kernel32.dll] +0x000510db BaseThreadInitThunk  0x77911e9d [ntdll.dll] +0x00061e9d __RtlUserThreadStart  0x77911e70 [ntdll.dll] +0x00061e70 _RtlUserThreadStart   </pre>
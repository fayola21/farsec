<title>Issue 24203 -   chromium -    [GKURL] setQuery() does not work on non-standard URLs - Project Hosting on Google Code</title> <pre> ( Migrating from http://buganizer/issue?id=1089231 ).    ericroman on March 26 2008 17:34  (New)  Summary     [GKURL] setQuery() does not work on non-standard URLs  Component     Chrome &gt; Deprecated &gt; Compatibility  Reporter     ericroman  CC     brettw  chrome-bugs  Type     Feature request  Priority     P2  Severity     S2  In prod     false  Notes  When posting forms  WebCore uses KURL.setQuery() to append the GET  parameters to the URL.  In GKURL this has no effect on non-standard URLs.  The end result is no GET parameters are appended to the URL.    WebKit's layout tests include some of the following non-standard form  action urls:      about:blank    <a href="mailto:foo@foo.com">mailto:foo@foo.com</a>    data:text/html &lt;script&gt;if (window.layoutTestController)  layoutTestController.notifyDone();&lt;/script&gt;PASS&lt;br&gt;    ***note on data:urls**    By far the weirdest one is data:url  since blindly appending  ?var1=val1&amp;var2=val2... really doesn't have any meaning.  However  it looks like both Safari and Firefox do this.  In fact  in what looks like a bug  both Safari and Firefox will do wonky  stuff if you have a question mark already in the data:url (i.e. it is  probably just scanning for the first question mark  and considering that  the start of the &quot;query&quot;)    This difference accounts for the following layout test failures:    V8 | KJS #  LayoutTestshttptestsnavigationonload-navigation-iframe-timeout.html = FAIL  V8 | KJS # LayoutTestshttptestsnavigationonload-navigation-iframe.html  = FAIL  V8 | KJS # LayoutTestsfasteventsstopPropagation-submit.html = FAIL  V8 | KJS # LayoutTestsfastformsmailtoadvanced-get.html = FAIL  V8 | KJS # LayoutTestsfastformsmailtoadvanced-put.html = FAIL  V8 | KJS # LayoutTestsfastformsmailtoget-multiple-items-text-plain.html  = FAIL  V8 | KJS #  LayoutTestsfastformsmailtoget-multiple-items-x-www-form-urlencoded.html  = FAIL  V8 | KJS # LayoutTestsfastformsmailtoget-multiple-items.html = FAIL  V8 | KJS # LayoutTestsfastformsmailtoget-non-ascii-text-plain.html = FAIL  V8 | KJS # LayoutTestsfastformsmailtoget-non-ascii.html = FAIL  V8 | KJS # LayoutTestsfastformsmailtoget-overwrite-query.html = FAIL  V8 | KJS # LayoutTestsfastformsmailtopost-append-query.html = FAIL  V8 | KJS #  LayoutTestsfastformsmailtopost-multiple-items-multipart-form-data.html  = FAIL  V8 | KJS #  LayoutTestsfastformsmailtopost-multiple-items-text-plain.html = FAIL  V8 | KJS #  LayoutTestsfastformsmailtopost-multiple-items-x-www-form-urlencoded.html =  FAIL  V8 | KJS # LayoutTestsfastformsmailtopost-multiple-items.html = FAIL  ericroman on March 26 2008 17:37  (New)  CC     brettw  chrome-bugs  ojan  Notes  1027218 has been marked a duplicate of this issue  mal on March 27 2008 16:14  (New)  Component     Chrome &gt; Deprecated &gt; WebKit  Hotlist     Cr__Rel_1.0  mal on March 27 2008 16:14  (New)  Depends on     771509  brettw on April 01 2008 10:36  (New)  Notes  What does IE do for setQuery on data URLs? This behavior sounds very wrong  to me  and I would be resistant to adding it if there is not requirement  for web compatibility.    We will need to do this for mailto URLs  though.  ojan on April 01 2008 11:43  (New)  CC     brettw  chrome-bugs  ianh  ojan  Notes  Does IE support data URLs? I thought not.    It does just seem totally broken to have query params for data URLs. I  tried finding documentation about data URLs in HTML5 and couldn't. Hixie   is this spec'ed anywhere you know of? I saw HTML5 mentions data URLs all  over the place  but doesn't actually define them anywhere.    That said  the data urls are jsut two of the failing tests. The mailto bug  we can go ahead and fix.  brettw on April 01 2008 11:49  (New)  Notes  javascript URLs should be handled the same as data URLs would be in this case.  ojan on April 01 2008 13:30  (New)  Notes  So  according to <a href="http://tools.ietf.org/html/rfc2397">http://tools.ietf.org/html/rfc2397</a>  for data: urls  if  there are parameters  they should be placed as part of the mediatype  (unless I'm reading it incorrectly). I think we should the data: and  javascript: bugs upstream to webkit and let them hash it out.  mal on April 10 2008 15:40  (Assigned)  Assignee     ericroman  Type     Bug  Priority     P1  Notes  Looks like this would fix a bunch of layout tests  so we should fix it (at  least mailto: sooner (P1).    I don't think Brett will get to this  given his plate so I'm assigning to Eric.  pamg on April 11 2008 17:59  (Assigned)  Notes  For    LayoutTestsfastformsmailtoget-overwrite-query.html    also note that the query should replace an existing value  and the @ in the  query parameters should be escaped.  chromedashboard-buganizer on April 21 2008 02:15  (Assigned)  URLs affected     <a href="http://tools.ietf.org/html/rfc2397">http://tools.ietf.org/html/rfc2397</a>  eseidel on April 28 2008 17:18  (Assigned)  Notes  If you're not hacking on this one  I'll see if I can't fix it tomorrow and  send you a patch.  Assign it to me if that's the case.  ericroman on April 28 2008 20:18  (Accepted)  URLs affected     &lt;none&gt;  Notes  eseidel: i'll give this one a stab tonight. sorry for being delinquent on it.  ericroman on May 06 2008 11:25  (Fixed / Fixed)  Notes  specifically addressed the mailto: case in googleurl 76.  ericroman on May 07 2008 13:55  (Fixed / Fixed)  Notes  filed: <a href="https://bugs.webkit.org/show_bug.cgi?id=18929">https://bugs.webkit.org/show_bug.cgi?id=18929</a>    since I don't think it makes sense to support this for non-standard urls  other than mailto.  i.e. doing this is non-nonsensical for data:urls.  laforge on October 28 2008 12:38  (Verified / Fixed)  Verifier     laforge  Notes  Cleanup operation  batch updating old 'FIXED' issues to 'VERIFIED' that  have not been modified since 9/2/08.  	  Status 	Verified  Resolution 	Fixed     Reporter 	ericroman  Assignee 	ericroman  Verifier 	laforge  CC 	brettw  chrome-bugs  ianh  ojan     Type 	Bug  Priority 	P1  Severity 	S2     Depends on 	771509  1155751  Blocking 	     Changelists 	     Found in 	  Targeted to 	  Verified in 	  In prod 	false     Hotlists 	  Cr__Rel_1.0  Email: 	buganizer-system+20506+1089231@google.com   </pre>
<title>Issue 27993 -   chromium -    Leaks in AppCacheDispatcherHost and ChromeAppCacheService - Project Hosting on Google Code</title> <pre> From   <a href="http://build.chromium.org/buildbot/waterfall/builders/Chromium%20Mac%20UI%2">http://build.chromium.org/buildbot/waterfall/builders/Chromium%20Mac%20UI%2</a>  0(valgrind)(1)/builds/602/steps/valgrind%20test:%20ui/logs/stdio    09:02:20 memcheck_analyze.py [ERROR] FAIL! There were 6 errors:  09:04:03 memcheck_analyze.py [ERROR] Leak_DefinitelyLost  Command: /b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromium --no-  first-run --no-default-browser-check --enable-file-cookies --testing-  channel=ChromeTestingInterface:92437.7 --homepage=about:blank --disable-  web-resources --user-data-dir=/private/var/folders/yo/yotGBOBoH+ijr5HR-  DAtvk+++TM/-Tmp-/org.chromium.0yCLDO/test_user_data --metrics-recording-  only --enable-logging --test-name=RedirectTest.ServerReference  16 bytes in 1 blocks are definitely lost in loss record 1 926 of 10 268    operator new(unsigned long) (sers/chrome-bot/valgrind-10880-  redzone/coregrind/m_replacemalloc/vg_replace_malloc.c:220)    Callback2&lt;bool  void*&gt;::Type* NewCallback&lt;AppCacheDispatcherHost  bool    void*&gt;(AppCacheDispatcherHost*  void (AppCacheDispatcherHost::*)(bool    void*)) (task.h:586)    AppCacheDispatcherHost::Initialize(IPC::Message::Sender*  int  int)   (appcache_dispatcher_host.cc:38)    ResourceMessageFilter::OnChannelConnected(int)   (resource_message_filter.cc:239)    IPC::ChannelProxy::Context::OnChannelConnected(int)   (ipc_channel_proxy.cc:97)    IPC::Channel::ChannelImpl::ProcessIncomingMessages()   (ipc_channel_posix.cc:660)    IPC::Channel::ChannelImpl::OnFileCanReadWithoutBlocking(int)   (ipc_channel_posix.cc:910)    base::MessagePumpLibevent::OnLibeventNotification(int  short  void*)   (message_pump_libevent.cc:214)    event_process_active (/b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/third_party/libevent/event.c:385)    event_base_loop (/b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/third_party/libevent/event.c:522)    base::MessagePumpLibevent::Run(base::MessagePump::Delegate*)   (message_pump_libevent.cc:269)    MessageLoop::RunInternal() (message_loop.cc:205)    MessageLoop::RunHandler() (message_loop.cc:177)    MessageLoop::Run() (message_loop.cc:155)    base::Thread::Run(MessageLoop*) (thread.cc:132)    base::Thread::ThreadMain() (thread.cc:153)    ThreadFunc(void*) (/b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/base/platform_thread_posix.cc:26)    _pthread_start    thread_start    09:04:03 memcheck_analyze.py [ERROR] Leak_DefinitelyLost  Command: /b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromium --no-  first-run --no-default-browser-check --enable-file-cookies --testing-  channel=ChromeTestingInterface:92437.7 --homepage=about:blank --disable-  web-resources --user-data-dir=/private/var/folders/yo/yotGBOBoH+ijr5HR-  DAtvk+++TM/-Tmp-/org.chromium.0yCLDO/test_user_data --metrics-recording-  only --enable-logging --test-name=RedirectTest.ServerReference  16 bytes in 1 blocks are definitely lost in loss record 1 925 of 10 268    operator new(unsigned long) (sers/chrome-bot/valgrind-10880-  redzone/coregrind/m_replacemalloc/vg_replace_malloc.c:220)    Callback2&lt;appcache::Status  void*&gt;::Type*   NewCallback&lt;AppCacheDispatcherHost  appcache::Status    void*&gt;(AppCacheDispatcherHost*  void   (AppCacheDispatcherHost::*)(appcache::Status  void*)) (task.h:586)    AppCacheDispatcherHost::Initialize(IPC::Message::Sender*  int  int)   (appcache_dispatcher_host.cc:36)    ResourceMessageFilter::OnChannelConnected(int)   (resource_message_filter.cc:239)    IPC::ChannelProxy::Context::OnChannelConnected(int)   (ipc_channel_proxy.cc:97)    IPC::Channel::ChannelImpl::ProcessIncomingMessages()   (ipc_channel_posix.cc:660)    IPC::Channel::ChannelImpl::OnFileCanReadWithoutBlocking(int)   (ipc_channel_posix.cc:910)    base::MessagePumpLibevent::OnLibeventNotification(int  short  void*)   (message_pump_libevent.cc:214)    event_process_active (/b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/third_party/libevent/event.c:385)    event_base_loop (/b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/third_party/libevent/event.c:522)    base::MessagePumpLibevent::Run(base::MessagePump::Delegate*)   (message_pump_libevent.cc:269)    MessageLoop::RunInternal() (message_loop.cc:205)    MessageLoop::RunHandler() (message_loop.cc:177)    MessageLoop::Run() (message_loop.cc:155)    base::Thread::Run(MessageLoop*) (thread.cc:132)    base::Thread::ThreadMain() (thread.cc:153)    ThreadFunc(void*) (/b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/base/platform_thread_posix.cc:26)    _pthread_start      thread_start    09:04:03 memcheck_analyze.py [ERROR] Leak_DefinitelyLost  Command: /b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromium --no-  first-run --no-default-browser-check --enable-file-cookies --testing-  channel=ChromeTestingInterface:92437.7 --homepage=about:blank --disable-  web-resources --user-data-dir=/private/var/folders/yo/yotGBOBoH+ijr5HR-  DAtvk+++TM/-Tmp-/org.chromium.0yCLDO/test_user_data --metrics-recording-  only --enable-logging --test-name=RedirectTest.ServerReference  20 bytes in 1 blocks are definitely lost in loss record 2 561 of 10 268    operator new(unsigned long) (sers/chrome-bot/valgrind-10880-  redzone/coregrind/m_replacemalloc/vg_replace_malloc.c:220)    __gnu_cxx::new_allocator&lt;std::_Rb_tree_node&lt;DOMStorageDispatcherHost*&gt;   &gt;::allocate(unsigned long  void const*) (ext/new_allocator.h:88)    std::_Rb_tree&lt;DOMStorageDispatcherHost*  DOMStorageDispatcherHost*    std::_Identity&lt;DOMStorageDispatcherHost*&gt;    std::less&lt;DOMStorageDispatcherHost*&gt;    std::allocator&lt;DOMStorageDispatcherHost*&gt; &gt;::_M_get_node() (stl_tree.h:356)    std::_Rb_tree&lt;DOMStorageDispatcherHost*  DOMStorageDispatcherHost*    std::_Identity&lt;DOMStorageDispatcherHost*&gt;    std::less&lt;DOMStorageDispatcherHost*&gt;    std::allocator&lt;DOMStorageDispatcherHost*&gt;   &gt;::_M_create_node(DOMStorageDispatcherHost* const&amp;) (stl_tree.h:365)    std::_Rb_tree&lt;DOMStorageDispatcherHost*  DOMStorageDispatcherHost*    std::_Identity&lt;DOMStorageDispatcherHost*&gt;    std::less&lt;DOMStorageDispatcherHost*&gt;    std::allocator&lt;DOMStorageDispatcherHost*&gt;   &gt;::_M_insert(std::_Rb_tree_node_base*  std::_Rb_tree_node_base*    DOMStorageDispatcherHost* const&amp;) (stl_tree.h:789)    std::_Rb_tree&lt;DOMStorageDispatcherHost*  DOMStorageDispatcherHost*    std::_Identity&lt;DOMStorageDispatcherHost*&gt;    std::less&lt;DOMStorageDispatcherHost*&gt;    std::allocator&lt;DOMStorageDispatcherHost*&gt;   &gt;::insert_unique(DOMStorageDispatcherHost* const&amp;) (stl_tree.h:883)    std::set&lt;DOMStorageDispatcherHost*  std::less&lt;DOMStorageDispatcherHost*&gt;    std::allocator&lt;DOMStorageDispatcherHost*&gt;   &gt;::insert(DOMStorageDispatcherHost* const&amp;) (stl_set.h:314)    DOMStorageContext::RegisterDispatcherHost(DOMStorageDispatcherHost*)   (dom_storage_context.cc:121)    DOMStorageDispatcherHost::Init(int) (dom_storage_dispatcher_host.cc:61)    ResourceMessageFilter::OnChannelConnected(int)   (resource_message_filter.cc:241)    IPC::ChannelProxy::Context::OnChannelConnected(int)   (ipc_channel_proxy.cc:97)    IPC::Channel::ChannelImpl::ProcessIncomingMessages()   (ipc_channel_posix.cc:660)    IPC::Channel::ChannelImpl::OnFileCanReadWithoutBlocking(int)   (ipc_channel_posix.cc:910)    base::MessagePumpLibevent::OnLibeventNotification(int  short  void*)   (message_pump_libevent.cc:214)    event_process_active (/b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/third_party/libevent/event.c:385)    event_base_loop (/b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/third_party/libevent/event.c:522)    base::MessagePumpLibevent::Run(base::MessagePump::Delegate*)   (message_pump_libevent.cc:269)    MessageLoop::RunInternal() (message_loop.cc:205)    MessageLoop::RunHandler() (message_loop.cc:177)    MessageLoop::Run() (message_loop.cc:155)    base::Thread::Run(MessageLoop*) (thread.cc:132)    base::Thread::ThreadMain() (thread.cc:153)    ThreadFunc(void*) (/b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/base/platform_thread_posix.cc:26)    _pthread_start    thread_start    09:04:03 memcheck_analyze.py [ERROR] Leak_DefinitelyLost  Command: /b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromium --no-  first-run --no-default-browser-check --enable-file-cookies --testing-  channel=ChromeTestingInterface:92437.7 --homepage=about:blank --disable-  web-resources --user-data-dir=/private/var/folders/yo/yotGBOBoH+ijr5HR-  DAtvk+++TM/-Tmp-/org.chromium.0yCLDO/test_user_data --metrics-recording-  only --enable-logging --test-name=RedirectTest.ServerReference  512 bytes in 1 blocks are definitely lost in loss record 9 723 of 10 268    operator new(unsigned long) (sers/chrome-bot/valgrind-10880-  redzone/coregrind/m_replacemalloc/vg_replace_malloc.c:220)    __gnu_cxx::new_allocator&lt;Task*&gt;::allocate(unsigned long  void const*)   (ext/new_allocator.h:88)    std::_Deque_base&lt;Task*  std::allocator&lt;Task*&gt; &gt;::_M_allocate_node()   (stl_deque.h:399)    std::_Deque_base&lt;Task*  std::allocator&lt;Task*&gt; &gt;::_M_create_nodes(Task***    Task***) (stl_deque.h:492)    std::_Deque_base&lt;Task*  std::allocator&lt;Task*&gt;   &gt;::_M_initialize_map(unsigned long) (stl_deque.h:466)    std::_Deque_base&lt;Task*  std::allocator&lt;Task*&gt;   &gt;::_Deque_base(std::allocator&lt;Task*&gt; const&amp;  unsigned long)   (stl_deque.h:368)    std::deque&lt;Task*  std::allocator&lt;Task*&gt; &gt;::deque(std::allocator&lt;Task*&gt;   const&amp;) (stl_deque.h:646)    std::deque&lt;Task*  std::allocator&lt;Task*&gt; &gt;::deque(std::allocator&lt;Task*&gt;   const&amp;) (stl_deque.h:646)      appcache::MockAppCacheStorage::MockAppCacheStorage(appcache::AppCacheServic  e*) (mock_appcache_storage.cc:36)      appcache::AppCacheStorageImpl::AppCacheStorageImpl(appcache::AppCacheServic  e*) (appcache_storage_impl.h:17)      appcache::AppCacheStorageImpl::AppCacheStorageImpl(appcache::AppCacheServic  e*) (appcache_storage_impl.h:17)    appcache::AppCacheService::Initialize(FilePath const&amp;)   (appcache_service.cc:23)    ChromeAppCacheService::ChromeAppCacheService(FilePath const&amp;  bool)   (appcache/chrome_appcache_service.h:32)    ChromeAppCacheService::ChromeAppCacheService(FilePath const&amp;  bool)   (appcache/chrome_appcache_service.h:33)    (anonymous namespace)::FactoryForOriginal::Create()   (chrome_url_request_context.cc:196)    ChromeURLRequestContextGetter::GetURLRequestContext()   (chrome_url_request_context.cc:443)    AppCacheDispatcherHost::Initialize(IPC::Message::Sender*  int  int)   (appcache_dispatcher_host.cc:26)    ResourceMessageFilter::OnChannelConnected(int)   (resource_message_filter.cc:239)    IPC::ChannelProxy::Context::OnChannelConnected(int)   (ipc_channel_proxy.cc:97)    IPC::Channel::ChannelImpl::ProcessIncomingMessages()   (ipc_channel_posix.cc:660)    IPC::Channel::ChannelImpl::OnFileCanReadWithoutBlocking(int)   (ipc_channel_posix.cc:910)    base::MessagePumpLibevent::OnLibeventNotification(int  short  void*)   (message_pump_libevent.cc:214)    event_process_active (/b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/third_party/libevent/event.c:385)    event_base_loop (/b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/third_party/libevent/event.c:522)    base::MessagePumpLibevent::Run(base::MessagePump::Delegate*)   (message_pump_libevent.cc:269)    MessageLoop::RunInternal() (message_loop.cc:205)    MessageLoop::RunHandler() (message_loop.cc:177)    MessageLoop::Run() (message_loop.cc:155)    base::Thread::Run(MessageLoop*) (thread.cc:132)    base::Thread::ThreadMain() (thread.cc:153)    09:04:03 memcheck_analyze.py [ERROR] Leak_DefinitelyLost  Command: /b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromium --no-  first-run --no-default-browser-check --enable-file-cookies --testing-  channel=ChromeTestingInterface:92437.7 --homepage=about:blank --disable-  web-resources --user-data-dir=/private/var/folders/yo/yotGBOBoH+ijr5HR-  DAtvk+++TM/-Tmp-/org.chromium.0yCLDO/test_user_data --metrics-recording-  only --enable-logging --test-name=RedirectTest.ServerReference  772 bytes in 1 blocks are definitely lost in loss record 9 891 of 10 268    operator new(unsigned long) (sers/chrome-bot/valgrind-10880-  redzone/coregrind/m_replacemalloc/vg_replace_malloc.c:220)    __gnu_cxx::new_allocator&lt;__gnu_cxx::_Hashtable_node&lt;std::pair&lt;long long   const  scoped_refptr&lt;appcache::AppCache&gt; &gt; &gt;*&gt;::allocate(unsigned long    void const*) (ext/new_allocator.h:88)    std::_Vector_base&lt;__gnu_cxx::_Hashtable_node&lt;std::pair&lt;long long const    scoped_refptr&lt;appcache::AppCache&gt; &gt; &gt;*    std::allocator&lt;__gnu_cxx::_Hashtable_node&lt;std::pair&lt;long long const    scoped_refptr&lt;appcache::AppCache&gt; &gt; &gt;*&gt; &gt;::_M_allocate(unsigned long)   (stl_vector.h:117)    __gnu_cxx::_Hashtable_node&lt;std::pair&lt;long long const    scoped_refptr&lt;appcache::AppCache&gt; &gt; &gt;**   std::vector&lt;__gnu_cxx::_Hashtable_node&lt;std::pair&lt;long long const    scoped_refptr&lt;appcache::AppCache&gt; &gt; &gt;*    std::allocator&lt;__gnu_cxx::_Hashtable_node&lt;std::pair&lt;long long const    scoped_refptr&lt;appcache::AppCache&gt; &gt; &gt;*&gt;   &gt;::_M_allocate_and_copy&lt;__gnu_cxx::_Hashtable_node&lt;std::pair&lt;long long   const  scoped_refptr&lt;appcache::AppCache&gt; &gt; &gt;**&gt;(unsigned long    __gnu_cxx::_Hashtable_node&lt;std::pair&lt;long long const    scoped_refptr&lt;appcache::AppCache&gt; &gt; &gt;**    __gnu_cxx::_Hashtable_node&lt;std::pair&lt;long long const    scoped_refptr&lt;appcache::AppCache&gt; &gt; &gt;**) (stl_vector.h:763)    std::vector&lt;__gnu_cxx::_Hashtable_node&lt;std::pair&lt;long long const    scoped_refptr&lt;appcache::AppCache&gt; &gt; &gt;*    std::allocator&lt;__gnu_cxx::_Hashtable_node&lt;std::pair&lt;long long const    scoped_refptr&lt;appcache::AppCache&gt; &gt; &gt;*&gt; &gt;::reserve(unsigned long)   (vector.tcc:78)    __gnu_cxx::hashtable&lt;std::pair&lt;long long const    scoped_refptr&lt;appcache::AppCache&gt; &gt;  long long  __gnu_cxx::hash&lt;long long&gt;    std::_Select1st&lt;std::pair&lt;long long const    scoped_refptr&lt;appcache::AppCache&gt; &gt; &gt;  std::equal_to&lt;long long&gt;    std::allocator&lt;scoped_refptr&lt;appcache::AppCache&gt; &gt;   &gt;::_M_initialize_buckets(unsigned long) (ext/hashtable.h:581)    __gnu_cxx::hashtable&lt;std::pair&lt;long long const    scoped_refptr&lt;appcache::AppCache&gt; &gt;  long long  __gnu_cxx::hash&lt;long long&gt;    std::_Select1st&lt;std::pair&lt;long long const    scoped_refptr&lt;appcache::AppCache&gt; &gt; &gt;  std::equal_to&lt;long long&gt;    std::allocator&lt;scoped_refptr&lt;appcache::AppCache&gt; &gt; &gt;::hashtable(unsigned   long  __gnu_cxx::hash&lt;long long&gt; const&amp;  std::equal_to&lt;long long&gt; const&amp;    std::allocator&lt;std::pair&lt;long long const  scoped_refptr&lt;appcache::AppCache&gt;   &gt; &gt; const&amp;) (ext/hashtable.h:338)    __gnu_cxx::hashtable&lt;std::pair&lt;long long const    scoped_refptr&lt;appcache::AppCache&gt; &gt;  long long  __gnu_cxx::hash&lt;long long&gt;    std::_Select1st&lt;std::pair&lt;long long const    scoped_refptr&lt;appcache::AppCache&gt; &gt; &gt;  std::equal_to&lt;long long&gt;    std::allocator&lt;scoped_refptr&lt;appcache::AppCache&gt; &gt; &gt;::hashtable(unsigned   long  __gnu_cxx::hash&lt;long long&gt; const&amp;  std::equal_to&lt;long long&gt; const&amp;    std::allocator&lt;std::pair&lt;long long const  scoped_refptr&lt;appcache::AppCache&gt;   &gt; &gt; const&amp;) (ext/hashtable.h:338)    __gnu_cxx::hash_map&lt;long long  scoped_refptr&lt;appcache::AppCache&gt;    __gnu_cxx::hash&lt;long long&gt;  std::equal_to&lt;long long&gt;    std::allocator&lt;scoped_refptr&lt;appcache::AppCache&gt; &gt; &gt;::hash_map()   (ext/hash_map:135)    __gnu_cxx::hash_map&lt;long long  scoped_refptr&lt;appcache::AppCache&gt;    __gnu_cxx::hash&lt;long long&gt;  std::equal_to&lt;long long&gt;    std::allocator&lt;scoped_refptr&lt;appcache::AppCache&gt; &gt; &gt;::hash_map()   (ext/hash_map:135)      appcache::MockAppCacheStorage::MockAppCacheStorage(appcache::AppCacheServic  e*) (mock_appcache_storage.cc:36)      appcache::AppCacheStorageImpl::AppCacheStorageImpl(appcache::AppCacheServic  e*) (appcache_storage_impl.h:17)      appcache::AppCacheStorageImpl::AppCacheStorageImpl(appcache::AppCacheServic  e*) (appcache_storage_impl.h:17)    appcache::AppCacheService::Initialize(FilePath const&amp;)   (appcache_service.cc:23)    ChromeAppCacheService::ChromeAppCacheService(FilePath const&amp;  bool)   (appcache/chrome_appcache_service.h:32)    ChromeAppCacheService::ChromeAppCacheService(FilePath const&amp;  bool)   (appcache/chrome_appcache_service.h:33)    (anonymous namespace)::FactoryForOriginal::Create()   (chrome_url_request_context.cc:196)    ChromeURLRequestContextGetter::GetURLRequestContext()   (chrome_url_request_context.cc:443)    AppCacheDispatcherHost::Initialize(IPC::Message::Sender*  int  int)   (appcache_dispatcher_host.cc:26)    ResourceMessageFilter::OnChannelConnected(int)   (resource_message_filter.cc:239)    IPC::ChannelProxy::Context::OnChannelConnected(int)   (ipc_channel_proxy.cc:97)    IPC::Channel::ChannelImpl::ProcessIncomingMessages()   (ipc_channel_posix.cc:660)    IPC::Channel::ChannelImpl::OnFileCanReadWithoutBlocking(int)   (ipc_channel_posix.cc:910)    base::MessagePumpLibevent::OnLibeventNotification(int  short  void*)   (message_pump_libevent.cc:214)    event_process_active (/b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/third_party/libevent/event.c:385)    event_base_loop (/b/slave/chromium-rel-mac-valgrind-ui-  1/build/src/third_party/libevent/event.c:522)    base::MessagePumpLibevent::Run(base::MessagePump::Delegate*)   (message_pump_libevent.cc:269)    MessageLoop::RunInternal() (message_loop.cc:205)    MessageLoop::RunHandler() (message_loop.cc:177)    MessageLoop::Run() (message_loop.cc:155) </pre>
<title>Issue 33662 -   chromium -    failed assertion when reloading document while queued workers are waiting to load - Project Hosting on Google Code</title> <pre> Try to create &gt; 16 shared workers in a single tab.  Reload the tab  Get a failed assertion:  ActiveDOMObject::~ActiveDOMObject()  {      if (m_scriptExecutionContext) {  #if ENABLE(WORKERS)          ASSERT((m_scriptExecutionContext-&gt;isDocument() &amp;&amp; isMainThread())              || (m_scriptExecutionContext-&gt;isWorkerContext() &amp;&amp;   currentThread() ==   static_cast&lt;WorkerContext*&gt;(m_scriptExecutionContext)-&gt;thread()-  &gt;threadID()));    Here's the scenario;    1) The parent document is GC'd and has its destructor called.  2) The parent of Document is ScriptExecutionContext - its destructor   invokes contextDestroyed on all ActiveDOMObjects. At this point  the   parent ScriptExecutionContext is not a Document any longer (since the   Document destructor has been called) so any assertions that rely on   m_scriptExecutionContext-&gt;isDocument() == true will fail.  3) SharedWorkerScriptLoader frees itself in its contextDestroyed() handler.   As part of freeing itself  it releases its reference to the SharedWorker.  4) The SharedWorker tries to free itself  but it hasn't gotten its   contextDestroyed() notification yet  so it still has a reference to the parent   scriptExecutionContext  and so the assertion in the ActiveDOMObject   destructor is triggered.    relevant portion of the stack trace:    #0  0x079813b8 in WebCore::ActiveDOMObject::~ActiveDOMObject   (this=0x17c560) at   /Volumes/source/chrome.git/src/third_party/WebKit/WebCore/WebCore.g  yp/../dom/ActiveDOMObject.cpp:52  #1  0x07f70861 in WebCore::AbstractWorker::~AbstractWorker   (this=0x17c560) at   /Volumes/source/chrome.git/src/third_party/WebKit/WebCore/WebCore.g  yp/../workers/AbstractWorker.cpp:53  #2  0x07f711df in WebCore::SharedWorker::~SharedWorker   (this=0x17c560) at   /Volumes/source/chrome.git/src/third_party/WebKit/WebCore/WebCore.g  yp/../workers/SharedWorker.cpp:60  #3  0x077e1925 in WTF::RefCounted&lt;WebCore::AbstractWorker&gt;::deref   (this=0x17c56c) at RefCounted.h:109  #4  0x077e194a in WTF::RefPtr&lt;WebCore::SharedWorker&gt;::~RefPtr   (this=0x17d434) at RefPtr.h:53  #5  0x077e1c75 in   WebCore::SharedWorkerScriptLoader::~SharedWorkerScriptLoader   (this=0x17d420) at   /Volumes/source/chrome.git/src/third_party/WebKit/WebKit/chromium/sr  c/SharedWorkerRepository.cpp:64  #6  0x077e0f36 in WebCore::SharedWorkerScriptLoader::contextDestroyed   (this=0x17d420) at   /Volumes/source/chrome.git/src/third_party/WebKit/WebKit/chromium/sr  c/SharedWorkerRepository.cpp:134  #7  0x07a05659 in   WebCore::ScriptExecutionContext::~ScriptExecutionContext   (this=0x857634) at   /Volumes/source/chrome.git/src/third_party/WebKit/WebCore/WebCore.g  yp/../dom/ScriptExecutionContext.cpp:72  #8  0x079a0798 in WebCore::Document::~Document (this=0x857600) at   /Volumes/source/chrome.git/src/third_party/WebKit/WebCore/WebCore.g  yp/../dom/Document.cpp:543  #9  0x07ad611b in WebCore::HTMLDocument::~HTMLDocument   (this=0x857600) at   /Volumes/source/chrome.git/src/third_party/WebKit/WebCore/WebCore.g  yp/../html/HTMLDocument.cpp:91  #10 0x079e6b55 in WebCore::Document::selfOnlyDeref (this=0x857600)   at Document.h:212  #11 0x079a0935 in WebCore::Document::removedLastRef   (this=0x857600) at   /Volumes/source/chrome.git/src/third_party/WebKit/WebCore/WebCore.g  yp/../dom/Document.cpp:493  #12 0x07f307ff in WebCore::TreeShared&lt;WebCore::Node&gt;::deref   (this=0x857604) at TreeShared.h:69  #13 0x07873116 in WebCore::DOMDataStore::weakNodeCallback   (v8Object={&lt;v8::Handle&lt;v8::Value&gt;&gt; = {val_ = 0x18144}  &lt;No data   fields&gt;}  domObject=0x857600) at   /Volumes/source/chrome.git/src/third_party/WebKit/WebCore/WebCore.g  yp/../bindings/v8/DOMDataStore.cpp:171  #14 0x0736c330 in   v8::internal::GlobalHandles::Node::PostGarbageCollectionProcessing   (this=0x18144) at   /Volumes/source/chrome.git/src/v8/tools/gyp/../../src/global-  handles.cc:179   </pre>
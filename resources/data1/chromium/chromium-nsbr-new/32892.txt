<title>Issue 32892 -   chromium -    Possible data race detected during sync unittest - Project Hosting on Google Code</title> <pre> (+CC timurrr for races  nickbaum for sync triage)    From the log of   <a href="http://build.chromium.org/buildbot/memory/builders/Linux%20Tests%20(tsan)/b">http://build.chromium.org/buildbot/memory/builders/Linux%20Tests%20(tsan)/b</a>  uilds/2156/steps/valgrind%20test:%20unit/logs/stdio :    05:13:58 tsan_analyze.py [ERROR] Found 1 race reports  05:13:58 tsan_analyze.py [ERROR]   ==440== INFO: T206 has been created by T0 at this point: {{{  ==440==     #0  clone /lib/tls/i686/cmov/libc-2.7.so  ==440==     #1  pthread_create@@GLIBC_2.1 /lib/tls/i686/cmov/libpthread-  2.7.so  ==440==     #2  pthread_create@* /home/chrome-bot/valgrind-10880-  redzone/tsan/ts_valgrind_intercepts.c:577  ==440==     #3  (anonymous namespace)::CreateThread(unsigned int  bool    PlatformThread::Delegate*  unsigned long*) /b/slave/chromium-rel-linux-  valgrind-builder/build/src/base/platform_thread_posix.cc:96  ==440==     #4  PlatformThread::Create(unsigned int    PlatformThread::Delegate*  unsigned long*) /b/slave/chromium-rel-linux-  valgrind-builder/build/src/base/platform_thread_posix.cc:108  ==440==     #5  base::Thread::StartWithOptions(base::Thread::Options   const&amp;) /b/slave/chromium-rel-linux-valgrind-  builder/build/src/base/thread.cc:86  ==440==     #6  base::Thread::Start() /b/slave/chromium-rel-linux-valgrind-  builder/build/src/base/thread.cc:75  ==440==     #7  UIModelWorkerTest::SetUp() /b/slave/chromium-rel-linux-  valgrind-  builder/build/src/chrome/browser/sync/glue/ui_model_worker_unittest.cc:108  ==440==     #8  testing::Test::Run() /b/slave/chromium-rel-linux-valgrind-  builder/build/src/testing/gtest/src/gtest.cc:2080  ==440==     #9  testing::internal::TestInfoImpl::Run() /b/slave/chromium-  rel-linux-valgrind-builder/build/src/testing/gtest/src/gtest.cc:2304  ==440==     #10 testing::TestCase::Run() /b/slave/chromium-rel-linux-  valgrind-builder/build/src/testing/gtest/src/gtest.cc:2412  ==440==     #11 testing::internal::UnitTestImpl::RunAllTests()   /b/slave/chromium-rel-linux-valgrind-  builder/build/src/testing/gtest/src/gtest.cc:4013  ==440==     #12 testing::UnitTest::Run() /b/slave/chromium-rel-linux-  valgrind-builder/build/src/testing/gtest/src/gtest.cc:3680  ==440==     #13 TestSuite::Run() /b/slave/chromium-rel-linux-valgrind-  builder/build/src/base/test/test_suite.h:124  ==440==     #14 main /b/slave/chromium-rel-linux-valgrind-  builder/build/src/chrome/test/unit/run_all_unittests.cc:8  ==440== }}}  ==440== INFO: T0 is program's main thread  ==440== WARNING: Possible data race during read of size 4 at 0xA709634: {{{  ==440==    T206 (FauxSyncerThread) (locks held: {}):  ==440==     #0    browser_sync::UIModelWorker::DoWorkAndWaitUntilDone(CallbackRunner&lt;Tuple0&gt;*  ) /b/slave/chromium-rel-linux-valgrind-  builder/build/src/chrome/browser/sync/glue/ui_model_worker.cc:18  ==440==     #1  Syncer::SyncShare(UIModelWorkerVisitor*) /b/slave/chromium-  rel-linux-valgrind-  builder/build/src/chrome/browser/sync/glue/ui_model_worker_unittest.cc:47  ==440==     #2  FakeSyncShareTask::Run() /b/slave/chromium-rel-linux-  valgrind-  builder/build/src/chrome/browser/sync/glue/ui_model_worker_unittest.cc:62  ==440==     #3  MessageLoop::RunTask(Task*) /b/slave/chromium-rel-linux-  valgrind-builder/build/src/base/message_loop.cc:320  ==440==     #4  MessageLoop::DeferOrRunPendingTask(MessageLoop::PendingTask   const&amp;) /b/slave/chromium-rel-linux-valgrind-  builder/build/src/base/message_loop.cc:328  ==440==     #5  MessageLoop::DoWork() /b/slave/chromium-rel-linux-valgrind-  builder/build/src/base/message_loop.cc:435  ==440==     #6  base::MessagePumpDefault::Run(base::MessagePump::Delegate*)   /b/slave/chromium-rel-linux-valgrind-  builder/build/src/base/message_pump_default.cc:23  ==440==     #7  MessageLoop::RunInternal() /b/slave/chromium-rel-linux-  valgrind-builder/build/src/base/message_loop.cc:205  ==440==     #8  MessageLoop::RunHandler() /b/slave/chromium-rel-linux-  valgrind-builder/build/src/base/message_loop.cc:177  ==440==     #9  MessageLoop::Run() /b/slave/chromium-rel-linux-valgrind-  builder/build/src/base/message_loop.cc:155  ==440==     #10 base::Thread::Run(MessageLoop*) /b/slave/chromium-rel-  linux-valgrind-builder/build/src/base/thread.cc:133  ==440==     #11 base::Thread::ThreadMain() /b/slave/chromium-rel-linux-  valgrind-builder/build/src/base/thread.cc:155  ==440==     #12 ThreadFunc(void*) /b/slave/chromium-rel-linux-valgrind-  builder/build/src/base/platform_thread_posix.cc:26  ==440==     #13 ThreadSanitizerStartThread /home/chrome-bot/valgrind-10880-  redzone/tsan/ts_valgrind_intercepts.c:525  ==440==   Concurrent write(s) happened at (OR AFTER) these points:  ==440==    T0 (locks held: {L1715}):  ==440==     #0  browser_sync::UIModelWorker::Stop() /b/slave/chromium-rel-  linux-valgrind-  builder/build/src/chrome/browser/sync/glue/ui_model_worker.cc:67  ==440==     #1    UIModelWorkerTest_HypotheticalManualPumpFlooding_Test::TestBody()   /b/slave/chromium-rel-linux-valgrind-  builder/build/src/chrome/browser/sync/glue/ui_model_worker_unittest.cc:218  ==440==     #2  testing::Test::Run() /b/slave/chromium-rel-linux-valgrind-  builder/build/src/testing/gtest/src/gtest.cc:2085  ==440==     #3  testing::internal::TestInfoImpl::Run() /b/slave/chromium-  rel-linux-valgrind-builder/build/src/testing/gtest/src/gtest.cc:2304  ==440==     #4  testing::TestCase::Run() /b/slave/chromium-rel-linux-  valgrind-builder/build/src/testing/gtest/src/gtest.cc:2412  ==440==     #5  testing::internal::UnitTestImpl::RunAllTests()   /b/slave/chromium-rel-linux-valgrind-  builder/build/src/testing/gtest/src/gtest.cc:4013  ==440==     #6  testing::UnitTest::Run() /b/slave/chromium-rel-linux-  valgrind-builder/build/src/testing/gtest/src/gtest.cc:3680  ==440==     #7  TestSuite::Run() /b/slave/chromium-rel-linux-valgrind-  builder/build/src/base/test/test_suite.h:124  ==440==     #8  main /b/slave/chromium-rel-linux-valgrind-  builder/build/src/chrome/test/unit/run_all_unittests.cc:8  ==440==   Location 0xA709634 is 4 bytes inside a block starting at   0xA709630 of size 96 allocated by T0 from heap:  ==440==     #0  malloc /home/chrome-bot/valgrind-10880-  redzone/tsan/ts_valgrind_intercepts.c:340  ==440==     #1  operator new(unsigned int) /usr/lib/libstdc++.so.6.0.9  ==440==     #2  UIModelWorkerTest::SetUp() /b/slave/chromium-rel-linux-  valgrind-  builder/build/src/chrome/browser/sync/glue/ui_model_worker_unittest.cc:109  ==440==     #3  testing::Test::Run() /b/slave/chromium-rel-linux-valgrind-  builder/build/src/testing/gtest/src/gtest.cc:2080  ==440==     #4  testing::internal::TestInfoImpl::Run() /b/slave/chromium-  rel-linux-valgrind-builder/build/src/testing/gtest/src/gtest.cc:2304  ==440==     #5  testing::TestCase::Run() /b/slave/chromium-rel-linux-  valgrind-builder/build/src/testing/gtest/src/gtest.cc:2412  ==440==     #6  testing::internal::UnitTestImpl::RunAllTests()   /b/slave/chromium-rel-linux-valgrind-  builder/build/src/testing/gtest/src/gtest.cc:4013  ==440==     #7  testing::UnitTest::Run() /b/slave/chromium-rel-linux-  valgrind-builder/build/src/testing/gtest/src/gtest.cc:3680  ==440==     #8  TestSuite::Run() /b/slave/chromium-rel-linux-valgrind-  builder/build/src/base/test/test_suite.h:124  ==440==     #9  main /b/slave/chromium-rel-linux-valgrind-  builder/build/src/chrome/test/unit/run_all_unittests.cc:8  ==440==   Locks involved in this report (reporting last lock sites):   {L1715}  ==440==    L1715  ==440==     #0  pthread_mutex_lock /home/chrome-bot/valgrind-10880-  redzone/tsan/ts_valgrind_intercepts.c:772  ==440==     #1  LockImpl::Lock() /b/slave/chromium-rel-linux-valgrind-  builder/build/src/base/lock_impl_posix.cc:41  ==440==     #2  Lock::Acquire() /b/slave/chromium-rel-linux-valgrind-  builder/build/src/base/lock.h:16  ==440==     #3  AutoLock::AutoLock(Lock&amp;) /b/slave/chromium-rel-linux-  valgrind-builder/build/src/base/lock.h:43  ==440==     #4  browser_sync::UIModelWorker::Stop() /b/slave/chromium-rel-  linux-valgrind-  builder/build/src/chrome/browser/sync/glue/ui_model_worker.cc:62  ==440==     #5    UIModelWorkerTest_HypotheticalManualPumpFlooding_Test::TestBody()   /b/slave/chromium-rel-linux-valgrind-  builder/build/src/chrome/browser/sync/glue/ui_model_worker_unittest.cc:218  ==440==     #6  testing::Test::Run() /b/slave/chromium-rel-linux-valgrind-  builder/build/src/testing/gtest/src/gtest.cc:2085  ==440==     #7  testing::internal::TestInfoImpl::Run() /b/slave/chromium-  rel-linux-valgrind-builder/build/src/testing/gtest/src/gtest.cc:2304  ==440==     #8  testing::TestCase::Run() /b/slave/chromium-rel-linux-  valgrind-builder/build/src/testing/gtest/src/gtest.cc:2412  ==440==     #9  testing::internal::UnitTestImpl::RunAllTests()   /b/slave/chromium-rel-linux-valgrind-  builder/build/src/testing/gtest/src/gtest.cc:4013  ==440==     #10 testing::UnitTest::Run() /b/slave/chromium-rel-linux-  valgrind-builder/build/src/testing/gtest/src/gtest.cc:3680  ==440==     #11 TestSuite::Run() /b/slave/chromium-rel-linux-valgrind-  builder/build/src/base/test/test_suite.h:124  ==440==     #12 main /b/slave/chromium-rel-linux-valgrind-  builder/build/src/chrome/test/unit/run_all_unittests.cc:8  ==440== }}}    05:13:58 valgrind_test.py [INFO] Please see   <a href="http://dev.chromium.org/developers/how-tos/using-valgrind/threadsanitizer">http://dev.chromium.org/developers/how-tos/using-valgrind/threadsanitizer</a>   for the info on ThreadSanitizer  05:13:58 valgrind_test.py [ERROR] Analyze failed.  05:13:58 valgrind_test.py [INFO] elapsed time: 00:29:31   </pre>
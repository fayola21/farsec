<title>Issue 42215 -   chromium -    SPDY Crash on session teardown with re-entrant call through CloseAllStreams - Project Hosting on Google Code</title> <pre>   I'm hitting this crash with high frequency.       	chrome.dll!DebugUtil::BreakDebugger()  Line 222	C++   	chrome.dll!logging::LogMessage::~LogMessage()  Line 572	C++   	chrome.dll!base::subtle::RefCountedBase::Release()  Line 45	C++   	chrome.dll!base::RefCounted&lt;net::SpdyStream&gt;::Release()  Line 92 +   0x8 bytes	C++   	  chrome.dll!scoped_refptr&lt;net::SpdyStream&gt;::~scoped_refptr&lt;net::SpdyStream&gt;(  )  Line 239	C++   	chrome.dll!std::pair&lt;int const  scoped_refptr&lt;net::SpdyStream&gt;   &gt;::~pair&lt;int const  scoped_refptr&lt;net::SpdyStream&gt; &gt;()  + 0x19 bytes	C++   	  chrome.dll!std::_Tree_nod&lt;std::_Tmap_traits&lt;int scoped_refptr&lt;net::SpdyStre  am&gt; std::less&lt;int&gt; std::allocator&lt;std::pair&lt;int const    scoped_refptr&lt;net::SpdyStream&gt; &gt; &gt; 0&gt; &gt;::_Node::~_Node()  + 0x19 bytes	C++   	  chrome.dll!std::_Tree_nod&lt;std::_Tmap_traits&lt;int scoped_refptr&lt;net::SpdyStre  am&gt; std::less&lt;int&gt; std::allocator&lt;std::pair&lt;int const    scoped_refptr&lt;net::SpdyStream&gt; &gt; &gt; 0&gt; &gt;::_Node::`scalar deleting   destructor'()  + 0x16 bytes	C++   	  chrome.dll!std::_Destroy&lt;std::_Tree_nod&lt;std::_Tmap_traits&lt;int scoped_refptr  &lt;net::SpdyStream&gt; std::less&lt;int&gt; std::allocator&lt;std::pair&lt;int const    scoped_refptr&lt;net::SpdyStream&gt; &gt; &gt; 0&gt;   &gt;::_Node&gt;(std::_Tree_nod&lt;std::_Tmap_traits&lt;int scoped_refptr&lt;net::SpdyStrea  m&gt; std::less&lt;int&gt; std::allocator&lt;std::pair&lt;int const    scoped_refptr&lt;net::SpdyStream&gt; &gt; &gt; 0&gt; &gt;::_Node * _Ptr=0x050c4fe0)  Line 61	  C++   	  chrome.dll!std::allocator&lt;std::_Tree_nod&lt;std::_Tmap_traits&lt;int scoped_refpt  r&lt;net::SpdyStream&gt; std::less&lt;int&gt; std::allocator&lt;std::pair&lt;int const    scoped_refptr&lt;net::SpdyStream&gt; &gt; &gt; 0&gt;   &gt;::_Node&gt;::destroy(std::_Tree_nod&lt;std::_Tmap_traits&lt;int scoped_refptr&lt;net::  SpdyStream&gt; std::less&lt;int&gt; std::allocator&lt;std::pair&lt;int const    scoped_refptr&lt;net::SpdyStream&gt; &gt; &gt; 0&gt; &gt;::_Node * _Ptr=0x050c4fe0)  Line   161 + 0x9 bytes	C++   	  chrome.dll!std::_Tree&lt;std::_Tmap_traits&lt;int scoped_refptr&lt;net::SpdyStream&gt;   std::less&lt;int&gt; std::allocator&lt;std::pair&lt;int const    scoped_refptr&lt;net::SpdyStream&gt; &gt; &gt; 0&gt;   &gt;::_Erase(std::_Tree_nod&lt;std::_Tmap_traits&lt;int scoped_refptr&lt;net::SpdyStrea  m&gt; std::less&lt;int&gt; std::allocator&lt;std::pair&lt;int const    scoped_refptr&lt;net::SpdyStream&gt; &gt; &gt; 0&gt; &gt;::_Node * _Rootnode=0x050c4fe0)    Line 1078	C++   	  chrome.dll!std::_Tree&lt;std::_Tmap_traits&lt;int scoped_refptr&lt;net::SpdyStream&gt;   std::less&lt;int&gt; std::allocator&lt;std::pair&lt;int const    scoped_refptr&lt;net::SpdyStream&gt; &gt; &gt; 0&gt; &gt;::clear()  Line 955	C++   	chrome.dll!net::SpdySession::CloseAllStreams(net::Error   code=ERR_ABORTED)  Line 768	C++   	chrome.dll!net::SpdySession::~SpdySession()  Line 229	C++   	chrome.dll!net::SpdySession::`scalar deleting destructor'()  + 0x16   bytes	C++   	chrome.dll!base::RefCounted&lt;net::SpdySession&gt;::Release()  Line 93 +   0x3a bytes	C++   	  chrome.dll!scoped_refptr&lt;net::SpdySession&gt;::~scoped_refptr&lt;net::SpdySession  &gt;()  Line 239	C++   	chrome.dll!net::SpdyStream::~SpdyStream()  Line 50 + 0x32 bytes	C++   	chrome.dll!net::SpdyStream::`scalar deleting destructor'()  + 0x16   bytes	C++   	chrome.dll!base::RefCounted&lt;net::SpdyStream&gt;::Release()  Line 93 +   0x1c bytes	C++   	  chrome.dll!scoped_refptr&lt;net::SpdyStream&gt;::~scoped_refptr&lt;net::SpdyStream&gt;(  )  Line 239	C++   	chrome.dll!std::pair&lt;int const  scoped_refptr&lt;net::SpdyStream&gt;   &gt;::~pair&lt;int const  scoped_refptr&lt;net::SpdyStream&gt; &gt;()  + 0x19 bytes	C++   	  chrome.dll!std::_Tree_nod&lt;std::_Tmap_traits&lt;int scoped_refptr&lt;net::SpdyStre  am&gt; std::less&lt;int&gt; std::allocator&lt;std::pair&lt;int const    scoped_refptr&lt;net::SpdyStream&gt; &gt; &gt; 0&gt; &gt;::_Node::~_Node()  + 0x19 bytes	C++   	  chrome.dll!std::_Tree_nod&lt;std::_Tmap_traits&lt;int scoped_refptr&lt;net::SpdyStre  am&gt; std::less&lt;int&gt; std::allocator&lt;std::pair&lt;int const    scoped_refptr&lt;net::SpdyStream&gt; &gt; &gt; 0&gt; &gt;::_Node::`scalar deleting   destructor'()  + 0x16 bytes	C++   	  chrome.dll!std::_Destroy&lt;std::_Tree_nod&lt;std::_Tmap_traits&lt;int scoped_refptr  &lt;net::SpdyStream&gt; std::less&lt;int&gt; std::allocator&lt;std::pair&lt;int const    scoped_refptr&lt;net::SpdyStream&gt; &gt; &gt; 0&gt;   &gt;::_Node&gt;(std::_Tree_nod&lt;std::_Tmap_traits&lt;int scoped_refptr&lt;net::SpdyStrea  m&gt; std::less&lt;int&gt; std::allocator&lt;std::pair&lt;int const    scoped_refptr&lt;net::SpdyStream&gt; &gt; &gt; 0&gt; &gt;::_Node * _Ptr=0x050c4fe0)  Line 61	  C++   	  chrome.dll!std::allocator&lt;std::_Tree_nod&lt;std::_Tmap_traits&lt;int scoped_refpt  r&lt;net::SpdyStream&gt; std::less&lt;int&gt; std::allocator&lt;std::pair&lt;int const    scoped_refptr&lt;net::SpdyStream&gt; &gt; &gt; 0&gt;   &gt;::_Node&gt;::destroy(std::_Tree_nod&lt;std::_Tmap_traits&lt;int scoped_refptr&lt;net::  SpdyStream&gt; std::less&lt;int&gt; std::allocator&lt;std::pair&lt;int const    scoped_refptr&lt;net::SpdyStream&gt; &gt; &gt; 0&gt; &gt;::_Node * _Ptr=0x050c4fe0)  Line   161 + 0x9 bytes	C++   	  chrome.dll!std::_Tree&lt;std::_Tmap_traits&lt;int scoped_refptr&lt;net::SpdyStream&gt;   std::less&lt;int&gt; std::allocator&lt;std::pair&lt;int const    scoped_refptr&lt;net::SpdyStream&gt; &gt; &gt; 0&gt;   &gt;::_Erase(std::_Tree_nod&lt;std::_Tmap_traits&lt;int scoped_refptr&lt;net::SpdyStrea  m&gt; std::less&lt;int&gt; std::allocator&lt;std::pair&lt;int const    scoped_refptr&lt;net::SpdyStream&gt; &gt; &gt; 0&gt; &gt;::_Node * _Rootnode=0x050c4fe0)    Line 1078	C++   	  chrome.dll!std::_Tree&lt;std::_Tmap_traits&lt;int scoped_refptr&lt;net::SpdyStream&gt;   std::less&lt;int&gt; std::allocator&lt;std::pair&lt;int const    scoped_refptr&lt;net::SpdyStream&gt; &gt; &gt; 0&gt; &gt;::clear()  Line 955	C++  &gt;	chrome.dll!net::SpdySession::CloseAllStreams(net::Error   code=ERR_CONNECTION_CLOSED)  Line 768	C++   	chrome.dll!net::SpdySession::CloseSessionOnError(net::Error   err=ERR_CONNECTION_CLOSED)  Line 813	C++   	chrome.dll!net::SpdySession::OnReadComplete(int   bytes_read=0x00000000)  Line 538	C++   	chrome.dll!DispatchToMethod&lt;net::SpdySession void (__thiscall   net::SpdySession::*)(int) int&gt;(net::SpdySession * obj=0x057bf8c0  void   (int)* method=0x5c919f80  const Tuple1&lt;int&gt; &amp; arg={...})  Line 422 + 0x11   bytes	C++   	chrome.dll!CallbackImpl&lt;net::SpdySession void (__thiscall   net::SpdySession::*)(int) Tuple1&lt;int&gt; &gt;::RunWithParams(const Tuple1&lt;int&gt; &amp;   params={...})  Line 118 + 0x1b bytes	C++   	  chrome.dll!net::CancelableCompletionCallback&lt;net::SpdySession&gt;::RunWithPara  ms(const Tuple1&lt;int&gt; &amp; params={...})  Line 51	C++   	chrome.dll!CallbackRunner&lt;Tuple1&lt;int&gt; &gt;::Run&lt;int&gt;(const int &amp;   a=0x00000000)  Line 83 + 0x1c bytes	C++   	chrome.dll!net::TCPClientSocketWin::DoReadCallback(int   rv=0x00000000)  Line 628	C++   	chrome.dll!net::TCPClientSocketWin::DidCompleteRead()  Line 701	C++   	  chrome.dll!net::TCPClientSocketWin::Core::ReadDelegate::OnObjectSignaled(vo  id * object=0x0000074c)  Line 261	C++   	chrome.dll!base::ObjectWatcher::Watch::Run()  Line 30 + 0x1c bytes	  C++   	chrome.dll!MessageLoop::RunTask(Task * task=0x0558e570)  Line 328 +   0xf bytes	C++   	chrome.dll!MessageLoop::DeferOrRunPendingTask(const   MessageLoop::PendingTask &amp; pending_task={...})  Line 339	C++   	chrome.dll!MessageLoop::DoWork()  Line 443 + 0xc bytes	C++   	chrome.dll!base::MessagePumpForIO::DoRunLoop()  Line 449 + 0x19   bytes	C++   	  chrome.dll!base::MessagePumpWin::RunWithDispatcher(base::MessagePump::Deleg  ate * delegate=0x0416fdd8  base::MessagePumpWin::Dispatcher *   dispatcher=0x00000000)  Line 52 + 0xf bytes	C++   	chrome.dll!base::MessagePumpWin::Run(base::MessagePump::Delegate *   delegate=0x0416fdd8)  Line 78 + 0x1c bytes	C++   	chrome.dll!MessageLoop::RunInternal()  Line 204 + 0x2a bytes	C++   	chrome.dll!MessageLoop::RunHandler()  Line 177	C++   	chrome.dll!MessageLoop::Run()  Line 155	C++   	chrome.dll!base::Thread::Run(MessageLoop * message_loop=0x0416fdd8)    Line 134	C++   	chrome.dll!base::Thread::ThreadMain()  Line 156 + 0x16 bytes	C++   	chrome.dll!`anonymous namespace'::ThreadFunc(void *   closure=0x02ba04b0)  Line 26 + 0xf bytes	C++   	kernel32.dll!76bee4a5() 	   	[Frames below may be incorrect and/or missing  no symbols loaded   for kernel32.dll]	   	ntdll.dll!7738cfed() 	   	ntdll.dll!7738d1ff() 	 </pre>
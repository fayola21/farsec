<title>Issue 40699 -   chromium -    Valgrind leak in GeolocationPermissionContextTests_QueuedPermission_Test::TestBody  GeolocationPermissionContextTests_CancelGeolocationPermissionRequest_Test::TestBody  and GeolocationPermissionContextTests::SetUp - Project Hosting on Google Code</title> <pre> <a href="http://build.chromium.org/buildbot/memory/builders/Chromium%20Mac%20(valgrind)/builds/4">http://build.chromium.org/buildbot/memory/builders/Chromium%20Mac%20(valgrind)/builds/4</a>  144/steps/valgrind%20test:%20unit/logs/stdio      10:13:17 memcheck_analyze.py [ERROR] FAIL! There were 3 errors:   10:14:23 memcheck_analyze.py [ERROR] Leak_DefinitelyLost  Command: src/xcodebuild/Debug/unit_tests --gtest_filter=-  VisitedLinkEventsTest.Coalescense:VisitedLinkRelayTest.Basics:RenderViewTest.ImeComposition:  DnsMasterTest.MassiveConcurrentLookupTest:IPCSyncChannelTest.*:WebDropTargetTest.URL:We  bDropTargetTest.Data:AutocompleteTextFieldEditorTest.CutCopyTest:DownloadUtilTest.AddFileT  oPasteboardTest:FindPasteboardTest.ReadingFromPboardUpdatesFindText:FindPasteboardTest.Se  ndsNotificationWhenTextChanges:RenderViewTest.MacTestCmdUp:ChromeBrowserWindowTest.D  oesHideTitle:ClearBrowsingDataControllerTest.*:NSMenuItemAdditionsTest.TestMOnDifferentLayo  uts:PrefsControllerTest.GetPrefsViewForPage:PrefsControllerTest.GetToolbarItemForPage:PrefsCon  trollerTest.ShowAndClose:PrefsControllerTest.SwitchToPage:RenderViewTest.OnPrintPages:Render  ViewTest.Print*:TabStripControllerTest.AddRemoveTabs:TaskManagerWindowControllerTest.*:Boo  kmarkAllTabsControllerTest.BookmarkAllTabs:BookmarkFolderTargetTest.* --gtest_print_time  385 (100 direct  285 indirect) bytes in 1 blocks are definitely lost in loss record 14 023 of 15 040    operator new(unsigned long) (mp/vg-chr/scripts/valgrind-  source/coregrind/m_replacemalloc/vg_replace_malloc.c:235)    GeolocationPermissionContext::ShowQueuedInfoBar(TabContents*  int  int)   (geolocation_permission_context.cc:294)    GeolocationPermissionContext::OnInfoBarClosed(TabContents*  int  int  int)   (geolocation_permission_context.cc:235)    (anonymous namespace)::GeolocationConfirmInfoBarDelegate::InfoBarClosed()   (geolocation_permission_context.cc:49)    GeolocationPermissionContextTests_QueuedPermission_Test::TestBody() (/b/slave/chromium-  dbg-mac-  valgrind/build/src/chrome/browser/geolocation/geolocation_permission_context_unittest.cc:147  )    testing::Test::Run() (gtest.cc:2095)    testing::internal::TestInfoImpl::Run() (gtest.cc:2314)    testing::TestCase::Run() (gtest.cc:2420)    testing::internal::UnitTestImpl::RunAllTests() (gtest.cc:4024)    testing::UnitTest::Run() (gtest.cc:3687)    TestSuite::Run() (test/test_suite.h:125)    main (/b/slave/chromium-dbg-mac-  valgrind/build/src/chrome/test/unit/run_all_unittests.cc:8)  Suppression:  {     &lt;insert_a_suppression_name_here&gt;     Memcheck:Leak     fun:_Znw*     fun:_ZN28GeolocationPermissionContext17ShowQueuedInfoBarEP11TabContentsii     fun:_ZN28GeolocationPermissionContext15OnInfoBarClosedEP11TabContentsiii     fun:_ZN12_GLOBAL__N_133GeolocationConfirmInfoBarDelegate13InfoBarClosedEv     fun:_ZN55GeolocationPermissionContextTests_QueuedPermission_Test8TestBodyEv     fun:_ZN7testing4Test3RunEv     fun:_ZN7testing8internal12TestInfoImpl3RunEv     fun:_ZN7testing8TestCase3RunEv     fun:_ZN7testing8internal12UnitTestImpl11RunAllTestsEv     fun:_ZN7testing8UnitTest3RunEv     fun:_ZN9TestSuite3RunEv     fun:main  }      10:14:23 memcheck_analyze.py [ERROR] Leak_DefinitelyLost  Command: src/xcodebuild/Debug/unit_tests --gtest_filter=-  VisitedLinkEventsTest.Coalescense:VisitedLinkRelayTest.Basics:RenderViewTest.ImeComposition:  DnsMasterTest.MassiveConcurrentLookupTest:IPCSyncChannelTest.*:WebDropTargetTest.URL:We  bDropTargetTest.Data:AutocompleteTextFieldEditorTest.CutCopyTest:DownloadUtilTest.AddFileT  oPasteboardTest:FindPasteboardTest.ReadingFromPboardUpdatesFindText:FindPasteboardTest.Se  ndsNotificationWhenTextChanges:RenderViewTest.MacTestCmdUp:ChromeBrowserWindowTest.D  oesHideTitle:ClearBrowsingDataControllerTest.*:NSMenuItemAdditionsTest.TestMOnDifferentLayo  uts:PrefsControllerTest.GetPrefsViewForPage:PrefsControllerTest.GetToolbarItemForPage:PrefsCon  trollerTest.ShowAndClose:PrefsControllerTest.SwitchToPage:RenderViewTest.OnPrintPages:Render  ViewTest.Print*:TabStripControllerTest.AddRemoveTabs:TaskManagerWindowControllerTest.*:Boo  kmarkAllTabsControllerTest.BookmarkAllTabs:BookmarkFolderTargetTest.* --gtest_print_time  385 (176 direct  209 indirect) bytes in 1 blocks are definitely lost in loss record 14 024 of 15 040    operator new(unsigned long) (mp/vg-chr/scripts/valgrind-  source/coregrind/m_replacemalloc/vg_replace_malloc.c:235)      __gnu_cxx::new_allocator&lt;GeolocationPermissionContext::PendingInfoBarRequest&gt;::allocate(unsi  gned long  void const*) (ext/new_allocator.h:88)    std::_Vector_base&lt;GeolocationPermissionContext::PendingInfoBarRequest    std::allocator&lt;GeolocationPermissionContext::PendingInfoBarRequest&gt; &gt;::_M_allocate(unsigned   long) (stl_vector.h:117)    std::vector&lt;GeolocationPermissionContext::PendingInfoBarRequest    std::allocator&lt;GeolocationPermissionContext::PendingInfoBarRequest&gt;   &gt;::_M_insert_aux(__gnu_cxx::__normal_iterator&lt;GeolocationPermissionContext::PendingInfoBarRe  quest*  std::vector&lt;GeolocationPermissionContext::PendingInfoBarRequest    std::allocator&lt;GeolocationPermissionContext::PendingInfoBarRequest&gt; &gt; &gt;    GeolocationPermissionContext::PendingInfoBarRequest const&amp;) (vector.tcc:275)    std::vector&lt;GeolocationPermissionContext::PendingInfoBarRequest    std::allocator&lt;GeolocationPermissionContext::PendingInfoBarRequest&gt;   &gt;::push_back(GeolocationPermissionContext::PendingInfoBarRequest const&amp;) (stl_vector.h:610)    GeolocationPermissionContext::RequestPermissionFromUI(TabContents*  int  int  int  GURL   const&amp;) (geolocation_permission_context.cc:248)    GeolocationPermissionContext::RequestGeolocationPermission(int  int  int  GURL const&amp;)   (geolocation_permission_context.cc:174)    GeolocationPermissionContextTests_CancelGeolocationPermissionRequest_Test::TestBody()   (/b/slave/chromium-dbg-mac-  valgrind/build/src/chrome/browser/geolocation/geolocation_permission_context_unittest.cc:192  )    testing::Test::Run() (gtest.cc:2095)    testing::internal::TestInfoImpl::Run() (gtest.cc:2314)    testing::TestCase::Run() (gtest.cc:2420)    testing::internal::UnitTestImpl::RunAllTests() (gtest.cc:4024)    testing::UnitTest::Run() (gtest.cc:3687)    TestSuite::Run() (test/test_suite.h:125)    main (/b/slave/chromium-dbg-mac-  valgrind/build/src/chrome/test/unit/run_all_unittests.cc:8)  Suppression:  {     &lt;insert_a_suppression_name_here&gt;     Memcheck:Leak     fun:_Znw*       fun:_ZN9__gnu_cxx13new_allocatorIN28GeolocationPermissionContext21PendingInfoBarRequestE  E8allocateEmPKv       fun:_ZNSt12_Vector_baseIN28GeolocationPermissionContext21PendingInfoBarRequestESaIS1_EE1  1_M_allocateEm       fun:_ZNSt6vectorIN28GeolocationPermissionContext21PendingInfoBarRequestESaIS1_EE13_M_inse  rt_auxEN9__gnu_cxx17__normal_iteratorIPS1_S3_EERKS1_       fun:_ZNSt6vectorIN28GeolocationPermissionContext21PendingInfoBarRequestESaIS1_EE9push_ba  ckERKS1_       fun:_ZN28GeolocationPermissionContext23RequestPermissionFromUIEP11TabContentsiiiRK4GUR  L     fun:_ZN28GeolocationPermissionContext28RequestGeolocationPermissionEiiiRK4GURL       fun:_ZN73GeolocationPermissionContextTests_CancelGeolocationPermissionRequest_Test8TestBo  dyEv     fun:_ZN7testing4Test3RunEv     fun:_ZN7testing8internal12TestInfoImpl3RunEv     fun:_ZN7testing8TestCase3RunEv     fun:_ZN7testing8internal12UnitTestImpl11RunAllTestsEv     fun:_ZN7testing8UnitTest3RunEv     fun:_ZN9TestSuite3RunEv     fun:main  }      10:14:23 memcheck_analyze.py [ERROR] Leak_DefinitelyLost  Command: src/xcodebuild/Debug/unit_tests --gtest_filter=-  VisitedLinkEventsTest.Coalescense:VisitedLinkRelayTest.Basics:RenderViewTest.ImeComposition:  DnsMasterTest.MassiveConcurrentLookupTest:IPCSyncChannelTest.*:WebDropTargetTest.URL:We  bDropTargetTest.Data:AutocompleteTextFieldEditorTest.CutCopyTest:DownloadUtilTest.AddFileT  oPasteboardTest:FindPasteboardTest.ReadingFromPboardUpdatesFindText:FindPasteboardTest.Se  ndsNotificationWhenTextChanges:RenderViewTest.MacTestCmdUp:ChromeBrowserWindowTest.D  oesHideTitle:ClearBrowsingDataControllerTest.*:NSMenuItemAdditionsTest.TestMOnDifferentLayo  uts:PrefsControllerTest.GetPrefsViewForPage:PrefsControllerTest.GetToolbarItemForPage:PrefsCon  trollerTest.ShowAndClose:PrefsControllerTest.SwitchToPage:RenderViewTest.OnPrintPages:Render  ViewTest.Print*:TabStripControllerTest.AddRemoveTabs:TaskManagerWindowControllerTest.*:Boo  kmarkAllTabsControllerTest.BookmarkAllTabs:BookmarkFolderTargetTest.* --gtest_print_time  295 (28 direct  267 indirect) bytes in 1 blocks are definitely lost in loss record 13 839 of 15 040    operator new(unsigned long) (mp/vg-chr/scripts/valgrind-  source/coregrind/m_replacemalloc/vg_replace_malloc.c:235)    GeolocationPermissionContextTests::SetUp() (/b/slave/chromium-dbg-mac-  valgrind/build/src/chrome/browser/geolocation/geolocation_permission_context_unittest.cc:65)    testing::Test::Run() (gtest.cc:2090)    testing::internal::TestInfoImpl::Run() (gtest.cc:2314)    testing::TestCase::Run() (gtest.cc:2420)    testing::internal::UnitTestImpl::RunAllTests() (gtest.cc:4024)    testing::UnitTest::Run() (gtest.cc:3687)    TestSuite::Run() (test/test_suite.h:125)    main (/b/slave/chromium-dbg-mac-  valgrind/build/src/chrome/test/unit/run_all_unittests.cc:8)  Suppression:  {     &lt;insert_a_suppression_name_here&gt;     Memcheck:Leak     fun:_Znw*     fun:_ZN33GeolocationPermissionContextTests5SetUpEv     fun:_ZN7testing4Test3RunEv     fun:_ZN7testing8internal12TestInfoImpl3RunEv     fun:_ZN7testing8TestCase3RunEv     fun:_ZN7testing8internal12UnitTestImpl11RunAllTestsEv     fun:_ZN7testing8UnitTest3RunEv     fun:_ZN9TestSuite3RunEv     fun:main  }      10:14:23 valgrind_test.py [INFO] Please see <a href="http://dev.chromium.org/developers/how-">http://dev.chromium.org/developers/how-</a>  tos/using-valgrind for the info on Memcheck/Valgrind  10:14:23 valgrind_test.py [ERROR] Analyze failed.  10:14:23 valgrind_test.py [INFO] elapsed time: 00:47:11    Regression window:   <a href="http://build.chromium.org/buildbot/memory/builders/Chromium%20Mac%20(valgrind)/builds/4">http://build.chromium.org/buildbot/memory/builders/Chromium%20Mac%20(valgrind)/builds/4</a>  144    This looks like <a href="/p/chromium/source/detail?r=43836">r43836</a>.  It's affecting both Mac and Linux. </pre>
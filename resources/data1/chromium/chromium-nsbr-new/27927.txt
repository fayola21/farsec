<title>Issue 27927 -   chromium -    linux hang in RenderViewTest.ImeComposition - Project Hosting on Google Code</title> <pre> Starting in build 7800  Linux unit tests started hanging RenderViewTest.ImeComposition  <a href="http://build.chromium.org/buildbot/waterfall/builders/Chromium%20Linux/builds/7800">http://build.chromium.org/buildbot/waterfall/builders/Chromium%20Linux/builds/7800</a>    The only CL that looked promising from the blamelist was thakis <a href="/p/chromium/source/detail?r=32121">r32121</a>  but reverting that change didn't get rid of the crash.    thakis was able to repro the hang on a non-bot  but only if you run outside of gdb and attach.  Here's his stack trace:    (gdb) bt  #0  0x00007fcd0d171a8b in recvmsg () from /lib/libpthread.so.0  #1  0x0000000001a98f00 in base::RecvMsg (fd=17  buf=0x7fff18d1c750  length=512  fds=0x7fff18d1c630) at /usr/local/google/chrwme/src/base/unix_domain_socket_posix.cc:64  #2  0x0000000001a9946c in base::SendRecvMsg (fd=5  reply=0x7fff18d1c750 &quot;240307321030377177&quot;  max_reply_len=512  result_fd=0x0  request=...)      at /usr/local/google/chrwme/src/base/unix_domain_socket_posix.cc:117  #3  0x00000000015d8304 in renderer_sandbox_support::getFontFamilyForCharacters (utf16=0x7fff18d1ccc0  num_utf16=1) at /usr/local/google/chrwme/src/chrome/renderer/renderer_sandbox_support_linux.cc:26  #4  0x00000000015a324a in RendererWebKitClientImpl::SandboxSupport::getFontFamilyForCharacters (this=0x4da6e58  characters=0x7fff18d1ccc0  num_characters=1)      at /usr/local/google/chrwme/src/chrome/renderer/renderer_webkitclient_impl.cc:293  #5  0x00000000019b8a22 in WebCore::ChromiumBridge::getFontFamilyForCharacters (characters=0x7fff18d1ccc0  numCharacters=1)      at /usr/local/google/chrwme/src/third_party/WebKit/WebKit/chromium/src/ChromiumBridge.cpp:296  #6  0x00000000024b9eea in WebCore::FontCache::getFontDataForCharacters (this=0x4df1660  font=...  characters=0x7fff18d1ccc0  length=1)      at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/platform/graphics/chromium/FontCacheLinux.cpp:61  #7  0x000000000217be19 in WebCore::Font::glyphDataForCharacter (this=0x4de8510  c=20320  mirror=false  forceSmallCaps=false)      at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/platform/graphics/FontFastPath.cpp:151  #8  0x00000000021901f9 in WebCore::WidthIterator::advance (this=0x7fff18d1ce60  offset=1  glyphBuffer=0x0)      at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/platform/graphics/WidthIterator.cpp:116  #9  0x000000000217b123 in WebCore::Font::floatWidthForSimpleText (this=0x4de8510  run=...  glyphBuffer=0x0  fallbackFonts=0x0)      at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/platform/graphics/FontFastPath.cpp:327  #10 0x000000000216e01d in WebCore::Font::floatWidth (this=0x4de8510  run=...  fallbackFonts=0x0) at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/platform/graphics/Font.cpp:198  #11 0x000000000215324b in WebCore::Font::width (this=0x4de8510  run=...  fallbackFonts=0x0) at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/platform/graphics/Font.h:81  #12 0x0000000002226296 in textWidth (text=0x4e6ad38  from=0  len=1  font=...  xPos=0  isFixedPitch=false  collapseWhiteSpace=true)      at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/rendering/RenderBlockLineLayout.cpp:1582  #13 0x000000000222a952 in WebCore::RenderBlock::findNextLineBreak (this=0x4e0f528  resolver=...  firstLine=true  isLineEmpty=@0x7fff18d1d7a6  previousLineBrokeCleanly=@0x7fff18d1d7aa       clear=0x7fff18d1d734) at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/rendering/RenderBlockLineLayout.cpp:1871  #14 0x000000000222d2aa in WebCore::RenderBlock::layoutInlineChildren (this=0x4e0f528  relayoutChildren=false  repaintTop=@0x7fff18d1d8ec  repaintBottom=@0x7fff18d1d8e8)      at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/rendering/RenderBlockLineLayout.cpp:959  #15 0x000000000221034d in WebCore::RenderBlock::layoutBlock (this=0x4e0f528  relayoutChildren=false) at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/rendering/RenderBlock.cpp:722  #16 0x000000000220fcc9 in WebCore::RenderBlock::layout (this=0x4e0f528) at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/rendering/RenderBlock.cpp:648  #17 0x000000000220edcf in WebCore::RenderBlock::layoutBlockChild (this=0x4e1fc98  child=0x4e0f528  marginInfo=...  previousFloatBottom=@0x7fff18d1db44  maxFloatBottom=@0x7fff18d1dc74)      at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/rendering/RenderBlock.cpp:1343  #18 0x000000000220fb66 in WebCore::RenderBlock::layoutBlockChildren (this=0x4e1fc98  relayoutChildren=false  maxFloatBottom=@0x7fff18d1dc74)      at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/rendering/RenderBlock.cpp:1286  #19 0x0000000002210366 in WebCore::RenderBlock::layoutBlock (this=0x4e1fc98  relayoutChildren=false) at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/rendering/RenderBlock.cpp:724  #20 0x000000000220fcc9 in WebCore::RenderBlock::layout (this=0x4e1fc98) at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/rendering/RenderBlock.cpp:648  #21 0x000000000220edcf in WebCore::RenderBlock::layoutBlockChild (this=0x4df14f8  child=0x4e1fc98  marginInfo=...  previousFloatBottom=@0x7fff18d1ded4  maxFloatBottom=@0x7fff18d1e004)      at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/rendering/RenderBlock.cpp:1343  #22 0x000000000220fb66 in WebCore::RenderBlock::layoutBlockChildren (this=0x4df14f8  relayoutChildren=false  maxFloatBottom=@0x7fff18d1e004)      at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/rendering/RenderBlock.cpp:1286  #23 0x0000000002210366 in WebCore::RenderBlock::layoutBlock (this=0x4df14f8  relayoutChildren=false) at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/rendering/RenderBlock.cpp:724  #24 0x000000000220fcc9 in WebCore::RenderBlock::layout (this=0x4df14f8) at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/rendering/RenderBlock.cpp:648  #25 0x000000000220edcf in WebCore::RenderBlock::layoutBlockChild (this=0x4de7fd8  child=0x4df14f8  marginInfo=...  previousFloatBottom=@0x7fff18d1e264  maxFloatBottom=@0x7fff18d1e394)      at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/rendering/RenderBlock.cpp:1343  #26 0x000000000220fb66 in WebCore::RenderBlock::layoutBlockChildren (this=0x4de7fd8  relayoutChildren=false  maxFloatBottom=@0x7fff18d1e394)      at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/rendering/RenderBlock.cpp:1286  #27 0x0000000002210366 in WebCore::RenderBlock::layoutBlock (this=0x4de7fd8  relayoutChildren=false) at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/rendering/RenderBlock.cpp:724  #28 0x000000000220fcc9 in WebCore::RenderBlock::layout (this=0x4de7fd8) at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/rendering/RenderBlock.cpp:648  #29 0x00000000022c2b40 in WebCore::RenderView::layout (this=0x4de7fd8) at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/rendering/RenderView.cpp:122  #30 0x00000000021248b3 in WebCore::FrameView::layout (this=0x4de8730  allowSubtree=true) at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/page/FrameView.cpp:662  #31 0x0000000001f2f047 in WebCore::Document::updateLayout (this=0x4e02530) at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/dom/Document.cpp:1358  #32 0x0000000001fe9afa in WebCore::VisibleSelection::toNormalizedRange (this=0x4dcc340) at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/editing/VisibleSelection.cpp:144  #33 0x0000000001fb15d8 in enclosingDeletableElement (selection=...) at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/editing/DeleteButtonController.cpp:148  #34 0x0000000001fb1f86 in WebCore::DeleteButtonController::enable (this=0x4dcc730) at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/editing/DeleteButtonController.cpp:331  #35 0x0000000001fb308e in WebCore::EditCommand::apply (this=0x4e7f070) at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/editing/EditCommand.cpp:92  #36 0x0000000002458e70 in WebCore::CompositeEditCommand::applyCommandToComposite (this=0x4e6aaa0  cmd=...) at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/editing/CompositeEditCommand.cpp:99  ---Type &lt;return&gt; to continue  or q &lt;return&gt; to quit---  #37 0x000000000245919e in WebCore::CompositeEditCommand::replaceTextInNode (this=0x4e6aaa0  node=...  offset=0  count=5  replacementText=...)      at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/editing/CompositeEditCommand.cpp:335  #38 0x0000000002469c2a in WebCore::InsertTextCommand::performTrivialReplace (this=0x4e6aaa0  text=...  selectInsertedText=true)      at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/editing/InsertTextCommand.cpp:92  #39 0x000000000246a03b in WebCore::InsertTextCommand::input (this=0x4e6aaa0  text=...  selectInsertedText=true) at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/editing/InsertTextCommand.cpp:120  #40 0x0000000001fe2994 in WebCore::TypingCommand::insertTextRunWithoutNewlines (this=0x4e6a990  text=...  selectInsertedText=true)      at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/editing/TypingCommand.cpp:365  #41 0x0000000001fe2a54 in WebCore::TypingCommand::insertText (this=0x4e6a990  text=...  selectInsertedText=true) at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/editing/TypingCommand.cpp:344  #42 0x0000000001fe328b in WebCore::TypingCommand::insertText (document=0x4e02530  text=...  selectionForInsertion=...  selectInsertedText=true  insertedTextIsComposition=true)      at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/editing/TypingCommand.cpp:166  #43 0x0000000001fe3518 in WebCore::TypingCommand::insertText (document=0x4e02530  text=...  selectInsertedText=true  insertedTextIsComposition=true)      at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/editing/TypingCommand.cpp:129  #44 0x0000000001fb5f18 in WebCore::Editor::setComposition (this=0x4dcc458  text=...  underlines=...  selectionStart=2  selectionEnd=2)      at /usr/local/google/chrwme/src/third_party/WebKit/WebCore/editing/Editor.cpp:1451  #45 0x00000000019af33c in WebKit::WebViewImpl::handleCompositionEvent (this=0x4dca120  command=WebKit::WebCompositionCommandSet  cursorPosition=2  targetStart=0  targetEnd=2  imeString=...)      at /usr/local/google/chrwme/src/third_party/WebKit/WebKit/chromium/src/WebViewImpl.cpp:1029  #46 0x0000000001598286 in RenderWidget::OnImeSetComposition (this=0x4dc7df0  command=WebKit::WebCompositionCommandSet  cursor_position=2  target_start=-1  target_end=-1  ime_string=...)      at /usr/local/google/chrwme/src/chrome/renderer/render_widget.cc:758  #47 0x0000000000f45a3b in RenderViewTest_ImeComposition_Test::TestBody (this=0x4da6c30) at /usr/local/google/chrwme/src/chrome/renderer/render_view_unittest.cc:241  #48 0x00000000016d9eef in testing::Test::Run (this=0x4da6c30) at /usr/local/google/chrwme/src/testing/gtest/src/gtest.cc:2099  #49 0x00000000016dd660 in testing::internal::TestInfoImpl::Run (this=0x4ce4c70) at /usr/local/google/chrwme/src/testing/gtest/src/gtest.cc:2318  #50 0x00000000016dd796 in testing::TestCase::Run (this=0x4ce4730) at /usr/local/google/chrwme/src/testing/gtest/src/gtest.cc:2426  #51 0x00000000016de1f5 in testing::internal::UnitTestImpl::RunAllTests (this=0x4cde1d0) at /usr/local/google/chrwme/src/testing/gtest/src/gtest.cc:4026  #52 0x00000000016de345 in testing::UnitTest::Run (this=0x4c8c5e0) at /usr/local/google/chrwme/src/testing/gtest/src/gtest.cc:3694  #53 0x00000000015e9b99 in TestSuite::Run (this=0x7fff18d1f3d0) at /usr/local/google/chrwme/src/base/test/test_suite.h:95  #54 0x00000000015e8411 in main (argc=2  argv=0x7fff18d1f588) at /usr/local/google/chrwme/src/chrome/test/unit/run_all_unittests.cc:8       </pre>
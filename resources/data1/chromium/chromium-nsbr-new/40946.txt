<title>Issue 40946 -   chromium -    Race condition when restarting Chrome on Linux (RestoreAfterClosingTabbedBrowserWithAppAndLaunching) - Project Hosting on Google Code</title> <pre> SessionRestoreUITest.RestoreAfterClosingTabbedBrowserWithAppAndLaunching fails sporadically on Linux (times out):    [ RUN      ] SessionRestoreUITest.FLAKY_RestoreAfterClosingTabbedBrowserWithAppAndLaunching  [25549:25549:1278169834834:ERROR:chrome/browser/chromeos/cros/cros_library_loader.cc(24)] Problem loading chromeos shared object: Couldn't load libcros from: /b/slave/chromium-rel-linux-  chromiumos/build/src/out/Release/chromeos/libcros.so error: /b/slave/chromium-rel-linux-chromiumos/build/src/out/Release/chromeos/libcros.so: cannot open shared object file: No such file or directory  [25549:25549:1278169956142:ERROR:chrome/browser/chromeos/cros/mount_library.cc(65)] Cros Library has not been loaded  [22707:22707:0409/061418:1278170021403:ERROR:chrome/test/ui/ui_test.cc(1240)] Not implemented reached in bool UITestBase::LaunchBrowserHelper(const CommandLine&amp;  bool  bool  base::ProcessHandle*)  [25565:25565:1278170044639:ERROR:chrome/browser/chromeos/cros/cros_library_loader.cc(24)] Problem loading chromeos shared object: Couldn't load libcros from: /b/slave/chromium-rel-linux-  chromiumos/build/src/out/Release/chromeos/libcros.so error: /b/slave/chromium-rel-linux-chromiumos/build/src/out/Release/chromeos/libcros.so: cannot open shared object file: No such file or directory  Created new window in existing browser session.  [25582:25582:1278170126924:ERROR:chrome/browser/chromeos/cros/cros_library_loader.cc(24)] Problem loading chromeos shared object: Couldn't load libcros from: /b/slave/chromium-rel-linux-  chromiumos/build/src/out/Release/chromeos/libcros.so error: /b/slave/chromium-rel-linux-chromiumos/build/src/out/Release/chromeos/libcros.so: cannot open shared object file: No such file or directory  [25582:25582:1278170130917:ERROR:chrome/browser/process_singleton_linux.cc(174)] read() failed: Connection reset by peer  process killed by signal 9  program finished with exit code -1  elapsedTime=134.889560    More debug information by way of dbelenko - this seems to be a race condition in the linux &quot;start a new process while the old process is exiting&quot; code. Here's some additional investigation details:    There are three browser launch attempts in this test. First one succeeds. Second one passes control to the first    as it should. Third one successfully connects to a socket  but then fails to receive ACK  and fails to kill the   process since by the time it tries to kill  the other process already deletes the SingletonLock. I stuffed it with   some debug output and here's the gist of what's going on. The only explanation I have to this is that teardown   routine does not fully ensure that the processor has completely exited (at least on Linux)  and even though it   says it did  there's still a socket open (as you see we establish connection just fine). We then write into that   socket  but it quits before sending ACK back to us  so we attempt to kill the process  but it has already deleted   the lock. Race condition.    This did not show up before because browser main would hit the disk to read the profile  which would   presumably introduce a few ms of latency  which was sufficient for the other process to exit and close the   socket.    Inserting sleep(1) into browser main makes this never happen again. Merely adding debug output statements   makes this not happen every time.     Browser instance #1:  [18633:18633:811803408729:ERROR:chrome/browser/process_singleton_linux.cc(656)] **   NotifyOtherProcessWithTimeout start  [18633:18633:811803408826:ERROR:chrome/browser/process_singleton_linux.cc(245)] ** ParseLockPath   enter  [18633:18633:811803531779:ERROR:chrome/browser/process_singleton_linux.cc(231)] ** UnlinkPath enter  [18633:18633:811803531938:ERROR:chrome/browser/process_singleton_linux.cc(233)] ** unlink return val -  1  [18633:18641:811803532158:ERROR:chrome/browser/process_singleton_linux.cc(475)] ** StartListening   enter  [18633:18641:811803532320:ERROR:chrome/browser/process_singleton_linux.cc(482)] ** StartListening   leave    Browser instance #2:  [18649:18649:811807347627:ERROR:chrome/browser/process_singleton_linux.cc(656)] **   NotifyOtherProcessWithTimeout start  [18649:18649:811807347730:ERROR:chrome/browser/process_singleton_linux.cc(709)] ** Connected OK  [18649:18649:811807347799:ERROR:chrome/browser/process_singleton_linux.cc(740)] ** Wrote to socket   successfully  [18633:18641:811807347861:ERROR:chrome/browser/process_singleton_linux.cc(347)] ** SocketReader ctor   begin  [18633:18641:811807347994:ERROR:chrome/browser/process_singleton_linux.cc(354)] ** SocketReader ctor   end  [18633:18633:811807348303:ERROR:chrome/browser/process_singleton_linux.cc(489)] ** HandleMessage   enter  Created new window in existing browser session.  [18629:18629:0408/212840:811808335245:WARNING:chrome/test/ui/ui_test.cc(425)] ** Quitting browser  [18633:18633:811808510584:ERROR:chrome/browser/process_singleton_linux.cc(231)] ** UnlinkPath enter  [18633:18633:811808510694:ERROR:chrome/browser/process_singleton_linux.cc(233)] ** unlink return val 0    Browser instance #3:  [18663:18663:811808797119:ERROR:chrome/browser/process_singleton_linux.cc(656)] **   NotifyOtherProcessWithTimeout start  [18633:18641:811808797342:ERROR:chrome/browser/process_singleton_linux.cc(347)] ** SocketReader ctor   begin  [18633:18641:811808797409:ERROR:chrome/browser/process_singleton_linux.cc(354)] ** SocketReader ctor   end  [18663:18663:811808797516:ERROR:chrome/browser/process_singleton_linux.cc(709)] ** Connected OK  [18663:18663:811808797652:ERROR:chrome/browser/process_singleton_linux.cc(740)] ** Wrote to socket   successfully  [18663:18663:811811056139:ERROR:chrome/browser/process_singleton_linux.cc(753)] ** Failed to read ACK:   Success  [18663:18663:811811056483:ERROR:chrome/browser/process_singleton_linux.cc(292)] **   KillProcessByLockPath entered  [18663:18663:811811056550:ERROR:chrome/browser/process_singleton_linux.cc(245)] ** ParseLockPath   enter  [18663:18663:811811056640:ERROR:chrome/browser/process_singleton_linux.cc(295)] ** Path   /tmp/org.chromium.JG861d/test_user_data/SingletonLock  [18663:18663:811811056929:ERROR:chrome/browser/process_singleton_linux.cc(296)] ** PID 32767  [18663:18663:811811057285:ERROR:chrome/browser/process_singleton_linux.cc(231)] ** UnlinkPath enter  [18663:18663:811811057520:ERROR:chrome/browser/process_singleton_linux.cc(233)] ** unlink return val -  1  [18663:18663:811811057589:ERROR:chrome/browser/process_singleton_linux.cc(305)] ** Trying to kill  [18663:18663:811811057698:FATAL:chrome/browser/process_singleton_linux.cc(308)] Check failed: 0 == rv   (0 vs. -1)Error killing process: No such process    I'm going to disable this test for now. </pre>
<title>Issue 42958 -   chromium -    Valgrind leaks in NPN_RegisterObject - Project Hosting on Google Code</title> <pre> <a href="http://build.chromium.org/buildbot/memory/builders/Webkit%20Linux%20(valgrind%20layout)/b">http://build.chromium.org/buildbot/memory/builders/Webkit%20Linux%20(valgrind%20layout)/b</a>  uilds/8354/steps/valgrind%20test:%20layout/logs/stdio    Command: /b/slave/webkit-rel-linux-valgrind-layout/build/src/sconsbuild/Release/test_shell -  -layout-tests --pixel-tests=/b/slave/webkit-rel-linux-valgrind-  layout/build/src/webkit/Release/layout-test-results/png_result3.png  20 bytes in 1 blocks are definitely lost in loss record 3 990 of 8 861    malloc (mp/scripts/valgrind-memcheck/coregrind/m_replacemalloc/vg_replace_malloc.c:241)    WTF::fastMalloc(unsigned int) (third_party/WebKit/JavaScriptCore/wtf/FastMalloc.cpp:249)    WTF::FastAllocBase::operator new(unsigned int)   (third_party/WebKit/JavaScriptCore/wtf/FastAllocBase.h:96)    _NPN_RegisterObject (third_party/WebKit/WebCore/bindings/v8/npruntime.cpp:375)    WebCore::ScriptController::windowScriptNPObject()   (third_party/WebKit/WebCore/bindings/v8/ScriptController.cpp:403)    WebKit::WebFrameImpl::windowObject() const   (third_party/WebKit/WebKit/chromium/src/WebFrameImpl.cpp:707)    webkit_glue::WebPluginImpl::GetWindowScriptNPObject()   (webkit/glue/plugins/webplugin_impl.cc:636)    NPN_GetValue (webkit/glue/plugins/plugin_host.cc:662)    executeScript(PluginObject const*  char const*)   (webkit/tools/npapi_layout_test_plugin/main.cpp:206)    NPP_URLNotify (webkit/tools/npapi_layout_test_plugin/main.cpp:446)    NPAPI::PluginInstance::NPP_URLNotify(char const*  short  void*)   (webkit/glue/plugins/plugin_instance.cc:301)    NPAPI::PluginStream::Notify(short) (webkit/glue/plugins/plugin_stream.cc:249)    NPAPI::PluginStream::Open(std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt;   &gt; const&amp;  std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; const&amp;    unsigned int  unsigned int  bool) (webkit/glue/plugins/plugin_stream.cc:71)    NPAPI::PluginStreamUrl::DidReceiveResponse(std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const&amp;  std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const&amp;  unsigned int  unsigned int  bool)   (webkit/glue/plugins/plugin_stream_url.cc:58)    webkit_glue::WebPluginImpl::didReceiveResponse(WebKit::WebURLLoader*    WebKit::WebURLResponse const&amp;) (webkit/glue/plugins/webplugin_impl.cc:798)      webkit_glue::WebURLLoaderImpl::Context::OnReceivedResponse(webkit_glue::ResourceLoaderBrid  ge::ResponseInfo const&amp;  bool) (webkit/glue/weburlloader_impl.cc:482)    webkit_glue::WebURLLoaderImpl::Context::HandleDataURL()   (webkit/glue/weburlloader_impl.cc:578)    void DispatchToMethod&lt;webkit_glue::WebURLLoaderImpl::Context  void   (webkit_glue::WebURLLoaderImpl::Context::*)()&gt;(webkit_glue::WebURLLoaderImpl::Context*  void   (webkit_glue::WebURLLoaderImpl::Context::*)()  Tuple0 const&amp;) (./base/tuple.h:412)    RunnableMethod&lt;webkit_glue::WebURLLoaderImpl::Context  void   (webkit_glue::WebURLLoaderImpl::Context::*)()  Tuple0&gt;::Run() (./base/task.h:296)    MessageLoop::RunTask(Task*) (base/message_loop.cc:328)    MessageLoop::DeferOrRunPendingTask(MessageLoop::PendingTask const&amp;)   (base/message_loop.cc:336)    MessageLoop::DoWork() (base/message_loop.cc:443)    base::MessagePumpForUI::RunWithDispatcher(base::MessagePump::Delegate*    base::MessagePumpForUI::Dispatcher*) (base/message_pump_glib.cc:199)    base::MessagePumpForUI::Run(base::MessagePump::Delegate*)   (./base/message_pump_glib.h:59)    MessageLoop::RunInternal() (base/message_loop.cc:204)    MessageLoop::RunHandler() (base/message_loop.cc:176)    MessageLoop::Run() (base/message_loop.cc:154)    TestShell::WaitTestFinished() (webkit/tools/test_shell/test_shell_gtk.cc:458)    TestShell::RunFileTest(TestShell::TestParams const&amp;)   (webkit/tools/test_shell/test_shell_gtk.cc:572)    main (webkit/tools/test_shell/test_shell_main.cc:348)  Suppression:  {     &lt;insert_a_suppression_name_here&gt;     Memcheck:Leak     fun:malloc     fun:_ZN3WTF10fastMallocEj     fun:_ZN3WTF13FastAllocBasenwEj     fun:_NPN_RegisterObject     fun:_ZN7WebCore16ScriptController20windowScriptNPObjectEv     fun:_ZNK6WebKit12WebFrameImpl12windowObjectEv     fun:_ZN11webkit_glue13WebPluginImpl23GetWindowScriptNPObjectEv     fun:NPN_GetValue     fun:_Z13executeScriptPK12PluginObjectPKc     fun:NPP_URLNotify     fun:_ZN5NPAPI14PluginInstance13NPP_URLNotifyEPKcsPv     fun:_ZN5NPAPI12PluginStream6NotifyEs     fun:_ZN5NPAPI12PluginStream4OpenERKSsS2_jjb     fun:_ZN5NPAPI15PluginStreamUrl18DidReceiveResponseERKSsS2_jjb       fun:_ZN11webkit_glue13WebPluginImpl18didReceiveResponseEPN6WebKit12WebURLLoaderERKNS  1_14WebURLResponseE       fun:_ZN11webkit_glue16WebURLLoaderImpl7Context18OnReceivedResponseERKNS_20ResourceL  oaderBridge12ResponseInfoEb     fun:_ZN11webkit_glue16WebURLLoaderImpl7Context13HandleDataURLEv       fun:_Z16DispatchToMethodIN11webkit_glue16WebURLLoaderImpl7ContextEMS2_FvvEEvPT_T0_RK  6Tuple0       fun:_ZN14RunnableMethodIN11webkit_glue16WebURLLoaderImpl7ContextEMS2_FvvE6Tuple0E3R  unEv     fun:_ZN11MessageLoop7RunTaskEP4Task     fun:_ZN11MessageLoop21DeferOrRunPendingTaskERKNS_11PendingTaskE     fun:_ZN11MessageLoop6DoWorkEv  }    10:52:34 memcheck_analyze.py [ERROR] Leak_DefinitelyLost  Command: /b/slave/webkit-rel-linux-valgrind-layout/build/src/sconsbuild/Release/test_shell -  -layout-tests --pixel-tests=/b/slave/webkit-rel-linux-valgrind-  layout/build/src/webkit/Release/layout-test-results/png_result3.png  276 (20 direct  256 indirect) bytes in 1 blocks are definitely lost in loss record 8 308 of 8 685    malloc (mp/scripts/valgrind-memcheck/coregrind/m_replacemalloc/vg_replace_malloc.c:241)    WTF::fastMalloc(unsigned int) (third_party/WebKit/JavaScriptCore/wtf/FastMalloc.cpp:249)    WTF::FastAllocBase::operator new(unsigned int)   (third_party/WebKit/JavaScriptCore/wtf/FastAllocBase.h:96)    _NPN_RegisterObject (third_party/WebKit/WebCore/bindings/v8/npruntime.cpp:375)    WebCore::ScriptController::windowScriptNPObject()   (third_party/WebKit/WebCore/bindings/v8/ScriptController.cpp:403)    WebKit::WebFrameImpl::windowObject() const   (third_party/WebKit/WebKit/chromium/src/WebFrameImpl.cpp:707)    webkit_glue::WebPluginImpl::GetWindowScriptNPObject()   (webkit/glue/plugins/webplugin_impl.cc:636)    NPN_GetValue (webkit/glue/plugins/plugin_host.cc:662)    testWindowOpen(_NPP*) (webkit/tools/npapi_layout_test_plugin/PluginObject.cpp:749)    NPP_SetWindow (webkit/tools/npapi_layout_test_plugin/main.cpp:190)    NPAPI::PluginInstance::NPP_SetWindow(_NPWindow*)   (webkit/glue/plugins/plugin_instance.cc:228)    WebPluginDelegateImpl::WindowlessSetWindow()   (webkit/glue/plugins/webplugin_delegate_impl_gtk.cc:473)    WebPluginDelegateImpl::WindowlessUpdateGeometry(gfx::Rect const&amp;  gfx::Rect const&amp;)   (webkit/glue/plugins/webplugin_delegate_impl_gtk.cc:233)    WebPluginDelegateImpl::UpdateGeometry(gfx::Rect const&amp;  gfx::Rect const&amp;)   (webkit/glue/plugins/webplugin_delegate_impl.cc:142)    webkit_glue::WebPluginImpl::updateGeometry(WebKit::WebRect const&amp;  WebKit::WebRect const&amp;    WebKit::WebVector&lt;WebKit::WebRect&gt; const&amp;  bool)   (webkit/glue/plugins/webplugin_impl.cc:276)    WebKit::WebPluginContainerImpl::reportGeometry()   (third_party/WebKit/WebKit/chromium/src/WebPluginContainerImpl.cpp:261)    WebKit::WebPluginContainerImpl::setParent(WebCore::ScrollView*)   (third_party/WebKit/WebKit/chromium/src/WebPluginContainerImpl.cpp:209)    WebCore::ScrollView::addChild(WTF::PassRefPtr&lt;WebCore::Widget&gt;)   (third_party/WebKit/WebCore/platform/ScrollView.cpp:69)    WebCore::moveWidgetToParentSoon(WebCore::Widget*  WebCore::FrameView*)   (third_party/WebKit/WebCore/rendering/RenderWidget.cpp:84)    WebCore::RenderWidget::setWidget(WTF::PassRefPtr&lt;WebCore::Widget&gt;)   (third_party/WebKit/WebCore/rendering/RenderWidget.cpp:196)    WebCore::RenderPart::setWidget(WTF::PassRefPtr&lt;WebCore::Widget&gt;)   (third_party/WebKit/WebCore/rendering/RenderPart.cpp:50)    WebCore::FrameLoader::loadPlugin(WebCore::RenderEmbeddedObject*  WebCore::KURL const&amp;    WebCore::String const&amp;  WTF::Vector&lt;WebCore::String  0u&gt; const&amp;    WTF::Vector&lt;WebCore::String  0u&gt; const&amp;  bool)   (third_party/WebKit/WebCore/loader/FrameLoader.cpp:1226)    WebCore::FrameLoader::requestObject(WebCore::RenderEmbeddedObject*  WebCore::String   const&amp;  WebCore::AtomicString const&amp;  WebCore::String const&amp;  WTF::Vector&lt;WebCore::String    0u&gt; const&amp;  WTF::Vector&lt;WebCore::String  0u&gt; const&amp;)   (third_party/WebKit/WebCore/loader/FrameLoader.cpp:1137)    WebCore::RenderEmbeddedObject::updateWidget(bool)   (third_party/WebKit/WebCore/rendering/RenderEmbeddedObject.cpp:287)    WebCore::FrameView::updateWidgets()   (third_party/WebKit/WebCore/page/FrameView.cpp:1442)    WebCore::FrameView::performPostLayoutTasks()   (third_party/WebKit/WebCore/page/FrameView.cpp:1472)    WebCore::FrameView::layout(bool) (third_party/WebKit/WebCore/page/FrameView.cpp:774)    WebCore::Document::implicitClose() (third_party/WebKit/WebCore/dom/Document.cpp:1883)    WebCore::FrameLoader::checkCallImplicitClose()   (third_party/WebKit/WebCore/loader/FrameLoader.cpp:1042)    WebCore::FrameLoader::checkCompleted()   (third_party/WebKit/WebCore/loader/FrameLoader.cpp:990)  Suppression:  {     &lt;insert_a_suppression_name_here&gt;     Memcheck:Leak     fun:malloc     fun:_ZN3WTF10fastMallocEj     fun:_ZN3WTF13FastAllocBasenwEj     fun:_NPN_RegisterObject     fun:_ZN7WebCore16ScriptController20windowScriptNPObjectEv     fun:_ZNK6WebKit12WebFrameImpl12windowObjectEv     fun:_ZN11webkit_glue13WebPluginImpl23GetWindowScriptNPObjectEv     fun:NPN_GetValue     fun:_Z14testWindowOpenP4_NPP     fun:NPP_SetWindow     fun:_ZN5NPAPI14PluginInstance13NPP_SetWindowEP9_NPWindow     fun:_ZN21WebPluginDelegateImpl19WindowlessSetWindowEv     fun:_ZN21WebPluginDelegateImpl24WindowlessUpdateGeometryERKN3gfx4RectES3_     fun:_ZN21WebPluginDelegateImpl14UpdateGeometryERKN3gfx4RectES3_       fun:_ZN11webkit_glue13WebPluginImpl14updateGeometryERKN6WebKit7WebRectES4_RKNS1_9W  ebVectorIS2_EEb     fun:_ZN6WebKit22WebPluginContainerImpl14reportGeometryEv     fun:_ZN6WebKit22WebPluginContainerImpl9setParentEPN7WebCore10ScrollViewE     fun:_ZN7WebCore10ScrollView8addChildEN3WTF10PassRefPtrINS_6WidgetEEE     fun:_ZN7WebCore22moveWidgetToParentSoonEPNS_6WidgetEPNS_9FrameViewE     fun:_ZN7WebCore12RenderWidget9setWidgetEN3WTF10PassRefPtrINS_6WidgetEEE     fun:_ZN7WebCore10RenderPart9setWidgetEN3WTF10PassRefPtrINS_6WidgetEEE       fun:_ZN7WebCore11FrameLoader10loadPluginEPNS_20RenderEmbeddedObjectERKNS_4KURLERKN  S_6StringERKN3WTF6VectorIS6_Lj0EEESD_b  } </pre>
<title>Issue 29085 -   chromium -    DCHECK in RefCountedThreadSafeBase::AddRef - Project Hosting on Google Code</title> <pre> I was working on some code where I needed to test UMA changes  so I turned on the metrics service which is normally disabled (I   disabled the #ifdef in browser_main.cc that always turns it off if GOOGLE_CHROME_BUILD is not defined). I temporarily undid all   the rest of my local changes  but have not tried a full build with GOOGLE_CHROME_BUILD so it's possible there some other code   ifdef'ed behind GOOGLE_CHROME_BUILD that would cause this not to happen.     After running the browser for about 1-2 minutes  I get a DCHECK from RefCountedThreadSafeBase::AddRef because in_dtor_ is true.   The stack (copied below) makes it look like this is coming from MemoryDetails::StartFetch().    jam  I'm CC'ing you in case this might be related to the ref counting destructors change you did a while back.        	chrome.dll!DebugUtil::BreakDebugger()  Line 222	C++   	chrome.dll!logging::LogMessage::~LogMessage()  Line 550	C++  &gt;	chrome.dll!base::subtle::RefCountedThreadSafeBase::AddRef()  Line 71	C++   	chrome.dll!base::RefCountedThreadSafe&lt;MemoryDetails base::DefaultRefCountedThreadSafeTraits&lt;MemoryDetails&gt; &gt;::AddRef()    Line 136	C++   	chrome.dll!RunnableMethodTraits&lt;MemoryDetails&gt;::RetainCallee(obj)  Line 232	C++   	chrome.dll!RunnableMethod&lt;MemoryDetails void (__thiscall   MemoryDetails::*)(void) Tuple0&gt;::RunnableMethod&lt;MemoryDetails void (__thiscall MemoryDetails::*)(void) Tuple0&gt;(obj  meth    params)  Line 276	C++   	chrome.dll!NewRunnableMethod&lt;MemoryDetails void (__thiscall MemoryDetails::*)(void)&gt;(object  method)  Line 307	C++   	chrome.dll!MemoryDetails::StartFetch()  Line 46	C++   	chrome.dll!MetricsService::LogTransmissionTimerDone()  Line 947	C++   	chrome.dll!DispatchToMethod&lt;MetricsService void (__thiscall MetricsService::*)(void)&gt;(obj  method  arg)  Line 412	  C++   	chrome.dll!ScopedRunnableMethodFactory&lt;MetricsService&gt;::RunnableMethod&lt;void (__thiscall   MetricsService::*)(void) Tuple0&gt;::Run()  Line 147	C++   	chrome.dll!MessageLoop::RunTask(task)  Line 320	C++   	chrome.dll!MessageLoop::DeferOrRunPendingTask(pending_task)  Line 331	C++   	chrome.dll!MessageLoop::DoDelayedWork(next_delayed_work_time)  Line 463	C++   	chrome.dll!base::MessagePumpForUI::DoRunLoop()  Line 214	C++   	chrome.dll!base::MessagePumpWin::RunWithDispatcher(delegate  dispatcher)  Line 52	C++   	chrome.dll!MessageLoop::RunInternal()  Line 201	C++   	chrome.dll!MessageLoop::RunHandler()  Line 178	C++   	chrome.dll!MessageLoopForUI::Run(dispatcher)  Line 606	C++   	chrome.dll!`anonymous namespace'::RunUIMessageLoop(browser_process)  Line 164	C++   	chrome.dll!BrowserMain(parameters)  Line 900	C++   	chrome.dll!ChromeMain(instance  sandbox_info  command_line)  Line 643	C++   </pre>
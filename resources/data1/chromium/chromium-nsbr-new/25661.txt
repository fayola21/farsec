<title>Issue 25661 -   chromium -    Invalid read in scoped_ptr&lt;ChildThread&gt;::get() in worker process on Mac UI valgrind 3 - Project Hosting on Google Code</title> <pre> Seems to be happening pretty persistently on Mac UI valgrind 3. Example:  <a href="http://build.chromium.org/buildbot/waterfall.fyi/builders/Chromium%20M">http://build.chromium.org/buildbot/waterfall.fyi/builders/Chromium%20M</a>  ac%20UI%20(valgrind)(3)/builds/1479/steps/valgrind%20test:%20ui/logs/st  dio    Invalid read of size 4    scoped_ptr&lt;ChildThread&gt;::get() const (scoped_ptr.h:96)    ChildProcess::main_thread() (child_process.h:23)    ChildThread::current() (/b/slave/chromium-rel-mac-valgrind-ui-  3/build/src/chrome/common/child_thread.cc:141)    WebMessagePortChannelImpl::postMessage(WebKit::WebString const&amp;    WebKit::WebVector&lt;WebKit::WebMessagePortChannel*&gt;*)   (/b/slave/chromium-rel-mac-valgrind-ui-  3/build/src/chrome/common/webmessageportchannel_impl.cc:80)      WebCore::PlatformMessagePortChannel::postMessageToRemote(WTF::Pass  OwnPtr&lt;WebCore::MessagePortChannel::EventData&gt;) (/b/slave/chromium-  rel-mac-valgrind-ui-  3/build/src/webkit/api/src/PlatformMessagePortChannel.cpp:193)      WebCore::MessagePortChannel::postMessageToRemote(WTF::PassOwnPtr&lt;  WebCore::MessagePortChannel::EventData&gt;) (/b/slave/chromium-rel-  mac-valgrind-ui-  3/build/src/webkit/api/src/PlatformMessagePortChannel.cpp:80)      WebCore::MessagePort::postMessage(WTF::PassRefPtr&lt;WebCore::Serialized  ScriptValue&gt;  WTF::Vector&lt;WTF::RefPtr&lt;WebCore::MessagePort&gt;  1ul&gt;   const*  int&amp;) (/b/slave/chromium-rel-mac-valgrind-ui-  3/build/src/third_party/WebKit/WebCore/WebCore.gyp/../dom/MessagePo  rt.cpp:92)    WebCore::V8Custom::v8MessagePortPostMessageCallback(v8::Arguments   const&amp;) (/b/slave/chromium-rel-mac-valgrind-ui-  3/build/src/third_party/WebKit/WebCore/WebCore.gyp/../bindings/v8/cus  tom/V8MessagePortCustom.cpp:88)    v8::internal::Builtin_HandleApiCall(v8::internal::Arguments)   (builtins.cc:383)    0x114BA18A    0x114CC3C4    0x114C91B8    0x114BAE81    v8::internal::Invoke(bool  v8::internal::Handle&lt;v8::internal::JSFunction&gt;    v8::internal::Handle&lt;v8::internal::Object&gt;  int  v8::internal::Object***    bool*) (execution.cc:99)    v8::internal::Execution::Call(v8::internal::Handle&lt;v8::internal::JSFunction&gt;    v8::internal::Handle&lt;v8::internal::Object&gt;  int  v8::internal::Object***    bool*) (execution.cc:129)    v8::Function::Call(v8::Handle&lt;v8::Object&gt;  int  v8::Handle&lt;v8::Value&gt;*)   (api.cc:2345)      WebCore::V8WorkerContextEventListener::callListenerFunction(WebCore::Sc  riptExecutionContext*  v8::Handle&lt;v8::Value&gt;  WebCore::Event*)   (/b/slave/chromium-rel-mac-valgrind-ui-  3/build/src/third_party/WebKit/WebCore/WebCore.gyp/../bindings/v8/V8  WorkerContextEventListener.cpp:144)      WebCore::V8AbstractEventListener::invokeEventHandler(WebCore::ScriptExe  cutionContext*  WebCore::Event*  v8::Handle&lt;v8::Value&gt;)   (/b/slave/chromium-rel-mac-valgrind-ui-  3/build/src/third_party/WebKit/WebCore/WebCore.gyp/../bindings/v8/V8  AbstractEventListener.cpp:150)      WebCore::V8WorkerContextEventListener::handleEvent(WebCore::ScriptExec  utionContext*  WebCore::Event*) (/b/slave/chromium-rel-mac-valgrind-  ui-  3/build/src/third_party/WebKit/WebCore/WebCore.gyp/../bindings/v8/V8  WorkerContextEventListener.cpp:82)    WebCore::EventTarget::fireEventListeners(WebCore::Event*)   (/b/slave/chromium-rel-mac-valgrind-ui-  3/build/src/third_party/WebKit/WebCore/WebCore.gyp/../dom/EventTarg  et.cpp:276)    WebCore::EventTarget::dispatchEvent(WTF::PassRefPtr&lt;WebCore::Event&gt;)   (/b/slave/chromium-rel-mac-valgrind-ui-  3/build/src/third_party/WebKit/WebCore/WebCore.gyp/../dom/EventTarg  et.cpp:247)      WebWorkerImpl::PostMessageToWorkerContextTask(WebCore::ScriptExecuti  onContext*  WebWorkerImpl*  WebCore::String const&amp;    WTF::PassOwnPtr&lt;WTF::Vector&lt;WTF::OwnPtr&lt;WebCore::MessagePortChann  el&gt;  1ul&gt; &gt;) (/b/slave/chromium-rel-mac-valgrind-ui-  3/build/src/webkit/glue/webworker_impl.cc:130)    WebCore::GenericWorkerTask3&lt;WebWorkerImpl*  WebWorkerImpl*    WebCore::String  WebCore::String const&amp;    WTF::Vector&lt;WTF::OwnPtr&lt;WebCore::MessagePortChannel&gt;  1ul&gt;*    WTF::PassOwnPtr&lt;WTF::Vector&lt;WTF::OwnPtr&lt;WebCore::MessagePortChann  el&gt;  1ul&gt; &gt; &gt;::performTask(WebCore::ScriptExecutionContext*)   (GenericWorkerTask.h:152)      WebCore::WorkerRunLoop::Task::performTask(WebCore::ScriptExecutionCo  ntext*) (/b/slave/chromium-rel-mac-valgrind-ui-  3/build/src/third_party/WebKit/WebCore/WebCore.gyp/../workers/Worker  RunLoop.cpp:75)    WebCore::WorkerRunLoop::runInMode(WebCore::WorkerContext*    WebCore::ModePredicate const&amp;) (/b/slave/chromium-rel-mac-valgrind-  ui-  3/build/src/third_party/WebKit/WebCore/WebCore.gyp/../workers/Worker  RunLoop.cpp:185)    WebCore::WorkerRunLoop::run(WebCore::WorkerContext*)   (/b/slave/chromium-rel-mac-valgrind-ui-  3/build/src/third_party/WebKit/WebCore/WebCore.gyp/../workers/Worker  RunLoop.cpp:154)    WebCore::WorkerThread::runEventLoop() (/b/slave/chromium-rel-mac-  valgrind-ui-  3/build/src/third_party/WebKit/WebCore/WebCore.gyp/../workers/Worker  Thread.cpp:154)    WebCore::DedicatedWorkerThread::runEventLoop() (/b/slave/chromium-  rel-mac-valgrind-ui-  3/build/src/third_party/WebKit/WebCore/WebCore.gyp/../workers/Dedicat  edWorkerThread.cpp:66)    WebCore::WorkerThread::workerThread() (/b/slave/chromium-rel-mac-  valgrind-ui-  3/build/src/third_party/WebKit/WebCore/WebCore.gyp/../workers/Worker  Thread.cpp:134)    WebCore::WorkerThread::workerThreadStart(void*) (/b/slave/chromium-  rel-mac-valgrind-ui-  3/build/src/third_party/WebKit/WebCore/WebCore.gyp/../workers/Worker  Thread.cpp:111)   </pre>
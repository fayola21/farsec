<title>Issue 37709 -   chromium -    Bookmark Sync can not call BookmarkModel functions on background thread - Project Hosting on Google Code</title> <pre> BookmarkModel should be used only on UI thread    I can find instances of this kind of violation in bookmark sync code. For   example CreateBookmarkNode calls into BookmarkModel::AddGroup and   BookmarkModel::AddURL.    const BookmarkNode* BookmarkChangeProcessor::CreateBookmarkNode(      sync_api::BaseNode* sync_node       const BookmarkNode* parent       BookmarkModel* model       int index) {    DCHECK(parent);    DCHECK(index &gt;= 0 &amp;&amp; index &lt;= parent-&gt;GetChildCount());      const BookmarkNode* node;    if (sync_node-&gt;GetIsFolder()) {      node = model-&gt;AddGroup(parent  index  sync_node-&gt;GetTitle());    } else {      node = model-&gt;AddURL(parent  index                            sync_node-&gt;GetTitle()  sync_node-&gt;GetURL());      SetBookmarkFavicon(sync_node  node  model-&gt;profile());    }    return node;  }    It will be good to check all the callings to BookmarkModel and other   classes that should be called in UI thread.    The above code will eventually lead to crashes like the following:    http://crash/reportdetail?reportid=9b1edc54ae58436f    0600eb04 01f891b6 chrome_1c30000!NotificationService::HasKey+0xa   [c:bslavechrome-officialbuildsrcchromecommonnotification_service.cc   @ 21]  0600eb30 01e153f9 chrome_1c30000!NotificationService::Notify+0x25   [c:bslavechrome-officialbuildsrcchromecommonnotification_service.cc   @ 121]  0600eb74 01e14c09 chrome_1c30000!BookmarkModel::AddNode+0xcc   [c:bslavechrome-  officialbuildsrcchromebrowserbookmarksbookmark_model.cc @ 684]  0600eba8 01e14b0a chrome_1c30000!BookmarkModel::AddURLWithCreationTime+0xfb   [c:bslavechrome-  officialbuildsrcchromebrowserbookmarksbookmark_model.cc @ 415]  0600ebd4 01f22cff chrome_1c30000!BookmarkModel::AddURL+0x25   [c:bslavechrome-  officialbuildsrcchromebrowserbookmarksbookmark_model.cc @ 375]  0600ec7c 01f22c0f   chrome_1c30000!browser_sync::BookmarkChangeProcessor::CreateBookmarkNode+0x  6a [c:bslavechrome-  officialbuildsrcchromebrowsersyncgluebookmark_change_processor.cc @   484]  0600ed20 01f22afa   chrome_1c30000!browser_sync::BookmarkChangeProcessor::CreateOrUpdateBookmar  kNode+0x84 [c:bslavechrome-  officialbuildsrcchromebrowsersyncgluebookmark_change_processor.cc @   449]  0600ee10 01eb64f8   chrome_1c30000!browser_sync::BookmarkChangeProcessor::ApplyChangesFromSyncM  odel+0x17a [c:bslavechrome-  officialbuildsrcchromebrowsersyncgluebookmark_change_processor.cc @   416]  0600ee40 024a6cac   chrome_1c30000!browser_sync::SyncBackendHost::Core::OnChangesApplied+0x79   [c:bslavechrome-  officialbuildsrcchromebrowsersyncgluesync_backend_host.cc @ 336]  0600ee84 024a6bee   chrome_1c30000!sync_api::SyncManager::SyncInternal::HandleTransactionComple  teChangeEvent+0x81 [c:bslavechrome-  officialbuildsrcchromebrowsersyncenginesyncapi.cc @ 1572]  0600ee9c 024a79a4   chrome_1c30000!sync_api::SyncManager::SyncInternal::HandleChangeEvent+0x18   [c:bslavechrome-officialbuildsrcchromebrowsersyncenginesyncapi.cc   @ 1539]  0600eeb4 024bc5f9   chrome_1c30000!EventListenerHookupImpl&lt;EventChannel&lt;browser_sync::SyncerEve  nt Lock AutoLock&gt; browser_sync::SyncerEvent SimpleHookup&lt;EventChannel&lt;brows  er_sync::SyncerEvent Lock AutoLock&gt; browser_sync::SyncerEvent sync_api::Syn  cManager::SyncInternal void (__thiscall   sync_api::SyncManager::SyncInternal::*)(browser_sync::SyncerEvent const &amp;)&gt;   &gt;::HandleEvent+0x1c [c:bslavechrome-  officialbuildsrcchromebrowsersyncutilevent_sys-inl.h @ 254]  0600eeec 024b9e9b   chrome_1c30000!EventChannel&lt;syncable::DirectoryChangeEvent Lock AutoLock&gt;::  NotifyListeners+0xa0 [c:bslavechrome-  officialbuildsrcchromebrowsersyncutilevent_sys-inl.h @ 186]  0600ef30 024ba096   chrome_1c30000!syncable::BaseTransaction::UnlockAndLog+0x98   [c:bslavechrome-  officialbuildsrcchromebrowsersyncsyncablesyncable.cc @ 959]  0600ef78 024c6519   chrome_1c30000!syncable::WriteTransaction::~WriteTransaction+0x9d   [c:bslavechrome-  officialbuildsrcchromebrowsersyncsyncablesyncable.cc @ 1011]  0600f0d0 024cdd1d   chrome_1c30000!browser_sync::ApplyUpdatesCommand::ModelChangingExecuteImpl+  0x159 [c:bslavechrome-  officialbuildsrcchromebrowsersyncengineapply_updates_command.cc @   38]  0600f0d8 01efc33e   chrome_1c30000!browser_sync::ModelChangingSyncerCommand::StartChangingModel  +0x8 [c:bslavechrome-  officialbuildsrcchromebrowsersyncenginemodel_changing_syncer_command  .h @ 36]  0600f0dc 01c4c321 chrome_1c30000!CallbackImpl&lt;BrowsingDataRemover void   (__thiscall BrowsingDataRemover::*)(void) Tuple0&gt;::RunWithParams+0x8   [c:bslavechrome-officialbuildsrcbasecallback.h @ 119]  0600f0f0 01eb576d chrome_1c30000!CallbackRunner&lt;Tuple0&gt;::Run+0x14   [c:bslavechrome-officialbuildsrcbasecallback.h @ 78]  0600f0f4 024cddc8   chrome_1c30000!browser_sync::ModelSafeWorker::DoWorkAndWaitUntilDone+0x9   [c:bslavechrome-  officialbuildsrcchromebrowsersyncenginemodel_safe_worker.h @ 44]     </pre>
<title>Issue 43113 -   chromium -    Valgrind errors related to ssl - Project Hosting on Google Code</title> <pre> These two showed up between <a href="/p/chromium/source/detail?r=46231">r46231</a> and <a href="/p/chromium/source/detail?r=46235">r46235</a>. I'm guessing <a href="/p/chromium/source/detail?r=46232">r46232</a> is to   blame.    11:39:46 memcheck_analyze.py [ERROR] Leak_DefinitelyLost  Command: /b/slave/chromium-rel-chromeos-valgrind-tests-  2/build/src/out/Release/chrome --no-first-run --no-default-browser-check --  test-type=ui --enable-file-cookies --dom-automation --testing-  channel=ChromeTestingInterface:5669.9 --noerrdialogs --homepage=about:blank   --disable-web-resources --user-data-  dir=/tmp/org.chromium.1G0Eke/test_user_data --metrics-recording-only --  enable-logging --test-name=AutomationProxyTest.NavigateToURLAsync --allow-  file-access-from-files --lang=en-US  372 (176 direct  196 indirect) bytes in 1 blocks are definitely lost in   loss record 6 146 of 6 604    operator new(unsigned int) (mp/scripts/valgrind-  memcheck/coregrind/m_replacemalloc/vg_replace_malloc.c:269)    net::X509Certificate::CreateFromHandle(CERTCertificateStr*    net::X509Certificate::Source  std::vector&lt;CERTCertificateStr*    std::allocator&lt;CERTCertificateStr*&gt; &gt; const&amp;)   (net/base/x509_certificate.cc:154)    net::SSLClientSocketNSS::UpdateServerCert()   (net/socket/ssl_client_socket_nss.cc:670)    net::SSLClientSocketNSS::HandshakeCallback(PRFileDesc*  void*)   (net/socket/ssl_client_socket_nss.cc:1273)    ssl3_HandleServerHelloDone (net/third_party/nss/ssl/ssl3con.c:5751)    ssl3_HandleHandshakeMessage (net/third_party/nss/ssl/ssl3con.c:8666)    ssl3_HandleHandshake (net/third_party/nss/ssl/ssl3con.c:8761)    ssl3_HandleRecord (net/third_party/nss/ssl/ssl3con.c:9098)    ssl3_GatherCompleteHandshake (net/third_party/nss/ssl/ssl3gthr.c:207)    SSL_ForceHandshake (net/third_party/nss/ssl/sslsecur.c:397)    net::SSLClientSocketNSS::DoHandshake()   (net/socket/ssl_client_socket_nss.cc:1281)    net::SSLClientSocketNSS::DoHandshakeLoop(int)   (net/socket/ssl_client_socket_nss.cc:1035)    net::SSLClientSocketNSS::Connect(CallbackRunner&lt;Tuple1&lt;int&gt; &gt;*)   (net/socket/ssl_client_socket_nss.cc:311)    net::HttpNetworkTransaction::DoSSLConnect()   (net/http/http_network_transaction.cc:871)    net::HttpNetworkTransaction::DoLoop(int)   (net/http/http_network_transaction.cc:550)    net::HttpNetworkTransaction::OnIOComplete(int)   (net/http/http_network_transaction.cc:516)    void DispatchToMethod&lt;net::HttpNetworkTransaction  void   (net::HttpNetworkTransaction::*)(int)  int&gt;(net::HttpNetworkTransaction*    void (net::HttpNetworkTransaction::*)(int)  Tuple1&lt;int&gt; const&amp;)   (./base/tuple.h:422)    CallbackImpl&lt;net::HttpNetworkTransaction  void   (net::HttpNetworkTransaction::*)(int)  Tuple1&lt;int&gt;   &gt;::RunWithParams(Tuple1&lt;int&gt; const&amp;) (./base/callback.h:118)    void CallbackRunner&lt;Tuple1&lt;int&gt; &gt;::Run&lt;int&gt;(int const&amp;)   (./base/callback.h:83)    net::ClientSocketHandle::OnIOComplete(int)   (net/socket/client_socket_handle.cc:67)    void DispatchToMethod&lt;net::ClientSocketHandle  void   (net::ClientSocketHandle::*)(int)  int&gt;(net::ClientSocketHandle*  void   (net::ClientSocketHandle::*)(int)  Tuple1&lt;int&gt; const&amp;) (./base/tuple.h:422)    CallbackImpl&lt;net::ClientSocketHandle  void   (net::ClientSocketHandle::*)(int)  Tuple1&lt;int&gt; &gt;::RunWithParams(Tuple1&lt;int&gt;   const&amp;) (./base/callback.h:118)    void CallbackRunner&lt;Tuple1&lt;int&gt; &gt;::Run&lt;int&gt;(int const&amp;)   (./base/callback.h:83)    net::internal::ClientSocketPoolBaseHelper::OnConnectJobComplete(int    net::ConnectJob*) (net/socket/client_socket_pool_base.cc:587)    net::ConnectJob::NotifyDelegateOfCompletion(int)   (net/socket/client_socket_pool_base.cc:81)    net::TCPConnectJob::OnIOComplete(int)   (net/socket/tcp_client_socket_pool.cc:78)    void DispatchToMethod&lt;net::TCPConnectJob  void   (net::TCPConnectJob::*)(int)  int&gt;(net::TCPConnectJob*  void   (net::TCPConnectJob::*)(int)  Tuple1&lt;int&gt; const&amp;) (./base/tuple.h:422)    CallbackImpl&lt;net::TCPConnectJob  void (net::TCPConnectJob::*)(int)    Tuple1&lt;int&gt; &gt;::RunWithParams(Tuple1&lt;int&gt; const&amp;) (./base/callback.h:118)    void CallbackRunner&lt;Tuple1&lt;int&gt; &gt;::Run&lt;int&gt;(int const&amp;)   (./base/callback.h:83)    net::TCPClientSocketLibevent::DoWriteCallback(int)   (net/socket/tcp_client_socket_libevent.cc:390)  Suppression:  {     &lt;insert_a_suppression_name_here&gt;     Memcheck:Leak     fun:_Znw*       fun:_ZN3net15X509Certificate16CreateFromHandleEP18CERTCertificateStrNS0_6So  urceERKSt6vectorIS2_SaIS2_EE     fun:_ZN3net18SSLClientSocketNSS16UpdateServerCertEv     fun:_ZN3net18SSLClientSocketNSS17HandshakeCallbackEP10PRFileDescPv     fun:ssl3_HandleServerHelloDone     fun:ssl3_HandleHandshakeMessage     fun:ssl3_HandleHandshake     fun:ssl3_HandleRecord     fun:ssl3_GatherCompleteHandshake     fun:SSL_ForceHandshake     fun:_ZN3net18SSLClientSocketNSS11DoHandshakeEv     fun:_ZN3net18SSLClientSocketNSS15DoHandshakeLoopEi     fun:_ZN3net18SSLClientSocketNSS7ConnectEP14CallbackRunnerI6Tuple1IiEE     fun:_ZN3net22HttpNetworkTransaction12DoSSLConnectEv     fun:_ZN3net22HttpNetworkTransaction6DoLoopEi     fun:_ZN3net22HttpNetworkTransaction12OnIOCompleteEi       fun:_Z16DispatchToMethodIN3net22HttpNetworkTransactionEMS1_FviEiEvPT_T0_RK6  Tuple1IT1_E       fun:_ZN12CallbackImplIN3net22HttpNetworkTransactionEMS1_FviE6Tuple1IiEE13Ru  nWithParamsERKS5_     fun:_ZN14CallbackRunnerI6Tuple1IiEE3RunIiEEvRKT_     fun:_ZN3net18ClientSocketHandle12OnIOCompleteEi       fun:_Z16DispatchToMethodIN3net18ClientSocketHandleEMS1_FviEiEvPT_T0_RK6Tupl  e1IT1_E       fun:_ZN12CallbackImplIN3net18ClientSocketHandleEMS1_FviE6Tuple1IiEE13RunWit  hParamsERKS5_  }    11:39:46 memcheck_analyze.py [ERROR] InvalidRead  Command: /b/slave/chromium-rel-chromeos-valgrind-tests-  2/build/src/out/Release/chrome --no-first-run --no-default-browser-check --  test-type=ui --enable-file-cookies --dom-automation --testing-  channel=ChromeTestingInterface:5669.9 --noerrdialogs --homepage=about:blank   --disable-web-resources --user-data-  dir=/tmp/org.chromium.1G0Eke/test_user_data --metrics-recording-only --  enable-logging --test-name=AutomationProxyTest.NavigateToURLAsync --allow-  file-access-from-files --lang=en-US  Invalid read of size 4    rc4_wordconv (ild/buildd/nss-  3.12.3.1/mozilla/security/nss/lib/freebl/arcfour.c:555)    RC4_Encrypt (ild/buildd/nss-  3.12.3.1/mozilla/security/nss/lib/freebl/loader.c:365)    NSC_EncryptUpdate (ild/buildd/nss-  3.12.3.1/mozilla/security/nss/lib/softoken/pkcs11c.c:926)    PK11_CipherOp (ild/buildd/nss-  3.12.3.1/mozilla/security/nss/lib/pk11wrap/pk11cxt.c:731)    ssl3_CompressMACEncryptRecord (net/third_party/nss/ssl/ssl3con.c:2125)    ssl3_SendRecord (net/third_party/nss/ssl/ssl3con.c:2242)    ssl3_SendApplicationData (net/third_party/nss/ssl/ssl3con.c:2358)    ssl_SecureSend (net/third_party/nss/ssl/sslsecur.c:1241)    ssl_SecureWrite (net/third_party/nss/ssl/sslsecur.c:1258)    ssl_Write (net/third_party/nss/ssl/sslsock.c:1732)    PR_Write (ild/buildd/nspr-4.7.5/mozilla/nsprpub/pr/src/io/priometh.c:146)    net::SSLClientSocketNSS::DoPayloadWrite()   (net/socket/ssl_client_socket_nss.cc:1439)    net::SSLClientSocketNSS::DoWriteLoop(int)   (net/socket/ssl_client_socket_nss.cc:1094)    net::SSLClientSocketNSS::Write(net::IOBuffer*  int    CallbackRunner&lt;Tuple1&lt;int&gt; &gt;*) (net/socket/ssl_client_socket_nss.cc:593)    net::HttpStreamParser::DoSendHeaders(int)   (net/http/http_stream_parser.cc:226)    net::HttpStreamParser::DoLoop(int) (net/http/http_stream_parser.cc:135)    net::HttpStreamParser::SendRequest(net::HttpRequestInfo const*    std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt;   const&amp;  net::UploadDataStream*  net::HttpResponseInfo*    CallbackRunner&lt;Tuple1&lt;int&gt; &gt;*) (net/http/http_stream_parser.cc:58)    net::HttpBasicStream::SendRequest(net::HttpRequestInfo const*    std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt;   const&amp;  net::UploadDataStream*  net::HttpResponseInfo*    CallbackRunner&lt;Tuple1&lt;int&gt; &gt;*) (net/http/http_basic_stream.cc:21)    net::HttpNetworkTransaction::DoSendRequest()   (net/http/http_network_transaction.cc:993)    net::HttpNetworkTransaction::DoLoop(int)   (net/http/http_network_transaction.cc:560)    net::HttpNetworkTransaction::OnIOComplete(int)   (net/http/http_network_transaction.cc:516)    void DispatchToMethod&lt;net::HttpNetworkTransaction  void   (net::HttpNetworkTransaction::*)(int)  int&gt;(net::HttpNetworkTransaction*    void (net::HttpNetworkTransaction::*)(int)  Tuple1&lt;int&gt; const&amp;)   (./base/tuple.h:422)    CallbackImpl&lt;net::HttpNetworkTransaction  void   (net::HttpNetworkTransaction::*)(int)  Tuple1&lt;int&gt;   &gt;::RunWithParams(Tuple1&lt;int&gt; const&amp;) (./base/callback.h:118)    void CallbackRunner&lt;Tuple1&lt;int&gt; &gt;::Run&lt;int&gt;(int const&amp;)   (./base/callback.h:83)    net::SSLClientSocketNSS::DoConnectCallback(int)   (net/socket/ssl_client_socket_nss.cc:813)    net::SSLClientSocketNSS::OnHandshakeIOComplete(int)   (net/socket/ssl_client_socket_nss.cc:822)    void DispatchToMethod&lt;net::SSLClientSocketNSS  void   (net::SSLClientSocketNSS::*)(int)  int&gt;(net::SSLClientSocketNSS*  void   (net::SSLClientSocketNSS::*)(int)  Tuple1&lt;int&gt; const&amp;) (./base/tuple.h:422)    CallbackImpl&lt;net::SSLClientSocketNSS  void   (net::SSLClientSocketNSS::*)(int)  Tuple1&lt;int&gt; &gt;::RunWithParams(Tuple1&lt;int&gt;   const&amp;) (./base/callback.h:118)    void CallbackRunner&lt;Tuple1&lt;int&gt; &gt;::Run&lt;int&gt;(int const&amp;)   (./base/callback.h:83)    net::CertVerifier::Request::DoCallback() (net/base/cert_verifier.cc:82)  Address 0x7440280 is 440 bytes inside a block of size 443 alloc'd    operator new(unsigned int) (mp/scripts/valgrind-  memcheck/coregrind/m_replacemalloc/vg_replace_malloc.c:269)    std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt;   &gt;::_Rep::_S_create(unsigned int  unsigned int  std::allocator&lt;char&gt; const&amp;)   (/usr/lib/libstdc++.so.6.0.9)    std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt;   &gt;::_Rep::_M_clone(std::allocator&lt;char&gt; const&amp;  unsigned int)   (/usr/lib/libstdc++.so.6.0.9)    std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt;   &gt;::reserve(unsigned int) (/usr/lib/libstdc++.so.6.0.9)    std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt;   &gt;::append(std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const&amp;) (/usr/lib/libstdc++.so.6.0.9)    std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt;   std::operator+&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt;   &gt;(std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt;   const&amp;  std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const&amp;)   (sr/include/c++/4.2/bits/basic_string.h:2075)    net::HttpNetworkTransaction::DoSendRequest()   (net/http/http_network_transaction.cc:986)    net::HttpNetworkTransaction::DoLoop(int)   (net/http/http_network_transaction.cc:560)    net::HttpNetworkTransaction::OnIOComplete(int)   (net/http/http_network_transaction.cc:516)    void DispatchToMethod&lt;net::HttpNetworkTransaction  void   (net::HttpNetworkTransaction::*)(int)  int&gt;(net::HttpNetworkTransaction*    void (net::HttpNetworkTransaction::*)(int)  Tuple1&lt;int&gt; const&amp;)   (./base/tuple.h:422)    CallbackImpl&lt;net::HttpNetworkTransaction  void   (net::HttpNetworkTransaction::*)(int)  Tuple1&lt;int&gt;   &gt;::RunWithParams(Tuple1&lt;int&gt; const&amp;) (./base/callback.h:118)    void CallbackRunner&lt;Tuple1&lt;int&gt; &gt;::Run&lt;int&gt;(int const&amp;)   (./base/callback.h:83)    net::SSLClientSocketNSS::DoConnectCallback(int)   (net/socket/ssl_client_socket_nss.cc:813)    net::SSLClientSocketNSS::OnHandshakeIOComplete(int)   (net/socket/ssl_client_socket_nss.cc:822)    void DispatchToMethod&lt;net::SSLClientSocketNSS  void   (net::SSLClientSocketNSS::*)(int)  int&gt;(net::SSLClientSocketNSS*  void   (net::SSLClientSocketNSS::*)(int)  Tuple1&lt;int&gt; const&amp;) (./base/tuple.h:422)    CallbackImpl&lt;net::SSLClientSocketNSS  void   (net::SSLClientSocketNSS::*)(int)  Tuple1&lt;int&gt; &gt;::RunWithParams(Tuple1&lt;int&gt;   const&amp;) (./base/callback.h:118)    void CallbackRunner&lt;Tuple1&lt;int&gt; &gt;::Run&lt;int&gt;(int const&amp;)   (./base/callback.h:83)    net::CertVerifier::Request::DoCallback() (net/base/cert_verifier.cc:82)    void DispatchToMethod&lt;net::CertVerifier::Request  void   (net::CertVerifier::Request::*)()&gt;(net::CertVerifier::Request*  void   (net::CertVerifier::Request::*)()  Tuple0 const&amp;) (./base/tuple.h:412)    RunnableMethod&lt;net::CertVerifier::Request  void   (net::CertVerifier::Request::*)()  Tuple0&gt;::Run() (./base/task.h:296)    MessageLoop::RunTask(Task*) (base/message_loop.cc:328)    MessageLoop::DeferOrRunPendingTask(MessageLoop::PendingTask const&amp;)   (base/message_loop.cc:336)    MessageLoop::DoWork() (base/message_loop.cc:443)    base::MessagePumpLibevent::Run(base::MessagePump::Delegate*)   (base/message_pump_libevent.cc:241)    MessageLoop::RunInternal() (base/message_loop.cc:204)    MessageLoop::RunHandler() (base/message_loop.cc:176)    MessageLoop::Run() (base/message_loop.cc:154)    base::Thread::Run(MessageLoop*) (base/thread.cc:133)    base::Thread::ThreadMain() (base/thread.cc:156)    ThreadFunc(void*) (base/platform_thread_posix.cc:26)  Suppression:  {     &lt;insert_a_suppression_name_here&gt;     Memcheck:Addr4     fun:rc4_wordconv     fun:RC4_Encrypt     fun:NSC_EncryptUpdate     fun:PK11_CipherOp     fun:ssl3_CompressMACEncryptRecord     fun:ssl3_SendRecord     fun:ssl3_SendApplicationData     fun:ssl_SecureSend     fun:ssl_SecureWrite     fun:ssl_Write     fun:PR_Write     fun:_ZN3net18SSLClientSocketNSS14DoPayloadWriteEv     fun:_ZN3net18SSLClientSocketNSS11DoWriteLoopEi       fun:_ZN3net18SSLClientSocketNSS5WriteEPNS_8IOBufferEiP14CallbackRunnerI6Tup  le1IiEE     fun:_ZN3net16HttpStreamParser13DoSendHeadersEi     fun:_ZN3net16HttpStreamParser6DoLoopEi       fun:_ZN3net16HttpStreamParser11SendRequestEPKNS_15HttpRequestInfoERKSsPNS_1  6UploadDataStreamEPNS_16HttpResponseInfoEP14CallbackRunnerI6Tuple1IiEE       fun:_ZN3net15HttpBasicStream11SendRequestEPKNS_15HttpRequestInfoERKSsPNS_16  UploadDataStreamEPNS_16HttpResponseInfoEP14CallbackRunnerI6Tuple1IiEE     fun:_ZN3net22HttpNetworkTransaction13DoSendRequestEv     fun:_ZN3net22HttpNetworkTransaction6DoLoopEi     fun:_ZN3net22HttpNetworkTransaction12OnIOCompleteEi       fun:_Z16DispatchToMethodIN3net22HttpNetworkTransactionEMS1_FviEiEvPT_T0_RK6  Tuple1IT1_E  }   </pre>
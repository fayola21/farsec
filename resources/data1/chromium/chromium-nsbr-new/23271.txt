<title>Issue 23271 -   chromium -    Use FFmpeg locking API instead of Singleton&lt;FFmpegLock&gt; - Project Hosting on Google Code</title> <pre> Instead of using a global lock and finding out thread-unsafe areas of   FFmpeg via crash reports  we should switch to the FFmpeg locking API.    Example from libav-user mailing list:    static int  lockmgr(void **mtx  enum AVLockOp op)  {   switch(op) {   case AV_LOCK_CREATE:    *mtx = malloc(sizeof(pthread_mutex_t));    if(!*mtx)      return 1;    return !!pthread_mutex_init(*mtx  NULL);   case AV_LOCK_OBTAIN:    return !!pthread_mutex_lock(*mtx);   case AV_LOCK_RELEASE:    return !!pthread_mutex_unlock(*mtx);   case AV_LOCK_DESTROY:    pthread_mutex_destroy(*mtx);    free(*mtx);    return 0;   }   return 1;  }      // During application startup.  if(av_lockmgr_register(lockmgr)) {    // Failure  }    // During application shutdown.  av_lockmgr_register(NULL); </pre>
<title>Issue 46135 -   chromium -    Investigate use_existing_browser UI test weirdness - Project Hosting on Google Code</title> <pre> Quoting a good question I just got:    Anyway  I'm kind of confused about what the function LaunchBrowserHelper() is doing on line 1081.  There's a variable use_existing_browser which doesn't seem to be used until the end of the function?  It seems like we should be checking if another browser is running and if it is  simply returning without launching anything.  Instead  we launch a browser no matter what  and THEN we check if the browser is running.    I think the concerns are valid  and the code indeed looks broken.    chrome/test/ui/ui_test.cc:      bool started = base::LaunchApp(command_line.argv()                                       // We launch the browser here  always.                                   server_-&gt;fds_to_map()                                    wait                                    process);  #endif    if (!started)      return false;      if (use_existing_browser) {                                                                                       // But then check for an existing (previous?) browser.  #if defined(OS_WIN)      DWORD pid = 0;      HWND hwnd = FindWindowEx(HWND_MESSAGE  NULL  chrome::kMessageWindowClass                                user_data_dir_.value().c_str());      GetWindowThreadProcessId(hwnd  &amp;pid);      // This mode doesn't work if we wound up launching a new browser ourselves.      EXPECT_NE(pid  base::GetProcId(*process));      CloseHandle(*process);      *process = OpenProcess(SYNCHRONIZE  false  pid); </pre>
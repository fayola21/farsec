<title>Issue 46147 -   chromium -    MessageLoopTest.FileDescriptorWatcherOutlivesMessageLoop disabled - Project Hosting on Google Code</title> <pre> Backstory:  Test MessageLoopTest.FileDescriptorWatcherOutlivesMessageLoop was originally disabled with a comment explaining it tested unrequired functionality    <a href="/p/chromium/source/detail?r=48102">r48102</a> (committed May 24) enabled this test  mentioning it appeared to now pass (but left the comment on the test stating it was disabled  and functionality not needed)  <a href="http://src.chromium.org/viewvc/chrome?view=rev&amp;revision=48102">http://src.chromium.org/viewvc/chrome?view=rev&amp;revision=48102</a>    <a href="/p/chromium/source/detail?r=49188">r49188</a> (committed June 8) appeared to reintroduce the test fail  on Chrome OS Valgrind base tests  <a href="http://src.chromium.org/viewvc/chrome?view=rev&amp;revision=49188">http://src.chromium.org/viewvc/chrome?view=rev&amp;revision=49188</a>  e.g. <a href="http://build.chromium.org/buildbot/memory/builders/Chromium%20OS%20UI%20(valgrind)(2)/builds/3724/steps/valgrind%20test:%20base/logs/stdio">http://build.chromium.org/buildbot/memory/builders/Chromium%20OS%20UI%20(valgrind)(2)/builds/3724/steps/valgrind%20test:%20base/logs/stdio</a>  15:42:52 memcheck_analyze.py [ERROR] FAIL! There were 1 errors:   15:42:52 memcheck_analyze.py [ERROR] InvalidRead  Command: src/sconsbuild/Release/base_unittests --gtest_filter=-WatchdogTest.AlarmTest:TimerTest.RepeatingTimer:TimerTest.RepeatingTimer_Cancel:ObserverListThreadSafeTest.CrossThreadObserver:ObserverListThreadSafeTest.CrossThreadNotifications:ClipboardTest.*:OutOfMemoryTest.* --gtest_print_time  Invalid read of size 4    event_del (third_party/libevent/event.c:792)    base::MessagePumpLibevent::FileDescriptorWatcher::StopWatchingFileDescriptor() (base/message_pump_libevent.cc:86)    base::MessagePumpLibevent::FileDescriptorWatcher::~FileDescriptorWatcher() (base/message_pump_libevent.cc:61)    (anonymous namespace)::MessageLoopTest_FileDescriptorWatcherOutlivesMessageLoop_Test::TestBody() (base/message_loop_unittest.cc:1581)    testing::Test::Run() (testing/gtest/src/gtest.cc:2095)    testing::internal::TestInfoImpl::Run() (testing/gtest/src/gtest.cc:2314)    testing::TestCase::Run() (testing/gtest/src/gtest.cc:2420)    testing::internal::UnitTestImpl::RunAllTests() (testing/gtest/src/gtest.cc:4024)    testing::UnitTest::Run() (testing/gtest/src/gtest.cc:3687)    TestSuite::Run() (./base/test/test_suite.h:137)    main (base/test/run_all_unittests.cc:10)  Address 0x59b8528 is 0 bytes inside a block of size 944 free'd    free (mp/scripts/valgrind-memcheck/coregrind/m_replacemalloc/vg_replace_malloc.c:389)    event_base_free (third_party/libevent/event.c:263)    base::MessagePumpLibevent::~MessagePumpLibevent() (base/message_pump_libevent.cc:167)    base::RefCountedThreadSafe&lt;base::MessagePump  base::DefaultRefCountedThreadSafeTraits&lt;base::MessagePump&gt; &gt;::DeleteInternal(base::MessagePump*) (./base/ref_counted.h:146)    base::DefaultRefCountedThreadSafeTraits&lt;base::MessagePump&gt;::Destruct(base::MessagePump*) (./base/ref_counted.h:112)    base::RefCountedThreadSafe&lt;base::MessagePump  base::DefaultRefCountedThreadSafeTraits&lt;base::MessagePump&gt; &gt;::Release() (./base/ref_counted.h:140)    scoped_refptr&lt;base::MessagePump&gt;::~scoped_refptr() (./base/ref_counted.h:238)    MessageLoop::~MessageLoop() (base/message_loop.cc:140)    MessageLoopForIO::~MessageLoopForIO() (./base/message_loop.h:516)    (anonymous namespace)::MessageLoopTest_FileDescriptorWatcherOutlivesMessageLoop_Test::TestBody() (base/message_loop_unittest.cc:1579)    testing::Test::Run() (testing/gtest/src/gtest.cc:2095)    testing::internal::TestInfoImpl::Run() (testing/gtest/src/gtest.cc:2314)    testing::TestCase::Run() (testing/gtest/src/gtest.cc:2420)    testing::internal::UnitTestImpl::RunAllTests() (testing/gtest/src/gtest.cc:4024)    testing::UnitTest::Run() (testing/gtest/src/gtest.cc:3687)    TestSuite::Run() (./base/test/test_suite.h:137)    main (base/test/run_all_unittests.cc:10)      In independent efforts to get the tree green  hamaji reverted <a href="/p/chromium/source/detail?r=49188">r49188</a> (the junk monitor changes) and I reverted <a href="/p/chromium/source/detail?r=48102">r48102</a> (enabling the test)  <a href="http://src.chromium.org/viewvc/chrome?view=rev&amp;revision=49225">http://src.chromium.org/viewvc/chrome?view=rev&amp;revision=49225</a>  <a href="http://src.chromium.org/viewvc/chrome?view=rev&amp;revision=49241">http://src.chromium.org/viewvc/chrome?view=rev&amp;revision=49241</a>     </pre>
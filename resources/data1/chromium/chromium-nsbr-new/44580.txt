<title>Issue 44580 -   chromium -    tsan failure in TestMultipleManifestDownloading - Project Hosting on Google Code</title> <pre> <a href="http://build.chromium.org/buildbot/memory/builders/Linux%20Tests%20(tsan)/b">http://build.chromium.org/buildbot/memory/builders/Linux%20Tests%20(tsan)/b</a>  uilds/4315/steps/valgrind%20test:%20unit/logs/stdio    It looks like during a thread's tear down message_loop() is being accessed   while it is being NULL-ed out.     10:16:18 tsan_analyze.py [ERROR] FAIL! Found 1 race reports  10:16:18 tsan_analyze.py [ERROR]   ==24608== INFO: T561 has been created by T0 at this point: {{{  ==24608==     #0  ???//lib/tls/i686/cmov/libpthread-2.7.so   /lib/tls/i686/cmov/libpthread-2.7.so  ==24608==     #1  pthread_create@@GLIBC_2.1 /lib/tls/i686/cmov/libpthread-  2.7.so  ==24608==     #2  pthread_create@* ts_valgrind_intercepts.c:652  ==24608==     #3  (anonymous namespace)::CreateThread(unsigned int  bool    PlatformThread::Delegate*  unsigned long*)   base/platform_thread_posix.cc:129  ==24608==     #4  PlatformThread::Create(unsigned int    PlatformThread::Delegate*  unsigned long*)   base/platform_thread_posix.cc:141  ==24608==     #5  base::Thread::StartWithOptions(base::Thread::Options   const&amp;) base/thread.cc:86  ==24608==     #6  base::Thread::Start() base/thread.cc:75  ==24608==     #7  ExtensionUpdaterTest::TestMultipleManifestDownloading()   chrome/browser/extensions/extension_updater_unittest.cc:479  ==24608==     #8    ExtensionUpdaterTest_TestMultipleManifestDownloading_Test::TestBody()   chrome/browser/extensions/extension_updater_unittest.cc:846  ==24608==     #9  testing::Test::Run() testing/gtest/src/gtest.cc:2095  ==24608== }}}  ==24608== INFO: T0 is program's main thread  ==24608== INFO: T560 has been created by T0 at this point: {{{  ==24608==     #0  ???//lib/tls/i686/cmov/libpthread-2.7.so   /lib/tls/i686/cmov/libpthread-2.7.so  ==24608==     #1  pthread_create@@GLIBC_2.1 /lib/tls/i686/cmov/libpthread-  2.7.so  ==24608==     #2  pthread_create@* ts_valgrind_intercepts.c:652  ==24608==     #3  (anonymous namespace)::CreateThread(unsigned int  bool    PlatformThread::Delegate*  unsigned long*)   base/platform_thread_posix.cc:129  ==24608==     #4  PlatformThread::Create(unsigned int    PlatformThread::Delegate*  unsigned long*)   base/platform_thread_posix.cc:141  ==24608==     #5  base::Thread::StartWithOptions(base::Thread::Options   const&amp;) base/thread.cc:86  ==24608==     #6  base::Thread::Start() base/thread.cc:75  ==24608==     #7  ExtensionUpdaterTest::TestMultipleManifestDownloading()   chrome/browser/extensions/extension_updater_unittest.cc:477  ==24608==     #8    ExtensionUpdaterTest_TestMultipleManifestDownloading_Test::TestBody()   chrome/browser/extensions/extension_updater_unittest.cc:846  ==24608==     #9  testing::Test::Run() testing/gtest/src/gtest.cc:2095  ==24608== }}}  ==24608== WARNING: Possible data race during write of size 4 at 0xBE801488:   {{{  ==24608==    T560 (Chrome_FileThread) (locks held: {}):  ==24608==     #0  base::Thread::ThreadMain() base/thread.cc:169  ==24608==     #1  ThreadFunc(void*) base/platform_thread_posix.cc:28  ==24608==     #2  ThreadSanitizerStartThread ts_valgrind_intercepts.c:600  ==24608==   Concurrent read(s) happened at (OR AFTER) these points:  ==24608==    T561 (Chrome_IOThread) (locks held: {}):  ==24608==     #0  base::Thread::message_loop() const base/thread.h:106  ==24608==     #1    ChromeThread::GetCurrentThreadIdentifier(ChromeThread::ID*)   chrome/browser/chrome_thread.cc:157  ==24608==     #2  ChromeThread::PostTaskHelper(ChromeThread::ID    tracked_objects::Location const&amp;  Task*  long long  bool)   chrome/browser/chrome_thread.cc:193  ==24608==     #3  ChromeThread::PostTask(ChromeThread::ID    tracked_objects::Location const&amp;  Task*)   chrome/browser/chrome_thread.cc:125  ==24608==     #4    SafeManifestParser::ParseInSandbox(ResourceDispatcherHost*)   chrome/browser/extensions/extension_updater.cc:465  ==24608==     #5  void DispatchToMethod&lt;SafeManifestParser  void   (SafeManifestParser::*)(ResourceDispatcherHost*)    ResourceDispatcherHost*&gt;(SafeManifestParser*  void   (SafeManifestParser::*)(ResourceDispatcherHost*)    Tuple1&lt;ResourceDispatcherHost*&gt; const&amp;) base/tuple.h:422  ==24608==     #6  RunnableMethod&lt;SafeManifestParser  void   (SafeManifestParser::*)(ResourceDispatcherHost*)    Tuple1&lt;ResourceDispatcherHost*&gt; &gt;::Run() base/task.h:296  ==24608==     #7  MessageLoop::RunTask(Task*) base/message_loop.cc:328  ==24608==     #8    MessageLoop::DeferOrRunPendingTask(MessageLoop::PendingTask const&amp;)   base/message_loop.cc:336  ==24608==     #9  MessageLoop::DoWork() base/message_loop.cc:443  ==24608==   Location 0xBE801488 is 2932 bytes inside T0's stack   [0xBD801FFC 0xBE801FFC]  ==24608== }}}   </pre>
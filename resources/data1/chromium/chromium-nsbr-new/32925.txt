<title>Issue 32925 -   chromium -    regression: Don't block UI thread on IO thread during shutdown for saving DNS prefetcher data - Project Hosting on Google Code</title> <pre> As part of:    <a href="http://codereview.chromium.org/300032">http://codereview.chromium.org/300032</a>    I added a blocking wait to access data off of the IO thread during   shutdown.    The problem is that the IO thread goes away before the prefservice  so it is   tricky to get the data off the IO thread at the right time to serialize it to the   prefs during shutdown.    This sort of blocking can add latency to shutdown  so should be avoided.    Tradeoff is needing to do more work in the non-shutdown cases. Some   options:    (a) Don't try to save during shutdown. Instead save continuously every XXX   minutes by posting a task from IO thread back to UI thread to write to   prefs.    (b) Add locks around the data that will be needed during shutdown  and   always do locking. (This adds locking to the common case to facilitate   shutdown). This will be complicated by:  <a href="http://codereview.chromium.org/553026">http://codereview.chromium.org/553026</a>  Which has moved some of those globals to instances allocated on IO   thread.    (c) Delay destruction of the pref service to after the IO thread has already   been stopped. This would allow writing the data without need for locking   once the IO thread is gone.      My inclination right now is towards option (b)  I will see how that goes. </pre>
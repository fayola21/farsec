<title>Issue 30436 -   chromium -    valgrind leaks in unit_tests and ui_tests - Project Hosting on Google Code</title> <pre> These started showing up after a clobber build.  Seems related to tcmalloc:  09:25:16 memcheck_analyze.py [ERROR] FAIL! There were 3 errors:   09:25:16 memcheck_analyze.py [ERROR] Leak_DefinitelyLost  Command: src/sconsbuild/Release/unit_tests --gtest_filter=-  VisitedLinkEventsTest.Coalescense:VisitedLinkRelayTest.Basics:RenderViewTes  t.ImeComposition:DnsMasterTest.MassiveConcurrentLookupTest --  gtest_print_time  4 bytes in 1 blocks are definitely lost in loss record 7 414 of 24 464    operator new(unsigned int) (ome/chrome-bot/valgrind-10880-  redzone/coregrind/m_replacemalloc/vg_replace_malloc.c:219)    InitModule()   (uilder/build/src/third_party/tcmalloc/chromium/src/malloc_extension.cc:172  )    pthread_once (/lib/tls/i686/cmov/libpthread-2.7.so)    MallocExtension::Register(MallocExtension*)   (uilder/build/src/third_party/tcmalloc/chromium/src/malloc_extension.cc:184  )    TCMallocGuard::TCMallocGuard()   (uilder/build/src/third_party/tcmalloc/chromium/src/tcmalloc_linux.cc:692)    __static_initialization_and_destruction_0(int  int)   (uilder/build/src/third_party/tcmalloc/chromium/src/tcmalloc_linux.cc:707)    global constructors keyed to   _ZN61FLAG__namespace_do_not_use_directly_use_DECLARE_int64_instead43FLAGS_t  cmalloc_large_alloc_report_thresholdE   (uilder/build/src/third_party/tcmalloc/chromium/src/tcmalloc_linux.cc:1417)    0x94D8EC4 (/b/slave/chromium-rel-linux-valgrind-tests-  1/build/src/sconsbuild/Release/unit_tests)    0xA23E84F (/b/slave/chromium-rel-linux-valgrind-tests-  1/build/src/sconsbuild/Release/unit_tests)    __libc_csu_init (/b/slave/chromium-rel-linux-valgrind-tests-  1/build/src/sconsbuild/Release/unit_tests)    (below main) (/lib/tls/i686/cmov/libc-2.7.so)  Suppression:  {     &lt;insert_a_suppression_name_here&gt;     Memcheck:Leak     fun:_Znw*     fun:_Z10InitModulev     fun:pthread_once     fun:_ZN15MallocExtension8RegisterEPS_     fun:_ZN13TCMallocGuardC1Ev     fun:_Z41__static_initialization_and_destruction_0ii       fun:_GLOBAL__I__ZN61FLAG__namespace_do_not_use_directly_use_DECLARE_int64_i  nstead43FLAGS_tcmalloc_large_alloc_report_thresholdE     obj:/b/slave/chromium-rel-linux-valgrind-tests-  1/build/src/sconsbuild/Release/unit_tests     obj:/b/slave/chromium-rel-linux-valgrind-tests-  1/build/src/sconsbuild/Release/unit_tests     fun:__libc_csu_init     fun:(below main)  }      09:25:16 memcheck_analyze.py [ERROR] SyscallParam  Command: src/sconsbuild/Release/unit_tests --gtest_filter=-  VisitedLinkEventsTest.Coalescense:VisitedLinkRelayTest.Basics:RenderViewTes  t.ImeComposition:DnsMasterTest.MassiveConcurrentLookupTest --  gtest_print_time  Syscall param write(buf) points to uninitialised byte(s)    0x4CA531B (/lib/tls/i686/cmov/libc-2.7.so)    new_do_write (/lib/tls/i686/cmov/libc-2.7.so)    _IO_do_write@@GLIBC_2.1 (/lib/tls/i686/cmov/libc-2.7.so)    _IO_file_overflow@@GLIBC_2.1 (/lib/tls/i686/cmov/libc-2.7.so)    _IO_switch_to_get_mode (/lib/tls/i686/cmov/libc-2.7.so)    _IO_file_seekoff@@GLIBC_2.1 (/lib/tls/i686/cmov/libc-2.7.so)    _IO_seekoff_unlocked (/lib/tls/i686/cmov/libc-2.7.so)    ftell (/lib/tls/i686/cmov/libc-2.7.so)    ftell_file_func   (uilder/build/src/third_party/zlib/contrib/minizip/ioapi.c:121)    zipCloseFileInZipRaw   (uilder/build/src/third_party/zlib/contrib/minizip/zip.c:1106)    zipCloseFileInZip   (uilder/build/src/third_party/zlib/contrib/minizip/zip.c:1134)    AddEntryToZip(void*  FilePath const&amp;  FilePath const&amp;)   (uilder/build/src/chrome/common/zip.cc:254)    Zip(FilePath const&amp;  FilePath const&amp;  bool)   (uilder/build/src/chrome/common/zip.cc:299)    (anonymous namespace)::ZipTest_Zip_Test::TestBody()   (uilder/build/src/chrome/common/zip_unittest.cc:136)    testing::Test::Run() (uilder/build/src/testing/gtest/src/gtest.cc:2099)    testing::internal::TestInfoImpl::Run()   (uilder/build/src/testing/gtest/src/gtest.cc:2318)    testing::TestCase::Run()   (uilder/build/src/testing/gtest/src/gtest.cc:2426)    testing::internal::UnitTestImpl::RunAllTests()   (uilder/build/src/testing/gtest/src/gtest.cc:4026)    testing::UnitTest::Run()   (uilder/build/src/testing/gtest/src/gtest.cc:3694)    TestSuite::Run() (uilder/build/src/base/test/test_suite.h:124)    main (uilder/build/src/chrome/test/unit/run_all_unittests.cc:8)  Suppression:  {     &lt;insert_a_suppression_name_here&gt;     Memcheck:Param     write(buf)     obj:/lib/tls/i686/cmov/libc-2.7.so     fun:new_do_write     fun:_IO_do_write@@GLIBC_2.1     fun:_IO_file_overflow@@GLIBC_2.1     fun:_IO_switch_to_get_mode     fun:_IO_file_seekoff@@GLIBC_2.1     fun:_IO_seekoff_unlocked     fun:ftell     fun:ftell_file_func     fun:zipCloseFileInZipRaw     fun:zipCloseFileInZip     fun:_Z13AddEntryToZipPvRK8FilePathS2_     fun:_Z3ZipRK8FilePathS1_b       fun:_ZN113_GLOBAL__N__b_slave_chromium_rel_linux_valgrind_builder_build_src  _chrome_common_zip_unittest.cc_00000000_01702B1416ZipTest_Zip_Test8TestBody  Ev     fun:_ZN7testing4Test3RunEv     fun:_ZN7testing8internal12TestInfoImpl3RunEv     fun:_ZN7testing8TestCase3RunEv     fun:_ZN7testing8internal12UnitTestImpl11RunAllTestsEv     fun:_ZN7testing8UnitTest3RunEv     fun:_ZN9TestSuite3RunEv     fun:main  }    09:25:16 memcheck_analyze.py [ERROR] InvalidRead  Command: src/sconsbuild/Release/unit_tests --gtest_filter=-  VisitedLinkEventsTest.Coalescense:VisitedLinkRelayTest.Basics:RenderViewTes  t.ImeComposition:DnsMasterTest.MassiveConcurrentLookupTest --  gtest_print_time  Invalid read of size 2    tcmalloc::CentralFreeList::FetchFromSpans()   (uilder/build/src/third_party/tcmalloc/chromium/src/central_freelist.cc:247  )    tcmalloc::CentralFreeList::FetchFromSpansSafe()   (uilder/build/src/third_party/tcmalloc/chromium/src/central_freelist.cc:234  )    tcmalloc::CentralFreeList::RemoveRange(void**  void**  int)   (uilder/build/src/third_party/tcmalloc/chromium/src/central_freelist.cc:214  )    tcmalloc::ThreadCache::FetchFromCentralCache(unsigned int  unsigned int)   (uilder/build/src/third_party/tcmalloc/chromium/src/thread_cache.cc:149)    tcmalloc::ThreadCache::Allocate(unsigned int)   (uilder/build/src/third_party/tcmalloc/chromium/src/thread_cache.h:340)    (anonymous namespace)::do_malloc(unsigned int)   (uilder/build/src/third_party/tcmalloc/chromium/src/tcmalloc_linux.cc:838)    (anonymous namespace)::cpp_alloc(unsigned int  bool)   (uilder/build/src/third_party/tcmalloc/chromium/src/tcmalloc_linux.cc:1104)    0xA23EE36 (/b/slave/chromium-rel-linux-valgrind-tests-  1/build/src/sconsbuild/Release/unit_tests)    std::pair&lt;CharacterEncoding::EncodingInfo*  int&gt;   std::__get_temporary_buffer&lt;CharacterEncoding::EncodingInfo&gt;(int    CharacterEncoding::EncodingInfo*) (sr/include/c++/4.2/memory:83)    std::pair&lt;CharacterEncoding::EncodingInfo*  int&gt;   std::get_temporary_buffer&lt;CharacterEncoding::EncodingInfo&gt;(int)   (sr/include/c++/4.2/memory:111)      std::_Temporary_buffer&lt;__gnu_cxx::__normal_iterator&lt;CharacterEncoding::Enco  dingInfo*  std::vector&lt;CharacterEncoding::EncodingInfo    std::allocator&lt;CharacterEncoding::EncodingInfo&gt; &gt; &gt;    CharacterEncoding::EncodingInfo&gt;::_Temporary_buffer(__gnu_cxx::__normal_ite  rator&lt;CharacterEncoding::EncodingInfo*    std::vector&lt;CharacterEncoding::EncodingInfo    std::allocator&lt;CharacterEncoding::EncodingInfo&gt; &gt; &gt;    __gnu_cxx::__normal_iterator&lt;CharacterEncoding::EncodingInfo*    std::vector&lt;CharacterEncoding::EncodingInfo    std::allocator&lt;CharacterEncoding::EncodingInfo&gt; &gt; &gt;)   (sr/include/c++/4.2/bits/stl_tempbuf.h:154)    void   std::stable_sort&lt;__gnu_cxx::__normal_iterator&lt;CharacterEncoding::EncodingIn  fo*  std::vector&lt;CharacterEncoding::EncodingInfo    std::allocator&lt;CharacterEncoding::EncodingInfo&gt; &gt; &gt;    l10n_util::StringComparator&lt;CharacterEncoding::EncodingInfo&gt;   &gt;(__gnu_cxx::__normal_iterator&lt;CharacterEncoding::EncodingInfo*    std::vector&lt;CharacterEncoding::EncodingInfo    std::allocator&lt;CharacterEncoding::EncodingInfo&gt; &gt; &gt;    __gnu_cxx::__normal_iterator&lt;CharacterEncoding::EncodingInfo*    std::vector&lt;CharacterEncoding::EncodingInfo    std::allocator&lt;CharacterEncoding::EncodingInfo&gt; &gt; &gt;    l10n_util::StringComparator&lt;CharacterEncoding::EncodingInfo&gt;)   (sr/include/c++/4.2/bits/stl_algo.h:3934)    void   l10n_util::SortVectorWithStringKey&lt;CharacterEncoding::EncodingInfo&gt;(std::ba  sic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; const&amp;    std::vector&lt;CharacterEncoding::EncodingInfo    std::allocator&lt;CharacterEncoding::EncodingInfo&gt; &gt;*  unsigned int  unsigned   int  bool) (uilder/build/src/app/l10n_util.h:389)    CharacterEncoding::GetCurrentDisplayEncodings(std::basic_string&lt;char    std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt; const&amp;    std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt;   const&amp;  std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const&amp;)   (uilder/build/src/chrome/browser/character_encoding.cc:495)    EncodingMenuController::GetEncodingMenuItems(Profile*    std::vector&lt;std::pair&lt;int  std::basic_string&lt;unsigned short    base::string16_char_traits  std::allocator&lt;unsigned short&gt; &gt; &gt;    std::allocator&lt;std::pair&lt;int  std::basic_string&lt;unsigned short    base::string16_char_traits  std::allocator&lt;unsigned short&gt; &gt; &gt; &gt; &gt;*)   (uilder/build/src/chrome/browser/encoding_menu_controller.cc:127)    EncodingMenuModel::Build()   (uilder/build/src/chrome/browser/page_menu_model.cc:65)    EncodingMenuModel::EncodingMenuModel(Browser*)   (uilder/build/src/chrome/browser/page_menu_model.cc:58)    PageMenuModel::Build()   (uilder/build/src/chrome/browser/page_menu_model.cc:37)    PageMenuModel::PageMenuModel(menus::SimpleMenuModel::Delegate*  Browser*)   (uilder/build/src/chrome/browser/page_menu_model.cc:19)    PageMenuModelTest_Basics_Test::TestBody()   (uilder/build/src/chrome/browser/page_menu_model_unittest.cc:37)    testing::Test::Run() (uilder/build/src/testing/gtest/src/gtest.cc:2099)    testing::internal::TestInfoImpl::Run()   (uilder/build/src/testing/gtest/src/gtest.cc:2318)    testing::TestCase::Run()   (uilder/build/src/testing/gtest/src/gtest.cc:2426)    testing::internal::UnitTestImpl::RunAllTests()   (uilder/build/src/testing/gtest/src/gtest.cc:4026)    testing::UnitTest::Run()   (uilder/build/src/testing/gtest/src/gtest.cc:3694)    TestSuite::Run() (uilder/build/src/base/test/test_suite.h:124)    main (uilder/build/src/chrome/test/unit/run_all_unittests.cc:8)  Suppression:  {     &lt;insert_a_suppression_name_here&gt;     Memcheck:Addr2     fun:_ZN8tcmalloc15CentralFreeList14FetchFromSpansEv     fun:_ZN8tcmalloc15CentralFreeList18FetchFromSpansSafeEv     fun:_ZN8tcmalloc15CentralFreeList11RemoveRangeEPPvS2_i     fun:_ZN8tcmalloc11ThreadCache21FetchFromCentralCacheEjj     fun:_ZN8tcmalloc11ThreadCache8AllocateEj       fun:_ZN123_GLOBAL__N__ZN61FLAG__namespace_do_not_use_directly_use_DECLARE_i  nt64_instead43FLAGS_tcmalloc_large_alloc_report_thresholdE9do_mallocEj       fun:_ZN123_GLOBAL__N__ZN61FLAG__namespace_do_not_use_directly_use_DECLARE_i  nt64_instead43FLAGS_tcmalloc_large_alloc_report_thresholdE9cpp_allocEjb     obj:/b/slave/chromium-rel-linux-valgrind-tests-  1/build/src/sconsbuild/Release/unit_tests       fun:_ZSt22__get_temporary_bufferIN17CharacterEncoding12EncodingInfoEESt4pai  rIPT_iEiS4_       fun:_ZSt20get_temporary_bufferIN17CharacterEncoding12EncodingInfoEESt4pairI  PT_iEi       fun:_ZNSt17_Temporary_bufferIN9__gnu_cxx17__normal_iteratorIPN17CharacterEn  coding12EncodingInfoESt6vectorIS3_SaIS3_EEEES3_EC1ES8_S8_       fun:_ZSt11stable_sortIN9__gnu_cxx17__normal_iteratorIPN17CharacterEncoding1  2EncodingInfoESt6vectorIS3_SaIS3_EEEEN9l10n_util16StringComparatorIS3_EEEvT  _SC_T0_       fun:_ZN9l10n_util23SortVectorWithStringKeyIN17CharacterEncoding12EncodingIn  foEEEvRKSsPSt6vectorIT_SaIS6_EEjjb     fun:_ZN17CharacterEncoding26GetCurrentDisplayEncodingsERKSsS1_S1_       fun:_ZN22EncodingMenuController20GetEncodingMenuItemsEP7ProfilePSt6vectorIS  t4pairIiSbItN4base20string16_char_traitsESaItEEESaIS8_EE     fun:_ZN17EncodingMenuModel5BuildEv     fun:_ZN17EncodingMenuModelC1EP7Browser     fun:_ZN13PageMenuModel5BuildEv     fun:_ZN13PageMenuModelC1EPN5menus15SimpleMenuModel8DelegateEP7Browser     fun:_ZN29PageMenuModelTest_Basics_Test8TestBodyEv     fun:_ZN7testing4Test3RunEv     fun:_ZN7testing8internal12TestInfoImpl3RunEv  }   </pre>
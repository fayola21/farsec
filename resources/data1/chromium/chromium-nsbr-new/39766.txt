<title>Issue 39766 -   chromium -    Gmail crashing renderer with tip-of-tree - Project Hosting on Google Code</title> <pre> This likely has already been reported.    Steps to repro:    1) Go to <a href="https://mail.google.com/">https://mail.google.com/</a>   2) Sign in.  3) Wait for the page to load.  4) Witness... AW SNAP!    The crash happens while raising a xhr.readyStateChange event when transitioning to the DONE state   m_state == DONE in XMLHttpRequest::callReadyStateChangeListener().    We call out to script via V8EventListener::callListenerFunction(). It calls back into v8 to 'shift' an array  which ends up calling JSObject::set_elements().    void JSObject::set_elements(Array* value  WriteBarrierMode mode) {    // In the assert below Dictionary is covered under FixedArray.    ASSERT(value-&gt;IsFixedArray() || value-&gt;IsPixelArray() ||           value-&gt;IsExternalArray());    WRITE_FIELD(this  kElementsOffset  value);    CONDITIONAL_WRITE_BARRIER(this  kElementsOffset  mode);  }    This assertion in the CONDITIONAL_WRITE_BARRIER macro is tripped on...      ASSERT(Heap::InNewSpace(object) ||              !Heap::InNewSpace(READ_FIELD(object  offset)));           Stack crawl...     	chrome.dll!v8::internal::OS::DebugBreak()  Line 907	C++   	chrome.dll!v8::internal::OS::Abort()  Line 902	C++   	chrome.dll!V8_Fatal(const char * file=0x5e40149c  int line=1162  const char * format=0x5e3fcd18  ...)  Line 59	C++  &gt;	chrome.dll!CheckHelper(const char * file=0x5e40149c  int line=1162  const char * source=0x5e401760  bool condition=false)  Line 62 + 0x16 bytes	C++   	chrome.dll!v8::internal::JSObject::set_elements(v8::internal::Array * value=0x03d2c139  v8::internal::WriteBarrierMode mode=SKIP_WRITE_BARRIER)  Line 1162 +   0x89 bytes	C++   	chrome.dll!v8::internal::Builtin_Impl_ArrayShift(v8::internal::`anonymous-namespace'::BuiltinArguments&lt;0&gt; args={...})  Line 501	C++   	chrome.dll!v8::internal::Builtin_ArrayShift(v8::internal::`anonymous-namespace'::BuiltinArguments&lt;0&gt; args={...})  Line 478 + 0x18 bytes	C++   	003a01ee()	   	chrome.dll!v8::internal::Invoke(bool construct=false  v8::internal::Handle&lt;v8::internal::JSFunction&gt; func={...}  v8::internal::Handle&lt;v8::internal::Object&gt;   receiver={...}  int argc=1  v8::internal::Object * * * args=0x002ce63c  bool * has_pending_exception=0x002ce543)  Line 98 + 0x19 bytes	C++   	chrome.dll!v8::internal::Execution::Call(v8::internal::Handle&lt;v8::internal::JSFunction&gt; func={...}  v8::internal::Handle&lt;v8::internal::Object&gt; receiver={...}    int argc=1  v8::internal::Object * * * args=0x002ce63c  bool * pending_exception=0x002ce543)  Line 124 + 0x1f bytes	C++   	chrome.dll!v8::Function::Call(v8::Handle&lt;v8::Object&gt; recv={...}  int argc=1  v8::Handle&lt;v8::Value&gt; * argv=0x002ce63c)  Line 2515 + 0x1d bytes	C++   	chrome.dll!WebCore::V8Proxy::callFunction(v8::Handle&lt;v8::Function&gt; function={...}  v8::Handle&lt;v8::Object&gt; receiver={...}  int argc=1  v8::Handle&lt;v8::Value&gt; *   args=0x002ce63c)  Line 493 + 0x1f bytes	C++   	chrome.dll!WebCore::V8EventListener::callListenerFunction(WebCore::ScriptExecutionContext * context=0x028f9038  v8::Handle&lt;v8::Value&gt; jsEvent={...}    WebCore::Event * event=0x0544ab90)  Line 75 + 0x26 bytes	C++   	chrome.dll!WebCore::V8AbstractEventListener::invokeEventHandler(WebCore::ScriptExecutionContext * context=0x028f9038  WebCore::Event * event=0x0544ab90    v8::Handle&lt;v8::Value&gt; jsEvent={...})  Line 144 + 0x1f bytes	C++   	chrome.dll!WebCore::V8AbstractEventListener::handleEvent(WebCore::ScriptExecutionContext * context=0x028f9038  WebCore::Event * event=0x0544ab90)  Line 91	  C++   	chrome.dll!WebCore::EventTarget::fireEventListeners(WebCore::Event * event=0x0544ab90  WebCore::EventTargetData * d=0x059bd83c    WTF::Vector&lt;WebCore::RegisteredEventListener 1&gt; &amp; entry={...})  Line 315 + 0x35 bytes	C++   	chrome.dll!WebCore::EventTarget::fireEventListeners(WebCore::Event * event=0x0544ab90)  Line 281	C++   	chrome.dll!WebCore::EventTarget::dispatchEvent(WTF::PassRefPtr&lt;WebCore::Event&gt; event={...})  Line 262 + 0x11 bytes	C++   	chrome.dll!WebCore::XMLHttpRequestProgressEventThrottle::dispatchEvent(WTF::PassRefPtr&lt;WebCore::Event&gt; event={...}  WebCore::ProgressEventAction   progressEventAction=FlushProgressEvent)  Line 82	C++   	chrome.dll!WebCore::XMLHttpRequest::callReadyStateChangeListener()  Line 263 + 0x43 bytes	C++   	chrome.dll!WebCore::XMLHttpRequest::changeState(WebCore::XMLHttpRequest::State newState=DONE)  Line 249	C++   	chrome.dll!WebCore::XMLHttpRequest::didFinishLoading(unsigned long identifier=97)  Line 883	C++   	chrome.dll!WebCore::DocumentThreadableLoader::didFinishLoading(unsigned long identifier=97)  Line 237 + 0x1b bytes	C++   	chrome.dll!WebCore::DocumentThreadableLoader::didFinishLoading(WebCore::SubresourceLoader * loader=0x01f83800)  Line 228	C++   	chrome.dll!WebCore::SubresourceLoader::didFinishLoading()  Line 184 + 0x21 bytes	C++   	chrome.dll!WebCore::ResourceLoader::didFinishLoading(WebCore::ResourceHandle * __formal=0x04dfd120)  Line 443 + 0xf bytes	C++   	chrome.dll!WebCore::ResourceHandleInternal::didFinishLoading(WebKit::WebURLLoader * __formal=0x05435a18)  Line 148 + 0x25 bytes	C++   	chrome.dll!webkit_glue::WebURLLoaderImpl::Context::OnCompletedRequest(const URLRequestStatus &amp; status={...}  const   std::basic_string&lt;char std::char_traits&lt;char&gt; std::allocator&lt;char&gt; &gt; &amp; security_info=&quot;&quot;)  Line 552 + 0x1e bytes	C++   	chrome.dll!ResourceDispatcher::OnRequestComplete(int request_id=91  const URLRequestStatus &amp; status={...}  const   std::basic_string&lt;char std::char_traits&lt;char&gt; std::allocator&lt;char&gt; &gt; &amp; security_info=&quot;&quot;)  Line 466 + 0x17 bytes	C++   	chrome.dll!DispatchToMethod&lt;ResourceDispatcher void (__thiscall ResourceDispatcher::*)(int URLRequestStatus const   &amp; std::basic_string&lt;char std::char_traits&lt;char&gt; std::allocator&lt;char&gt; &gt; const &amp;) int URLRequestStatus std::basic_string&lt;char std::char_traits&lt;char&gt; std::allocator&lt;char&gt;   &gt; &gt;(ResourceDispatcher * obj=0x01f788c0  void (int  const URLRequestStatus &amp;  const std::basic_string&lt;char std::char_traits&lt;char&gt; std::allocator&lt;char&gt; &gt; &amp;)*   method=0x5a7cfc30  const Tuple3&lt;int URLRequestStatus std::basic_string&lt;char std::char_traits&lt;char&gt; std::allocator&lt;char&gt; &gt; &gt; &amp; arg={...})  Line 435 + 0x1c bytes	C++   	chrome.dll!IPC::MessageWithTuple&lt;Tuple3&lt;int URLRequestStatus std::basic_string&lt;char std::char_traits&lt;char&gt; std::allocator&lt;char&gt; &gt; &gt;   &gt;::Dispatch&lt;ResourceDispatcher void (__thiscall ResourceDispatcher::*)(int URLRequestStatus const &amp; std::basic_string&lt;char std::char_traits&lt;char&gt; std::allocator&lt;char&gt; &gt;   const &amp;)&gt;(const IPC::Message * msg=0x0578fca8  ResourceDispatcher * obj=0x01f788c0  void (int  const URLRequestStatus &amp;  const   std::basic_string&lt;char std::char_traits&lt;char&gt; std::allocator&lt;char&gt; &gt; &amp;)* func=0x5a7cfc30)  Line 991 + 0x11 bytes	C++   	chrome.dll!ResourceDispatcher::DispatchMessageW(const IPC::Message &amp; message={...})  Line 540 + 0x12 bytes	C++   	chrome.dll!ResourceDispatcher::OnMessageReceived(const IPC::Message &amp; message={...})  Line 303	C++   	chrome.dll!ChildThread::OnMessageReceived(const IPC::Message &amp; msg={...})  Line 117 + 0x19 bytes	C++   	chrome.dll!IPC::ChannelProxy::Context::OnDispatchMessage(const IPC::Message &amp; message={...})  Line 204 + 0x19 bytes	C++   	chrome.dll!DispatchToMethod&lt;IPC::ChannelProxy::Context void (__thiscall IPC::ChannelProxy::Context::*)(IPC::Message const   &amp;) IPC::Message&gt;(IPC::ChannelProxy::Context * obj=0x01fc0000  void (const IPC::Message &amp;)* method=0x598bf200  const Tuple1&lt;IPC::Message&gt; &amp; arg={...})  Line 422 + 0xf   bytes	C++   	chrome.dll!RunnableMethod&lt;IPC::ChannelProxy::Context void (__thiscall IPC::ChannelProxy::Context::*)(IPC::Message const &amp;) Tuple1&lt;IPC::Message&gt; &gt;::Run()  Line   296 + 0x1e bytes	C++   	chrome.dll!MessageLoop::RunTask(Task * task=0x0578fc80)  Line 329 + 0xf bytes	C++   	chrome.dll!MessageLoop::DeferOrRunPendingTask(const MessageLoop::PendingTask &amp; pending_task={...})  Line 340	C++   	chrome.dll!MessageLoop::DoWork()  Line 444 + 0xc bytes	C++   	chrome.dll!base::MessagePumpDefault::Run(base::MessagePump::Delegate * delegate=0x002cf50c)  Line 23 + 0xf bytes	C++   	chrome.dll!MessageLoop::RunInternal()  Line 205 + 0x2a bytes	C++   	chrome.dll!MessageLoop::RunHandler()  Line 178	C++   	chrome.dll!MessageLoop::Run()  Line 156	C++   	chrome.dll!RendererMain(const MainFunctionParams &amp; parameters={...})  Line 291	C++   	chrome.dll!ChromeMain(HINSTANCE__ * instance=0x00e30000  sandbox::SandboxInterfaceInfo * sandbox_info=0x002cfe44  wchar_t * command_line=0x00532c62)  Line 716 +   0xc bytes	C++   	chrome.exe!MainDllLoader::Launch(HINSTANCE__ * instance=0x00e30000  sandbox::SandboxInterfaceInfo * sbox_info=0x002cfe44)  Line 195 + 0x1d bytes	C++   	chrome.exe!wWinMain(HINSTANCE__ * instance=0x00e30000  HINSTANCE__ * __formal=0x00000000  HINSTANCE__ * __formal=0x00000000  HINSTANCE__ * __formal=0x00000000)    Line 46 + 0x10 bytes	C++   	chrome.exe!__tmainCRTStartup()  Line 263 + 0x2c bytes	C   	chrome.exe!wWinMainCRTStartup()  Line 182	C   	kernel32.dll!7646e4a5() 	   	[Frames below may be incorrect and/or missing  no symbols loaded for kernel32.dll]	   	ntdll.dll!7707cfed() 	   	ntdll.dll!7707d1ff() 	   </pre>
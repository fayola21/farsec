<title>Issue 32355 -   chromium -    invalid write : NPP_DestroyStream  - Project Hosting on Google Code</title> <pre> Command: /b/slave/webkit-rel-linux-valgrind-  layout/build/src/sconsbuild/Release/test_shell --layout-tests --pixel-  tests=/b/slave/webkit-rel-linux-valgrind-  layout/build/src/webkit/Release/layout-test-results/png_result0.png --time-  out-ms=200000 file:///b/slave/webkit-rel-linux-valgrind-  layout/build/src/third_party/WebKit/LayoutTests/plugins/document-open.html  Invalid write of size 1    NPP_DestroyStream (webkit/tools/npapi_layout_test_plugin/main.cpp:239)    NPAPI::PluginInstance::NPP_DestroyStream(_NPStream*  short)   (webkit/glue/plugins/plugin_instance.cc:218)    NPAPI::PluginStream::Close(short)   (webkit/glue/plugins/plugin_stream.cc:235)    NPAPI::PluginStreamUrl::Close(short)   (webkit/glue/plugins/plugin_stream_url.cc:35)    NPAPI::PluginStreamUrl::DidFinishLoading()   (webkit/glue/plugins/plugin_stream_url.cc:89)    webkit_glue::WebPluginImpl::didFinishLoading(WebKit::WebURLLoader*)   (webkit/glue/webplugin_impl.cc:777)      webkit_glue::WebURLLoaderImpl::Context::OnCompletedRequest(URLRequestStatus   const&amp;  std::basic_string&lt;char  std::char_traits&lt;char&gt;    std::allocator&lt;char&gt; &gt; const&amp;) (webkit/glue/weburlloader_impl.cc:533)    webkit_glue::WebURLLoaderImpl::Context::HandleDataURL()   (webkit/glue/weburlloader_impl.cc:558)    void DispatchToMethod&lt;webkit_glue::WebURLLoaderImpl::Context  void   (webkit_glue::WebURLLoaderImpl::Context::*)()&gt;(webkit_glue::WebURLLoaderImp  l::Context*  void (webkit_glue::WebURLLoaderImpl::Context::*)()  Tuple0   const&amp;) (base/tuple.h:412)    RunnableMethod&lt;webkit_glue::WebURLLoaderImpl::Context  void   (webkit_glue::WebURLLoaderImpl::Context::*)()  Tuple0&gt;::Run()   (base/task.h:289)    MessageLoop::RunTask(Task*) (base/message_loop.cc:320)    MessageLoop::DeferOrRunPendingTask(MessageLoop::PendingTask const&amp;)   (base/message_loop.cc:328)    MessageLoop::DoWork() (base/message_loop.cc:435)    base::MessagePumpForUI::RunWithDispatcher(base::MessagePump::Delegate*    base::MessagePumpForUI::Dispatcher*) (base/message_pump_glib.cc:200)    base::MessagePumpForUI::Run(base::MessagePump::Delegate*)   (base/message_pump_glib.h:59)    MessageLoop::RunInternal() (base/message_loop.cc:205)    MessageLoop::RunHandler() (base/message_loop.cc:177)    MessageLoop::Run() (base/message_loop.cc:155)    TestShell::WaitTestFinished()   (webkit/tools/test_shell/test_shell_gtk.cc:451)    TestShell::RunFileTest(TestShell::TestParams const&amp;)   (webkit/tools/test_shell/test_shell_gtk.cc:565)    main (webkit/tools/test_shell/test_shell_main.cc:336)  Address 0x5b38361 is 25 bytes inside a block of size 56 free'd    free (ome/chrome-bot/valgrind-10880-  redzone/coregrind/m_replacemalloc/vg_replace_malloc.c:348)    pluginDeallocate(NPObject*)   (webkit/tools/npapi_layout_test_plugin/PluginObject.cpp:980)    _NPN_DeallocateObject   (third_party/WebKit/WebCore/bindings/v8/npruntime.cpp:309)    _NPN_ReleaseObject   (third_party/WebKit/WebCore/bindings/v8/npruntime.cpp:322)    WebKit::WebBindings::releaseObject(NPObject*)   (third_party/WebKit/WebKit/chromium/src/WebBindings.cpp:151)    NPP_Destroy (webkit/tools/npapi_layout_test_plugin/main.cpp:169)    NPAPI::PluginInstance::NPP_Destroy()   (webkit/glue/plugins/plugin_instance.cc:168)    WebPluginDelegateImpl::DestroyInstance()   (webkit/glue/plugins/webplugin_delegate_impl.cc:120)    WebPluginDelegateImpl::~WebPluginDelegateImpl()   (webkit/glue/plugins/webplugin_delegate_impl_gtk.cc:71)    WebPluginDelegateImpl::PluginDestroyed()   (webkit/glue/plugins/webplugin_delegate_impl_gtk.cc:98)    webkit_glue::WebPluginImpl::TearDownPluginInstance(WebKit::WebURLLoader*)   (webkit/glue/webplugin_impl.cc:1087)    webkit_glue::WebPluginImpl::SetContainer(WebKit::WebPluginContainer*)   (webkit/glue/webplugin_impl.cc:815)    webkit_glue::WebPluginImpl::destroy() (webkit/glue/webplugin_impl.cc:234)    WebKit::WebPluginContainerImpl::~WebPluginContainerImpl()   (third_party/WebKit/WebKit/chromium/src/WebPluginContainerImpl.cpp:331)    WTF::RefCounted&lt;WebCore::Widget&gt;::deref()   (third_party/WebKit/JavaScriptCore/wtf/RefCounted.h:109)    WTF::RefPtr&lt;WebCore::Widget&gt;::~RefPtr()   (third_party/WebKit/JavaScriptCore/wtf/RefPtr.h:53)    std::pair&lt;WTF::RefPtr&lt;WebCore::Widget&gt;  WebCore::FrameView*&gt;::~pair()   (sr/include/c++/4.2/bits/stl_pair.h:69)    WTF::HashTable&lt;WTF::RefPtr&lt;WebCore::Widget&gt;    std::pair&lt;WTF::RefPtr&lt;WebCore::Widget&gt;  WebCore::FrameView*&gt;    WTF::PairFirstExtractor&lt;std::pair&lt;WTF::RefPtr&lt;WebCore::Widget&gt;    WebCore::FrameView*&gt; &gt;  WTF::PtrHash&lt;WTF::RefPtr&lt;WebCore::Widget&gt; &gt;    WTF::PairHashTraits&lt;WTF::HashTraits&lt;WTF::RefPtr&lt;WebCore::Widget&gt; &gt;    WTF::HashTraits&lt;WebCore::FrameView*&gt; &gt;    WTF::HashTraits&lt;WTF::RefPtr&lt;WebCore::Widget&gt; &gt;   &gt;::deallocateTable(std::pair&lt;WTF::RefPtr&lt;WebCore::Widget&gt;    WebCore::FrameView*&gt;*  int)   (third_party/WebKit/JavaScriptCore/wtf/HashTable.h:872)    WTF::HashTable&lt;WTF::RefPtr&lt;WebCore::Widget&gt;    std::pair&lt;WTF::RefPtr&lt;WebCore::Widget&gt;  WebCore::FrameView*&gt;    WTF::PairFirstExtractor&lt;std::pair&lt;WTF::RefPtr&lt;WebCore::Widget&gt;    WebCore::FrameView*&gt; &gt;  WTF::PtrHash&lt;WTF::RefPtr&lt;WebCore::Widget&gt; &gt;    WTF::PairHashTraits&lt;WTF::HashTraits&lt;WTF::RefPtr&lt;WebCore::Widget&gt; &gt;    WTF::HashTraits&lt;WebCore::FrameView*&gt; &gt;    WTF::HashTraits&lt;WTF::RefPtr&lt;WebCore::Widget&gt; &gt; &gt;::~HashTable()   (third_party/WebKit/JavaScriptCore/wtf/HashTable.h:296)    WTF::HashMap&lt;WTF::RefPtr&lt;WebCore::Widget&gt;  WebCore::FrameView*    WTF::PtrHash&lt;WTF::RefPtr&lt;WebCore::Widget&gt; &gt;    WTF::HashTraits&lt;WTF::RefPtr&lt;WebCore::Widget&gt; &gt;    WTF::HashTraits&lt;WebCore::FrameView*&gt; &gt;::~HashMap()   (third_party/WebKit/JavaScriptCore/wtf/HashMap.h:32)    WebCore::RenderWidget::resumeWidgetHierarchyUpdates()   (third_party/WebKit/WebCore/rendering/RenderWidget.cpp:75)    WebCore::Element::detach()   (third_party/WebKit/WebCore/dom/Element.cpp:784)    WebCore::ContainerNode::removeChildren()   (third_party/WebKit/WebCore/dom/ContainerNode.cpp:415)    WebCore::Document::implicitOpen()   (third_party/WebKit/WebCore/dom/Document.cpp:1672)    WebCore::Document::open(WebCore::Document*)   (third_party/WebKit/WebCore/dom/Document.cpp:1645)    WebCore::V8HTMLDocument::openCallback(v8::Arguments const&amp;)   (third_party/WebKit/WebCore/bindings/v8/custom/V8HTMLDocumentCustom.cpp:169  )    v8::internal::Builtin_HandleApiCall(v8::internal::Arguments)   (v8/src/builtins.cc:386)    0x511F083 ()  Suppression:  {     &lt;insert_a_suppression_name_here&gt;     Memcheck:Addr1     fun:NPP_DestroyStream     fun:_ZN5NPAPI14PluginInstance17NPP_DestroyStreamEP9_NPStreams     fun:_ZN5NPAPI12PluginStream5CloseEs     fun:_ZN5NPAPI15PluginStreamUrl5CloseEs     fun:_ZN5NPAPI15PluginStreamUrl16DidFinishLoadingEv       fun:_ZN11webkit_glue13WebPluginImpl16didFinishLoadingEPN6WebKit12WebURLLoad  erE       fun:_ZN11webkit_glue16WebURLLoaderImpl7Context18OnCompletedRequestERK16URLR  equestStatusRKSs     fun:_ZN11webkit_glue16WebURLLoaderImpl7Context13HandleDataURLEv       fun:_Z16DispatchToMethodIN11webkit_glue16WebURLLoaderImpl7ContextEMS2_FvvEE  vPT_T0_RK6Tuple0       fun:_ZN14RunnableMethodIN11webkit_glue16WebURLLoaderImpl7ContextEMS2_FvvE6T  uple0E3RunEv     fun:_ZN11MessageLoop7RunTaskEP4Task     fun:_ZN11MessageLoop21DeferOrRunPendingTaskERKNS_11PendingTaskE     fun:_ZN11MessageLoop6DoWorkEv       fun:_ZN4base16MessagePumpForUI17RunWithDispatcherEPNS_11MessagePump8Delegat  eEPNS0_10DispatcherE     fun:_ZN4base16MessagePumpForUI3RunEPNS_11MessagePump8DelegateE     fun:_ZN11MessageLoop11RunInternalEv     fun:_ZN11MessageLoop10RunHandlerEv  }   </pre>
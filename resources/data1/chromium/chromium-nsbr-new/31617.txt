<title>Issue 31617 -   chromium -    Troubles when calculating caret bounds - Project Hosting on Google Code</title> <pre> The way to reproduce:    1) reenable RenderViewTest.ImeComposition (note it only works on Win and Mac);  2) run it.    It should fail with stack trace like:           unit_tests.exe!WebCore::SelectionController::recomputeCaretRect()  Line 936 + 0x42 bytes   C++         unit_tests.exe!WebCore::SelectionController::absoluteCaretBounds()  Line 906        C++  &gt;       unit_tests.exe!WebKit::WebViewImpl::queryCompositionStatus(bool *   enableIME=0x0025f44f  WebKit::WebRect * caretRect=0x0025f434)  Line 1085 + 0xc bytes  C++         unit_tests.exe!RenderWidget::UpdateIME()  Line 769 + 0x26 bytes C++         unit_tests.exe!RenderViewTest_ImeComposition_Test::TestBody()  Line 252 C++    Darin Adler (darin@apple.com) thinks that somewhere higher in the stack we should have called   layout.  He further suggests to fix either WevViewImpl::queryCompositionStatus or even   SelectionController::absoluteCaretBounds (checking all the call sites).   </pre>
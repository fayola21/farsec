<title>Issue 39922 -   chromium -    Linux ProcessSingleton is racy - Project Hosting on Google Code</title> <pre> This probably happens to users who double click on the Chromium icon when   it's meant to be a single click. I tested by running the following from the   command line:    ./out/Release/chrome --user-data-dir=/tmp/foo &amp; ./out/Release/chrome --  user-data-dir=/tmp/foo    Normally  process A starts up  and then process B detects process A and ask   it to open a new window instead. However  if you repeat this process enough   times  you get all kinds of unexpected outputs. This is with <a href="/p/chromium/source/detail?r=42981">r42981</a> plus a   bunch of LOG statements.    cc: people who have modified big sections of process_linux_singleton.cc  cc: timurrrrrrrrrrrrr because he loves race conditions.    ----  Case 1    Here  both processes tried to look for the other process  but neither has   set up the socket yet  so both processes try to create the socket. Process   A wins  and process B hits a PLOG(FATAL)  as seen many times on the crash   server  now that we generate crash dumps for LOG(FATAL). This is pretty   harmless  except it might make our crash numbers look bad. I'm not sure - I   think this only generates a crash dump but does not get reported via UMA.    A:process_singleton_linux.cc(629) ctor  B:process_singleton_linux.cc(629) ctor  B:process_singleton_linux.cc(646) NotifyOtherProcessWithTimeout  B:process_singleton_linux.cc(667) PROCESS_NONE  B:process_singleton_linux.cc(740) Create Start  A:process_singleton_linux.cc(646) NotifyOtherProcessWithTimeout  A:process_singleton_linux.cc(667) PROCESS_NONE  A:process_singleton_linux.cc(740) Create Start  A:process_singleton_linux.cc(770) SetupSocket  A:process_singleton_linux.cc(773) UnlinkPath  A:process_singleton_linux.cc(776) Bind  A:process_singleton_linux.cc(787) Listen  A:process_singleton_linux.cc(791) Go  A:process_singleton_linux.cc(473) StartListening  B:process_singleton_linux.cc(764) Failed to create /tmp/foo/SingletonLock:   File exists  Aborted  ----    ----  Case 2    Similar to case 1  but we collide in a different spot  an then decide to   let the second process continue?! The disk cache looks unhappy. We should   probably just change the last log message to FATAL  like in case 1?      A:process_singleton_linux.cc(629) ctor  B:process_singleton_linux.cc(629) ctor  B:process_singleton_linux.cc(646) NotifyOtherProcessWithTimeout  B:process_singleton_linux.cc(667) PROCESS_NONE  B:process_singleton_linux.cc(740) Create Start  B:process_singleton_linux.cc(770) SetupSocket  B:process_singleton_linux.cc(773) UnlinkPath  A:process_singleton_linux.cc(646) NotifyOtherProcessWithTimeout  B:process_singleton_linux.cc(776) Bind  A:process_singleton_linux.cc(667) PROCESS_NONE  A:process_singleton_linux.cc(740) Create Start  A:process_singleton_linux.cc(770) SetupSocket  A:process_singleton_linux.cc(773) UnlinkPath  A:process_singleton_linux.cc(776) Bind  A:process_singleton_linux.cc(787) Listen  A:process_singleton_linux.cc(791) Go  A:process_singleton_linux.cc(473) StartListening  B:process_singleton_linux.cc(778) bind() failed: Address already in use  B:process_singleton_linux.cc(779) SingletonSocket failed to create a socket   in your home directory. This means that running multiple instances of the   Chrome binary will start multiple browser process rather than opening a new   window in the existing process.  A:net/disk_cache/rankings.cc(677) Inconsistent LRU.  A:net/disk_cache/backend_impl.cc(916) Critical error found -8  ----      ----  Case 3    Even worse  we collided but didn't even manage to detect it. We need to fix   this.    B:process_singleton_linux.cc(629) ctor  A:process_singleton_linux.cc(629) ctor  A:process_singleton_linux.cc(646) NotifyOtherProcessWithTimeout  A:process_singleton_linux.cc(667) PROCESS_NONE  A:process_singleton_linux.cc(740) Create Start  A:process_singleton_linux.cc(770) SetupSocket  A:process_singleton_linux.cc(773) UnlinkPath  B:process_singleton_linux.cc(646) NotifyOtherProcessWithTimeout  B:process_singleton_linux.cc(667) PROCESS_NONE  B:process_singleton_linux.cc(740) Create Start  B:process_singleton_linux.cc(770) SetupSocket  B:process_singleton_linux.cc(773) UnlinkPath  B:process_singleton_linux.cc(776) Bind  B:process_singleton_linux.cc(787) Listen  B:process_singleton_linux.cc(791) Go  B:process_singleton_linux.cc(473) StartListening  A:process_singleton_linux.cc(776) Bind  A:process_singleton_linux.cc(787) Listen  A:process_singleton_linux.cc(791) Go  A:process_singleton_linux.cc(473) StartListening  B:net/disk_cache/backend_impl.cc(916) Critical error found -8  ----   </pre>
<title>Issue 34158 -   chromium -    messageloop DCHECK in GaiaAuth during shutdown - Project Hosting on Google Code</title> <pre> When shutting down the browser while logged into sync  I'm seeing a DCHECK fail inside of GaiaAuth:    DCHECK_EQ(MessageLoop::current()  current_message_loop_);    The stack trace shows that GaiaAuth is being torn down from the main thread as a result of deletion of the SyncManager.     	chrome.dll!DebugUtil::BreakDebugger()  Line 222	C++   	chrome.dll!logging::LogMessage::~LogMessage()  Line 566	C++   	chrome.dll!buzz::GaiaAuth::~GaiaAuth()  Line 292	C++   	chrome.dll!buzz::GaiaAuth::`scalar deleting destructor'()  + 0x16 bytes	C++   	chrome.dll!scoped_ptr&lt;buzz::SaslHandler&gt;::~scoped_ptr&lt;buzz::SaslHandler&gt;()  Line 72 + 0x24 bytes	C++   	chrome.dll!buzz::XmppEngineImpl::~XmppEngineImpl()  Line 84 + 0x1c bytes	C++   	chrome.dll!buzz::XmppEngineImpl::`scalar deleting destructor'()  + 0x16 bytes	C++   	chrome.dll!scoped_ptr&lt;buzz::XmppEngine&gt;::~scoped_ptr&lt;buzz::XmppEngine&gt;()  Line 72 + 0x24 bytes	C++   	chrome.dll!buzz::XmppClient::Private::~Private()  + 0x61 bytes	C++   	chrome.dll!buzz::XmppClient::Private::`scalar deleting destructor'()  + 0x16 bytes	C++   	chrome.dll!scoped_ptr&lt;buzz::XmppClient::Private&gt;::~scoped_ptr&lt;buzz::XmppClient::Private&gt;()  Line 72 + 0x24 bytes	C++   	chrome.dll!buzz::XmppClient::~XmppClient()  Line 298 + 0xe bytes	C++   	chrome.dll!buzz::XmppClient::`scalar deleting destructor'()  + 0x16 bytes	C++   	chrome.dll!talk_base::TaskRunner::RunTasks()  Line 91 + 0x22 bytes	C++   	chrome.dll!talk_base::TaskRunner::~TaskRunner()  Line 49	C++   	chrome.dll!notifier::TaskPump::~TaskPump()  + 0x19 bytes	C++   	chrome.dll!notifier::TaskPump::`scalar deleting destructor'()  + 0x16 bytes	C++   	chrome.dll!scoped_ptr&lt;notifier::TaskPump&gt;::~scoped_ptr&lt;notifier::TaskPump&gt;()  Line 72 + 0x24 bytes	C++  &gt;	chrome.dll!browser_sync::MediatorThreadImpl::~MediatorThreadImpl()  Line 35 + 0x1c bytes	C++   	chrome.dll!browser_sync::MediatorThreadImpl::`scalar deleting destructor'()  + 0x16 bytes	C++   	chrome.dll!scoped_ptr&lt;browser_sync::MediatorThread&gt;::~scoped_ptr&lt;browser_sync::MediatorThread&gt;()  Line 72 + 0x24 bytes	C++   	chrome.dll!browser_sync::TalkMediatorImpl::~TalkMediatorImpl()  Line 76 + 0x1c bytes	C++   	chrome.dll!browser_sync::TalkMediatorImpl::`scalar deleting destructor'()  + 0x16 bytes	C++   	chrome.dll!scoped_ptr&lt;browser_sync::TalkMediator&gt;::~scoped_ptr&lt;browser_sync::TalkMediator&gt;()  Line 72 + 0x24 bytes	C++   	chrome.dll!sync_api::SyncManager::SyncInternal::~SyncInternal()  Line 810 + 0x86 bytes	C++   	chrome.dll!sync_api::SyncManager::SyncInternal::`scalar deleting destructor'()  + 0x16 bytes	C++   	chrome.dll!sync_api::SyncManager::~SyncManager()  Line 1291 + 0x1f bytes	C++   	chrome.dll!sync_api::SyncManager::`scalar deleting destructor'()  + 0x16 bytes	C++   	chrome.dll!scoped_ptr&lt;sync_api::SyncManager&gt;::~scoped_ptr&lt;sync_api::SyncManager&gt;()  Line 72 + 0x24 bytes	C++   	chrome.dll!browser_sync::SyncBackendHost::Core::~Core()  Line 229 + 0x22 bytes	C++   	chrome.dll!browser_sync::SyncBackendHost::Core::`scalar deleting destructor'()  + 0x16 bytes	C++   	  chrome.dll!base::RefCountedThreadSafe&lt;browser_sync::SyncBackendHost::Core base::DefaultRefCountedThreadSafeTraits&lt;browser_sync::SyncBackendHost::Cor  e&gt; &gt;::DeleteInternal(browser_sync::SyncBackendHost::Core * x=0x03347a20)  Line 146 + 0x3e bytes	C++   	chrome.dll!base::DefaultRefCountedThreadSafeTraits&lt;browser_sync::SyncBackendHost::Core&gt;::Destruct(browser_sync::SyncBackendHost::Core *   x=0x03347a20)  Line 112 + 0x9 bytes	C++   	  chrome.dll!base::RefCountedThreadSafe&lt;browser_sync::SyncBackendHost::Core base::DefaultRefCountedThreadSafeTraits&lt;browser_sync::SyncBackendHost::Cor  e&gt; &gt;::Release()  Line 140 + 0x21 bytes	C++   	chrome.dll!scoped_refptr&lt;browser_sync::SyncBackendHost::Core&gt;::operator=(browser_sync::SyncBackendHost::Core * p=0x00000000)  Line 262	C++   	chrome.dll!browser_sync::SyncBackendHost::Shutdown(bool sync_disabled=false)  Line 117	C++   	chrome.dll!ProfileSyncService::Shutdown(bool sync_disabled=false)  Line 177	C++   	chrome.dll!ProfileSyncService::~ProfileSyncService()  Line 62	C++   	chrome.dll!ProfileSyncService::`scalar deleting destructor'()  + 0x16 bytes	C++   	chrome.dll!scoped_ptr&lt;ProfileSyncService&gt;::reset(ProfileSyncService * p=0x00000000)  Line 81 + 0x24 bytes	C++   	chrome.dll!ProfileImpl::~ProfileImpl()  Line 735	C++   	chrome.dll!ProfileImpl::`scalar deleting destructor'()  + 0x16 bytes	C++   	chrome.dll!ProfileManager::~ProfileManager()  Line 50 + 0x29 bytes	C++   	chrome.dll!ProfileManager::`scalar deleting destructor'()  + 0x16 bytes	C++   	chrome.dll!scoped_ptr&lt;ProfileManager&gt;::reset(ProfileManager * p=0x00000000)  Line 81 + 0x25 bytes	C++   	chrome.dll!BrowserProcessImpl::~BrowserProcessImpl()  Line 119	C++   	chrome.dll!BrowserProcessImpl::`scalar deleting destructor'()  + 0x16 bytes	C++   	chrome.dll!browser_shutdown::Shutdown()  Line 141 + 0x36 bytes	C++   	chrome.dll!BrowserMain(const MainFunctionParams &amp; parameters={...})  Line 1009	C++   	chrome.dll!ChromeMain(HINSTANCE__ * instance=0x00090000  sandbox::SandboxInterfaceInfo * sandbox_info=0x003df9b0  wchar_t *   command_line=0x007635c8)  Line 756 + 0xc bytes	C++   </pre>
<title>Issue 35787 -   chromium -    HTML5 Database crash when content is blocked - Project Hosting on Google Code</title> <pre> While looking at another bug  I ran into this:    HostContentSettingMap-&gt;GetContentSetting() with a file url on windows + cookie content type returns CONTENT_SETTING_DEFAULT (this is the other bug).  When this happens  we treat it as CONTENT_SETTING_BLOCK.    Apparently when this happens  we get a null pointer error (caught by an ASSERT when in debug mode).  249 head stack trace in the renderer process:    &gt;	chrome.dll!WebCore::DatabaseTracker::removeOpenDatabase(WebCore::Database * database=0x01472480)  Line 120 + 0x1f bytes	C++   	chrome.dll!WebCore::Database::~Database()  Line 205	C++   	chrome.dll!WebCore::Database::`scalar deleting destructor'()  + 0x16 bytes	C++   	chrome.dll!WTF::ThreadSafeShared&lt;WebCore::Database&gt;::deref()  Line 313 + 0x1c bytes	C++   	chrome.dll!WebKit::WebDatabase::assign(WebKit::WebDatabasePrivate * d=0x00000000)  Line 148	C++   	chrome.dll!WebKit::WebDatabase::reset()  Line 59	C++   	chrome.dll!WebKit::WebDatabase::~WebDatabase()  Line 52 + 0x16 bytes	C++   	chrome.dll!WebCore::DatabaseObserver::databaseClosed(WebCore::Database * database=0x01472480)  Line 57 + 0x3f bytes	C++   	chrome.dll!WebCore::DatabaseTracker::removeOpenDatabase(WebCore::Database * database=0x01472480)  Line 135 + 0x9 bytes	C++   	chrome.dll!WebCore::Database::~Database()  Line 205	C++   	chrome.dll!WebCore::Database::`scalar deleting destructor'()  + 0x16 bytes	C++   	chrome.dll!WTF::ThreadSafeShared&lt;WebCore::Database&gt;::deref()  Line 313 + 0x1c bytes	C++   	chrome.dll!WTF::RefPtr&lt;WebCore::Database&gt;::~RefPtr&lt;WebCore::Database&gt;()  Line 53 + 0x2d bytes	C++   	chrome.dll!WebCore::Database::openDatabase(WebCore::Document * document=0x02062000  const WebCore::String &amp; name={...}  const WebCore::String &amp; expectedVersion={...}  const WebCore::String &amp; displayName={...}  unsigned long estimatedSize=1  int &amp; e=11)  Line 135 + 0x12 bytes	C++   	chrome.dll!WebCore::DOMWindow::openDatabase(const WebCore::String &amp; name={...}  const WebCore::String &amp; version={...}  const WebCore::String &amp; displayName={...}  unsigned long estimatedSize=1  int &amp; ec=11)  Line 1118 + 0x21 bytes	C++   	chrome.dll!WebCore::DOMWindowInternal::openDatabaseCallback(const v8::Arguments &amp; args={...})  Line 2090 + 0x20 bytes	C++   	chrome.dll!v8::internal::Builtin_HandleApiCall(v8::internal::Arguments args={...})  Line 383 + 0x13 bytes	C++   	008c018b()	   	chrome.dll!v8::internal::Invoke(bool construct=false  v8::internal::Handle&lt;v8::internal::JSFunction&gt; func={...}  v8::internal::Handle&lt;v8::internal::Object&gt; receiver={...}  int argc=1  v8::internal::Object * * * args=0x001be41c  bool * has_pending_exception=0x001be34b)  Line 103 + 0x19 bytes	C++   	chrome.dll!v8::internal::Execution::Call(v8::internal::Handle&lt;v8::internal::JSFunction&gt; func={...}  v8::internal::Handle&lt;v8::internal::Object&gt; receiver={...}  int argc=1  v8::internal::Object * * * args=0x001be41c  bool * pending_exception=0x001be34b)  Line 129 + 0x1f bytes	C++   	chrome.dll!v8::Function::Call(v8::Handle&lt;v8::Object&gt; recv={...}  int argc=1  v8::Handle&lt;v8::Value&gt; * argv=0x001be41c)  Line 2426 + 0x1d bytes	C++   	chrome.dll!WebCore::V8Proxy::callFunction(v8::Handle&lt;v8::Function&gt; function={...}  v8::Handle&lt;v8::Object&gt; receiver={...}  int argc=1  v8::Handle&lt;v8::Value&gt; * args=0x001be41c)  Line 532 + 0x1f bytes	C++   	chrome.dll!WebCore::V8LazyEventListener::callListenerFunction(WebCore::ScriptExecutionContext * context=0x02062034  v8::Handle&lt;v8::Value&gt; jsEvent={...}  WebCore::Event * event=0x020b9680)  Line 65 + 0x26 bytes	C++   	chrome.dll!WebCore::V8AbstractEventListener::invokeEventHandler(WebCore::ScriptExecutionContext * context=0x02062034  WebCore::Event * event=0x020b9680  v8::Handle&lt;v8::Value&gt; jsEvent={...})  Line 145 + 0x1f bytes	C++   	chrome.dll!WebCore::V8AbstractEventListener::handleEvent(WebCore::ScriptExecutionContext * context=0x02062034  WebCore::Event * event=0x020b9680)  Line 91	C++   	chrome.dll!WebCore::EventTarget::fireEventListeners(WebCore::Event * event=0x020b9680)  Line 297 + 0x35 bytes	C++   	chrome.dll!WebCore::DOMWindow::dispatchEvent(WTF::PassRefPtr&lt;WebCore::Event&gt; prpEvent={...}  WTF::PassRefPtr&lt;WebCore::EventTarget&gt; prpTarget={...})  Line 1327 + 0x11 bytes	C++   	chrome.dll!WebCore::DOMWindow::dispatchLoadEvent()  Line 1288	C++   	chrome.dll!WebCore::Document::dispatchWindowLoadEvent()  Line 2904	C++   	chrome.dll!WebCore::Document::implicitClose()  Line 1735	C++   	chrome.dll!WebCore::FrameLoader::checkCallImplicitClose()  Line 1160	C++   	chrome.dll!WebCore::FrameLoader::checkCompleted()  Line 1109	C++   	chrome.dll!WebCore::FrameLoader::loadDone()  Line 1060	C++   	chrome.dll!WebCore::DocLoader::setLoadInProgress(bool load=false)  Line 336	C++   	chrome.dll!WebCore::Loader::Host::didFinishLoading(WebCore::SubresourceLoader * loader=0x02046800)  Line 375	C++   	chrome.dll!WebCore::SubresourceLoader::didFinishLoading()  Line 184 + 0x21 bytes	C++   	chrome.dll!WebCore::ResourceLoader::didFinishLoading(WebCore::ResourceHandle * __formal=0x014da360)  Line 403 + 0xf bytes	C++   	chrome.dll!WebCore::ResourceHandleInternal::didFinishLoading(WebKit::WebURLLoader * __formal=0x01420d18)  Line 147 + 0x25 bytes	C++   	chrome.dll!webkit_glue::WebURLLoaderImpl::Context::OnCompletedRequest(const URLRequestStatus &amp; status={...}  const std::basic_string&lt;char std::char_traits&lt;char&gt; std::allocator&lt;char&gt; &gt; &amp; security_info=&quot;&quot;)  Line 515 + 0x1e bytes	C++   	chrome.dll!ResourceDispatcher::OnRequestComplete(int request_id=2  const URLRequestStatus &amp; status={...}  const std::basic_string&lt;char std::char_traits&lt;char&gt; std::allocator&lt;char&gt; &gt; &amp; security_info=&quot;&quot;)  Line 472 + 0x17 bytes	C++   	chrome.dll!DispatchToMethod&lt;ResourceDispatcher void (__thiscall ResourceDispatcher::*)(int URLRequestStatus const &amp; std::basic_string&lt;char std::char_traits&lt;char&gt; std::allocator&lt;char&gt; &gt; const &amp;) int URLRequestStatus std::basic_string&lt;char std::char_traits&lt;char&gt; std::allocator&lt;char&gt; &gt; &gt;(ResourceDispatcher * obj=0x0142d780  void (int  const URLRequestStatus &amp;  const std::basic_string&lt;char std::char_traits&lt;char&gt; std::allocator&lt;char&gt; &gt; &amp;)* method=0x62ef3ad0  const Tuple3&lt;int URLRequestStatus std::basic_string&lt;char std::char_traits&lt;char&gt; std::allocator&lt;char&gt; &gt; &gt; &amp; arg={...})  Line 435 + 0x1c bytes	C++   	chrome.dll!IPC::MessageWithTuple&lt;Tuple3&lt;int URLRequestStatus std::basic_string&lt;char std::char_traits&lt;char&gt; std::allocator&lt;char&gt; &gt; &gt; &gt;::Dispatch&lt;ResourceDispatcher void (__thiscall ResourceDispatcher::*)(int URLRequestStatus const &amp; std::basic_string&lt;char std::char_traits&lt;char&gt; std::allocator&lt;char&gt; &gt; const &amp;)&gt;(const IPC::Message * msg=0x0205ef28  ResourceDispatcher * obj=0x0142d780  void (int  const URLRequestStatus &amp;  const std::basic_string&lt;char std::char_traits&lt;char&gt; std::allocator&lt;char&gt; &gt; &amp;)* func=0x62ef3ad0)  Line 999 + 0x11 bytes	C++   	chrome.dll!ResourceDispatcher::DispatchMessageW(const IPC::Message &amp; message={...})  Line 544 + 0x12 bytes	C++   	chrome.dll!ResourceDispatcher::OnMessageReceived(const IPC::Message &amp; message={...})  Line 319	C++   	chrome.dll!ChildThread::OnMessageReceived(const IPC::Message &amp; msg={...})  Line 98 + 0x19 bytes	C++   	chrome.dll!IPC::ChannelProxy::Context::OnDispatchMessage(const IPC::Message &amp; message={...})  Line 204 + 0x1b bytes	C++   	chrome.dll!DispatchToMethod&lt;IPC::ChannelProxy::Context void (__thiscall IPC::ChannelProxy::Context::*)(IPC::Message const &amp;) IPC::Message&gt;(IPC::ChannelProxy::Context * obj=0x01472000  void (const IPC::Message &amp;)* method=0x620d2870  const Tuple1&lt;IPC::Message&gt; &amp; arg={...})  Line 422 + 0xf bytes	C++   	chrome.dll!RunnableMethod&lt;IPC::ChannelProxy::Context void (__thiscall IPC::ChannelProxy::Context::*)(IPC::Message const &amp;) Tuple1&lt;IPC::Message&gt; &gt;::Run()  Line 277 + 0x1e bytes	C++   	chrome.dll!MessageLoop::RunTask(Task * task=0x0205ef00)  Line 320 + 0xf bytes	C++   	chrome.dll!MessageLoop::DeferOrRunPendingTask(const MessageLoop::PendingTask &amp; pending_task={...})  Line 331	C++   	chrome.dll!MessageLoop::DoWork()  Line 435 + 0xc bytes	C++   	chrome.dll!base::MessagePumpDefault::Run(base::MessagePump::Delegate * delegate=0x001bf3e0)  Line 23 + 0xf bytes	C++   	chrome.dll!MessageLoop::RunInternal()  Line 205 + 0x2a bytes	C++   	chrome.dll!MessageLoop::RunHandler()  Line 178	C++   	chrome.dll!MessageLoop::Run()  Line 156	C++   	chrome.dll!RendererMain(const MainFunctionParams &amp; parameters={...})  Line 278	C++   	chrome.dll!ChromeMain(HINSTANCE__ * instance=0x008f0000  sandbox::SandboxInterfaceInfo * sandbox_info=0x001bfbc4  wchar_t * command_line=0x00413168)  Line 561 + 0xc bytes	C++   	chrome.exe!MainDllLoader::Launch(HINSTANCE__ * instance=0x008f0000  sandbox::SandboxInterfaceInfo * sbox_info=0x001bfbc4)  Line 176 + 0x1d bytes	C++   	chrome.exe!wWinMain(HINSTANCE__ * instance=0x008f0000  HINSTANCE__ * __formal=0x00000000  HINSTANCE__ * __formal=0x00000000  HINSTANCE__ * __formal=0x00000000)  Line 47 + 0x10 bytes	C++   	chrome.exe!__tmainCRTStartup()  Line 324 + 0x35 bytes	C   	chrome.exe!wWinMainCRTStartup()  Line 196	C   	kernel32.dll!@BaseThreadInitThunk@12()  + 0xe bytes	   	ntdll.dll!___RtlUserThreadStart@8()  + 0x23 bytes	   	ntdll.dll!__RtlUserThreadStart@8()  + 0x1b bytes	   </pre>
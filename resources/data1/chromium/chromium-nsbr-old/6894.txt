<title>Issue 6894 -   chromium -    Proxy lookup in proxy_resolver_winhttp.cc looks incorrect - Project Hosting on Google Code</title> <pre> Chrome Version       : File <a href="/p/chromium/source/detail?r=7323">revision 7323</a> (latest as of Fri Dec 19)    Currently the code to retrieve proxy information if no PAC file is  specified looks like this (line 69 ff)    options.lpszAutoConfigUrl =        pac_url_wide.empty() ? L&quot;http://wpad/wpad.dat : pac_url_wide.c_str();    ...    BOOL ok = CallWinHttpGetProxyForUrl(...)    I believe this is flawed because I suspect this default pac_url may go to  wpad.com instead of the local WPAD configuration when there is no WPAD  setup.  See <a href="http://www.wpad.com/">http://www.wpad.com/</a> where he complains about getting threats  due to buggy browser traffic.  Instead it seems that the default should be  &quot;wpad.foo.com&quot; where &quot;foo.com&quot; is the domain name of the computer.  Even  better  if a PAC is not specified why not call the API &quot;properly&quot; and ask  it to use DNS lookup if that's what we want?  According to the microsoft  docs at <a href="http://msdn.microsoft.com/en-us/library/aa384122(VS.85).aspx">http://msdn.microsoft.com/en-us/library/aa384122(VS.85).aspx</a> I  think the code should therefore look like:    if(pac_url_wide.empty()) {          // Use auto-detection because the Proxy         // Auto-Config URL is not known.        options.dwFlags = WINHTTP_AUTOPROXY_AUTO_DETECT;          // Use only DNS-based auto-detection.        // DHCP may be buggy as stated above?        options.dwAutoDetectFlags = WINHTTP_AUTO_DETECT_TYPE_DNS_A;  }  else  {        // Use PAC configuration        options.dwFlags = WINHTTP_AUTOPROXY_CONFIG_URL;        std::wstring pac_url_wide = ASCIIToWide(pac_url);        options.lpszAutoConfigUrl = pac_url_wide.c_str();  }             </pre>
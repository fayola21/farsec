<title>Issue 6259 -   chromium -    Chromium crashes with custom cursors - WebCursor::GetCursor() hitting InvalidParameter - Project Hosting on Google Code</title> <pre> Chrome Version       : continuous build @ <a href="/p/chromium/source/detail?r=7859">r7859</a> from <a href="http://build.chromium.org/buildbot/continuous/2009-01-11/7859/">http://build.chromium.org/buildbot/continuous/2009-01-11/7859/</a>  URLs (if applicable) : <a href="http://maps.google.com">http://maps.google.com</a>        1. Navigate Google maps  2. Scroll in/out  drag  move the mouse cursor in/out of the map area to   change the custom cursor until problem appears  3. See Chromium Crash  4. Sigh :(      Unfortunately I can't reproduce this on my primary workstation with visual   studio installed  only within a VMWare instance.  Both are running Win XP   SP3.  Thus the following info is from windbg.    Stacktrace:    chrome_1000000!`anonymous namespace'::InvalidParameter(wchar_t * expression   = 0x00000000 &quot;&quot;  wchar_t * function = 0x00000000 &quot;&quot;  wchar_t * file =   0x00000000 &quot;&quot;  unsigned int line = 0  unsigned int reserved = 0)+0x3   [c:bslavechromium-rel-xpbuildsrcchromeappchrome_dll_main.cc @ 87]  chrome_1000000!_invalid_parameter_noinfo(void)+0xc   [f:spvctoolscrt_bldself_x86crtsrcinvarg.c @ 99]  chrome_1000000!WebCursor::GetCursor(struct HINSTANCE__ * module_handle =   0x01000000)+0x12c [c:bslavechromium-rel-  xpbuildsrcwebkitgluewebcursor_win.cc @ 167]  chrome_1000000!RenderWidgetHostViewWin::UpdateCursorIfOverSelf(void)+0x83   [c:bslavechromium-rel-  xpbuildsrcchromebrowserrender_widget_host_view_win.cc @ 236]  chrome_1000000!RenderWidgetHostViewWin::UpdateCursor(class WebCursor *   cursor = 0x0012f3c8)+0x1b [c:bslavechromium-rel-  xpbuildsrcchromebrowserrender_widget_host_view_win.cc @ 218]  chrome_1000000!IPC::MessageWithTuple&lt;WebCursor&gt;::Dispatch&lt;RenderWidgetHost   void (class IPC::Message * msg = 0x0295f218  class RenderWidgetHost * obj =   0x028a2aa0  &lt;function&gt; * func = 0x011ed170)+0x2c [c:bslavechromium-rel-  xpbuildsrcchromecommonipc_message_utils.h @ 1041]  chrome_1000000!RenderWidgetHost::OnMessageReceived(class IPC::Message * msg   = 0x0295f218)+0x139 [c:bslavechromium-rel-  xpbuildsrcchromebrowserrender_widget_host.cc @ 322]  chrome_1000000!RenderViewHost::OnMessageReceived(class IPC::Message * msg =   0x0295f218)+0x4f9 [c:bslavechromium-rel-  xpbuildsrcchromebrowserrender_view_host.cc @ 712]  chrome_1000000!RenderProcessHost::OnMessageReceived(class IPC::Message *   msg = 0x0295f218)+0x170 [c:bslavechromium-rel-  xpbuildsrcchromebrowserrender_process_host.cc @ 618]  chrome_1000000!RunnableMethod&lt;history::HistoryBackend void (void)+0x17   [c:bslavechromium-rel-xpbuildsrcbasetask.h @ 312]  chrome_1000000!MessageLoop::RunTask(class Task * task = 0x0295f208)+0x80   [c:bslavechromium-rel-xpbuildsrcbasemessage_loop.cc @ 309]  chrome_1000000!MessageLoop::DoWork(void)+0x1ea [c:bslavechromium-rel-  xpbuildsrcbasemessage_loop.cc @ 416]  chrome_1000000!base::MessagePumpForUI::DoRunLoop(void)+0x5a   [c:bslavechromium-rel-xpbuildsrcbasemessage_pump_win.cc @ 209]  chrome_1000000!base::MessagePumpWin::RunWithDispatcher(class   base::MessagePump::Delegate * delegate = 0x0012f8d0  class   base::MessagePumpWin::Dispatcher * dispatcher = 0x00d4a0d0)+0x42   [c:bslavechromium-rel-xpbuildsrcbasemessage_pump_win.cc @ 54]  chrome_1000000!MessageLoop::RunInternal(void)+0xa9 [c:bslavechromium-  rel-xpbuildsrcbasemessage_loop.cc @ 192]  chrome_1000000!MessageLoop::RunHandler(void)+0xa0 [c:bslavechromium-rel-  xpbuildsrcbasemessage_loop.cc @ 181]  chrome_1000000!MessageLoopForUI::Run(class base::MessagePumpWin::Dispatcher   * dispatcher = 0x00d4a0d0)+0x49 [c:bslavechromium-rel-  xpbuildsrcbasemessage_loop.cc @ 559]  chrome_1000000!BrowserMain(struct MainFunctionParams * parameters =   0x0012fbf0)+0x1218 [c:bslavechromium-rel-  xpbuildsrcchromebrowserbrowser_main.cc @ 492]  chrome_1000000!ChromeMain(struct HINSTANCE__ * instance = 0x00400000  union   sandbox::SandboxInterfaceInfo * sandbox_info = 0x0012fcfc  wchar_t *   command_line = 0x000207d6 &quot;&quot;)+0x5c2 [c:bslavechromium-rel-  xpbuildsrcchromeappchrome_dll_main.cc @ 302]  chrome!wWinMain(struct HINSTANCE__ * instance = 0x00400000  struct   HINSTANCE__ * prev_instance = 0x00000000  wchar_t * command_line =   0x000207d6 &quot;&quot;  int __formal = 10)+0x22e [c:bslavechromium-rel-  xpbuildsrcchromeappchrome_exe_main.cc @ 93]    Here are the stack locals from the WebCursor::GetCursor frame:    module_handle	0x01000000 struct HINSTANCE__ *	struct HINSTANCE__ *	  0012f39c  cursor_bitmap_info	struct tagBITMAPINFO	struct tagBITMAPINFO	  0012f350  dc	0xea010629 struct HDC__ *	struct HDC__ *	0012f390  ii	struct _ICONINFO	struct _ICONINFO	0012f37c  mask	0x01000000 struct HBITMAP__ *	struct HBITMAP__ *	0012f39c  old_bitmap	0x01000000 struct HBITMAP__ *	struct HBITMAP__ *	  0012f39c  this	0x010012b0 class WebCursor *	class WebCursor *	@ecx   type_	-856913067	int	010012b0   hotspot_	class gfx::Point	class gfx::Point	010012b4   custom_size_	class gfx::Size	class gfx::Size	010012bc   custom_data_	class std::vector&lt;char std::allocator&lt;char&gt; &gt;	class   std::vector&lt;char std::allocator&lt;char&gt; &gt;	010012c4   external_cursor_	0x0001fc45 struct HICON__ *	struct HICON__ *	  010012d4   custom_cursor_	0x458b0000 struct HICON__ *	struct HICON__ *	  010012d8    Since this crash does not appear for every cursor change it seems there   could be some timing/synchronization issues.     </pre>
<title>Issue 23100 -   chromium -    occasional invalid memory read / write in UtilityProcessHostTest - Project Hosting on Google Code</title> <pre> Very flaky it seems  similar to bug 16625:    <a href="http://build.chromium.org/buildbot/waterfall/builders/Linux%20Tests%20(valgrind)(4)/builds/359/steps/valgrind%20test%3A%20unit/logs/stdio">http://build.chromium.org/buildbot/waterfall/builders/Linux%20Tests%20(valgrind)(4)/builds/359/steps/valgrind%20test%3A%20unit/logs/stdio</a>    13:28:02 memcheck_analyze.py [ERROR] FAIL! There were 2 errors:  13:28:02 memcheck_analyze.py [ERROR] InvalidWrite  Invalid write of size 1    IPC::Channel::ChannelImpl::ProcessOutgoingMessages()  (uilder/build/src/ipc/ipc_channel_posix.cc:693)    IPC::Channel::ChannelImpl::OnFileCanReadWithoutBlocking(int)  (uilder/build/src/ipc/ipc_channel_posix.cc:916)    base::MessagePumpLibevent::OnLibeventNotification(int  short  void*)  (uilder/build/src/base/message_pump_libevent.cc:214)    event_process_active (uilder/build/src/third_party/libevent/event.c:385)    event_base_loop (uilder/build/src/third_party/libevent/event.c:522)    base::MessagePumpLibevent::Run(base::MessagePump::Delegate*)  (uilder/build/src/base/message_pump_libevent.cc:249)    MessageLoop::RunInternal() (uilder/build/src/base/message_loop.cc:199)    MessageLoop::RunHandler() (uilder/build/src/base/message_loop.cc:181)    MessageLoop::Run() (uilder/build/src/base/message_loop.cc:155)    (anonymous namespace)::ProcessClosedObserver::RunUntilClose(int)  (uilder/build/src/chrome/browser/utility_process_host_unittest.cc:105)    (anonymous  namespace)::UtilityProcessHostTest_ExtensionUnpacker_Test::TestBody()  (uilder/build/src/chrome/browser/utility_process_host_unittest.cc:149)    testing::Test::Run() (uilder/build/src/testing/gtest/src/gtest.cc:2056)    testing::internal::TestInfoImpl::Run()  (uilder/build/src/testing/gtest/src/gtest.cc:2287)    testing::internal::TestInfoImpl::RunTest(testing::TestInfo*)  (uilder/build/src/testing/gtest/src/gtest-internal-inl.h:655)    void testing::internal::List&lt;testing::TestInfo*&gt;::ForEach&lt;void  (*)(testing::TestInfo*)&gt;(void (*)(testing::TestInfo*)) const  (uilder/build/src/testing/gtest/src/gtest-internal-inl.h:397)    testing::TestCase::Run() (uilder/build/src/testing/gtest/src/gtest.cc:2383)    testing::TestCase::RunTestCase(testing::TestCase*)  (uilder/build/src/testing/gtest/src/gtest-internal-inl.h:776)    void testing::internal::List&lt;testing::TestCase*&gt;::ForEach&lt;void  (*)(testing::TestCase*)&gt;(void (*)(testing::TestCase*)) const  (uilder/build/src/testing/gtest/src/gtest-internal-inl.h:397)    testing::internal::UnitTestImpl::RunAllTests()  (uilder/build/src/testing/gtest/src/gtest.cc:3670)    testing::UnitTest::Run() (uilder/build/src/testing/gtest/src/gtest.cc:3404)    TestSuite::Run() (uilder/build/src/base/test_suite.h:93)    main (uilder/build/src/chrome/test/unit/run_all_unittests.cc:8)  Suppression:    fun:_ZN3IPC7Channel11ChannelImpl23ProcessOutgoingMessagesEv    fun:_ZN3IPC7Channel11ChannelImpl28OnFileCanReadWithoutBlockingEi    fun:_ZN4base19MessagePumpLibevent22OnLibeventNotificationEisPv    fun:event_process_active    fun:event_base_loop    fun:_ZN4base19MessagePumpLibevent3RunEPNS_11MessagePump8DelegateE    fun:_ZN11MessageLoop11RunInternalEv    fun:_ZN11MessageLoop10RunHandlerEv    fun:_ZN11MessageLoop3RunEv     fun:_ZN131_GLOBAL__N__b_slave_chromium_rel_linux_valgrind_builder_build_src_chrome_browser_utility_process_host_unittest.cc_00000000_5A81720B21ProcessClosedObserver13RunUntilCloseEi     fun:_ZN131_GLOBAL__N__b_slave_chromium_rel_linux_valgrind_builder_build_src_chrome_browser_utility_process_host_unittest.cc_00000000_5A81720B45UtilityProcessHostTest_ExtensionUnpacker_Test8TestBodyEv    fun:_ZN7testing4Test3RunEv    fun:_ZN7testing8internal12TestInfoImpl3RunEv    fun:_ZN7testing8internal12TestInfoImpl7RunTestEPNS_8TestInfoE    fun:_ZNK7testing8internal4ListIPNS_8TestInfoEE7ForEachIPFvS3_EEEvT_    fun:_ZN7testing8TestCase3RunEv    fun:_ZN7testing8TestCase11RunTestCaseEPS0_    fun:_ZNK7testing8internal4ListIPNS_8TestCaseEE7ForEachIPFvS3_EEEvT_    fun:_ZN7testing8internal12UnitTestImpl11RunAllTestsEv    fun:_ZN7testing8UnitTest3RunEv    fun:_ZN9TestSuite3RunEv    fun:main  Address 0x598c358 is 32 bytes inside a block of size 8 348 free'd    operator delete(void*)  (ome/chrome-bot/valgrind-20090715/coregrind/m_replacemalloc/vg_replace_malloc.c:345)    IPC::Channel::ChannelImpl::~ChannelImpl()  (uilder/build/src/ipc/ipc_channel_posix.h:39)    IPC::Channel::~Channel() (uilder/build/src/ipc/ipc_channel_posix.cc:989)    scoped_ptr&lt;IPC::Channel&gt;::~scoped_ptr()  (uilder/build/src/base/scoped_ptr.h:72)    ChildProcessHost::~ChildProcessHost()  (uilder/build/src/chrome/common/child_process_host.cc:83)    UtilityProcessHost::~UtilityProcessHost()  (uilder/build/src/chrome/browser/utility_process_host.cc:34)    (anonymous namespace)::TestUtilityProcessHost::~TestUtilityProcessHost()  (uilder/build/src/chrome/browser/utility_process_host_unittest.cc:70)    ChildProcessHost::OnChildDied()  (uilder/build/src/chrome/common/child_process_host.cc:211)    ChildProcessHost::ListenerHook::OnChannelError()  (uilder/build/src/chrome/common/child_process_host.cc:270)    IPC::Channel::ChannelImpl::OnFileCanReadWithoutBlocking(int)  (uilder/build/src/ipc/ipc_channel_posix.cc:907)    base::MessagePumpLibevent::OnLibeventNotification(int  short  void*)  (uilder/build/src/base/message_pump_libevent.cc:214)    event_process_active (uilder/build/src/third_party/libevent/event.c:385)    event_base_loop (uilder/build/src/third_party/libevent/event.c:522)    base::MessagePumpLibevent::Run(base::MessagePump::Delegate*)  (uilder/build/src/base/message_pump_libevent.cc:249)    MessageLoop::RunInternal() (uilder/build/src/base/message_loop.cc:199)    MessageLoop::RunHandler() (uilder/build/src/base/message_loop.cc:181)    MessageLoop::Run() (uilder/build/src/base/message_loop.cc:155)    (anonymous namespace)::ProcessClosedObserver::RunUntilClose(int)  (uilder/build/src/chrome/browser/utility_process_host_unittest.cc:105)    (anonymous  namespace)::UtilityProcessHostTest_ExtensionUnpacker_Test::TestBody()  (uilder/build/src/chrome/browser/utility_process_host_unittest.cc:149)    testing::Test::Run() (uilder/build/src/testing/gtest/src/gtest.cc:2056)    testing::internal::TestInfoImpl::Run()  (uilder/build/src/testing/gtest/src/gtest.cc:2287)    testing::internal::TestInfoImpl::RunTest(testing::TestInfo*)  (uilder/build/src/testing/gtest/src/gtest-internal-inl.h:655)    void testing::internal::List&lt;testing::TestInfo*&gt;::ForEach&lt;void  (*)(testing::TestInfo*)&gt;(void (*)(testing::TestInfo*)) const  (uilder/build/src/testing/gtest/src/gtest-internal-inl.h:397)    testing::TestCase::Run() (uilder/build/src/testing/gtest/src/gtest.cc:2383)    testing::TestCase::RunTestCase(testing::TestCase*)  (uilder/build/src/testing/gtest/src/gtest-internal-inl.h:776)    void testing::internal::List&lt;testing::TestCase*&gt;::ForEach&lt;void  (*)(testing::TestCase*)&gt;(void (*)(testing::TestCase*)) const  (uilder/build/src/testing/gtest/src/gtest-internal-inl.h:397)    testing::internal::UnitTestImpl::RunAllTests()  (uilder/build/src/testing/gtest/src/gtest.cc:3670)    testing::UnitTest::Run() (uilder/build/src/testing/gtest/src/gtest.cc:3404)    TestSuite::Run() (uilder/build/src/base/test_suite.h:93)    main (uilder/build/src/chrome/test/unit/run_all_unittests.cc:8)  Suppression:    fun:_ZdlPv    fun:_ZN3IPC7Channel11ChannelImplD0Ev    fun:_ZN3IPC7ChannelD0Ev    fun:_ZN10scoped_ptrIN3IPC7ChannelEED1Ev    fun:_ZN16ChildProcessHostD2Ev    fun:_ZN18UtilityProcessHostD2Ev     fun:_ZN131_GLOBAL__N__b_slave_chromium_rel_linux_valgrind_builder_build_src_chrome_browser_utility_process_host_unittest.cc_00000000_5A81720B22TestUtilityProcessHostD0Ev    fun:_ZN16ChildProcessHost11OnChildDiedEv    fun:_ZN16ChildProcessHost12ListenerHook14OnChannelErrorEv    fun:_ZN3IPC7Channel11ChannelImpl28OnFileCanReadWithoutBlockingEi    fun:_ZN4base19MessagePumpLibevent22OnLibeventNotificationEisPv    fun:event_process_active    fun:event_base_loop    fun:_ZN4base19MessagePumpLibevent3RunEPNS_11MessagePump8DelegateE    fun:_ZN11MessageLoop11RunInternalEv    fun:_ZN11MessageLoop10RunHandlerEv    fun:_ZN11MessageLoop3RunEv     fun:_ZN131_GLOBAL__N__b_slave_chromium_rel_linux_valgrind_builder_build_src_chrome_browser_utility_process_host_unittest.cc_00000000_5A81720B21ProcessClosedObserver13RunUntilCloseEi     fun:_ZN131_GLOBAL__N__b_slave_chromium_rel_linux_valgrind_builder_build_src_chrome_browser_utility_process_host_unittest.cc_00000000_5A81720B45UtilityProcessHostTest_ExtensionUnpacker_Test8TestBodyEv    fun:_ZN7testing4Test3RunEv    fun:_ZN7testing8internal12TestInfoImpl3RunEv    fun:_ZN7testing8internal12TestInfoImpl7RunTestEPNS_8TestInfoE    fun:_ZNK7testing8internal4ListIPNS_8TestInfoEE7ForEachIPFvS3_EEEvT_    fun:_ZN7testing8TestCase3RunEv    fun:_ZN7testing8TestCase11RunTestCaseEPS0_    fun:_ZNK7testing8internal4ListIPNS_8TestCaseEE7ForEachIPFvS3_EEEvT_    fun:_ZN7testing8internal12UnitTestImpl11RunAllTestsEv    fun:_ZN7testing8UnitTest3RunEv    fun:_ZN9TestSuite3RunEv    fun:main    13:28:02 memcheck_analyze.py [ERROR] InvalidRead  Invalid read of size 4    bool std::operator==&lt;IPC::Message*  IPC::Message*&amp;   IPC::Message**&gt;(std::_Deque_iterator&lt;IPC::Message*  IPC::Message*&amp;   IPC::Message**&gt; const&amp;  std::_Deque_iterator&lt;IPC::Message*  IPC::Message*&amp;   IPC::Message**&gt; const&amp;) (sr/include/c++/4.2/bits/stl_deque.h:244)    std::deque&lt;IPC::Message*  std::allocator&lt;IPC::Message*&gt; &gt;::empty() const  (sr/include/c++/4.2/bits/stl_deque.h:902)    std::queue&lt;IPC::Message*  std::deque&lt;IPC::Message*   std::allocator&lt;IPC::Message*&gt; &gt; &gt;::empty() const  (sr/include/c++/4.2/bits/stl_queue.h:142)    IPC::Channel::ChannelImpl::ProcessOutgoingMessages()  (uilder/build/src/ipc/ipc_channel_posix.cc:695)    IPC::Channel::ChannelImpl::OnFileCanReadWithoutBlocking(int)  (uilder/build/src/ipc/ipc_channel_posix.cc:916)    base::MessagePumpLibevent::OnLibeventNotification(int  short  void*)  (uilder/build/src/base/message_pump_libevent.cc:214)    event_process_active (uilder/build/src/third_party/libevent/event.c:385)    event_base_loop (uilder/build/src/third_party/libevent/event.c:522)    base::MessagePumpLibevent::Run(base::MessagePump::Delegate*)  (uilder/build/src/base/message_pump_libevent.cc:249)    MessageLoop::RunInternal() (uilder/build/src/base/message_loop.cc:199)    MessageLoop::RunHandler() (uilder/build/src/base/message_loop.cc:181)    MessageLoop::Run() (uilder/build/src/base/message_loop.cc:155)    (anonymous namespace)::ProcessClosedObserver::RunUntilClose(int)  (uilder/build/src/chrome/browser/utility_process_host_unittest.cc:105)    (anonymous  namespace)::UtilityProcessHostTest_ExtensionUnpacker_Test::TestBody()  (uilder/build/src/chrome/browser/utility_process_host_unittest.cc:149)    testing::Test::Run() (uilder/build/src/testing/gtest/src/gtest.cc:2056)    testing::internal::TestInfoImpl::Run()  (uilder/build/src/testing/gtest/src/gtest.cc:2287)    testing::internal::TestInfoImpl::RunTest(testing::TestInfo*)  (uilder/build/src/testing/gtest/src/gtest-internal-inl.h:655)    void testing::internal::List&lt;testing::TestInfo*&gt;::ForEach&lt;void  (*)(testing::TestInfo*)&gt;(void (*)(testing::TestInfo*)) const  (uilder/build/src/testing/gtest/src/gtest-internal-inl.h:397)    testing::TestCase::Run() (uilder/build/src/testing/gtest/src/gtest.cc:2383)    testing::TestCase::RunTestCase(testing::TestCase*)  (uilder/build/src/testing/gtest/src/gtest-internal-inl.h:776)    void testing::internal::List&lt;testing::TestCase*&gt;::ForEach&lt;void  (*)(testing::TestCase*)&gt;(void (*)(testing::TestCase*)) const  (uilder/build/src/testing/gtest/src/gtest-internal-inl.h:397)    testing::internal::UnitTestImpl::RunAllTests()  (uilder/build/src/testing/gtest/src/gtest.cc:3670)    testing::UnitTest::Run() (uilder/build/src/testing/gtest/src/gtest.cc:3404)    TestSuite::Run() (uilder/build/src/base/test_suite.h:93)    main (uilder/build/src/chrome/test/unit/run_all_unittests.cc:8)  Suppression:    fun:_ZSteqIPN3IPC7MessageERS2_PS2_EbRKSt15_Deque_iteratorIT_T0_T1_ESB_    fun:_ZNKSt5dequeIPN3IPC7MessageESaIS2_EE5emptyEv    fun:_ZNKSt5queueIPN3IPC7MessageESt5dequeIS2_SaIS2_EEE5emptyEv    fun:_ZN3IPC7Channel11ChannelImpl23ProcessOutgoingMessagesEv    fun:_ZN3IPC7Channel11ChannelImpl28OnFileCanReadWithoutBlockingEi    fun:_ZN4base19MessagePumpLibevent22OnLibeventNotificationEisPv    fun:event_process_active    fun:event_base_loop    fun:_ZN4base19MessagePumpLibevent3RunEPNS_11MessagePump8DelegateE    fun:_ZN11MessageLoop11RunInternalEv    fun:_ZN11MessageLoop10RunHandlerEv    fun:_ZN11MessageLoop3RunEv     fun:_ZN131_GLOBAL__N__b_slave_chromium_rel_linux_valgrind_builder_build_src_chrome_browser_utility_process_host_unittest.cc_00000000_5A81720B21ProcessClosedObserver13RunUntilCloseEi     fun:_ZN131_GLOBAL__N__b_slave_chromium_rel_linux_valgrind_builder_build_src_chrome_browser_utility_process_host_unittest.cc_00000000_5A81720B45UtilityProcessHostTest_ExtensionUnpacker_Test8TestBodyEv    fun:_ZN7testing4Test3RunEv    fun:_ZN7testing8internal12TestInfoImpl3RunEv    fun:_ZN7testing8internal12TestInfoImpl7RunTestEPNS_8TestInfoE    fun:_ZNK7testing8internal4ListIPNS_8TestInfoEE7ForEachIPFvS3_EEEvT_    fun:_ZN7testing8TestCase3RunEv    fun:_ZN7testing8TestCase11RunTestCaseEPS0_    fun:_ZNK7testing8internal4ListIPNS_8TestCaseEE7ForEachIPFvS3_EEEvT_    fun:_ZN7testing8internal12UnitTestImpl11RunAllTestsEv    fun:_ZN7testing8UnitTest3RunEv    fun:_ZN9TestSuite3RunEv    fun:main  Address 0x598c398 is 96 bytes inside a block of size 8 348 free'd    operator delete(void*)  (ome/chrome-bot/valgrind-20090715/coregrind/m_replacemalloc/vg_replace_malloc.c:345)    IPC::Channel::ChannelImpl::~ChannelImpl()  (uilder/build/src/ipc/ipc_channel_posix.h:39)    IPC::Channel::~Channel() (uilder/build/src/ipc/ipc_channel_posix.cc:989)    scoped_ptr&lt;IPC::Channel&gt;::~scoped_ptr()  (uilder/build/src/base/scoped_ptr.h:72)    ChildProcessHost::~ChildProcessHost()  (uilder/build/src/chrome/common/child_process_host.cc:83)    UtilityProcessHost::~UtilityProcessHost()  (uilder/build/src/chrome/browser/utility_process_host.cc:34)    (anonymous namespace)::TestUtilityProcessHost::~TestUtilityProcessHost()  (uilder/build/src/chrome/browser/utility_process_host_unittest.cc:70)    ChildProcessHost::OnChildDied()  (uilder/build/src/chrome/common/child_process_host.cc:211)    ChildProcessHost::ListenerHook::OnChannelError()  (uilder/build/src/chrome/common/child_process_host.cc:270)    IPC::Channel::ChannelImpl::OnFileCanReadWithoutBlocking(int)  (uilder/build/src/ipc/ipc_channel_posix.cc:907)    base::MessagePumpLibevent::OnLibeventNotification(int  short  void*)  (uilder/build/src/base/message_pump_libevent.cc:214)    event_process_active (uilder/build/src/third_party/libevent/event.c:385)    event_base_loop (uilder/build/src/third_party/libevent/event.c:522)    base::MessagePumpLibevent::Run(base::MessagePump::Delegate*)  (uilder/build/src/base/message_pump_libevent.cc:249)    MessageLoop::RunInternal() (uilder/build/src/base/message_loop.cc:199)    MessageLoop::RunHandler() (uilder/build/src/base/message_loop.cc:181)    MessageLoop::Run() (uilder/build/src/base/message_loop.cc:155)    (anonymous namespace)::ProcessClosedObserver::RunUntilClose(int)  (uilder/build/src/chrome/browser/utility_process_host_unittest.cc:105)    (anonymous  namespace)::UtilityProcessHostTest_ExtensionUnpacker_Test::TestBody()  (uilder/build/src/chrome/browser/utility_process_host_unittest.cc:149)    testing::Test::Run() (uilder/build/src/testing/gtest/src/gtest.cc:2056)    testing::internal::TestInfoImpl::Run()  (uilder/build/src/testing/gtest/src/gtest.cc:2287)    testing::internal::TestInfoImpl::RunTest(testing::TestInfo*)  (uilder/build/src/testing/gtest/src/gtest-internal-inl.h:655)    void testing::internal::List&lt;testing::TestInfo*&gt;::ForEach&lt;void  (*)(testing::TestInfo*)&gt;(void (*)(testing::TestInfo*)) const  (uilder/build/src/testing/gtest/src/gtest-internal-inl.h:397)    testing::TestCase::Run() (uilder/build/src/testing/gtest/src/gtest.cc:2383)    testing::TestCase::RunTestCase(testing::TestCase*)  (uilder/build/src/testing/gtest/src/gtest-internal-inl.h:776)    void testing::internal::List&lt;testing::TestCase*&gt;::ForEach&lt;void  (*)(testing::TestCase*)&gt;(void (*)(testing::TestCase*)) const  (uilder/build/src/testing/gtest/src/gtest-internal-inl.h:397)    testing::internal::UnitTestImpl::RunAllTests()  (uilder/build/src/testing/gtest/src/gtest.cc:3670)    testing::UnitTest::Run() (uilder/build/src/testing/gtest/src/gtest.cc:3404)    TestSuite::Run() (uilder/build/src/base/test_suite.h:93)    main (uilder/build/src/chrome/test/unit/run_all_unittests.cc:8)  Suppression:    fun:_ZdlPv    fun:_ZN3IPC7Channel11ChannelImplD0Ev    fun:_ZN3IPC7ChannelD0Ev    fun:_ZN10scoped_ptrIN3IPC7ChannelEED1Ev    fun:_ZN16ChildProcessHostD2Ev    fun:_ZN18UtilityProcessHostD2Ev     fun:_ZN131_GLOBAL__N__b_slave_chromium_rel_linux_valgrind_builder_build_src_chrome_browser_utility_process_host_unittest.cc_00000000_5A81720B22TestUtilityProcessHostD0Ev    fun:_ZN16ChildProcessHost11OnChildDiedEv    fun:_ZN16ChildProcessHost12ListenerHook14OnChannelErrorEv    fun:_ZN3IPC7Channel11ChannelImpl28OnFileCanReadWithoutBlockingEi    fun:_ZN4base19MessagePumpLibevent22OnLibeventNotificationEisPv    fun:event_process_active    fun:event_base_loop    fun:_ZN4base19MessagePumpLibevent3RunEPNS_11MessagePump8DelegateE    fun:_ZN11MessageLoop11RunInternalEv    fun:_ZN11MessageLoop10RunHandlerEv    fun:_ZN11MessageLoop3RunEv     fun:_ZN131_GLOBAL__N__b_slave_chromium_rel_linux_valgrind_builder_build_src_chrome_browser_utility_process_host_unittest.cc_00000000_5A81720B21ProcessClosedObserver13RunUntilCloseEi     fun:_ZN131_GLOBAL__N__b_slave_chromium_rel_linux_valgrind_builder_build_src_chrome_browser_utility_process_host_unittest.cc_00000000_5A81720B45UtilityProcessHostTest_ExtensionUnpacker_Test8TestBodyEv    fun:_ZN7testing4Test3RunEv    fun:_ZN7testing8internal12TestInfoImpl3RunEv    fun:_ZN7testing8internal12TestInfoImpl7RunTestEPNS_8TestInfoE    fun:_ZNK7testing8internal4ListIPNS_8TestInfoEE7ForEachIPFvS3_EEEvT_    fun:_ZN7testing8TestCase3RunEv    fun:_ZN7testing8TestCase11RunTestCaseEPS0_    fun:_ZNK7testing8internal4ListIPNS_8TestCaseEE7ForEachIPFvS3_EEEvT_    fun:_ZN7testing8internal12UnitTestImpl11RunAllTestsEv    fun:_ZN7testing8UnitTest3RunEv    fun:_ZN9TestSuite3RunEv    fun:main   </pre>
<title>Issue 2363 -   chromium -    MERGE-BRANCH: ASSERT clicking on link on Apple.com - Project Hosting on Google Code</title> <pre> I think this is due to somehow us not clearing the navigator and location objects during page   navigation as this ASSERT seems to be guarding against.        // Look for real DOM wrapper.      global = LookupDOMWrapper(V8ClassIndex::DOMWINDOW  global);      ASSERT(global-&gt;GetInternalField(internal_index)-&gt;IsUndefined());      global-&gt;SetInternalField(internal_index  jsobj);    In this case  we're looking up the navigator object.  I'm not sure why every call to   window.navigator wouldn't trip this ASSERT  I guess V8 does some caching of the result it gets   back from the DOM.    This would probably be a totally different path if we implemented the split window object.    to reproduce:  1. build the merge branch  2.  run test_shell  3.  load <a href="http://www.apple.com/">http://www.apple.com/</a>  4.  click on one of hte big square images down lower in the page.       	test_shell.exe!WebCore::V8Proxy::SetHiddenWindowReference(WebCore::Frame *   frame=0x03924f58  const int internal_index=3  v8::Handle&lt;v8::Object&gt; jsobj={...})  Line 1880 +   0x48 bytes	C++  &gt;	test_shell.exe!WebCore::V8Proxy::ToV8Object(WebCore::V8ClassIndex::V8WrapperType   type=NAVIGATOR  void * imp=0x051daca0)  Line 1858 + 0x1a bytes	C++   	test_shell.exe!WebCore::DOMWindowInternal::navigatorAttrGetter(v8::Local&lt;v8::String&gt;   name={...}  const v8::AccessorInfo &amp; info={...})  Line 326 + 0xf bytes	C++   	test_shell.exe!v8::internal::Object::GetPropertyWithCallback(v8::internal::Object *   receiver=0x054dc555  v8::internal::Object * structure=0x054df831  v8::internal::String *   name=0x05572881  v8::internal::Object * holder=0x054f79e5)  Line 206 + 0x21 bytes	C++   	test_shell.exe!v8::internal::Object::GetProperty(v8::internal::Object * receiver=0x054dc555    v8::internal::LookupResult * result=0x0012df9c  v8::internal::String * name=0x05572881    PropertyAttributes * attributes=0x0012dfb4)  Line 397 + 0x1d bytes	C++   	test_shell.exe!v8::internal::LoadIC::Load(v8::internal::InlineCacheState state=UNINITIALIZED    v8::internal::Handle&lt;v8::internal::Object&gt; object={...}  v8::internal::Handle&lt;v8::internal::String&gt;   name={...})  Line 536	C++   	test_shell.exe!v8::internal::LoadIC_Miss(v8::internal::Arguments args={...})  Line 1070 + 0x2e   bytes	C++   	05800170()	   	test_shell.exe!v8::internal::Invoke(bool construct=false    v8::internal::Handle&lt;v8::internal::JSFunction&gt; func={...}    v8::internal::Handle&lt;v8::internal::Object&gt; receiver={...}  int argc=0  v8::internal::Object * * *   args=0x00000000  bool * has_pending_exception=0x0012e15b)  Line 87 + 0x34 bytes	C++   	test_shell.exe!v8::internal::Execution::Call(v8::internal::Handle&lt;v8::internal::JSFunction&gt;   func={...}  v8::internal::Handle&lt;v8::internal::Object&gt; receiver={...}  int argc=0    v8::internal::Object * * * args=0x00000000  bool * pending_exception=0x0012e15b)  Line 117   + 0x1f bytes	C++   	test_shell.exe!v8::Script::Run()  Line 1069 + 0x19 bytes	C++   	test_shell.exe!WebCore::V8Proxy::RunScript(v8::Handle&lt;v8::Script&gt; script={...}  bool   inline_code=false)  Line 1029 + 0x13 bytes	C++   	test_shell.exe!WebCore::V8Proxy::Evaluate(const WebCore::String &amp; fileName={...}  int   baseLine=1  const WebCore::String &amp; str={...}  WebCore::Node * n=0x00000000)  Line 986	  C++   	test_shell.exe!WebCore::ScriptController::evaluate(const WebCore::String &amp; filename={...}  int   baseLine=1  const WebCore::String &amp; code={...}  WebCore::Node * node=0x00000000  bool *   succ=0x0012e3f3)  Line 261	C++   	test_shell.exe!WebCore::FrameLoader::executeScript(const WebCore::String &amp; url={...}  int   baseLine=1  const WebCore::String &amp; script={...}  bool * succ=0x0012e3f3)  Line 795	C++   	test_shell.exe!WebCore::FrameLoader::executeScript(const WebCore::String &amp; url={...}  int   baseLine=1  const WebCore::String &amp; script={...})  Line 770 + 0x1c bytes	C++   	test_shell.exe!WebCore::HTMLTokenizer::scriptExecution(const WebCore::String &amp; str={...}    WebCore::HTMLTokenizer::State state={...}  const WebCore::String &amp; scriptURL={...}  int   baseLine=1)  Line 559	C++   	test_shell.exe!WebCore::HTMLTokenizer::notifyFinished(WebCore::CachedResource *   __formal=0x039b61d8)  Line 2006 + 0x23 bytes	C++   	test_shell.exe!WebCore::CachedScript::addClient(WebCore::CachedResourceClient *   c=0x05200468)  Line 58 + 0x13 bytes	C++   	test_shell.exe!WebCore::HTMLTokenizer::scriptHandler(WebCore::HTMLTokenizer::State   state={...})  Line 486 + 0x34 bytes	C++   	test_shell.exe!WebCore::HTMLTokenizer::parseSpecial(WebCore::SegmentedString &amp; src={...}    WebCore::HTMLTokenizer::State state={...})  Line 344 + 0x10 bytes	C++   	test_shell.exe!WebCore::HTMLTokenizer::parseTag(WebCore::SegmentedString &amp; src={...}    WebCore::HTMLTokenizer::State state={...})  Line 1512 + 0x17 bytes	C++   	test_shell.exe!WebCore::HTMLTokenizer::write(const WebCore::SegmentedString &amp; str={...}    bool appendData=true)  Line 1747 + 0x1d bytes	C++   	test_shell.exe!WebCore::FrameLoader::write(const char * str=0x052dc008  int len=14145    bool flush=false)  Line 1052 + 0x21 bytes	C++   	test_shell.exe!WebCore::FrameLoader::addData(const char * bytes=0x052dc008  int   length=14145)  Line 1904	C++   	test_shell.exe!WebFrameImpl::DidReceiveData(WebCore::DocumentLoader *   loader=0x04663368  const char * data=0x052dc008  int length=14145)  Line 1500	C++   	test_shell.exe!WebFrameLoaderClient::committedLoad(WebCore::DocumentLoader *   loader=0x04663368  const char * data=0x052dc008  int length=14145)  Line 1030 + 0x24   bytes	C++   	test_shell.exe!WebCore::FrameLoader::committedLoad(WebCore::DocumentLoader *   loader=0x04663368  const char * data=0x052dc008  int length=14145)  Line 3450 + 0x24   bytes	C++   	test_shell.exe!WebCore::DocumentLoader::commitLoad(const char * data=0x052dc008  int   length=14145)  Line 356	C++   	test_shell.exe!WebCore::DocumentLoader::receivedData(const char * data=0x052dc008  int   length=14145)  Line 368	C++   	test_shell.exe!WebCore::FrameLoader::receivedData(const char * data=0x052dc008  int   length=14145)  Line 2376	C++   	test_shell.exe!WebCore::MainResourceLoader::addData(const char * data=0x052dc008  int   length=14145  bool allAtOnce=false)  Line 146	C++   	test_shell.exe!WebCore::ResourceLoader::didReceiveData(const char * data=0x052dc008  int   length=14145  __int64 lengthReceived=4905  bool allAtOnce=false)  Line 251 + 0x1b bytes	  C++   	test_shell.exe!WebCore::MainResourceLoader::didReceiveData(const char *   data=0x052dc008  int length=14145  __int64 lengthReceived=4905  bool allAtOnce=false)  Line   306	C++   	test_shell.exe!WebCore::ResourceLoader::didReceiveData(WebCore::ResourceHandle *   __formal=0x05249910  const char * data=0x052dc008  int length=14145  int   lengthReceived=4905)  Line 393 + 0x23 bytes	C++   	test_shell.exe!WebCore::ResourceHandleInternal::OnReceivedData(const char *   data=0x052dc008  int data_len=14145)  Line 559 + 0x28 bytes	C++   	test_shell.exe!`anonymous namespace'::RequestProxy::NotifyReceivedData(int   bytes_read=14145)  Line 169 + 0x2a bytes	C++   	test_shell.exe!DispatchToMethod&lt;`anonymous namespace'::RequestProxy void (__thiscall   A0x6819cda2::RequestProxy::*)(int) int&gt;(`anonymous-namespace'::RequestProxy *   obj=0x052e0028  void (int)* method=0x00403a58  const Tuple1&lt;int&gt; &amp; arg={...})  Line 283 +   0x11 bytes	C++   	test_shell.exe!RunnableMethod&lt;`anonymous namespace'::RequestProxy void (__thiscall   A0x6819cda2::RequestProxy::*)(int) Tuple1&lt;int&gt; &gt;::Run()  Line 312 + 0x1e bytes	C++   	test_shell.exe!MessageLoop::RunTask(Task * task=0x045447d0)  Line 282 + 0xf bytes	  C++   	test_shell.exe!MessageLoop::DeferOrRunPendingTask(const MessageLoop::PendingTask &amp;   pending_task={...})  Line 293	C++   	test_shell.exe!MessageLoop::DoWork()  Line 382 + 0xc bytes	C++   	test_shell.exe!base::MessagePumpWin::DoRunLoop()  Line 270 + 0x1d bytes	C++   	test_shell.exe!base::MessagePumpWin::RunWithDispatcher(base::MessagePump::Delegate *   delegate=0x0012fe04  base::MessagePumpWin::Dispatcher * dispatcher=0x00000000)  Line 124	  C++   	test_shell.exe!base::MessagePumpWin::Run(base::MessagePump::Delegate *   delegate=0x0012fe04)  Line 136 + 0x1c bytes	C++   	test_shell.exe!MessageLoop::RunInternal()  Line 171 + 0x2a bytes	C++   	test_shell.exe!MessageLoop::RunHandler()  Line 155	C++   	test_shell.exe!MessageLoop::Run()  Line 129	C++   	test_shell.exe!main(int argc=1  char * * argv=0x034b3780)  Line 331	C++   	test_shell.exe!__tmainCRTStartup()  Line 327 + 0x19 bytes	C   	test_shell.exe!mainCRTStartup()  Line 196	C   	kernel32.dll!7c816fd7() 	   	[Frames below may be incorrect and/or missing  no symbols loaded for kernel32.dll]	   	test_shell.exe!std::_Debug_range&lt;std::list&lt;int std::allocator&lt;int&gt; &gt;::_Iterator&lt;1&gt;   *&gt;(std::list&lt;int std::allocator&lt;int&gt; &gt;::_Iterator&lt;1&gt; * _First=...  std::list&lt;int std::allocator&lt;int&gt;   &gt;::_Iterator&lt;1&gt; * _Last=1634497390  const wchar_t * _File=0x00690057  unsigned int   _Line=6553710)  Line 1406 + 0x9 bytes	C++   	test_shell.exe!WebCore::DOMWindow::prompt(const WebCore::String &amp; message={...}  const   WebCore::String &amp; defaultValue={...})  Line 598 + 0x8 bytes	C++   	test_shell.exe!WebCore::Element::updateFocusAppearance(bool   restorePreviousSelection=true)  Line 1174 + 0x5a bytes	C++   	test_shell.exe!WebCore::DOMWindow::prompt(const WebCore::String &amp; message={...}  const   WebCore::String &amp; defaultValue={...})  Line 598 + 0x8 bytes	C++   	test_shell.exe!std::_Debug_range&lt;std::list&lt;int std::allocator&lt;int&gt; &gt;::_Iterator&lt;1&gt;   *&gt;(std::list&lt;int std::allocator&lt;int&gt; &gt;::_Iterator&lt;1&gt; * _First=...  std::list&lt;int std::allocator&lt;int&gt;   &gt;::_Iterator&lt;1&gt; * _Last=1634497390  const wchar_t * _File=0x00690057  unsigned int   _Line=6553710)  Line 1406 + 0x9 bytes	C++   	test_shell.exe!WebCore::DOMWindow::prompt(const WebCore::String &amp; message={...}  const   WebCore::String &amp; defaultValue={...})  Line 598 + 0x8 bytes	C++   	test_shell.exe!std::deque&lt;bool std::allocator&lt;bool&gt; &gt;::_Orphan_off(unsigned int   _Offlo=6684783)  Line 1275 + 0x7 bytes	C++   	test_shell.exe!WebCore::DOMWindow::prompt(const WebCore::String &amp; message={...}  const   WebCore::String &amp; defaultValue={...})  Line 598 + 0x8 bytes	C++   	test_shell.exe!std::deque&lt;bool std::allocator&lt;bool&gt; &gt;::_Orphan_off(unsigned int   _Offlo=112)  Line 1275 + 0x7 bytes	C++   	  test_shell.exe!WebCore::HTMLFormElement::parseMappedAttribute(WebCore::MappedAttribute *   attr=0xb60ffff2)  Line 559 + 0x1e bytes	C++   	b88ee8f4()	   </pre>
<title>Issue 4846 -   chromium -    Browser crasher when opening tab context menu before the tab is closed - Project Hosting on Google Code</title> <pre> 1. Open a page that blocks in the unload method  2. Close the tab  it will take a short time before the tab closes (giving a chance to the unload to finish)  3. Before the tab disappears right click on it  it opens the tab context menu.  4. Once the tab has dissapeared  select something in the menu  -&gt; Boom!      The TabContextMenuController should probably listen for tab closure related events and close if its tab is closed.    Here is the stack:    &gt;	chrome.dll!TabContextMenuController::SelectionChanged(views::MenuItemView * menu=0x0218ab50)  Line 84 + 0x21 bytes	  C++   	chrome.dll!views::MenuController::SetSelection(views::MenuItemView * menu_item=0x0218ab50  bool open_submenu=true  bool   update_immediately=false)  Line 1692 + 0x1e bytes	C++   	chrome.dll!views::MenuController::OnMouseMoved(views::SubmenuView * source=0x020d1958  const views::MouseEvent &amp;   event={...})  Line 1899	C++   	chrome.dll!views::`anonymous namespace'::MenuHostRootView::OnMouseMoved(const views::MouseEvent &amp; event={...})  Line 604	  C++   	chrome.dll!views::WidgetWin::ProcessMouseMoved(const WTL::CPoint &amp; point={...}  unsigned int flags=0x00000000  bool   is_nonclient=false)  Line 760 + 0x24 bytes	C++   	chrome.dll!views::WidgetWin::OnMouseMove(unsigned int flags=0x00000000  const WTL::CPoint &amp; point={...})  Line 530	  C++   	chrome.dll!views::WidgetWin::_ProcessWindowMessage(HWND__ * hWnd=0x007302fc  unsigned int uMsg=0x00000200  unsigned int   wParam=0x00000000  long lParam=0x00150019  long &amp; lResult=0x00000000  unsigned long dwMsgMapID=0x00000000)  Line 204 + 0x4f bytes	  C++   	chrome.dll!views::WidgetWin::ProcessWindowMessage(HWND__ * hWnd=0x007302fc  unsigned int uMsg=0x00000200  unsigned int   wParam=0x00000000  long lParam=0x00150019  long &amp; lResult=0x00000000  unsigned long dwMsgMapID=0x00000000)  Line 159 + 0x47 bytes	  C++   	chrome.dll!views::WidgetWin::WndProc(HWND__ * window=0x007302fc  unsigned int message=0x00000200  unsigned int   w_param=0x00000000  long l_param=0x00150019)  Line 913 + 0x1e bytes	C++   	user32.dll!75fd1a10() 	   	[Frames below may be incorrect and/or missing  no symbols loaded for user32.dll]	   	user32.dll!75fd1ae8() 	   	user32.dll!75fd1a91() 	   	user32.dll!75fd2d6e() 	   	user32.dll!75fd2d14() 	   	chrome.dll!views::FocusWindowCallback(HWND__ * window=0x007302fc  unsigned int message=0x00000200  unsigned int   wParam=0x00000000  long lParam=0x00150019)  Line 198 + 0x1c bytes	C++   	user32.dll!75fd1a10() 	   	user32.dll!75fd1ae8() 	   	user32.dll!75fd1a91() 	   	user32.dll!75fd2a47() 	   	user32.dll!75fd2a98() 	   	chrome.dll!views::MenuController::Dispatch(const tagMSG &amp; msg={...})  Line 2104 + 0xc bytes	C++   	chrome.dll!base::MessagePumpForUI::ProcessMessageHelper(const tagMSG &amp; msg={...})  Line 356 + 0x1f bytes	C++   	chrome.dll!base::MessagePumpForUI::ProcessNextWindowsMessage()  Line 335 + 0xc bytes	C++   	chrome.dll!base::MessagePumpForUI::DoRunLoop()  Line 204 + 0x8 bytes	C++   	chrome.dll!base::MessagePumpWin::RunWithDispatcher(base::MessagePump::Delegate * delegate=0x002cf5b0    base::MessagePumpWin::Dispatcher * dispatcher=0x040be178)  Line 52 + 0xf bytes	C++   	chrome.dll!MessageLoop::RunInternal()  Line 193	C++   	chrome.dll!MessageLoop::RunHandler()  Line 181	C++   	chrome.dll!MessageLoopForUI::Run(base::MessagePumpWin::Dispatcher * dispatcher=0x040be178)  Line 559	C++   	chrome.dll!views::MenuController::Run(HWND__ * parent=0x00d90232  views::MenuItemView * root=0x020d16d0  const gfx::Rect   &amp; bounds={...}  views::MenuItemView::AnchorPosition position=TOPLEFT  int * result_mouse_event_flags=0x002ce42c)  Line 1636	  C++   	chrome.dll!views::MenuItemView::RunMenuAt(HWND__ * parent=0x00d90232  const gfx::Rect &amp; bounds={...}    views::MenuItemView::AnchorPosition anchor=TOPLEFT  bool has_mnemonics=true)  Line 1135 + 0x1c bytes	C++   	chrome.dll!TabContextMenuController::RunMenuAt(int x=0x000003a9  int y=0x00000108)  Line 57 + 0x63 bytes	C++   	chrome.dll!Tab::ShowContextMenu(views::View * source=0x040d00c8  int x=0x000003a9  int y=0x00000108  bool   is_mouse_gesture=true)  Line 203	C++   	chrome.dll!views::View::ShowContextMenu(int x=0x000003a9  int y=0x00000108  bool is_mouse_gesture=true)  Line 457 + 0x2a   bytes	C++   	chrome.dll!views::View::ProcessMouseReleased(const views::MouseEvent &amp; e={...}  bool canceled=false)  Line 513 + 0x26   bytes	C++   	chrome.dll!views::RootView::OnMouseReleased(const views::MouseEvent &amp; e={...}  bool canceled=false)  Line 382	C++   	chrome.dll!views::WidgetWin::ProcessMouseReleased(const WTL::CPoint &amp; point={...}  unsigned int flags=0x00000002)  Line   733 + 0x26 bytes	C++   	chrome.dll!views::WidgetWin::OnRButtonUp(unsigned int flags=0x00000000  const WTL::CPoint &amp; point={...})  Line 630	  C++   	chrome.dll!views::WidgetWin::_ProcessWindowMessage(HWND__ * hWnd=0x00d90232  unsigned int uMsg=0x00000205  unsigned int   wParam=0x00000000  long lParam=0x00270150  long &amp; lResult=0x00000000  unsigned long dwMsgMapID=0x00000000)  Line 227 + 0x52 bytes	  C++   	chrome.dll!views::WidgetWin::ProcessWindowMessage(HWND__ * hWnd=0x00d90232  unsigned int uMsg=0x00000205  unsigned int   wParam=0x00000000  long lParam=0x00270150  long &amp; lResult=0x00000000  unsigned long dwMsgMapID=0x00000000)  Line 159 + 0x47 bytes	  C++   	chrome.dll!views::WidgetWin::WndProc(HWND__ * window=0x00d90232  unsigned int message=0x00000205  unsigned int   w_param=0x00000000  long l_param=0x00270150)  Line 913 + 0x1e bytes	C++   	user32.dll!75fd1a10() 	   	user32.dll!75fd1ae8() 	   	user32.dll!75fd1a91() 	   	user32.dll!75fd2d6e() 	   	user32.dll!75fd2d14() 	   	chrome.dll!views::FocusWindowCallback(HWND__ * window=0x00d90232  unsigned int message=0x00000205  unsigned int   wParam=0x00000000  long lParam=0x00270150)  Line 198 + 0x1c bytes	C++   	user32.dll!75fd1a10() 	   	user32.dll!75fd1ae8() 	   	user32.dll!75fd1a91() 	   	chrome.dll!std::_Iterator_base::~_Iterator_base()  Line 151 + 0x17 bytes	C++   	user32.dll!75fd2a47() 	   	user32.dll!75fd2a98() 	   	chrome.dll!views::AcceleratorHandler::Dispatch(const tagMSG &amp; msg={...})  Line 29 + 0xc bytes	C++   	chrome.dll!base::MessagePumpForUI::ProcessMessageHelper(const tagMSG &amp; msg={...})  Line 356 + 0x1f bytes	C++   	chrome.dll!base::MessagePumpForUI::ProcessNextWindowsMessage()  Line 335 + 0xc bytes	C++   	chrome.dll!base::MessagePumpForUI::DoRunLoop()  Line 204 + 0x8 bytes	C++   	chrome.dll!base::MessagePumpWin::RunWithDispatcher(base::MessagePump::Delegate * delegate=0x002cf5b0    base::MessagePumpWin::Dispatcher * dispatcher=0x03f4c688)  Line 52 + 0xf bytes	C++   	chrome.dll!MessageLoop::RunInternal()  Line 193	C++   	chrome.dll!MessageLoop::RunHandler()  Line 181	C++   	chrome.dll!MessageLoopForUI::Run(base::MessagePumpWin::Dispatcher * dispatcher=0x03f4c688)  Line 559	C++   	chrome.dll!BrowserMain(CommandLine &amp; parsed_command_line={...}  sandbox::BrokerServices * broker_services=0x009f4f00)    Line 587	C++   	chrome.dll!ChromeMain(HINSTANCE__ * instance=0x00a00000  sandbox::SandboxInterfaceInfo * sandbox_info=0x002cfd98  wchar_t   * command_line=0x003728ba)  Line 224 + 0x10 bytes	C++   	chrome.exe!wWinMain(HINSTANCE__ * instance=0x00a00000  HINSTANCE__ * prev_instance=0x00000000  wchar_t *   command_line=0x003728ba  int __formal=0x00000001)  Line 93 + 0x14 bytes	C++   	chrome.exe!__tmainCRTStartup()  Line 324 + 0x35 bytes	C   	chrome.exe!wWinMainCRTStartup()  Line 196	C   	kernel32.dll!77323833() 	   	ntdll.dll!7757a9bd() 	     </pre>
<title>Issue 22031 -   chromium -    UMR and write in SessionBack::AppendCommandsToFile - Project Hosting on Google Code</title> <pre> RestoreToDifferentWindow is disabled as of 2009/09/16  so you must enable the test before reproducing with:    tools/valgrind/chrome_tests.sh --test ui --tool memcheck --gtest_filter=TabRestoreUITest.RestoreToDifferentWindow    Syscall param write(buf) points to uninitialised byte(s)    0x916254B (/lib/libpthread-2.7.so)    net::(anonymous namespace)::WriteFile(int  char const*  int) (//////////////////usr/local/google/work/google3/src/net/base/file_stream_posix.cc:66)    net::FileStream::Write(char const*  int  CallbackRunner&lt;Tuple1&lt;int&gt; &gt;*) (//////////////////usr/local/google/work/google3/src/net/base/file_stream_posix.cc:438)    SessionBackend::AppendCommandsToFile(net::FileStream*  std::vector&lt;SessionCommand*  std::allocator&lt;SessionCommand*&gt; &gt; const&amp;)   (//////////////////usr/local/google/work/google3/src/chrome/browser/sessions/session_backend.cc:310)    SessionBackend::AppendCommands(std::vector&lt;SessionCommand*  std::allocator&lt;SessionCommand*&gt; &gt;*  bool) (//////////////////usr/local/google/work/google3/src/chrome/browser/sessions/session_backend.cc:222)    void DispatchToMethod&lt;SessionBackend  void (SessionBackend::*)(std::vector&lt;SessionCommand*  std::allocator&lt;SessionCommand*&gt; &gt;*  bool)  std::vector&lt;SessionCommand*  std::allocator&lt;SessionCommand*&gt; &gt;*    bool&gt;(SessionBackend*  void (SessionBackend::*)(std::vector&lt;SessionCommand*  std::allocator&lt;SessionCommand*&gt; &gt;*  bool)  Tuple2&lt;std::vector&lt;SessionCommand*  std::allocator&lt;SessionCommand*&gt; &gt;*  bool&gt; const&amp;)   (//////////////////usr/local/google/work/google3/src/./base/tuple.h:429)    RunnableMethod&lt;SessionBackend  void (SessionBackend::*)(std::vector&lt;SessionCommand*  std::allocator&lt;SessionCommand*&gt; &gt;*  bool)  Tuple2&lt;std::vector&lt;SessionCommand*  std::allocator&lt;SessionCommand*&gt; &gt;*  bool&gt; &gt;::Run()   (//////////////////usr/local/google/work/google3/src/./base/task.h:307)    MessageLoop::RunTask(Task*) (//////////////////usr/local/google/work/google3/src/base/message_loop.cc:314)    MessageLoop::DeferOrRunPendingTask(MessageLoop::PendingTask const&amp;) (//////////////////usr/local/google/work/google3/src/base/message_loop.cc:322)    MessageLoop::DoWork() (//////////////////usr/local/google/work/google3/src/base/message_loop.cc:429)    base::MessagePumpLibevent::Run(base::MessagePump::Delegate*) (//////////////////usr/local/google/work/google3/src/base/message_pump_libevent.cc:224)    MessageLoop::RunInternal() (//////////////////usr/local/google/work/google3/src/base/message_loop.cc:199)    MessageLoop::RunHandler() (//////////////////usr/local/google/work/google3/src/base/message_loop.cc:181)    MessageLoop::Run() (//////////////////usr/local/google/work/google3/src/base/message_loop.cc:155)    base::Thread::Run(MessageLoop*) (//////////////////usr/local/google/work/google3/src/base/thread.cc:132)    base::Thread::ThreadMain() (//////////////////usr/local/google/work/google3/src/base/thread.cc:153)    ThreadFunc(void*) (//////////////////usr/local/google/work/google3/src/base/platform_thread_posix.cc:26)    start_thread (/lib/libpthread-2.7.so)  Suppression:    fun:*    fun:_ZN3net58_GLOBAL__N_net_base_file_stream_posix.cc_00000000_7A1642BC9WriteFileEiPKci    fun:_ZN3net10FileStream5WriteEPKciP14CallbackRunnerI6Tuple1IiEE    fun:_ZN14SessionBackend20AppendCommandsToFileEPN3net10FileStreamERKSt6vectorIP14SessionCommandSaIS5_EE    fun:_ZN14SessionBackend14AppendCommandsEPSt6vectorIP14SessionCommandSaIS2_EEb    fun:_Z16DispatchToMethodI14SessionBackendMS0_FvPSt6vectorIP14SessionCommandSaIS3_EEbES6_bEvPT_T0_RK6Tuple2IT1_T2_E    fun:_ZN14RunnableMethodI14SessionBackendMS0_FvPSt6vectorIP14SessionCommandSaIS3_EEbE6Tuple2IS6_bEE3RunEv    fun:_ZN11MessageLoop7RunTaskEP4Task    fun:_ZN11MessageLoop21DeferOrRunPendingTaskERKNS_11PendingTaskE    fun:_ZN11MessageLoop6DoWorkEv    fun:_ZN4base19MessagePumpLibevent3RunEPNS_11MessagePump8DelegateE    fun:_ZN11MessageLoop11RunInternalEv    fun:_ZN11MessageLoop10RunHandlerEv    fun:_ZN11MessageLoop3RunEv    fun:_ZN4base6Thread3RunEP11MessageLoop    fun:_ZN4base6Thread10ThreadMainEv    fun:_Z10ThreadFuncPv    fun:start_thread  Address 0xf82f244 is 36 bytes inside a block of size 49 alloc'd    operator new(unsigned long) (ome/jhawkins/google3/src/valgrind-10771/coregrind/m_replacemalloc/vg_replace_malloc.c:220)    std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt;::_Rep::_S_create(unsigned long  unsigned long  std::allocator&lt;char&gt; const&amp;) (/usr/lib/libstdc++.so.6.0.9)    std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt;::_S_construct(unsigned long  char  std::allocator&lt;char&gt; const&amp;) (/usr/lib/libstdc++.so.6.0.9)    std::basic_string&lt;char  std::char_traits&lt;char&gt;  std::allocator&lt;char&gt; &gt;::basic_string(unsigned long  char  std::allocator&lt;char&gt; const&amp;) (/usr/lib/libstdc++.so.6.0.9)    SessionCommand::SessionCommand(unsigned char  unsigned short) (//////////////////usr/local/google/work/google3/src/chrome/browser/sessions/session_command.cc:13)    TabRestoreService::CreateWindowCommand(int  int  int  base::Time) (//////////////////usr/local/google/work/google3/src/chrome/browser/sessions/tab_restore_service.cc:514)    TabRestoreService::ScheduleCommandsForWindow(TabRestoreService::Window const&amp;) (//////////////////usr/local/google/work/google3/src/chrome/browser/sessions/tab_restore_service.cc:445)    TabRestoreService::Save() (//////////////////usr/local/google/work/google3/src/chrome/browser/sessions/tab_restore_service.cc:354)    void DispatchToMethod&lt;BaseSessionService  void (BaseSessionService::*)()&gt;(BaseSessionService*  void (BaseSessionService::*)()  Tuple0 const&amp;) (//////////////////usr/local/google/work/google3/src/./base/tuple.h:412)    ScopedRunnableMethodFactory&lt;BaseSessionService&gt;::RunnableMethod&lt;void (BaseSessionService::*)()  Tuple0&gt;::Run() (//////////////////usr/local/google/work/google3/src/./base/task.h:197)    ScopedTaskFactory&lt;ScopedRunnableMethodFactory&lt;BaseSessionService&gt;::RunnableMethod&lt;void (BaseSessionService::*)()  Tuple0&gt; &gt;::TaskWrapper::Run() (//////////////////usr/local/google/work/google3/src/./base/task.h:92)    MessageLoop::RunTask(Task*) (//////////////////usr/local/google/work/google3/src/base/message_loop.cc:314)    MessageLoop::DeferOrRunPendingTask(MessageLoop::PendingTask const&amp;) (//////////////////usr/local/google/work/google3/src/base/message_loop.cc:322)    MessageLoop::DoDelayedWork(base::Time*) (//////////////////usr/local/google/work/google3/src/base/message_loop.cc:456)    base::MessagePumpForUI::HandleDispatch() (//////////////////usr/local/google/work/google3/src/base/message_pump_glib.cc:268)    (anonymous namespace)::WorkSourceDispatch(_GSource*  int (*)(void*)  void*) (//////////////////usr/local/google/work/google3/src/base/message_pump_glib.cc:107)    g_main_context_dispatch (mp/glib2.0.F15431/glib2.0-2.16.6/glib/gmain.c:2012)    g_main_context_iterate (mp/glib2.0.F15431/glib2.0-2.16.6/glib/gmain.c:2645)    g_main_context_iteration (mp/glib2.0.F15431/glib2.0-2.16.6/glib/gmain.c:2708)    base::MessagePumpForUI::RunWithDispatcher(base::MessagePump::Delegate*  base::MessagePumpForUI::Dispatcher*) (//////////////////usr/local/google/work/google3/src/base/message_pump_glib.cc:192)    base::MessagePumpForUI::Run(base::MessagePump::Delegate*) (//////////////////usr/local/google/work/google3/src/./base/message_pump_glib.h:56)    MessageLoop::RunInternal() (//////////////////usr/local/google/work/google3/src/base/message_loop.cc:199)    MessageLoop::RunHandler() (//////////////////usr/local/google/work/google3/src/base/message_loop.cc:181)    MessageLoopForUI::Run(base::MessagePumpForUI::Dispatcher*) (//////////////////usr/local/google/work/google3/src/base/message_loop.cc:599)    (anonymous namespace)::RunUIMessageLoop(BrowserProcess*) (//////////////////usr/local/google/work/google3/src/chrome/browser/browser_main.cc:188)    BrowserMain(MainFunctionParams const&amp;) (//////////////////usr/local/google/work/google3/src/chrome/browser/browser_main.cc:833)    ChromeMain (//////////////////usr/local/google/work/google3/src/chrome/app/chrome_dll_main.cc:607)    main (//////////////////usr/local/google/work/google3/src/chrome/app/chrome_exe_main_gtk.cc:33)  Suppression:    fun:_Znwm    fun:_ZNSs4_Rep9_S_createEmmRKSaIcE    fun:_ZNSs12_S_constructEmcRKSaIcE    fun:_ZNSsC1EmcRKSaIcE    fun:_ZN14SessionCommandC1Eht    fun:_ZN17TabRestoreService19CreateWindowCommandEiiiN4base4TimeE    fun:_ZN17TabRestoreService25ScheduleCommandsForWindowERKNS_6WindowE    fun:_ZN17TabRestoreService4SaveEv    fun:_Z16DispatchToMethodI18BaseSessionServiceMS0_FvvEEvPT_T0_RK6Tuple0    fun:_ZN27ScopedRunnableMethodFactoryI18BaseSessionServiceE14RunnableMethodIMS0_FvvE6Tuple0E3RunEv    fun:_ZN17ScopedTaskFactoryIN27ScopedRunnableMethodFactoryI18BaseSessionServiceE14RunnableMethodIMS1_FvvE6Tuple0EEE11TaskWrapper3RunEv    fun:_ZN11MessageLoop7RunTaskEP4Task    fun:_ZN11MessageLoop21DeferOrRunPendingTaskERKNS_11PendingTaskE    fun:_ZN11MessageLoop13DoDelayedWorkEPN4base4TimeE    fun:_ZN4base16MessagePumpForUI14HandleDispatchEv    fun:_ZN54_GLOBAL__N_base_message_pump_glib.cc_00000000_A17F7F2918WorkSourceDispatchEP8_GSourcePFiPvES2_    fun:g_main_context_dispatch    fun:g_main_context_iterate    fun:g_main_context_iteration    fun:_ZN4base16MessagePumpForUI17RunWithDispatcherEPNS_11MessagePump8DelegateEPNS0_10DispatcherE    fun:_ZN4base16MessagePumpForUI3RunEPNS_11MessagePump8DelegateE    fun:_ZN11MessageLoop11RunInternalEv    fun:_ZN11MessageLoop10RunHandlerEv    fun:_ZN16MessageLoopForUI3RunEPN4base16MessagePumpForUI10DispatcherE    fun:_ZN59_GLOBAL__N_chrome_browser_browser_main.cc_00000000_C8A79B1716RunUIMessageLoopEP14BrowserProcess    fun:_Z11BrowserMainRK18MainFunctionParams    fun:ChromeMain    fun:main </pre>
<title>Issue 6791 -   chromium -    Make svn rsync to backup server more robust - Project Hosting on Google Code</title> <pre> When a change gets committed  svn does a few things:   1. Collects up all the pieces of the change (new files  diffs  etc.) in a temp directory as   they come in   2. When it knows it has them all successfully  builds a single &quot;revision file&quot; holding all the   information for that <a href="/p/chromium/source/detail?r=3">revision   3</a>. Locks the repository and puts the revision file into it   4. Updates the file &quot;db/current&quot; with the new revision number   5. Unlocks the repository    If rsync happens to build its list of files before step 3  but doesn't actually copy the files   until after step 4  then it will miss copying the real &quot;revision file&quot; that got built in the   meantime  but still have a &quot;current&quot; file that expects that revision to exist.    The solution is to back up db/current before starting the main rsync  and use that backup after   the main rsync is done.  That way  as far as the copy is concerned  the new revision doesn't   exist yet.  Then  whether the real revision file gets copied or not doesn't matter -- it'll just   be pulled in on the next rsync if need be.    Patrick fixed up a script to do this  but it's never been put in place.  See   chromium_admin/server_setup/files/home/svn/push-svn-backup in Perforce. </pre>
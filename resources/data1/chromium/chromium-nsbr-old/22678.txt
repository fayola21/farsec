<title>Issue 22678 -   chromium -    Flakiness in NetUtilTest.GetSpecificHeader - Project Hosting on Google Code</title> <pre> <a href="http://build.chromium.org/buildbot/try-">http://build.chromium.org/buildbot/try-</a>  server/builders/win/builds/19429/steps/net_unittests/logs/stdio    Looks like thread destruction race condition.    [----------] 21 tests from NetUtilTest  [ RUN      ] NetUtilTest.FileURLConversion  [       OK ] NetUtilTest.FileURLConversion (0 ms)  [ RUN      ] NetUtilTest.GetIdentityFromURL  [       OK ] NetUtilTest.GetIdentityFromURL (0 ms)  [ RUN      ] NetUtilTest.GetIdentityFromURL_UTF8  [       OK ] NetUtilTest.GetIdentityFromURL_UTF8 (0 ms)  [ RUN      ] NetUtilTest.GetSpecificHeader  c:bslavewinbuildsrcbase/test_suite.h(108): error: Failed  [31448:30144:0922/125345:343623734:FATAL:thread.cc(122)] Check failed: thread_id_ !=   PlatformThread::CurrentId() (30144 vs. 30144)  Backtrace:  	StackTrace::StackTrace [0x00899BD1+33]   (c:bslavewinbuildsrcbasedebug_util_win.cc:226)  	logging::LogMessage::~LogMessage [0x00871F0A+618]   (c:bslavewinbuildsrcbaselogging.cc:540)  	base::Thread::StopSoon [0x00877AE1+129] (c:bslavewinbuildsrcbasethread.cc:124)  	base::Thread::Stop [0x00877997+71] (c:bslavewinbuildsrcbasethread.cc:109)  	base::Thread::~Thread [0x0087759F+31] (c:bslavewinbuildsrcbasethread.cc:48)  	base::Thread::`scalar deleting destructor' [0x00877556+22]  	scoped_ptr&lt;base::Thread&gt;::~scoped_ptr&lt;base::Thread&gt; [0x00568A5F+63]   (c:bslavewinbuildsrcbasescoped_ptr.h:72)  	ListenSocketTester::~ListenSocketTester [0x005BBD91+65]   (c:bslavewinbuildsrcnetbaselisten_socket_unittest.h:81)  	TelnetServerTester::~TelnetServerTester [0x005BC106+22]  	TelnetServerTester::`scalar deleting destructor' [0x005BC0B6+22]  	base::RefCountedThreadSafe&lt;ListenSocketTester&gt;::Release [0x005BC497+103]   (c:bslavewinbuildsrcbaseref_counted.h:107)  	RunnableMethodTraits&lt;ListenSocketTester&gt;::ReleaseCallee [0x00620A2E+14]   (c:bslavewinbuildsrcbasetask.h:264)  	RunnableMethod&lt;ListenSocketTester void (__thiscall   ListenSocketTester::*)(void) Tuple0&gt;::ReleaseCallee [0x006209D3+35]   (c:bslavewinbuildsrcbasetask.h:317)  	RunnableMethod&lt;ListenSocketTester void (__thiscall   ListenSocketTester::*)(void) Tuple0&gt;::~RunnableMethod&lt;ListenSocketTester void (__thiscall   ListenSocketTester::*)(void) Tuple0&gt; [0x0062097F+31] (c:bslavewinbuildsrcbasetask.h:303)  	RunnableMethod&lt;ListenSocketTester void (__thiscall   ListenSocketTester::*)(void) Tuple0&gt;::`scalar deleting destructor' [0x00620926+22]  	MessageLoop::RunTask [0x00866274+244]   (c:bslavewinbuildsrcbasemessage_loop.cc:315)  	MessageLoop::DeferOrRunPendingTask [0x008662E5+53]   (c:bslavewinbuildsrcbasemessage_loop.cc:325)  	MessageLoop::DoWork [0x00866839+233]   (c:bslavewinbuildsrcbasemessage_loop.cc:429)  	base::MessagePumpForIO::DoRunLoop [0x008C65A2+50]   (c:bslavewinbuildsrcbasemessage_pump_win.cc:446)  	base::MessagePumpWin::RunWithDispatcher [0x008C50C2+130]   (c:bslavewinbuildsrcbasemessage_pump_win.cc:52)  	base::MessagePumpWin::Run [0x008C531C+28]   (c:bslavewinbuildsrcbasemessage_pump_win.h:78)  	MessageLoop::RunInternal [0x00865B5B+267]   (c:bslavewinbuildsrcbasemessage_loop.cc:199)  	MessageLoop::RunHandler [0x008659B0+144]   (c:bslavewinbuildsrcbasemessage_loop.cc:182)  	MessageLoop::Run [0x0086583A+58] (c:bslavewinbuildsrcbasemessage_loop.cc:156)  	base::Thread::Run [0x00877C96+22] (c:bslavewinbuildsrcbasethread.cc:133)  	base::Thread::ThreadMain [0x00877D73+195] (c:bslavewinbuildsrcbasethread.cc:153)  	`anonymous namespace'::ThreadFunc [0x00876F11+33]   (c:bslavewinbuildsrcbaseplatform_thread_win.cc:26)  	GetModuleFileNameA [0x7C80B729+442]    Google Test trace:  c:bslavewinbuildsrcnetbasenet_util_unittest.cc:571: Test[0]:   http://username:password@google.com  [       OK ] NetUtilTest.GetSpecificHeader (0 ms)  [ RUN      ] NetUtilTest.GetHeaderParamValue  [       OK ] NetUtilTest.GetHeaderParamValue (0 ms)  (...)  [----------] 21 tests from NetUtilTest (422 ms total)   </pre>
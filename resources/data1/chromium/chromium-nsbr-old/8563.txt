<title>Issue 8563 -   chromium -    raw entities (eg &amp;rarr;) in JS stripped by parser before being handed to JS - Project Hosting on Google Code</title> <pre> There are several layout tests that fail because there is some JavaScript  that uses raw entities (eg  &quot;&amp;rarr;&quot;). JS sees these as the empty string.    The tests are:    MAC : LayoutTests/fast/parser/entities-in-attributes.xhtml = FAIL  MAC : LayoutTests/fast/parser/entities-in-xhtml.xhtml = FAIL  MAC : LayoutTests/fast/parser/entity-ignorable-whitespace.xhtml = FAIL    If you put a breakpoint in V8Proxy::Evaluate (v8_proxy.cpp)  you'll see  that the entity string has already been removed from |str|. This means the  libxml parser has done something untoward with it before it ever gets to V8.     If you break in getXHTMLEntity (XMLTokenizerLibxml2.cpp)  we do get called  back from the xml parser to get the entity. We properly return the correct  value (so it's found and recognized)  but then it gets dropped somewhere  inside the parser code.    Built-in entities (eg  &amp;gt;) work fine. I haven't been able to determine  why they are different as they go through almost exactly the same path in  the code and the xmlEntityPtr is almost exactly the same. Mucking with  memory to change one to the other from the debugger only yields parse errors.    TVL suggested it might be because we don't have the correct DTD so it's  getting dropped when the parser can't resolve the id. That's a possibility.    For now  I'm stumped. Filing to keep track of the research I've done. </pre>
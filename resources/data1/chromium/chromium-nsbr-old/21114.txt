<title>Issue 21114 -   chromium -    [Snow Leopard] Crash WebCore::BitmapImage::draw(WebCore::GraphicsContext*  WebCore::FloatRect const&amp;  WebCore::FloatRect const&amp;  WebCore::CompositeOperator) - Project Hosting on Google Code</title> <pre> Platform:    Hostname: kris-rambishs-mac-pro.local    Mac OS X Version 10.6 (Build 10A432)    Processor: 4 Intel 2.66 GHz    RAM: 2048 MB    Chrome:    Chrome version: 4.0.206.1  Release    QuickTime Player: 7.6    QuickTime PlayerX: 51    Flash Player: 10.0.23    To reproduce:    Open attached html file in Chrome    Expected behavior:    Chrome opens the page    Actual behavior:    Chrome crashes    Notes:    This only happens on Snow Leopard only.  Attached are the crash report   and the test html file.  Below is the stack trace of the crashing thread.    Thread 0 (crashed)   0 CoreFoundation      0.550.0.0            0x91329ca4 CFRetain + 0xd4   1 CoreFoundation      0.550.0.0            0x91334491   __CFBasicHashAddValue + 0x31   2 CoreFoundation      0.550.0.0            0x91334316 CFBasicHashAddValue   + 0xa6   3 CoreFoundation      0.550.0.0            0x9135ea9b CFDictionaryCreate +   0x6b   4 libCSync.A.dylib    0.535.5.0            0x963d5be5 CreateProfileSet + 0x8c   5 libCSync.A.dylib    0.535.5.0            0x963d58b7 deviceSet + 0x7e   6 libCSync.A.dylib    0.535.5.0            0x963d4e8d create + 0x2dd   7 libCSync.A.dylib    0.535.5.0            0x963d4a01 CMSCreateDataProvider   + 0x74   8 CoreGraphics        0.535.5.0            0x932e5277   create_generic_color_space + 0x4f   9 CoreGraphics        0.535.5.0            0x932e5035   CGColorSpaceCreateWithIndex + 0x129  10 CoreGraphics        0.535.5.0            0x93457514   CGColorSpaceCreateSystemDefaultCMYK + 0x11  11 CoreGraphics        0.535.5.0            0x932f0a94 resolveSource + 0x575  12 CoreGraphics        0.535.5.0            0x93320b06   CGColorTransformConvertNeedsCMS + 0x68  13 CoreGraphics        0.535.5.0            0x9331e194 img_data_lock + 0x65c  14 CoreGraphics        0.535.5.0            0x9331cee5 CGSImageDataLock +   0xab  15 libRIP.A.dylib      0.535.5.0            0x9646c747 ripc_AcquireImage +   0x98d  16 libRIP.A.dylib      0.535.5.0            0x9646a3bd ripc_DrawImage + 0x4dc  17 CoreGraphics        0.535.5.0            0x9331cb5f CGContextDrawImage +   0x1c1  18 Google Chrome Framew0.0.0.0              0x00e13bba   WebCore::BitmapImage::draw(WebCore::GraphicsContext*    WebCore::FloatRect const&amp;  WebCore::FloatRect const&amp;    WebCore::CompositeOperator) + 0x48 (ImageCG.cpp:208)  19 Google Chrome Framew0.0.0.0              0x00e34fd4   WebCore::GraphicsContext::drawImage(WebCore::Image*    WebCore::FloatRect const&amp;  WebCore::FloatRect const&amp;    WebCore::CompositeOperator  bool) + 0x20 (GraphicsContext.cpp:454)  20 Google Chrome Framew0.0.0.0              0x00e354c7   WebCore::GraphicsContext::drawImage(WebCore::Image*  WebCore::IntRect   const&amp;  WebCore::CompositeOperator  bool) + 0x4c   (GraphicsContext.cpp:324)  21 Google Chrome Framew0.0.0.0              0x00ee0863   WebCore::RenderImage::paintReplaced(WebCore::RenderObject::PaintInfo&amp;    int  int) + 0x46 (RenderImage.cpp:427)  22 Google Chrome Framew0.0.0.0              0x00f164f0   WebCore::RenderReplaced::paint(WebCore::RenderObject::PaintInfo&amp;  int    int) + 0x1f (RenderReplaced.cpp:145)  23 Google Chrome Framew0.0.0.0              0x00e88e51   WebCore::InlineBox::paint(WebCore::RenderObject::PaintInfo&amp;  int  int) +   0x1f (InlineBox.cpp:180)  24 Google Chrome Framew0.0.0.0              0x00e8cb3e   WebCore::InlineFlowBox::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)   + 0x19 (InlineFlowBox.cpp:681)  25 Google Chrome Framew0.0.0.0              0x00e8cb3e   WebCore::InlineFlowBox::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)   + 0x19 (InlineFlowBox.cpp:681)  26 Google Chrome Framew0.0.0.0              0x00f5308d   WebCore::RootInlineBox::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)   + 0x13 (RootInlineBox.cpp:165)  27 Google Chrome Framew0.0.0.0              0x00ef628f   WebCore::RenderLineBoxList::paint(WebCore::RenderBoxModelObject*    WebCore::RenderObject::PaintInfo&amp;  int  int) const + 0x1f   (RenderLineBoxList.cpp:203)  28 Google Chrome Framew0.0.0.0              0x00ea88c3   WebCore::RenderBlock::paintObject(WebCore::RenderObject::PaintInfo&amp;    int  int) + 0x23 (RenderBlock.cpp:1610)  29 Google Chrome Framew0.0.0.0              0x00e9d494   WebCore::RenderBlock::paint(WebCore::RenderObject::PaintInfo&amp;  int  int) +   0x25 (RenderBlock.cpp:1503)  30 Google Chrome Framew0.0.0.0              0x00e991bf   WebCore::RenderBlock::paintFloats(WebCore::RenderObject::PaintInfo&amp;  int    int  bool) + 0x21 (RenderBlock.cpp:1763)  31 Google Chrome Framew0.0.0.0              0x00ea8abb   WebCore::RenderBlock::paintObject(WebCore::RenderObject::PaintInfo&amp;    int  int) + 0x2b (RenderBlock.cpp:1713)  32 Google Chrome Framew0.0.0.0              0x00e9d494   WebCore::RenderBlock::paint(WebCore::RenderObject::PaintInfo&amp;  int  int) +   0x25 (RenderBlock.cpp:1503)  33 Google Chrome Framew0.0.0.0              0x00e9f2e1   WebCore::RenderBlock::paintChildren(WebCore::RenderObject::PaintInfo&amp;    int  int) + 0x1f (RenderBlock.cpp:1636)  34 Google Chrome Framew0.0.0.0              0x00ea8b9c   WebCore::RenderBlock::paintObject(WebCore::RenderObject::PaintInfo&amp;    int  int) + 0x1c (RenderBlock.cpp:1612)  35 Google Chrome Framew0.0.0.0              0x00e9d494   WebCore::RenderBlock::paint(WebCore::RenderObject::PaintInfo&amp;  int  int) +   0x25 (RenderBlock.cpp:1503)  36 Google Chrome Framew0.0.0.0              0x00e9f2e1   WebCore::RenderBlock::paintChildren(WebCore::RenderObject::PaintInfo&amp;    int  int) + 0x1f (RenderBlock.cpp:1636)  37 Google Chrome Framew0.0.0.0              0x00ea8b9c   WebCore::RenderBlock::paintObject(WebCore::RenderObject::PaintInfo&amp;    int  int) + 0x1c (RenderBlock.cpp:1612)  38 Google Chrome Framew0.0.0.0              0x00e9d494   WebCore::RenderBlock::paint(WebCore::RenderObject::PaintInfo&amp;  int  int) +   0x25 (RenderBlock.cpp:1503)  39 Google Chrome Framew0.0.0.0              0x00e9f2e1   WebCore::RenderBlock::paintChildren(WebCore::RenderObject::PaintInfo&amp;    int  int) + 0x1f (RenderBlock.cpp:1636)  40 Google Chrome Framew0.0.0.0              0x00ea8b9c   WebCore::RenderBlock::paintObject(WebCore::RenderObject::PaintInfo&amp;    int  int) + 0x1c (RenderBlock.cpp:1612)  41 Google Chrome Framew0.0.0.0              0x00e9d494   WebCore::RenderBlock::paint(WebCore::RenderObject::PaintInfo&amp;  int  int) +   0x25 (RenderBlock.cpp:1503)  42 Google Chrome Framew0.0.0.0              0x00e9f2e1   WebCore::RenderBlock::paintChildren(WebCore::RenderObject::PaintInfo&amp;    int  int) + 0x1f (RenderBlock.cpp:1636)  43 Google Chrome Framew0.0.0.0              0x00ea8b9c   WebCore::RenderBlock::paintObject(WebCore::RenderObject::PaintInfo&amp;    int  int) + 0x1c (RenderBlock.cpp:1612)  44 Google Chrome Framew0.0.0.0              0x00e9d494   WebCore::RenderBlock::paint(WebCore::RenderObject::PaintInfo&amp;  int  int) +   0x25 (RenderBlock.cpp:1503)  45 Google Chrome Framew0.0.0.0              0x00f2d20f   WebCore::RenderTableSection::paintObject(WebCore::RenderObject::PaintIn  fo&amp;  int  int) + 0x1f (RenderTableSection.cpp:1058)  46 Google Chrome Framew0.0.0.0              0x00f2cf78   WebCore::RenderTableSection::paint(WebCore::RenderObject::PaintInfo&amp;    int  int) + 0x1f (RenderTableSection.cpp:955)  47 Google Chrome Framew0.0.0.0              0x00f24315   WebCore::RenderTable::paintObject(WebCore::RenderObject::PaintInfo&amp;    int  int) + 0x22 (RenderTable.cpp:461)  48 Google Chrome Framew0.0.0.0              0x00f2329b   WebCore::RenderTable::paint(WebCore::RenderObject::PaintInfo&amp;  int  int) +   0x22 (RenderTable.cpp:431)  49 Google Chrome Framew0.0.0.0              0x00e9f2e1   WebCore::RenderBlock::paintChildren(WebCore::RenderObject::PaintInfo&amp;    int  int) + 0x1f (RenderBlock.cpp:1636)  50 Google Chrome Framew0.0.0.0              0x00ea8b9c   WebCore::RenderBlock::paintObject(WebCore::RenderObject::PaintInfo&amp;    int  int) + 0x1c (RenderBlock.cpp:1612)  51 Google Chrome Framew0.0.0.0              0x00e9d494   WebCore::RenderBlock::paint(WebCore::RenderObject::PaintInfo&amp;  int  int) +   0x25 (RenderBlock.cpp:1503)  52 Google Chrome Framew0.0.0.0              0x00ef30a3   WebCore::RenderLayer::paintLayer(WebCore::RenderLayer*    WebCore::GraphicsContext*  WebCore::IntRect const&amp;    WebCore::PaintRestriction  WebCore::RenderObject*    WTF::HashMap&lt;WebCore::OverlapTestRequestClient*  WebCore::IntRect    WTF::PtrHash&lt;WebCore::OverlapTestRequestClient*&gt;    WTF::HashTraits&lt;WebCore::OverlapTestRequestClient*&gt;    WTF::HashTraits&lt;WebCore::IntRect&gt; &gt;*  unsigned int) + 0x22   (RenderLayer.cpp:2235)  53 Google Chrome Framew0.0.0.0              0x00ef2420   WebCore::RenderLayer::paintLayer(WebCore::RenderLayer*    WebCore::GraphicsContext*  WebCore::IntRect const&amp;    WebCore::PaintRestriction  WebCore::RenderObject*    WTF::HashMap&lt;WebCore::OverlapTestRequestClient*  WebCore::IntRect    WTF::PtrHash&lt;WebCore::OverlapTestRequestClient*&gt;    WTF::HashTraits&lt;WebCore::OverlapTestRequestClient*&gt;    WTF::HashTraits&lt;WebCore::IntRect&gt; &gt;*  unsigned int) + 0x3d   (RenderLayer.cpp:2263)  54 Google Chrome Framew0.0.0.0              0x00ef2420   WebCore::RenderLayer::paintLayer(WebCore::RenderLayer*    WebCore::GraphicsContext*  WebCore::IntRect const&amp;    WebCore::PaintRestriction  WebCore::RenderObject*    WTF::HashMap&lt;WebCore::OverlapTestRequestClient*  WebCore::IntRect    WTF::PtrHash&lt;WebCore::OverlapTestRequestClient*&gt;    WTF::HashTraits&lt;WebCore::OverlapTestRequestClient*&gt;    WTF::HashTraits&lt;WebCore::IntRect&gt; &gt;*  unsigned int) + 0x3d   (RenderLayer.cpp:2263)  55 Google Chrome Framew0.0.0.0              0x00ef3254   WebCore::RenderLayer::paint(WebCore::GraphicsContext*    WebCore::IntRect const&amp;  WebCore::PaintRestriction    WebCore::RenderObject*) + 0x36 (RenderLayer.cpp:2040)  56 Google Chrome Framew0.0.0.0              0x00df052e   WebCore::FrameView::paintContents(WebCore::GraphicsContext*    WebCore::IntRect const&amp;) + 0x2c (FrameView.cpp:1585)  57 Google Chrome Framew0.0.0.0              0x00e6b9eb   WebCore::ScrollView::paint(WebCore::GraphicsContext*  WebCore::IntRect   const&amp;) + 0x18 (ScrollView.cpp:773)  58 Google Chrome Framew0.0.0.0              0x010e7e1d   WebFrameImpl::Paint(CGContext*  WebKit::WebRect const&amp;) + 0x17   (webframe_impl.cc:1569)  59 Google Chrome Framew0.0.0.0              0x003d46a2   RenderWidget::PaintRect(gfx::Rect const&amp;  skia::PlatformCanvas*) + 0x1d   (render_widget.cc:379)  60 Google Chrome Framew0.0.0.0              0x003d817a   RenderWidget::DoDeferredPaint() + 0x12 (render_widget.cc:427)  61 Google Chrome Framew0.0.0.0              0x003d8599   RenderWidget::OnPaintRectAck() + 0x7 (render_widget.cc:386)  62 Google Chrome Framew0.0.0.0              0x003d6d34   RenderWidget::OnMessageReceived(IPC::Message const&amp;) + 0x19   (ipc_message.h:134)  63 Google Chrome Framew0.0.0.0              0x003c7619   RenderView::OnMessageReceived(IPC::Message const&amp;) + 0x11   (render_view.cc:446)  64 Google Chrome Framew0.0.0.0              0x00036690   MessageRouter::RouteMessage(IPC::Message const&amp;) + 0xe   (message_router.cc:41)  65 Google Chrome Framew0.0.0.0              0x00819eea   RunnableMethod&lt;IPC::ChannelProxy::Context  void   (IPC::ChannelProxy::Context::*)(IPC::Message const&amp;)    Tuple1&lt;IPC::Message&gt; &gt;::Run() + 0x13 (tuple.h:422)  66 Google Chrome Framew0.0.0.0              0x004283fa   MessageLoop::DeferOrRunPendingTask(MessageLoop::PendingTask const&amp;)   + 0x7 (message_loop.cc:314)  67 Google Chrome Framew0.0.0.0              0x00429426   MessageLoop::DoWork() + 0xb (message_loop.cc:429)  68 Google Chrome Framew0.0.0.0              0x0042e06b   base::MessagePumpCFRunLoopBase::RunWorkSource(void*) + 0xa   (message_pump_mac.mm:217)  69 CoreFoundation      0.550.0.0            0x913618ca   __CFRunLoopDoSources0 + 0x61a  70 CoreFoundation      0.550.0.0            0x9135f85e __CFRunLoopRun +   0x42e  71 CoreFoundation      0.550.0.0            0x9135ed33 CFRunLoopRunSpecific   + 0x1c3  72 CoreFoundation      0.550.0.0            0x9135eb60 CFRunLoopRunInMode   + 0x60  73 HIToolbox           0.437.0.0            0x947f3feb   RunCurrentEventLoopInMode + 0x187  74 HIToolbox           0.437.0.0            0x947f3da2   ReceiveNextEventCommon + 0x161  75 HIToolbox           0.437.0.0            0x947f3c27   BlockUntilNextEventMatchingListInMode + 0x50  76 AppKit              0.1038.0.0           0x96ed2b98 _DPSNextEvent + 0x34e  77 AppKit              0.1038.0.0           0x96ed240d -[NSApplication   nextEventMatchingMask:untilDate:inMode:dequeue:] + 0x9b  78 AppKit              0.1038.0.0           0x96e945fa -[NSApplication run] +   0x334  79 Google Chrome Framew0.0.0.0              0x0042d6d2   base::MessagePumpNSApplication::DoRun(base::MessagePump::Delegate*)   + 0x19 (message_pump_mac.mm:482)  80 Google Chrome Framew0.0.0.0              0x0042d7b7   base::MessagePumpCFRunLoopBase::Run(base::MessagePump::Delegate*)   + 0xe (message_pump_mac.mm:146)  81 Google Chrome Framew0.0.0.0              0x00428343   MessageLoop::Run() + 0xb (message_loop.cc:199)  82 Google Chrome Framew0.0.0.0              0x003e244d   RendererMain(MainFunctionParams const&amp;) + 0xc (renderer_main.cc:162)  83 Google Chrome Framew0.0.0.0              0x0000933b ChromeMain + 0xd   (chrome_dll_main.cc:561)  84 Google Chrome Helper                     0x00001fc5   85  </pre>
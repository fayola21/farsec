<title>Issue 7919 -   chromium -    Escape bad ASCII characters generated by the charset converter - Project Hosting on Google Code</title> <pre> The URL query encoder shouldn't generate characters that change the parsing   of the URL. Currently we escape non-ASCII characters  and anything not   valid in a query  but certain characters like = and &amp; could be generated in   the destination character set  and these would make the query unparsable by   the server  even though it is still a valid query string.    I've attached an example. This should be pretty uncommon.    Markus came up with the idea of using the offset array in ucnv_fromUnicode:    http://www.icu-  project.org/apiref/icu4c/ucnv_8h.html#4a1f09772549fbcd7dd782297212c19f    Basically  you would post-process the ICU output to find byte values  that you care about (e.g. 0x26 == '&amp;')  use the offset array to find  the corresponding Unicode character in the input string  and  if that  Unicode is not the ASCII character that you care about  escape that  byte in the output (e.g. 0x26 -&gt; %26). </pre>
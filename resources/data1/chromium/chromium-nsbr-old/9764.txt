<title>Issue 9764 -   chromium -    Move most in-process browser tests into &quot;ChromeTest.dll&quot; to fix adhoc singleton issue - Project Hosting on Google Code</title> <pre> [From Darin]  A better design for the in-browser unit tests would be to redesign them to   work more like a normal browser. Instead of trying to restart BrowserMain    we should go all the way back to ChromeMain and unload chrome.dll.  To make   that work  perhaps we could bake the unit tests and the Chrome code into a   ChromeTest.dll. Then we could load that before each test  and invoke its   ChromeMain with a special command line flag that would magically invoke the   corresponding test. With some cleverness we could probably make this work.    Then advantage is that we would have a clean Chrome for each test without   having to teach Chrome how to do something (namely  shutting down and   restarting without unloading) it never needs to know how to do otherwise.    It seems way to fragile (read: recipe for flakiness) to try to patch all of   the odd statics.    ---    Let's define chrometest.dll which is roughly chrome.dll with additional   code backed in in it to support --run_inbrowser_test=int and an export to   return the number of available tests. It also includes test code.    browser_tests.exe is a really thin console app that repeatedly loads and   unloads chrometest.dll and calls ChromeMain() with --run_inbrowser_test=N.    Sounds simple? </pre>
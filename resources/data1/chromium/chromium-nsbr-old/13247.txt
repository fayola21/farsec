<title>Issue 13247 -   chromium -    FocusManager attempts to unsubclass twice. - Project Hosting on Google Code</title> <pre> This happened when closing a tab hosted in the external tab container.    Stack trace is below  afaict FocusManager subclasses a widget window and   handles WM_NCDESTROY in which it unsubclasses from the window and passes   the message along. When the window's original WndProc gets the WM_NCDESTROY   message it eventually calls into FocusManager:: UninstallFocusSubclass   again via NativeTabContentsContainerWin::DetachContents resulting in a   DCHECK.    I'm completely unfamiliar with this chunk of code (or I would just have   fixed it ;-)) but one fix would be for NativeTabContentsContainerWin::DetachContents() to check if   IsWindow(container_hwnd) before going about its business.      kv L45  ChildEBP RetAddr  Args to Child                004ed068 75361270 0000021c 00000000 00000000   ntdll!ZwWaitForSingleObject+0x15 (FPO: [3 0 0])  004ed0d8 753611d8 0000021c ffffffff 00000000   kernel32!WaitForSingleObjectEx+0xbe (FPO: [SEH])  004ed0ec 5fa44b44 0000021c ffffffff 004ed53c   kernel32!WaitForSingleObject+0x12 (FPO: [2 0 0])  004ed3b0 5fa45587 004ed40c 004ed5e0 004ed5ec   chrome_5f290000!logging::DisplayDebugMessage+0x154 (FPO: [Non-Fpo]) (CONV:   cdecl)  004ed53c 5f9a175f 004ed6b8 004ed5ec 00000000   chrome_5f290000!logging::LogMessage::~LogMessage+0x357 (FPO: [Non-Fpo])   (CONV: thiscall)  004ed5e0 60b745ed 00000000 004ed608 cccccccc   chrome_5f290000!views::FocusManager::UninstallFocusSubclass+0x8f (FPO:   [Non-Fpo]) (CONV: cdecl)  004ed5fc 60b2cd06 0052c480 004ed780 005352d0   chrome_5f290000!NativeTabContentsContainerWin::DetachContents+0x5d (FPO:   [Non-Fpo]) (CONV: thiscall)  004ed610 60b2d1ef 00000000 004ed76c 00000000   chrome_5f290000!TabContentsContainer::ChangeTabContents+0x36 (FPO: [Non-  Fpo]) (CONV: thiscall)  004ed6b8 60b2ce67 0052c480 004ed948 00000000   chrome_5f290000!TabContentsContainer::TabContentsDestroyed+0x9f (FPO: [Non-  Fpo]) (CONV: thiscall)  004ed76c 60c39f4c 00000025 004ed978 004ed97c   chrome_5f290000!TabContentsContainer::Observe+0xa7 (FPO: [Non-Fpo]) (CONV:   thiscall)  004ed948 5f3eec3f 00000025 004ed978 004ed97c   chrome_5f290000!NotificationService::Notify+0x48c (FPO: [Non-Fpo]) (CONV:   thiscall)  004ed9a0 5f406156 0052c480 004ed9e0 5f77d508   chrome_5f290000!TabContents::~TabContents+0x1bf (FPO: [Non-Fpo]) (CONV:   thiscall)  004ed9ac 5f77d508 00000001 004eda10 cccccccc   chrome_5f290000!TabContents::`scalar deleting destructor'+0x16 (FPO: [Non-  Fpo]) (CONV: thiscall)  004ed9e0 5f77b467 00000000 cccccccc cccccccc   chrome_5f290000!ExternalTabContainer::Uninitialize+0xf8 (FPO: [Non-Fpo])   (CONV: thiscall)  004ed9f8 5f77e336 00523140 004eda24 5f99ba28   chrome_5f290000!ExternalTabContainer::~ExternalTabContainer+0x77 (FPO:   [Non-Fpo]) (CONV: thiscall)  004eda04 5f99ba28 00000001 004eda30 cccccccc   chrome_5f290000!ExternalTabContainer::`scalar deleting destructor'+0x16   (FPO: [Non-Fpo]) (CONV: thiscall)  004eda24 5f99d1f1 0024043e 00000000 5f99d070   chrome_5f290000!views::WidgetWin::OnFinalMessage+0x48 (FPO: [Non-Fpo])   (CONV: thiscall)  004edae4 76eb8807 0024043e 00000082 00000000   chrome_5f290000!views::WidgetWin::WndProc+0x181 (FPO: [Non-Fpo]) (CONV:   stdcall)  004edb10 76eb8962 5f99d070 0024043e 00000082   USER32!InternalCallWinProc+0x23  004edb88 76ebc62c 00000000 5f99d070 0024043e   USER32!UserCallWinProcCheckWow+0x109 (FPO: [SEH])  004edbc0 76ebc652 5f99d070 0024043e 00000082 USER32!CallWindowProcAorW+0xa9   (FPO: [6 2 0])  004edbe0 5f9a16b4 5f99d070 0024043e 00000082 USER32!CallWindowProcW+0x1b   (FPO: [5 0 0])  004edd38 76eb8807 0024043e 00000082 00000000   chrome_5f290000!views::FocusWindowCallback+0x214 (FPO: [Non-Fpo]) (CONV:   stdcall)  004edd64 76ebb6a9 5f9a14a0 0024043e 00000082   USER32!InternalCallWinProc+0x23  004edddc 76ebb4d4 00000000 5f9a14a0 0024043e   USER32!UserCallWinProcCheckWow+0xd8 (FPO: [SEH])  004ede38 76ebbeab 01400470 00000000 00000082   USER32!DispatchClientMessage+0xe0 (FPO: [SEH])  004ede7c 77812ed6 004ede94 00000000 004ee124 USER32!__fnNCDESTROY+0x2d   (FPO: [1 6 4])  004ede90 01400470 00000000 00000082 00000000   ntdll!KiUserCallbackDispatcher+0x2e (FPO: [0 0 0])  WARNING: Frame IP not in any known module. Following frames may be wrong.  004eded8 76eb831a 004edfcc 00000000 00000200 0x1400470  004edf04 5fab6e4e 004edfcc 00000000 00000200 USER32!PeekMessageW+0x107   (FPO: [5 0 4])  004ee000 5fab6c14 004ee020 7efde000 00cccccc   chrome_5f290000!base::MessagePumpForUI::WaitForWork+0xbe (FPO: [Non-Fpo])   (CONV: thiscall)  004ee018 5fab6342 004ee168 00000001 00000000   chrome_5f290000!base::MessagePumpForUI::DoRunLoop+0x144 (FPO: [Non-Fpo])   (CONV: thiscall)  004ee048 5fa2bc2f 004eef6c 005102b0 004ef070   chrome_5f290000!base::MessagePumpWin::RunWithDispatcher+0x82 (FPO: [Non-  Fpo]) (CONV: thiscall)  004ee0fc 5fa2bac0 92684015 004ef070 004ee168   chrome_5f290000!MessageLoop::RunInternal+0xcf (FPO: [Non-Fpo]) (CONV:   thiscall)  004ee134 5fa2cf79 cccccccc 00000001 cccccc00   chrome_5f290000!MessageLoop::RunHandler+0x90 (FPO: [Non-Fpo]) (CONV:   thiscall)  004ee15c 5f2b5ea7 005102b0 004ee178 004ef070   chrome_5f290000!MessageLoopForUI::Run+0x49 (FPO: [Non-Fpo]) (CONV:   thiscall)  004ee16c 5f2b7fe8 00516e40 004ef510 00000000 chrome_5f290000!`anonymous   namespace'::RunUIMessageLoop+0x27 (FPO: [Non-Fpo]) (CONV: cdecl)  004ef070 5f291c5b 004ef3d0 00000000 cccccccc   chrome_5f290000!BrowserMain+0x1e68 (FPO: [Non-Fpo]) (CONV: cdecl)  004ef510 00156f23 00150000 004ef770 007d2680   chrome_5f290000!ChromeMain+0x63b (FPO: [Non-Fpo]) (CONV: cdecl)  004ef7e8 0025604f 00150000 00000000 007d2680 chrome!wWinMain+0x1e3 (FPO:   [Non-Fpo]) (CONV: stdcall)  004ef8a8 00255d9d 004ef8bc 753de4a5 7efde000 chrome!__tmainCRTStartup+0x2af   (FPO: [Non-Fpo]) (CONV: cdecl)  004ef8b0 753de4a5 7efde000 004ef8fc 7786cfed chrome!wWinMainCRTStartup+0xd   (FPO: [Non-Fpo]) (CONV: cdecl)  004ef8bc 7786cfed 7efde000 69ccad2e 00000000   kernel32!BaseThreadInitThunk+0xe (FPO: [1 0 0])  004ef8fc 7786d1ff 00255d90 7efde000 00000000   ntdll!__RtlUserThreadStart+0x23 (FPO: [SEH])  004ef914 00000000 00255d90 7efde000 00000000 ntdll!_RtlUserThreadStart+0x1b   (FPO: [2 2 0])   </pre>
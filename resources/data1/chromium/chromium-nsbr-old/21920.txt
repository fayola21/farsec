<title>Issue 21920 -   chromium -    When a query part is in a non-UTF-8 encoding and the query happens to be valid as UTF-8  the omnibox shows it as UTF-8.  - Project Hosting on Google Code</title> <pre> 1. Go to <a href="http://www.google.com/search?hl=en&amp;source=hp&amp;q=site:love.xatvs.com/userlisthot&amp;aq=f&amp;oq=&amp;aqi=">http://www.google.com/search?hl=en&amp;source=hp&amp;q=site:love.xatvs.com/userlisthot&amp;aq=f&amp;oq=&amp;aqi=</a>    2. Click on the 6th result (the order may change. The link to click on has this url:   love.xatvs.com/userlisthot.asp?pageno=12&amp;sex=��_��__ (in Green)    Actual: What's shown in the url bar is     <a href="http://love.xatvs.com/userlisthot.asp?sex=��_��_">http://love.xatvs.com/userlisthot.asp?sex=��_��_</a>    Expected(?):   <a href="http://love.xatvs.com/userlisthot.asp?sex=%C5%AE">http://love.xatvs.com/userlisthot.asp?sex=%C5%AE</a>    &quot;0xC5 0xAE&quot; is the byte sequence for '��_��__' in GB2312/GBK. It's also a valid UTF-8 sequence (representing   ��_��_).     When clicking on the second result ( <a href="http://love.xatvs.com/userlisthot.asp?pageno=10&amp;sex=%C4%D0">http://love.xatvs.com/userlisthot.asp?pageno=10&amp;sex=%C4%D0</a> )  the   omnibox has '<a href="http://love.xatvs.com/userlisthot.asp?pageno=10&amp;sex=%C4%D0'">http://love.xatvs.com/userlisthot.asp?pageno=10&amp;sex=%C4%D0'</a> because '0xC4 0xD0' is not valid   as UTF-8.     The chance of the 2-byte sequence for a *single* Hanzi/Kanji/Hangul encoded in GB  EUC-JP  Shift_JIS    EUC-KR  and Big5 is relatively high.  With more characters  the chance gets smaller.       With an encoding detector that can work well with a very short chunk of text and some more heuristics  we   'might' be able to do something about this.               &lt;a href=&quot;<a href="http://love.xatvs.com/userlisthot.asp?pageno=12&amp;sex=%C5%AE">http://love.xatvs.com/userlisthot.asp?pageno=12&amp;sex=%C5%AE</a>&quot; class=l onmousedown=&quot;return   clk('<a href="http://love.xatvs.com/userlisthot.asp?pageno=12&amp;sex=%C5%AE' '' '' 'res' '6' '')&quot;&gt;_��_����_��_��_��_��___��_&lt;/a&gt;">http://love.xatvs.com/userlisthot.asp?pageno=12&amp;sex=%C5%AE' '' '' 'res' '6' '')&quot;&gt;_��_����_��_��_��_��___��_&lt;/a&gt;</a>         </pre>
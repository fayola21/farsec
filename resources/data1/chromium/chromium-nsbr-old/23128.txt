<title>Issue 23128 -   chromium -    Sync crashes when trying to push bookmarks from 2 clients - Project Hosting on Google Code</title> <pre>   1. Run Sync Integration Test 'MC_BiDirectionalPush_AddingBM_373379'  2. It crashes while both clients are waiting for sync to finish syncing.    Here is the call stack --    &gt;	sync_integration_tests.exe!DebugUtil::BreakDebugger()  Line 221	C++   	sync_integration_tests.exe!logging::LogMessage::~LogMessage()  Line   536	C++   	  sync_integration_tests.exe!browser_sync::ChangeProcessor::ApplyChangesFromS  yncModel(const sync_api::BaseTransaction * trans=0x0012d208  const   sync_api::SyncManager::ChangeRecord * changes=0x06a9d7e8  int   change_count=1)  Line 406	C++   	  sync_integration_tests.exe!browser_sync::SyncBackendHost::Core::OnChangesAp  plied(const sync_api::BaseTransaction * trans=0x0012d208  const   sync_api::SyncManager::ChangeRecord * changes=0x06a9d7e8  int   change_count=1)  Line 257 + 0x26 bytes	C++   	  syncapi.dll!sync_api::SyncManager::SyncInternal::HandleTransactionCompleteC  hangeEvent(const syncable::DirectoryChangeEvent &amp; event={...})  Line 1260 +   0x2d bytes	C++   	  syncapi.dll!sync_api::SyncManager::SyncInternal::HandleChangeEvent(const   syncable::DirectoryChangeEvent &amp; event={...})  Line 1233 + 0xc bytes	C++   	  syncapi.dll!SimpleHookup&lt;EventChannel&lt;syncable::DirectoryChangeEvent PThrea  dMutex PThreadScopedLock&lt;PThreadMutex&gt;   &gt; syncable::DirectoryChangeEvent sync_api::SyncManager::SyncInternal void   (__thiscall   sync_api::SyncManager::SyncInternal::*)(syncable::DirectoryChangeEvent   const &amp;)&gt;::Callback(const syncable::DirectoryChangeEvent &amp; event={...})    Line 286 + 0x14 bytes	C++   	  syncapi.dll!EventListenerHookupImpl&lt;EventChannel&lt;syncable::DirectoryChangeE  vent PThreadMutex PThreadScopedLock&lt;PThreadMutex&gt;   &gt; syncable::DirectoryChangeEvent SimpleHookup&lt;EventChannel&lt;syncable::Direct  oryChangeEvent PThreadMutex PThreadScopedLock&lt;PThreadMutex&gt;   &gt; syncable::DirectoryChangeEvent sync_api::SyncManager::SyncInternal void   (__thiscall   sync_api::SyncManager::SyncInternal::*)(syncable::DirectoryChangeEvent   const &amp;)&gt; &gt;::HandleEvent(const syncable::DirectoryChangeEvent &amp;   event={...})  Line 253	C++   	  syncapi.dll!EventChannel&lt;syncable::DirectoryChangeEvent PThreadMutex PThrea  dScopedLock&lt;PThreadMutex&gt; &gt;::NotifyListeners(const   syncable::DirectoryChangeEvent &amp; event={...})  Line 183 + 0x28 bytes	C++   	  syncapi.dll!syncable::BaseTransaction::UnlockAndLog(syncable::ThreadCounts   * const thread_counts=0x06aae058    std::set&lt;syncable::EntryKernel syncable::LessEntryMetaHandles std::allocato  r&lt;syncable::EntryKernel&gt; &gt; * originals_arg=[2]({string_fields=&quot;Foo3&quot;   blob_fields=[0]() int64_fields=0x06a9d3a0 ...} {string_fields=&quot;Foo4&quot;   blob_fields=[0]() int64_fields=0x06a9d618 ...}))  Line 1274	C++   	syncapi.dll!syncable::WriteTransaction::~WriteTransaction()  Line   1342	C++   	  syncapi.dll!browser_sync::ProcessCommitResponseCommand::ModelChangingExecut  eImpl(browser_sync::SyncerSession * session=0x0777f56c)  Line 143	C++   	  syncapi.dll!browser_sync::ModelChangingSyncerCommand::StartChangingModel()    Line 32 + 0x16 bytes	C++   	  syncapi.dll!DispatchToMethod&lt;browser_sync::ModelChangingSyncerCommand void   (__thiscall   browser_sync::ModelChangingSyncerCommand::*)(void)&gt;(browser_sync::ModelChan  gingSyncerCommand * obj=0x0777f420  void (void)* method=0x100f0b30  const   Tuple0 &amp; arg={...})  Line 412 + 0x8 bytes	C++   	  syncapi.dll!CallbackImpl&lt;browser_sync::ModelChangingSyncerCommand void   (__thiscall   browser_sync::ModelChangingSyncerCommand::*)(void) Tuple0&gt;::RunWithParams(c  onst Tuple0 &amp; params={...})  Line 578 + 0x17 bytes	C++   	syncapi.dll!CallbackRunner&lt;Tuple0&gt;::Run()  Line 538 + 0x18 bytes	  C++   	syncapi.dll!sync_api::ModelSafeWorkerVisitor::DoWork()  Line 598	  C++   	  sync_integration_tests.exe!browser_sync::BookmarkModelWorker::CallDoWorkAnd  SignalTask::Run()  Line 100 + 0x15 bytes	C++   	sync_integration_tests.exe!MessageLoop::RunTask(Task *   task=0x06960300)  Line 314 + 0xf bytes	C++   	sync_integration_tests.exe!MessageLoop::DeferOrRunPendingTask(const   MessageLoop::PendingTask &amp; pending_task={...})  Line 325	C++   	sync_integration_tests.exe!MessageLoop::DoWork()  Line 429 + 0xc   bytes	C++   	sync_integration_tests.exe!base::MessagePumpForUI::DoRunLoop()    Line 209 + 0x1d bytes	C++   	  sync_integration_tests.exe!base::MessagePumpWin::RunWithDispatcher(base::Me  ssagePump::Delegate * delegate=0x0012f70c  base::MessagePumpWin::Dispatcher   * dispatcher=0x0012de18)  Line 52 + 0xf bytes	C++   	sync_integration_tests.exe!MessageLoop::RunInternal()  Line 195	C++   	sync_integration_tests.exe!MessageLoop::RunHandler()  Line 182	C++   	  sync_integration_tests.exe!MessageLoopForUI::Run(base::MessagePumpWin::Disp  atcher * dispatcher=0x0012de18)  Line 600	C++   	sync_integration_tests.exe!ui_test_utils::RunMessageLoop()  Line   268	C++   	  sync_integration_tests.exe!ProfileSyncServiceTestHarness::AwaitStatusChange  WithTimeout(int timeout_seconds=60  const   std::basic_string&lt;char std::char_traits&lt;char&gt; std::allocator&lt;char&gt; &gt; &amp;   reason=&quot;Sync cycle completion on active client.&quot;)  Line 207	C++   	  sync_integration_tests.exe!ProfileSyncServiceTestHarness::AwaitSyncCycleCom  pletion(const   std::basic_string&lt;char std::char_traits&lt;char&gt; std::allocator&lt;char&gt; &gt; &amp;   reason=&quot;Sync cycle completion on active client.&quot;)  Line 185 + 0x15 bytes	  C++   	  sync_integration_tests.exe!ProfileSyncServiceTestHarness::AwaitMutualSyncCy  cleCompletion(ProfileSyncServiceTestHarness * partner=0x04fd5dc0)  Line 192   + 0x1d bytes	C++   	  sync_integration_tests.exe!ProfileSyncServiceTestHarness::AwaitMutualSyncCy  cleCompletionWithConflict(ProfileSyncServiceTestHarness *   partner=0x04fd5dc0)  Line 213 + 0xc bytes	C++   	  sync_integration_tests.exe!TwoClientLiveBookmarksSyncTest_MC_BiDirectionalP  ush_AddingBM_373379_Test::RunTestOnMainThread()  Line 2237 + 0x2d bytes	C++   	  sync_integration_tests.exe!InProcessBrowserTest::RunTestOnMainThreadLoop()    Line 233 + 0xf bytes	C++   	  sync_integration_tests.exe!DispatchToMethod&lt;InProcessBrowserTest void   (__thiscall InProcessBrowserTest::*)(void)&gt;(InProcessBrowserTest *   obj=0x04fe4180  void (void)* method=0x0045cab0  const Tuple0 &amp; arg={...})    Line 412 + 0x8 bytes	C++   	sync_integration_tests.exe!RunnableMethod&lt;InProcessBrowserTest void   (__thiscall InProcessBrowserTest::*)(void) Tuple0&gt;::Run()  Line 307 + 0x1a   bytes	C++   	sync_integration_tests.exe!MessageLoop::RunTask(Task *   task=0x04fc8900)  Line 314 + 0xf bytes	C++   	sync_integration_tests.exe!MessageLoop::DeferOrRunPendingTask(const   MessageLoop::PendingTask &amp; pending_task={...})  Line 325	C++   	sync_integration_tests.exe!MessageLoop::DoWork()  Line 429 + 0xc   bytes	C++   	sync_integration_tests.exe!base::MessagePumpForUI::DoRunLoop()    Line 209 + 0x1d bytes	C++   	  sync_integration_tests.exe!base::MessagePumpWin::RunWithDispatcher(base::Me  ssagePump::Delegate * delegate=0x0012f70c  base::MessagePumpWin::Dispatcher   * dispatcher=0x0012e768)  Line 52 + 0xf bytes	C++   	sync_integration_tests.exe!MessageLoop::RunInternal()  Line 195	C++   	sync_integration_tests.exe!MessageLoop::RunHandler()  Line 182	C++   	  sync_integration_tests.exe!MessageLoopForUI::Run(base::MessagePumpWin::Disp  atcher * dispatcher=0x0012e768)  Line 600	C++   	sync_integration_tests.exe!`anonymous   namespace'::RunUIMessageLoop(BrowserProcess * browser_process=0x04fcb000)    Line 154	C++   	sync_integration_tests.exe!BrowserMain(const MainFunctionParams &amp;   parameters={...})  Line 800 + 0x11 bytes	C++   	sync_integration_tests.exe!InProcessBrowserTest::SetUp()  Line 146   + 0xc bytes	C++   	sync_integration_tests.exe!LiveBookmarksSyncTest::SetUp()  Line 49	  C++   	sync_integration_tests.exe!testing::Test::Run()  Line 2021 + 0xf   bytes	C++   	sync_integration_tests.exe!testing::internal::TestInfoImpl::Run()    Line 2291	C++   	  sync_integration_tests.exe!testing::internal::TestInfoImpl::RunTest(testing  ::TestInfo * test_info=0x04fc08c0)  Line 656	C++   	  sync_integration_tests.exe!testing::internal::List&lt;testing::TestInfo   *&gt;::ForEach&lt;void (__cdecl*)(testing::TestInfo *)&gt;(void (testing::TestInfo   *)* functor=0x0080a540)  Line 397 + 0x10 bytes	C++   	sync_integration_tests.exe!testing::TestCase::Run()  Line 2384	C++   	  sync_integration_tests.exe!testing::TestCase::RunTestCase(testing::TestCase   * test_case=0x04fc83f0)  Line 776 + 0xb bytes	C++   	  sync_integration_tests.exe!testing::internal::List&lt;testing::TestCase   *&gt;::ForEach&lt;void (__cdecl*)(testing::TestCase *)&gt;(void (testing::TestCase   *)* functor=0x0080e000)  Line 397 + 0x10 bytes	C++   	  sync_integration_tests.exe!testing::internal::UnitTestImpl::RunAllTests()    Line 3674	C++   	sync_integration_tests.exe!testing::UnitTest::Run()  Line 3394 +   0xb bytes	C++   	sync_integration_tests.exe!TestSuite::Run()  Line 93 + 0xc bytes	  C++   	sync_integration_tests.exe!main(int argc=6  char * *   argv=0x04fc4d80)  Line 8 + 0x17 bytes	C++   	sync_integration_tests.exe!__tmainCRTStartup()  Line 327 + 0x12   bytes	C   	kernel32.dll!_BaseProcessStart@4()  + 0x23 bytes	     </pre>
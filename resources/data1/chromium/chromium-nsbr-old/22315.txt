<title>Issue 22315 -   chromium -    Messages sent to MessagePorts can be dropped if port sent to worker before worker thread starts - Project Hosting on Google Code</title> <pre> The layout test worker-messageport-gc.html currently does not work    while the similar worker-messageport.html test *does* work.    worker-messageport-gc.html has this code:    var worker = new Worker(&quot;resources/worker-messageport.js&quot;);  var channel = new MessageChannel();  worker.postMessage(&quot;port&quot;  [channel.port1]);  channel.port2.postMessage(&quot;ping&quot;);    The last message sent (via channel.port2.postMessage()) never arrives at   the worker  because the port is posted to the worker in the previous line   before the worker itself has started.    If you change the code to make sure that the worker is running before   posting a port to it  it works just fine (for example  this code in worker-  messageport.html works):    var worker = new Worker(&quot;resources/worker-messageport.js&quot;);  var channel = new MessageChannel();    // Send messages with and without ports to the worker to make sure it   gets them.  worker.postMessage(&quot;noport&quot;);  worker.onmessage = function(evt) {      log(evt.data);      // Send port to worker *after* worker thread has started      worker.postMessage(&quot;port&quot;  [channel.port1]);      ...    When this is fixed  we should enable this test in worker_uitests.cc.    It's possible that I might have broken something here when I was adding   my multi-port support  so bounce it back to me if that appears to be the   case.        </pre>
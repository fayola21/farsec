<title>Issue 3087 -   chromium -    Omnibox dropdown behaves poorly if users race the first async update - Project Hosting on Google Code</title> <pre> If the omnibox popup is open  and another query starts  and then a user   hits down or clicks a result  we get into a weird state where the popup is   showing results that don't match what's on the controller (this is as of   after a refactoring patch I'll land soon).    sky and I came up with the following crazy hack:  * Add yet another AutocompleteResult to the controller  holding the   previous result set until the first RESULT_UPDATED notification fires  at   which point it's updated in sync with result_; when the popup closes we   clear this result set.  * Add a saved text/selection to the edit model.  This gets cleared when a   RESULT_UPDATED notification fires or the popup closes.  It is set in   OnBeforePossibleChange only if it is currently clear.  * If the user uses mouse or arrows to interact with the popup while the   results are desynced  stop the query  copy the the saved results over to   the main results  and notify RESULTS_ROLLED_BACK or similar.  The popup   does nothing on receiving this; the edit resets itself to its saved data   and clears the saved data. </pre>
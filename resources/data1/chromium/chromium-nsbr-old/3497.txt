<title>Issue 3497 -   chromium -    Improper cancellation of a FileInputStream operation. - Project Hosting on Google Code</title> <pre> URLRequestFileJob::Kill has the following code:    stream_.Close()    and the implementation of FileInputStream::Close does:    CloseHandle(handle_);  async_context_.reset();    The problem with this code is that if there is an IO operation in flight   when Kill is called  the overlapped structure that is part of the request   is deleted immediately  so when it actually completes it will not be valid   anymore.    Even if FileInputStream calls CancelIo  async_context_ has to be kept   around until the OS notifies that the operation was actually canceled  and   then the handle can be closed. </pre>
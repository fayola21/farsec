<title>Issue 4555 -   chromium -    We should remove DCHECKS from official builds. - Project Hosting on Google Code</title> <pre> In order to improve our testing coverage  we added code that allows us to   enable dchecks with a command line option  even from a release build. This   is good to automatically detect problems early on the development process    but has the disadvantage of increasing the code size and complexity of our   released code.    This dead code on the build represents a lot of extra comparisons and jumps   (with the adverse effect that it implies on the cpu pipeline)  and more   code to be loaded from memory (increasing the cache miss rate and page   fault rate).    We should remove this option from the official build.    As an example  consider the following function:    void HttpCache::DeactivateEntry(ActiveEntry* entry) {    DCHECK(!entry-&gt;will_process_pending_queue);    DCHECK(!entry-&gt;doomed);    DCHECK(!entry-&gt;writer);    DCHECK(entry-&gt;readers.empty());    DCHECK(entry-&gt;pending_queue.empty());      ActiveEntriesMap::iterator it =        active_entries_.find(entry-&gt;disk_entry-&gt;GetKey());    DCHECK(it != active_entries_.end());    DCHECK(it-&gt;second == entry);      active_entries_.erase(it);    delete entry;  }    that is compiled into this (686 bytes long  using 180 bytes of local   variables):    6be62d54 55              push    ebp  6be62d55 8bec            mov     ebp esp  6be62d57 81ecb4000000    sub     esp 0B4h  6be62d5d 8365fc00        and     dword ptr [ebp-4] 0  6be62d61 803dc8a1326c00  cmp     byte ptr [chrome_6bb20000!logging::g  6be62d68 53              push    ebx  6be62d69 56              push    esi  6be62d6a 57              push    edi  6be62d6b bee42b2b6c      mov     esi offset chrome_6bb20000!`string'   6be62d70 7432            je      chrome_6bb20000!net::HttpCache::Deac  6be62d72 8b450c          mov     eax dword ptr [ebp+0Ch]  6be62d75 80782000        cmp     byte ptr [eax+20h] 0  6be62d79 7429            je      chrome_6bb20000!net::HttpCache::Deac  6be62d7b 689c040000      push    49Ch  6be62d80 56              push    esi  6be62d81 6a03            push    3  6be62d83 58              pop     eax  6be62d84 8dbd6cffffff    lea     edi [ebp-94h]  6be62d8a c745fc01000000  mov     dword ptr [ebp-4] 1  6be62d91 e8a11bccff      call    chrome_6bb20000!logging::LogMessage:  6be62d96 68cc2f2b6c      push    offset chrome_6bb20000!`string' (6c2  6be62d9b 8d5804          lea     ebx [eax+4]  6be62d9e e84d10ccff      call    chrome_6bb20000!std::operator&lt;&lt;&lt;std:  6be62da3 59              pop     ecx  6be62da4 f645fc01        test    byte ptr [ebp-4] 1  6be62da8 740f            je      chrome_6bb20000!net::HttpCache::Deac  6be62daa 8365fcfe        and     dword ptr [ebp-4] 0FFFFFFFEh  6be62dae 8d8d6cffffff    lea     ecx [ebp-94h]  6be62db4 e80d1eccff      call    chrome_6bb20000!logging::LogMessage:  6be62db9 803dc8a1326c00  cmp     byte ptr [chrome_6bb20000!logging::g  6be62dc0 742f            je      chrome_6bb20000!net::HttpCache::Deac  6be62dc2 8b450c          mov     eax dword ptr [ebp+0Ch]  6be62dc5 80782100        cmp     byte ptr [eax+21h] 0  6be62dc9 7426            je      chrome_6bb20000!net::HttpCache::Deac  6be62dcb 834dfc02        or      dword ptr [ebp-4] 2  6be62dcf 689d040000      push    49Dh  6be62dd4 56              push    esi  6be62dd5 6a03            push    3  6be62dd7 58              pop     eax  6be62dd8 8dbd6cffffff    lea     edi [ebp-94h]  6be62dde e8541bccff      call    chrome_6bb20000!logging::LogMessage:  6be62de3 6800302b6c      push    offset chrome_6bb20000!`string' (6c2  6be62de8 8d5804          lea     ebx [eax+4]  6be62deb e80010ccff      call    chrome_6bb20000!std::operator&lt;&lt;&lt;std:  6be62df0 59              pop     ecx  6be62df1 f645fc02        test    byte ptr [ebp-4] 2  6be62df5 740f            je      chrome_6bb20000!net::HttpCache::Deac  6be62df7 8365fcfd        and     dword ptr [ebp-4] 0FFFFFFFDh  6be62dfb 8d8d6cffffff    lea     ecx [ebp-94h]  6be62e01 e8c01dccff      call    chrome_6bb20000!logging::LogMessage:  6be62e06 803dc8a1326c00  cmp     byte ptr [chrome_6bb20000!logging::g  6be62e0d 742f            je      chrome_6bb20000!net::HttpCache::Deac  6be62e0f 8b450c          mov     eax dword ptr [ebp+0Ch]  6be62e12 83780400        cmp     dword ptr [eax+4] 0  6be62e16 7426            je      chrome_6bb20000!net::HttpCache::Deac  6be62e18 834dfc04        or      dword ptr [ebp-4] 4  6be62e1c 689e040000      push    49Eh  6be62e21 56              push    esi  6be62e22 6a03            push    3  6be62e24 58              pop     eax  6be62e25 8dbd6cffffff    lea     edi [ebp-94h]  6be62e2b e8071bccff      call    chrome_6bb20000!logging::LogMessage:  6be62e30 68002f2b6c      push    offset chrome_6bb20000!`string' (6c2  6be62e35 8d5804          lea     ebx [eax+4]  6be62e38 e8b30fccff      call    chrome_6bb20000!std::operator&lt;&lt;&lt;std:  6be62e3d 59              pop     ecx  6be62e3e f645fc04        test    byte ptr [ebp-4] 4  6be62e42 740f            je      chrome_6bb20000!net::HttpCache::Deac  6be62e44 8365fcfb        and     dword ptr [ebp-4] 0FFFFFFFBh  6be62e48 8d8d6cffffff    lea     ecx [ebp-94h]  6be62e4e e8731dccff      call    chrome_6bb20000!logging::LogMessage:  6be62e53 803dc8a1326c00  cmp     byte ptr [chrome_6bb20000!logging::g  6be62e5a 742f            je      chrome_6bb20000!net::HttpCache::Deac  6be62e5c 8b450c          mov     eax dword ptr [ebp+0Ch]  6be62e5f 83781000        cmp     dword ptr [eax+10h] 0  6be62e63 7426            je      chrome_6bb20000!net::HttpCache::Deac  6be62e65 834dfc08        or      dword ptr [ebp-4] 8  6be62e69 689f040000      push    49Fh  6be62e6e 56              push    esi  6be62e6f 6a03            push    3  6be62e71 58              pop     eax  6be62e72 8dbd6cffffff    lea     edi [ebp-94h]  6be62e78 e8ba1accff      call    chrome_6bb20000!logging::LogMessage:  6be62e7d 68202f2b6c      push    offset chrome_6bb20000!`string' (6c2  6be62e82 8d5804          lea     ebx [eax+4]  6be62e85 e8660fccff      call    chrome_6bb20000!std::operator&lt;&lt;&lt;std:  6be62e8a 59              pop     ecx  6be62e8b f645fc08        test    byte ptr [ebp-4] 8  6be62e8f 740f            je      chrome_6bb20000!net::HttpCache::Deac  6be62e91 8365fcf7        and     dword ptr [ebp-4] 0FFFFFFF7h  6be62e95 8d8d6cffffff    lea     ecx [ebp-94h]  6be62e9b e8261dccff      call    chrome_6bb20000!logging::LogMessage:  6be62ea0 803dc8a1326c00  cmp     byte ptr [chrome_6bb20000!logging::g  6be62ea7 742f            je      chrome_6bb20000!net::HttpCache::Deac  6be62ea9 8b450c          mov     eax dword ptr [ebp+0Ch]  6be62eac 83781c00        cmp     dword ptr [eax+1Ch] 0  6be62eb0 7426            je      chrome_6bb20000!net::HttpCache::Deac  6be62eb2 834dfc10        or      dword ptr [ebp-4] 10h  6be62eb6 68a0040000      push    4A0h  6be62ebb 56              push    esi  6be62ebc 6a03            push    3  6be62ebe 58              pop     eax  6be62ebf 8dbd6cffffff    lea     edi [ebp-94h]  6be62ec5 e86d1accff      call    chrome_6bb20000!logging::LogMessage:  6be62eca 68482f2b6c      push    offset chrome_6bb20000!`string' (6c2  6be62ecf 8d5804          lea     ebx [eax+4]  6be62ed2 e8190fccff      call    chrome_6bb20000!std::operator&lt;&lt;&lt;std:  6be62ed7 59              pop     ecx  6be62ed8 f645fc10        test    byte ptr [ebp-4] 10h  6be62edc 740f            je      chrome_6bb20000!net::HttpCache::Deac  6be62ede 8365fcef        and     dword ptr [ebp-4] 0FFFFFFEFh  6be62ee2 8d8d6cffffff    lea     ecx [ebp-94h]  6be62ee8 e8d91cccff      call    chrome_6bb20000!logging::LogMessage:  6be62eed 8b450c          mov     eax dword ptr [ebp+0Ch]  6be62ef0 8b08            mov     ecx dword ptr [eax]  6be62ef2 8b01            mov     eax dword ptr [ecx]  6be62ef4 8d9550ffffff    lea     edx [ebp-0B0h]  6be62efa 52              push    edx  6be62efb ff5008          call    dword ptr [eax+8]  6be62efe 8b7d08          mov     edi dword ptr [ebp+8]  6be62f01 50              push    eax  6be62f02 8d45f4          lea     eax [ebp-0Ch]  6be62f05 8d4f2c          lea     ecx [edi+2Ch]  6be62f08 50              push    eax  6be62f09 51              push    ecx  6be62f0a 894d08          mov     dword ptr [ebp+8] ecx  6be62f0d e8f50b0000      call    chrome_6bb20000!stdext::_Hash&lt;stdext  6be62f12 6a00            push    0  6be62f14 6a01            push    1  6be62f16 8d8d50ffffff    lea     ecx [ebp-0B0h]  6be62f1c e85308ccff      call    chrome_6bb20000!std::basic_string&lt;ch  6be62f21 803dc8a1326c00  cmp     byte ptr [chrome_6bb20000!logging::g  6be62f28 7441            je      chrome_6bb20000!net::HttpCache::Deac  6be62f2a 837df400        cmp     dword ptr [ebp-0Ch] 0  6be62f2e 8d4730          lea     eax [edi+30h]  6be62f31 8b7804          mov     edi dword ptr [eax+4]  6be62f34 7405            je      chrome_6bb20000!net::HttpCache::Deac  6be62f36 3945f4          cmp     dword ptr [ebp-0Ch] eax  6be62f39 7405            je      chrome_6bb20000!net::HttpCache::Deac  6be62f3b e8c3eb2400      call    chrome_6bb20000!_invalid_parameter_n  6be62f40 397df8          cmp     dword ptr [ebp-8] edi  6be62f43 7526            jne     chrome_6bb20000!net::HttpCache::Deac  6be62f45 834dfc20        or      dword ptr [ebp-4] 20h  6be62f49 68a4040000      push    4A4h  6be62f4e 56              push    esi  6be62f4f 6a03            push    3  6be62f51 58              pop     eax  6be62f52 8dbd6cffffff    lea     edi [ebp-94h]  6be62f58 e8da19ccff      call    chrome_6bb20000!logging::LogMessage:  6be62f5d 6820302b6c      push    offset chrome_6bb20000!`string' (6c2  6be62f62 8d5804          lea     ebx [eax+4]  6be62f65 e8860eccff      call    chrome_6bb20000!std::operator&lt;&lt;&lt;std:  6be62f6a 59              pop     ecx  6be62f6b f645fc20        test    byte ptr [ebp-4] 20h  6be62f6f 740f            je      chrome_6bb20000!net::HttpCache::Deac  6be62f71 8365fcdf        and     dword ptr [ebp-4] 0FFFFFFDFh  6be62f75 8d8d6cffffff    lea     ecx [ebp-94h]  6be62f7b e8461cccff      call    chrome_6bb20000!logging::LogMessage:  6be62f80 803dc8a1326c00  cmp     byte ptr [chrome_6bb20000!logging::g  6be62f87 7447            je      chrome_6bb20000!net::HttpCache::Deac  6be62f89 8b5df4          mov     ebx dword ptr [ebp-0Ch]  6be62f8c 85db            test    ebx ebx  6be62f8e 7505            jne     chrome_6bb20000!net::HttpCache::Deac  6be62f90 e86eeb2400      call    chrome_6bb20000!_invalid_parameter_n  6be62f95 8b7df8          mov     edi dword ptr [ebp-8]  6be62f98 3b7b04          cmp     edi dword ptr [ebx+4]  6be62f9b 7505            jne     chrome_6bb20000!net::HttpCache::Deac  6be62f9d e861eb2400      call    chrome_6bb20000!_invalid_parameter_n  6be62fa2 8b450c          mov     eax dword ptr [ebp+0Ch]  6be62fa5 394724          cmp     dword ptr [edi+24h] eax  6be62fa8 7426            je      chrome_6bb20000!net::HttpCache::Deac  6be62faa 834dfc40        or      dword ptr [ebp-4] 40h  6be62fae 68a5040000      push    4A5h  6be62fb3 56              push    esi  6be62fb4 6a03            push    3  6be62fb6 58              pop     eax  6be62fb7 8dbd6cffffff    lea     edi [ebp-94h]  6be62fbd e87519ccff      call    chrome_6bb20000!logging::LogMessage:  6be62fc2 684c302b6c      push    offset chrome_6bb20000!`string' (6c2  6be62fc7 8d5804          lea     ebx [eax+4]  6be62fca e8210eccff      call    chrome_6bb20000!std::operator&lt;&lt;&lt;std:  6be62fcf 59              pop     ecx  6be62fd0 f645fc40        test    byte ptr [ebp-4] 40h  6be62fd4 740b            je      chrome_6bb20000!net::HttpCache::Deac  6be62fd6 8d8d6cffffff    lea     ecx [ebp-94h]  6be62fdc e8e51bccff      call    chrome_6bb20000!logging::LogMessage:  6be62fe1 ff75f8          push    dword ptr [ebp-8]  6be62fe4 8d45f4          lea     eax [ebp-0Ch]  6be62fe7 ff75f4          push    dword ptr [ebp-0Ch]  6be62fea 50              push    eax  6be62feb ff7508          push    dword ptr [ebp+8]  6be62fee e8de9cfaff      call    chrome_6bb20000!stdext::_Hash&lt;stdext  6be62ff3 8b750c          mov     esi dword ptr [ebp+0Ch]  6be62ff6 e829f4ffff      call    chrome_6bb20000!net::HttpCache::Acti  6be62ffb 5f              pop     edi  6be62ffc 5e              pop     esi  6be62ffd 5b              pop     ebx  6be62ffe c9              leave  6be62fff c20800          ret     8     </pre>
<title>Issue 8870 -   chromium -    TextEliderTest.TestGeneralEliding Segmentation fault when missing system fonts(?) - Project Hosting on Google Code</title> <pre> 1. Launch Hammer/unit_tests on system which may miss some fonts etc.  2. See the segfault:    [----------] 7 tests from TextEliderTest  [ RUN      ] TextEliderTest.TestGeneralEliding  Segmentation fault    I would expect the test to fail in such case  and not segfault.    gdb backtrace:    #0  0x0931d82e in SkTypeface::uniqueID (this=0x0)      at /home/ph/chromium-git/src/skia/include/SkTypeface.h:63  #1  0x0931d825 in SkTypeface::UniqueID (face=0x0)      at /home/ph/chromium-git/src/skia/sgl/SkTypeface.cpp:15  #2  0x0933c3cd in SkScalerContext::MakeRec (paint=@0xbfd18448   deviceMatrix=0x0       rec=0xbfd182d8) at /home/ph/chromium-git/src/skia/sgl/SkPaint.cpp:1161  #3  0x0933a667 in SkPaint::descriptorProc (this=0xbfd18448  deviceMatrix=0x0       proc=0x933a382 &lt;FontMetricsDescProc&gt;  context=0xbfd18484)      at /home/ph/chromium-git/src/skia/sgl/SkPaint.cpp:1230  #4  0x0933ac40 in SkPaint::getFontMetrics (this=0xbfd18448  metrics=0xbfd18484       zoom=0) at /home/ph/chromium-git/src/skia/sgl/SkPaint.cpp:930  #5  0x08576703 in ChromeFont::calculateMetrics (this=0xa0b9a80)      at common/gfx/chrome_font_skia.cc:37  #6  0x08576884 in ChromeFont (this=0xa0b9a80  tf=0x0  font_name=@0xbfd185f4       font_size=10  style=0) at common/gfx/chrome_font_skia.cc:29  #7  0x08576b39 in ChromeFont::CreateFont (font_name=@0xbfd185f4  font_size=10)      at common/gfx/chrome_font_skia.cc:90  #8  0x08575fbb in ChromeFont (this=0x976dc80) at  common/gfx/chrome_font_gtk.cc:25  #9  0x082123ee in RunTest (testcases=0xbfd18790  num_testcases=10)      at common/gfx/text_elider_unittest.cc:34  #10 0x082133b7 in TextEliderTest_TestGeneralEliding_Test::TestBody  (this=0xb6400468)      at common/gfx/text_elider_unittest.cc:73  #11 0x08fc441a in testing::Test::Run (this=0xb6400468)      at /home/ph/chromium-git/src/testing/gtest/src/gtest.cc:2035  #12 0x08fc809d in testing::internal::TestInfoImpl::Run (this=0x9fcc658)      at /home/ph/chromium-git/src/testing/gtest/src/gtest.cc:2257  #13 0x08fcc5d7 in testing::internal::TestInfoImpl::RunTest  (test_info=0x9fcc648)      at /home/ph/chromium-git/src/testing/gtest/src/gtest-internal-inl.h:611  #14 0x08fc8973 in testing::internal::List&lt;testing::TestInfo*&gt;::ForEach&lt;void  (*)(testing::TestInfo*)&gt; (this=0x9fcc718       functor=0x8fcc5be  &lt;testing::internal::TestInfoImpl::RunTest(testing::TestInfo*)&gt;)      at /home/ph/chromium-git/src/testing/gtest/src/gtest-internal-inl.h:365  #15 0x08fc7f88 in testing::TestCase::Run (this=0x9fcc730)      at /home/ph/chromium-git/src/testing/gtest/src/gtest.cc:2353  #16 0x08fcc5bb in testing::TestCase::RunTestCase (test_case=0x9fcc730)      at /home/ph/chromium-git/src/testing/gtest/src/gtest-internal-inl.h:730  #17 0x08fc87e7 in testing::internal::List&lt;testing::TestCase*&gt;::ForEach&lt;void  (*)(testing::TestCase*)&gt; (this=0x9fc8520       functor=0x8fcc5aa &lt;testing::TestCase::RunTestCase(testing::TestCase*)&gt;)      at /home/ph/chromium-git/src/testing/gtest/src/gtest-internal-inl.h:365  #18 0x08fc7df9 in testing::internal::UnitTestImpl::RunAllTests (this=0x9fc84d8)      at /home/ph/chromium-git/src/testing/gtest/src/gtest.cc:3550  #19 0x08fc7eec in testing::UnitTest::Run (this=0x9796da8)      at /home/ph/chromium-git/src/testing/gtest/src/gtest.cc:3299  #20 0x08250a92 in TestSuite::Run (this=0xbfd189b0)      at /home/ph/chromium-git/src/base/test_suite.h:60  #21 0x0824fd21 in main (argc=0  argv=0x41200000) at  test/unit/run_all_unittests.cc:8 </pre>
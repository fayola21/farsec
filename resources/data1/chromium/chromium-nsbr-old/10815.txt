<title>Issue 10815 -   chromium -    Recursive locking of AtExitManager::lock_ due to reentrancy - Project Hosting on Google Code</title> <pre> I just hit a DCHECK(false) in LockImpl::Lock complaining about recursive   locking.  This happened because an AtExitManager exit callback eventually   caused a Singleton to be invoked.  In my case  this was the first time that   Singleton was used (Chrome was not open very long)  so the Singleton was   initialized and called AtExitManager::RegisterCallback  which re-locked the   lock_.    This happened on trunk <a href="/p/chromium/source/detail?r=14092">r14092</a>.    Call stack:     	chrome.dll!DebugUtil::BreakDebugger()  Line 102	C++   	chrome.dll!logging::LogMessage::~LogMessage()  Line 522	C++   	chrome.dll!LockImpl::Lock()  Line 56	C++   	chrome.dll!Lock::Acquire()  Line 16 + 0x16 bytes	C++   	chrome.dll!AutoLock::AutoLock(Lock &amp; lock={...})  Line 44	C++  &gt;	chrome.dll!base::AtExitManager::RegisterCallback(void (void *)*   func=0x02e696e0  void * param=0x00000000)  Line 47	C++   	chrome.dll!Singleton&lt;std::map&lt;HWND__   * tracked_objects::Location std::less&lt;HWND__   *&gt; std::allocator&lt;std::pair&lt;HWND__ * const tracked_objects::Location&gt; &gt;   &gt; win_util::HWNDDeathMapTrait std::map&lt;HWND__   * tracked_objects::Location std::less&lt;HWND__   *&gt; std::allocator&lt;std::pair&lt;HWND__ * const tracked_objects::Location&gt; &gt; &gt;   &gt;::get()  Line 134 + 0xc bytes	C++   	chrome.dll!win_util::NotifyHWNDDestruction(const   tracked_objects::Location &amp; from_here={...}  HWND__ * hwnd=0x001607ec)    Line 410 + 0x5 bytes	C++   	chrome.dll!views::NativeControlWin::NativeControlWndProc(HWND__ *   window=0x001607ec  unsigned int message=2  unsigned int w_param=0  long   l_param=0)  Line 194 + 0x24 bytes	C++   	user32.dll!7e418734() 	   	[Frames below may be incorrect and/or missing  no symbols loaded   for user32.dll]	   	user32.dll!7e418816() 	   	user32.dll!7e4318e3() 	   	user32.dll!7e41b4c0() 	   	user32.dll!7e41b50c() 	   	ntdll.dll!7c90e473() 	   	user32.dll!7e41daf6() 	   	chrome.dll!views::NativeControlWin::~NativeControlWin()  Line 36 +   0xc bytes	C++   	chrome.dll!views::NativeButtonWin::~NativeButtonWin()  Line 28 +   0x8 bytes	C++   	chrome.dll!views::NativeButtonWin::`scalar deleting destructor'()    + 0x16 bytes	C++   	chrome.dll!views::View::~View()  Line 100 + 0x31 bytes	C++   	chrome.dll!views::Button::~Button()  Line 13 + 0x32 bytes	C++   	chrome.dll!views::NativeButton::~NativeButton()  Line 46 + 0x32   bytes	C++   	chrome.dll!views::NativeButton::`scalar deleting destructor'()  +   0x16 bytes	C++   	  chrome.dll!scoped_ptr&lt;views::NativeButton&gt;::~scoped_ptr&lt;views::NativeButton  &gt;()  Line 72 + 0x25 bytes	C++   	chrome.dll!TaskManagerContents::~TaskManagerContents()  Line 739 +   0x2a bytes	C++   	chrome.dll!TaskManagerContents::`scalar deleting destructor'()  +   0x16 bytes	C++   	  chrome.dll!scoped_ptr&lt;TaskManagerContents&gt;::~scoped_ptr&lt;TaskManagerContents  &gt;()  Line 72 + 0x25 bytes	C++   	chrome.dll!TaskManager::~TaskManager()  Line 965 + 0xb bytes	C++   	chrome.dll!TaskManager::`scalar deleting destructor'()  + 0x16   bytes	C++   	chrome.dll!DefaultSingletonTraits&lt;TaskManager&gt;::Delete(TaskManager   * x=0x076749e8)  Line 26 + 0x22 bytes	C++   	  chrome.dll!Singleton&lt;TaskManager DefaultSingletonTraits&lt;TaskManager&gt; TaskMa  nager&gt;::OnExit(void * unused=0x00000000)  Line 172 + 0x15 bytes	C++   	chrome.dll!base::AtExitManager::ProcessCallbacksNow()  Line 63 +   0x9 bytes	C++   	chrome.dll!base::AtExitManager::~AtExitManager()  Line 34	C++   	chrome.dll!ChromeMain(HINSTANCE__ * instance=0x00400000    sandbox::SandboxInterfaceInfo * sandbox_info=0x0012fe80  wchar_t *   command_line=0x00020ce2)  Line 462 + 0x35 bytes	C++   </pre>
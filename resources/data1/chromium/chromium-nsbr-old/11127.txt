<title>Issue 11127 -   chromium -    OS X: Spell check marker drawing is broken and crashy - Project Hosting on Google Code</title> <pre> Steps to reproduce:  * Start typing in a text area e.g. compose a new email in gmail.  * Misspell a word.    Expected results:  Underlines for misspelled words.    Actual results:  No underlines are drawn  sometimes you can get wierd red streaks to appear over the page.  There are also a bunch of crash reports with the following stack:    The cause of this could be similar to what we saw in <a title="Gmail: Crash in form control code" class=closed_ref href="/p/chromium/issues/detail?id=9229"> Issue 9229 </a>.    Thread 1 *CRASHED* (EXC_BAD_ACCESS / KERN_INVALID_ADDRESS @0x964c6ed0)    0x964c6ed0	 [CoreGraphics	 + 0x00055ed0]	 argb32_mark_pixelshape  0x96490274	 [CoreGraphics	 + 0x0001f274]	 argb32_mark  0x96db1473	 [libRIP.A.dylib	 + 0x00020473]	  0x96d95212	 [libRIP.A.dylib	 + 0x00004212]	  0x96d9e6bc	 [libRIP.A.dylib	 + 0x0000d6bc]	  0x9648c47d	 [CoreGraphics	 + 0x0001b47d]	 CGContextFillRects  0x964e11ad	 [CoreGraphics	 + 0x000701ad]	 CGContextFillRect  0x9432da5f	 [AppKit	 + 0x00076a5f]	 NSRectFillUsingOperation  0x008cadee	 [Chrome	 + 0x008c9dee]	   WebCore::GraphicsContext::drawLineForMisspellingOrBadGrammar(WebCore::IntPoint const&amp;  int    bool)  0x0091aad8	 [Chrome	 + 0x00919ad8]	   WebCore::InlineTextBox::paintSpellingOrGrammarMarker(WebCore::GraphicsContext*  int  int    WebCore::DocumentMarker  WebCore::RenderStyle*  WebCore::Font const&amp;  bool)  0x0091afbf	 [Chrome	 + 0x00919fbf]	   WebCore::InlineTextBox::paintDocumentMarkers(WebCore::GraphicsContext*  int  int    WebCore::RenderStyle*  WebCore::Font const&amp;  bool)  0x0091bcb1	 [Chrome	 + 0x0091acb1]	   WebCore::InlineTextBox::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x00916f96	 [Chrome	 + 0x00915f96]	   WebCore::InlineFlowBox::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x009977fc	 [Chrome	 + 0x009967fc]	   WebCore::RootInlineBox::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x00955513	 [Chrome	 + 0x00954513]	   WebCore::RenderLineBoxList::paint(WebCore::RenderBoxModelObject*    WebCore::RenderObject::PaintInfo&amp;  int  int) const  0x009285a0	 [Chrome	 + 0x009275a0]	   WebCore::RenderBlock::paintContents(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092893a	 [Chrome	 + 0x0092793a]	   WebCore::RenderBlock::paintObject(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092343c	 [Chrome	 + 0x0092243c]	   WebCore::RenderBlock::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092846e	 [Chrome	 + 0x0092746e]	   WebCore::RenderBlock::paintChildren(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092893a	 [Chrome	 + 0x0092793a]	   WebCore::RenderBlock::paintObject(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092343c	 [Chrome	 + 0x0092243c]	   WebCore::RenderBlock::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x009140f1	 [Chrome	 + 0x009130f1]	   WebCore::InlineBox::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x00916f96	 [Chrome	 + 0x00915f96]	   WebCore::InlineFlowBox::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x009977fc	 [Chrome	 + 0x009967fc]	   WebCore::RootInlineBox::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x00955513	 [Chrome	 + 0x00954513]	   WebCore::RenderLineBoxList::paint(WebCore::RenderBoxModelObject*    WebCore::RenderObject::PaintInfo&amp;  int  int) const  0x009285a0	 [Chrome	 + 0x009275a0]	   WebCore::RenderBlock::paintContents(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092893a	 [Chrome	 + 0x0092793a]	   WebCore::RenderBlock::paintObject(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092343c	 [Chrome	 + 0x0092243c]	   WebCore::RenderBlock::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0097b74b	 [Chrome	 + 0x0097a74b]	   WebCore::RenderTableSection::paintObject(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0097b2fb	 [Chrome	 + 0x0097a2fb]	   WebCore::RenderTableSection::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x00975217	 [Chrome	 + 0x00974217]	   WebCore::RenderTable::paintObject(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x009744a4	 [Chrome	 + 0x009734a4]	   WebCore::RenderTable::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092846e	 [Chrome	 + 0x0092746e]	   WebCore::RenderBlock::paintChildren(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092893a	 [Chrome	 + 0x0092793a]	   WebCore::RenderBlock::paintObject(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092343c	 [Chrome	 + 0x0092243c]	   WebCore::RenderBlock::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092846e	 [Chrome	 + 0x0092746e]	   WebCore::RenderBlock::paintChildren(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092893a	 [Chrome	 + 0x0092793a]	   WebCore::RenderBlock::paintObject(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092343c	 [Chrome	 + 0x0092243c]	   WebCore::RenderBlock::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092846e	 [Chrome	 + 0x0092746e]	   WebCore::RenderBlock::paintChildren(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092893a	 [Chrome	 + 0x0092793a]	   WebCore::RenderBlock::paintObject(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092343c	 [Chrome	 + 0x0092243c]	   WebCore::RenderBlock::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092846e	 [Chrome	 + 0x0092746e]	   WebCore::RenderBlock::paintChildren(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092893a	 [Chrome	 + 0x0092793a]	   WebCore::RenderBlock::paintObject(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092343c	 [Chrome	 + 0x0092243c]	   WebCore::RenderBlock::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092846e	 [Chrome	 + 0x0092746e]	   WebCore::RenderBlock::paintChildren(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092893a	 [Chrome	 + 0x0092793a]	   WebCore::RenderBlock::paintObject(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092343c	 [Chrome	 + 0x0092243c]	   WebCore::RenderBlock::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092846e	 [Chrome	 + 0x0092746e]	   WebCore::RenderBlock::paintChildren(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092893a	 [Chrome	 + 0x0092793a]	   WebCore::RenderBlock::paintObject(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092343c	 [Chrome	 + 0x0092243c]	   WebCore::RenderBlock::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092846e	 [Chrome	 + 0x0092746e]	   WebCore::RenderBlock::paintChildren(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092893a	 [Chrome	 + 0x0092793a]	   WebCore::RenderBlock::paintObject(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092343c	 [Chrome	 + 0x0092243c]	   WebCore::RenderBlock::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092846e	 [Chrome	 + 0x0092746e]	   WebCore::RenderBlock::paintChildren(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092893a	 [Chrome	 + 0x0092793a]	   WebCore::RenderBlock::paintObject(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092343c	 [Chrome	 + 0x0092243c]	   WebCore::RenderBlock::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092846e	 [Chrome	 + 0x0092746e]	   WebCore::RenderBlock::paintChildren(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092893a	 [Chrome	 + 0x0092793a]	   WebCore::RenderBlock::paintObject(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092343c	 [Chrome	 + 0x0092243c]	   WebCore::RenderBlock::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092846e	 [Chrome	 + 0x0092746e]	   WebCore::RenderBlock::paintChildren(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092893a	 [Chrome	 + 0x0092793a]	   WebCore::RenderBlock::paintObject(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092343c	 [Chrome	 + 0x0092243c]	   WebCore::RenderBlock::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092846e	 [Chrome	 + 0x0092746e]	   WebCore::RenderBlock::paintChildren(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092893a	 [Chrome	 + 0x0092793a]	   WebCore::RenderBlock::paintObject(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092343c	 [Chrome	 + 0x0092243c]	   WebCore::RenderBlock::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0095021a	 [Chrome	 + 0x0094f21a]	   WebCore::RenderLayer::paintLayer(WebCore::RenderLayer*  WebCore::GraphicsContext*    WebCore::IntRect const&amp;  bool  WebCore::PaintRestriction  WebCore::RenderObject*  bool  bool)  0x0094ff1e	 [Chrome	 + 0x0094ef1e]	   WebCore::RenderLayer::paintLayer(WebCore::RenderLayer*  WebCore::GraphicsContext*    WebCore::IntRect const&amp;  bool  WebCore::PaintRestriction  WebCore::RenderObject*  bool  bool)  0x0094ff1e	 [Chrome	 + 0x0094ef1e]	   WebCore::RenderLayer::paintLayer(WebCore::RenderLayer*  WebCore::GraphicsContext*    WebCore::IntRect const&amp;  bool  WebCore::PaintRestriction  WebCore::RenderObject*  bool  bool)  0x009502a0	 [Chrome	 + 0x0094f2a0]	   WebCore::RenderLayer::paint(WebCore::GraphicsContext*  WebCore::IntRect const&amp;    WebCore::PaintRestriction  WebCore::RenderObject*)  0x008ae335	 [Chrome	 + 0x008ad335]	   WebCore::FrameView::paintContents(WebCore::GraphicsContext*  WebCore::IntRect const&amp;)  0x0090071f	 [Chrome	 + 0x008ff71f]	   WebCore::ScrollView::paint(WebCore::GraphicsContext*  WebCore::IntRect const&amp;)  0x00995aa7	 [Chrome	 + 0x00994aa7]	   WebCore::RenderWidget::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x009140f1	 [Chrome	 + 0x009130f1]	   WebCore::InlineBox::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x00916f96	 [Chrome	 + 0x00915f96]	   WebCore::InlineFlowBox::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x009977fc	 [Chrome	 + 0x009967fc]	   WebCore::RootInlineBox::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x00955513	 [Chrome	 + 0x00954513]	   WebCore::RenderLineBoxList::paint(WebCore::RenderBoxModelObject*    WebCore::RenderObject::PaintInfo&amp;  int  int) const  0x009285a0	 [Chrome	 + 0x009275a0]	   WebCore::RenderBlock::paintContents(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092893a	 [Chrome	 + 0x0092793a]	   WebCore::RenderBlock::paintObject(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092343c	 [Chrome	 + 0x0092243c]	   WebCore::RenderBlock::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092846e	 [Chrome	 + 0x0092746e]	   WebCore::RenderBlock::paintChildren(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092893a	 [Chrome	 + 0x0092793a]	   WebCore::RenderBlock::paintObject(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092343c	 [Chrome	 + 0x0092243c]	   WebCore::RenderBlock::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092846e	 [Chrome	 + 0x0092746e]	   WebCore::RenderBlock::paintChildren(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092893a	 [Chrome	 + 0x0092793a]	   WebCore::RenderBlock::paintObject(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0092343c	 [Chrome	 + 0x0092243c]	   WebCore::RenderBlock::paint(WebCore::RenderObject::PaintInfo&amp;  int  int)  0x0095021a	 [Chrome	 + 0x0094f21a]	   WebCore::RenderLayer::paintLayer(WebCore::RenderLayer*  WebCore::GraphicsContext*    WebCore::IntRect const&amp;  bool  WebCore::PaintRestriction  WebCore::RenderObject*  bool  bool)  0x0094ff1e	 [Chrome	 + 0x0094ef1e]	   WebCore::RenderLayer::paintLayer(WebCore::RenderLayer*  WebCore::GraphicsContext*    WebCore::IntRect const&amp;  bool  WebCore::PaintRestriction  WebCore::RenderObject*  bool  bool)  0x009502a0	 [Chrome	 + 0x0094f2a0]	   WebCore::RenderLayer::paint(WebCore::GraphicsContext*  WebCore::IntRect const&amp;    WebCore::PaintRestriction  WebCore::RenderObject*)  0x008ae335	 [Chrome	 + 0x008ad335]	   WebCore::FrameView::paintContents(WebCore::GraphicsContext*  WebCore::IntRect const&amp;)  0x0090071f	 [Chrome	 + 0x008ff71f]	   WebCore::ScrollView::paint(WebCore::GraphicsContext*  WebCore::IntRect const&amp;)  0x005be888	 [Chrome	 + 0x005bd888]	 WebFrameImpl::Paint(skia::PlatformCanvasMac*    WebKit::WebRect const&amp;)  0x002624bc	 [Chrome	 + 0x002614bc]	 RenderWidget::PaintRect(gfx::Rect const&amp;    skia::PlatformCanvasMac*)  0x002656cf	 [Chrome	 + 0x002646cf]	 RenderWidget::DoDeferredPaint()  0x0028e641	 [Chrome	 + 0x0028d641]	 MessageLoop::RunTask(Task*)  0x0028e686	 [Chrome	 + 0x0028d686]	   MessageLoop::DeferOrRunPendingTask(MessageLoop::PendingTask const&amp;)  0x0028f2ce	 [Chrome	 + 0x0028e2ce]	 MessageLoop::DoWork()  0x00293621	 [Chrome	 + 0x00292621]	   base::MessagePumpDefault::Run(base::MessagePump::Delegate*)  0x0028ebb6	 [Chrome	 + 0x0028dbb6]	 MessageLoop::RunInternal()  0x0028ec60	 [Chrome	 + 0x0028dc60]	 MessageLoop::Run()  0x002a7dc1	 [Chrome	 + 0x002a6dc1]	 base::Thread::ThreadMain()  0x002990ee	 [Chrome	 + 0x002980ee]	 _ZL10ThreadFuncPv  0x912e8094	 [libSystem.B.dylib	 + 0x00032094]	 _pthread_start  0x912e7f51	 [libSystem.B.dylib	 + 0x00031f51]	 thread_start   </pre>
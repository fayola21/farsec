<title>Issue 15141 -   chromium -    Better search domain detection - Project Hosting on Google Code</title> <pre> Issue: In Chrome  we use the behavior of Google.com redirects to assign   users to a google search domain (by country). We always do this check on   startup and assign them a domain based on their current IP.    The problem is that the server logic on google.com isn't fully intended for   this--it assumes anyone who types google.com is not asking for a specific   country (if they were  they would have typed google.de  for example).     A US-based user can set their search pref to always go to google.com so   they don't get the weird redirect if they happen to be traveling abroad.   However  a user outside the US can't get this same benefit. For instance    If I'm French and want the omnibox to always search google.fr  things work   fine in France  but when I go on vacation to Venice  chrome sends a query   to .com which redirects to .it and my cookie-based preference on google.fr   is never respected.     I think the problem is that our logic assumes that a non-american user who   has a preference won't type .com  they'll type .fr or whatever. Chrome   isn't that smart though  and it always uses .com.    The solution discussed with the i18n search team at Google is   1. On startup  make a request to  <a href="https://www.google.com/searchdomaincheck?format=domain&amp;type=chrome">https://www.google.com/searchdomaincheck?format=domain&amp;type=chrome</a> (instead   of the old HEAD request we had been making) and store the resulting country   domain.  2. If the domain is different than the stored value  don't just change it    but prompt the user with an infobar that says  &quot;It looks like you've moved.    [Set search go google.XX] [Keep searching on google.XX]&quot;   3. To make this infobar less unexpected  we shouldn't prompt the user until   they do an omnibox search.   </pre>
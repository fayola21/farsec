<title>Issue 11847 -   chromium -    Linux: OwnedWidgetGtk::Destroy debug crash - Project Hosting on Google Code</title> <pre>   1. Navigate somewhere that takes a long time to finish loading.  An   interstitial page sometimes does this.  2. Go to the omnibox and go to some location.    This causes the pending RVH to shutdown.  Note that this happens within a   gtk signal for a keypress.  The widget associated with this will be the   pending RVH's view's widget.  gtkmain will g_object_ref() this widget.    When the RVHWGtk shuts down  it will call OwnedWidgetGtk::Destroy() to   destroy the widget.  This calls gtk_widget_destroy() which detaches the   widget from all containers holding a reference to it  but it doesn't   compensate for the key press signal handler holding a reference to it.    OwnedWidgetGtk::Destroy() will DCHECK that there is only one reference   count for the widget  which fails  so it crashes.    [30642:30642:1742813990478:FATAL:/usr/local/google/chromium2/src/chrome/com  mon/owned_widget_gtk.cc(38)] Check failed: ((((GObject*)   g_type_check_instance_cast ((GTypeInstance*) ((widget))  (((GType) ((20) &lt;&lt;   (2))))))))-&gt;ref_count == 1U (2 vs. 1)  RefDbg shutdown    Program received signal SIGTRAP  Trace/breakpoint trap.  DebugUtil::BreakDebugger () at   /usr/local/google/chromium2/src/base/debug_util_posix.cc:116  116     }  (gdb) ba  #0  DebugUtil::BreakDebugger () at   /usr/local/google/chromium2/src/base/debug_util_posix.cc:116  #1  0x084567a9 in ~LogMessage (this=0xffe28c6c) at   /usr/local/google/chromium2/src/base/logging.cc:521  #2  0x0932c586 in OwnedWidgetGtk::Destroy (this=0xb935538) at   /usr/local/google/chromium2/src/chrome/common/owned_widget_gtk.cc:38  #3  0x08300c11 in RenderWidgetHostViewGtk::Destroy (this=0xb935508) at   /usr/local/google/chromium2/src/chrome/browser/renderer_host/render_widget_  host_view_gtk.cc:311  #4  0x0815e493 in RenderWidgetHost::Destroy (this=0xb938c00) at   /usr/local/google/chromium2/src/chrome/browser/renderer_host/render_widget_  host.cc:414  #5  0x08160481 in RenderWidgetHost::Shutdown (this=0xb938c00) at   /usr/local/google/chromium2/src/chrome/browser/renderer_host/render_widget_  host.cc:104  #6  0x08148fd2 in RenderViewHost::Shutdown (this=0xb938c00) at   /usr/local/google/chromium2/src/chrome/browser/renderer_host/render_view_ho  st.cc:819  #7  0x08342f7d in RenderViewHostManager::CancelPending (this=0xb937804) at   /usr/local/google/chromium2/src/chrome/browser/tab_contents/render_view_hos  t_manager.cc:559  #8  0x08343d0c in RenderViewHostManager::UpdateRendererStateForNavigate   (this=0xb937804  entry=@0xb8ebf00)      at   /usr/local/google/chromium2/src/chrome/browser/tab_contents/render_view_hos  t_manager.cc:479  #9  0x083441d0 in RenderViewHostManager::Navigate (this=0xb937804    entry=@0xb8ebf00)      at   /usr/local/google/chromium2/src/chrome/browser/tab_contents/render_view_hos  t_manager.cc:69  #10 0x081e18ee in TabContents::NavigateToPendingEntry (this=0xb937780    reload=false) at   /usr/local/google/chromium2/src/chrome/browser/tab_contents/tab_contents.cc  :674  #11 0x081d56aa in NavigationController::NavigateToPendingEntry   (this=0xb9377a4  reload=false)      at   /usr/local/google/chromium2/src/chrome/browser/tab_contents/navigation_cont  roller.cc:862  #12 0x081d6203 in NavigationController::LoadEntry (this=0xb9377a4    entry=0xb8ebf00)      at   /usr/local/google/chromium2/src/chrome/browser/tab_contents/navigation_cont  roller.cc:203  #13 0x081d6248 in NavigationController::LoadURL (this=0xb9377a4    url=@0xffe29798  referrer=@0xffe29750  transition=1)      at   /usr/local/google/chromium2/src/chrome/browser/tab_contents/navigation_cont  roller.cc:381  #14 0x082401cf in Browser::OpenURLFromTab (this=0xb911710  source=0x0    url=@0xffe29798  referrer=@0xffe29750  disposition=CURRENT_TAB    transition=1)      at /usr/local/google/chromium2/src/chrome/browser/browser.cc:1737  #15 0x08238940 in Browser::OpenURL (this=0xb911710  url=@0xffe29798    referrer=@0xffe29750  disposition=CURRENT_TAB  transition=1)      at /usr/local/google/chromium2/src/chrome/browser/browser.cc:1663  #16 0x0823c811 in Browser::OpenCurrentURL (this=0xb911710) at   /usr/local/google/chromium2/src/chrome/browser/browser.cc:713  #17 0x08240823 in Browser::ExecuteCommandWithDisposition (this=0xb911710    id=33004  disposition=CURRENT_TAB)      at /usr/local/google/chromium2/src/chrome/browser/browser.cc:1217  #18 0x08240b20 in Browser::ExecuteCommand (this=0xb911710  id=33004) at   /usr/local/google/chromium2/src/chrome/browser/browser.cc:1374  #19 0x0826d090 in CommandUpdater::ExecuteCommand (this=0xb911784  id=33004)   at /usr/local/google/chromium2/src/chrome/browser/command_updater.cc:33  #20 0x0838f42e in LocationBarViewGtk::OnAutocompleteAccept (this=0xb913060    url=@0xffe29a6c  disposition=CURRENT_TAB  transition=1    alternate_nav_url=@0xffe29ab4)      at   /usr/local/google/chromium2/src/chrome/browser/gtk/location_bar_view_gtk.cc  :114  #21 0x083bcafe in AutocompleteEditViewGtk::OpenURL (this=0xb914758    url=@0xffe29a6c  disposition=CURRENT_TAB  transition=1    alternate_nav_url=@0xffe29ab4       selected_line=4294967295  keyword=@0xffe29b04) at   /usr/local/google/chromium2/src/chrome/browser/autocomplete/autocomplete_ed  it_view_gtk.cc:187  #22 0x083bac39 in AutocompleteEditModel::AcceptInput (this=0xb9147a8    disposition=CURRENT_TAB  for_drop=false)      at   /usr/local/google/chromium2/src/chrome/browser/autocomplete/autocomplete_ed  it.cc:251  #23 0x083bbf36 in AutocompleteEditViewGtk::HandleKeyPress (this=0xb914758    widget=0xb6de108  event=0xb60ab40)      at   /usr/local/google/chromium2/src/chrome/browser/autocomplete/autocomplete_ed  it_view_gtk.cc:382  #24 0x083bd787 in AutocompleteEditViewGtk::HandleKeyPressThunk   (widget=0xb6de108  event=0xb60ab40  self=0xb914758)      at   /usr/local/google/chromium2/src/chrome/browser/autocomplete/autocomplete_ed  it_view_gtk.h:115  #25 0xf7b97ccf in _gtk_marshal_BOOLEAN__BOXED (closure=0xb91f358    return_value=0xffe29dd0  n_param_values=2  param_values=0xffe29eb4    invocation_hint=0xffe29dbc       marshal_data=0x83bd768) at gtkmarshalers.c:84  #26 0xf789781c in g_closure_invoke (closure=0xb91f358    return_value=0xffe29dd0  n_param_values=2  param_values=0xffe29eb4    invocation_hint=0xffe29dbc) at gclosure.c:490  #27 0xf78ac96a in signal_emit_unlocked_R (node=0xb64e2f0  detail=0    instance=0xb6de108  emission_return=0xffe2a074    instance_and_params=0xffe29eb4) at gsignal.c:2440  #28 0xf78ae514 in g_signal_emit_valist (instance=0xb6de108  signal_id=39    detail=0  var_args=0xffe2a0f0 &quot;030��_��_��_��_��__��_��_��_��_��__��_��_��_��_��__0��_��_��_��_��__dv(��_��_��_��_��__��_��_��_��_��__��_��_��_��_��__G001��_��_��_��_��__��_��_��_��_��__  b��_��_��_��_��__mv0��_��_��_��_��__dvb��_��_��_��_��__mv��_��_��_��_��__]��_��_��_��_��__��_��_��_��_��__b��_��_��_��_��__mv��__��_��_dv&quot;)      at gsignal.c:2209  #29 0xf78aebcb in g_signal_emit (instance=0xb6de108  signal_id=39    detail=0) at gsignal.c:2243  #30 0xf7cc03b8 in gtk_widget_event_internal (widget=0xb6de108    event=0xb60ab40) at gtkwidget.c:4678  #31 0xf7cd31ed in gtk_window_propagate_key_event (window=0xb653730    event=0xb60ab40) at gtkwindow.c:4936  #32 0x082aeabb in OnKeyPress (window=0xb653730  event=0xb60ab40    browser=0xb911710) at   /usr/local/google/chromium2/src/chrome/browser/gtk/browser_window_gtk.cc:24  6  #33 0xf7b97ccf in _gtk_marshal_BOOLEAN__BOXED (closure=0xb90f0b0    return_value=0xffe2a480  n_param_values=2  param_values=0xffe2a564    invocation_hint=0xffe2a46c       marshal_data=0x82ae9ca) at gtkmarshalers.c:84  #34 0xf789781c in g_closure_invoke (closure=0xb90f0b0    return_value=0xffe2a480  n_param_values=2  param_values=0xffe2a564    invocation_hint=0xffe2a46c) at gclosure.c:490  #35 0xf78ac96a in signal_emit_unlocked_R (node=0xb64e2f0  detail=0    instance=0xb653730  emission_return=0xffe2a724    instance_and_params=0xffe2a564) at gsignal.c:2440  #36 0xf78ae514 in g_signal_emit_valist (instance=0xb653730  signal_id=39    detail=0  var_args=0xffe2a7a0   &quot;��__��__��_��_��_��_��__��_��_��_��_��__0��_��_��_��_��__dv��_��_��__��_��_��_��_��__��_��_��_��_��__G001��_��_��_��_��__��_��_��_��_��__07ev0��_��_��_��_��__dv07ev��_��_��_��_��__]��_��_��_��_��__��_��_��_��_��__030��_��_��_��_��__  231v��__��_��_dv&quot;)      at gsignal.c:2209  #37 0xf78aebcb in g_signal_emit (instance=0xb653730  signal_id=39    detail=0) at gsignal.c:2243  #38 0xf7cc03b8 in gtk_widget_event_internal (widget=0xb653730    event=0xb60ab40) at gtkwidget.c:4678  #39 0xf7b8fd8e in gtk_propagate_event (widget=0xb99df18  event=0xb60ab40)   at gtkmain.c:2310  #40 0xf7b91155 in gtk_main_do_event (event=0xb60ab40) at gtkmain.c:1556  #41 0xf79efc1a in gdk_event_dispatch (source=0xb608a50  callback=0    user_data=0x0) at gdkevents-x11.c:2351  #42 0xf77ed0bc in g_main_context_dispatch (context=0xb5c5290) at   gmain.c:2012  #43 0xf77f075f in g_main_context_iterate (context=0xb5c5290  block=1    dispatch=1  self=0xb604a38) at gmain.c:2645  #44 0xf77f0cd2 in g_main_context_iteration (context=0xb5c5290  may_block=1)   at gmain.c:2708  #45 0x084610c7 in base::MessagePumpForUI::Run (this=0xb609800    delegate=0xffe2b1f0) at   /usr/local/google/chromium2/src/base/message_pump_glib.cc:150  #46 0x084598dd in MessageLoop::RunInternal (this=0xffe2b1f0) at   /usr/local/google/chromium2/src/base/message_loop.cc:197  #47 0x084598f7 in MessageLoop::RunHandler (this=0xffe2b1f0) at   /usr/local/google/chromium2/src/base/message_loop.cc:180  #48 0x0845995b in MessageLoop::Run (this=0xffe2b1f0) at   /usr/local/google/chromium2/src/base/message_loop.cc:154  #49 0x0804d699 in RunUIMessageLoop (browser_process=0xb609fe0) at   /usr/local/google/chromium2/src/chrome/browser/browser_main.cc:180  #50 0x0804f2b8 in BrowserMain (parameters=@0xffe2b6ec) at   /usr/local/google/chromium2/src/chrome/browser/browser_main.cc:652  #51 0x08048b52 in ChromeMain (argc=1  argv=0xffe2b854) at   /usr/local/google/chromium2/src/chrome/app/chrome_dll_main.cc:463  #52 0x0804945a in main (argc=1  argv=0xffe2b854) at   /usr/local/google/chromium2/src/chrome/app/chrome_exe_main_gtk.cc:33  (gdb) frame 2  #2  0x0932c586 in OwnedWidgetGtk::Destroy (this=0xb935538) at   /usr/local/google/chromium2/src/chrome/common/owned_widget_gtk.cc:38  38        DCHECK_EQ(G_OBJECT(widget)-&gt;ref_count  1U);    I'll probably just post a task to delete the widget. </pre>
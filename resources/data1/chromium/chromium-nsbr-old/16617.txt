<title>Issue 16617 -   chromium -    Mem leak with TabStripModelObserverBridge - Project Hosting on Google Code</title> <pre> Beginning to track down Valgrind errors from UI tests (currently on FYI   waterfall).  Pink  assigning to you since this was your checkin (<a href="/p/chromium/source/detail?r=13346">r13346</a>). The leak   occurs as: TabStripModelObserverBridge::TabChangedAt()      <a href="http://build.chromium.org/buildbot/waterfall.fyi/builders/Mac%20UI%201">http://build.chromium.org/buildbot/waterfall.fyi/builders/Mac%20UI%201</a>  %20of%203%20(valgrind)/builds/720/steps/valgrind%20test:%20ui/logs/st  dio    22:02:20 valgrind_analyze.py [ERROR] Leak_DefinitelyLost  14 bytes in 1 blocks are definitely lost in loss record 211 of 1 973    malloc (algrind-  trunk/coregrind/m_replacemalloc/vg_replace_malloc.c:193)    sl_aa_parse_kernel   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    fe_kernel_new_with_string   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    fe_kernel_set   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    fe_tree_expand_color   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    fe_tree_expand_1   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    fe_tree_expand_1   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    fe_tree_expand   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    fe_tree_prepare_tree_   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    fe_tree_render_image   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    fe_image_render_   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    fe_image_get_bitmap   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    -[CIContextImpl render:toBitmap:rowBytes:bounds:format:colorSpace:]   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    cgxcoreimage_instance_render   (/System/Library/Frameworks/ApplicationServices.framework/Versions/A/  Frameworks/CoreGraphics.framework/Versions/A/Resources/libCGXCoreI  mage.A.dylib)    CGXCoreImageInstanceRender   (/System/Library/Frameworks/ApplicationServices.framework/Versions/A/  Frameworks/CoreGraphics.framework/Versions/A/CoreGraphics)    ripc_AcquireCoreImage   (/System/Library/Frameworks/ApplicationServices.framework/Versions/A/  Frameworks/CoreGraphics.framework/Versions/A/Resources/libRIP.A.dylib  )    ripc_DrawShading   (/System/Library/Frameworks/ApplicationServices.framework/Versions/A/  Frameworks/CoreGraphics.framework/Versions/A/Resources/libRIP.A.dylib  )    CGContextDrawShading   (/System/Library/Frameworks/ApplicationServices.framework/Versions/A/  Frameworks/CoreGraphics.framework/Versions/A/CoreGraphics)    -[CICGContextImpl render:]   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    -[CIContext drawImage:inRect:fromRect:]   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    -[CIImage(NSAppKitAdditions) drawInRect:fromRect:operation:fraction:]   (/System/Library/Frameworks/AppKit.framework/Versions/C/AppKit)    -[ThrobberView drawRect:] (/b/slave/chromium-dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    -[NSView(NSInternal)   _recursive:displayRectIgnoringOpacity:inContext:topView:]   (/System/Library/Frameworks/AppKit.framework/Versions/C/AppKit)    -[NSView(NSLayerKitGlue) drawLayer:inContext:]   (/System/Library/Frameworks/AppKit.framework/Versions/C/AppKit)    -[CALayer drawInContext:]   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    -[CALayer _display]   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    CALayerDisplayIfNeeded   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    CAContextCommitTransaction   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    CATransactionCommit   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    -[NSView _setSuperview:]   (/System/Library/Frameworks/AppKit.framework/Versions/C/AppKit)    -[NSView addSubview:]   (/System/Library/Frameworks/AppKit.framework/Versions/C/AppKit)    -[TabController setIconView:] (/b/slave/chromium-dbg-mac-valgrind-  ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    -[TabStripController tabChangedWithContents:atIndex:loadingOnly:]   (/b/slave/chromium-dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    TabStripModelObserverBridge::TabChangedAt(TabContents*  int  bool)   (/b/slave/chromium-dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    TabStripModel::UpdateTabContentsStateAt(int  bool) (/b/slave/chromium-  dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    Browser::ScheduleUIUpdate(TabContents const*  unsigned int)   (/b/slave/chromium-dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    Browser::NavigationStateChanged(TabContents const*  unsigned int)   (/b/slave/chromium-dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    TabContents::NotifyNavigationStateChanged(unsigned int)   (/b/slave/chromium-dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)      NavigationController::NotifyNavigationEntryCommitted(NavigationControlle  r::LoadCommittedDetails*) (/b/slave/chromium-dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)      NavigationController::RendererDidNavigate(ViewHostMsg_FrameNavigate_P  arams const&amp;  NavigationController::LoadCommittedDetails*)   (/b/slave/chromium-dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    TabContents::DidNavigate(RenderViewHost*    ViewHostMsg_FrameNavigate_Params const&amp;) (/b/slave/chromium-dbg-  mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    RenderViewHost::OnMsgNavigate(IPC::Message const&amp;)   (/b/slave/chromium-dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    RenderViewHost::OnMessageReceived(IPC::Message const&amp;)   (/b/slave/chromium-dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    BrowserRenderProcessHost::OnMessageReceived(IPC::Message const&amp;)   (/b/slave/chromium-dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    IPC::ChannelProxy::Context::OnDispatchMessage(IPC::Message const&amp;)   (/b/slave/chromium-dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    void DispatchToMethod&lt;IPC::ChannelProxy::Context  void   (IPC::ChannelProxy::Context::*)(IPC::Message const&amp;)    IPC::Message&gt;(IPC::ChannelProxy::Context*  void   (IPC::ChannelProxy::Context::*)(IPC::Message const&amp;)    Tuple1&lt;IPC::Message&gt; const&amp;) (/b/slave/chromium-dbg-mac-valgrind-  ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    RunnableMethod&lt;IPC::ChannelProxy::Context  void   (IPC::ChannelProxy::Context::*)(IPC::Message const&amp;)    Tuple1&lt;IPC::Message&gt; &gt;::Run() (/b/slave/chromium-dbg-mac-valgrind-  ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    MessageLoop::RunTask(Task*) (/b/slave/chromium-dbg-mac-valgrind-  ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    MessageLoop::DeferOrRunPendingTask(MessageLoop::PendingTask   const&amp;) (/b/slave/chromium-dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    MessageLoop::DoWork() (/b/slave/chromium-dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    22:02:20 valgrind_analyze.py [ERROR] Leak_DefinitelyLost  128 bytes in 1 blocks are definitely lost in loss record 1 237 of 1 973    malloc (algrind-  trunk/coregrind/m_replacemalloc/vg_replace_malloc.c:193)    asprintf (/usr/lib/libSystem.B.dylib)    sl_kernel_inline   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    fe_kernel_concat   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    fe_tree_merge_apply   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    fe_tree_merge_kernels_1   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    fe_tree_merge_kernels_1   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    fe_tree_merge_kernels   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    fe_tree_prepare_tree_   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    fe_tree_render_image   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    fe_image_render_   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    fe_image_get_bitmap   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    -[CIContextImpl render:toBitmap:rowBytes:bounds:format:colorSpace:]   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    cgxcoreimage_instance_render   (/System/Library/Frameworks/ApplicationServices.framework/Versions/A/  Frameworks/CoreGraphics.framework/Versions/A/Resources/libCGXCoreI  mage.A.dylib)    CGXCoreImageInstanceRender   (/System/Library/Frameworks/ApplicationServices.framework/Versions/A/  Frameworks/CoreGraphics.framework/Versions/A/CoreGraphics)    ripc_AcquireCoreImage   (/System/Library/Frameworks/ApplicationServices.framework/Versions/A/  Frameworks/CoreGraphics.framework/Versions/A/Resources/libRIP.A.dylib  )    ripc_DrawShading   (/System/Library/Frameworks/ApplicationServices.framework/Versions/A/  Frameworks/CoreGraphics.framework/Versions/A/Resources/libRIP.A.dylib  )    CGContextDrawShading   (/System/Library/Frameworks/ApplicationServices.framework/Versions/A/  Frameworks/CoreGraphics.framework/Versions/A/CoreGraphics)    -[CICGContextImpl render:]   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    -[CIContext drawImage:inRect:fromRect:]   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    -[CIImage(NSAppKitAdditions) drawInRect:fromRect:operation:fraction:]   (/System/Library/Frameworks/AppKit.framework/Versions/C/AppKit)    -[ThrobberView drawRect:] (/b/slave/chromium-dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    -[NSView(NSInternal)   _recursive:displayRectIgnoringOpacity:inContext:topView:]   (/System/Library/Frameworks/AppKit.framework/Versions/C/AppKit)    -[NSView(NSLayerKitGlue) drawLayer:inContext:]   (/System/Library/Frameworks/AppKit.framework/Versions/C/AppKit)    -[CALayer drawInContext:]   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    -[CALayer _display]   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    CALayerDisplayIfNeeded   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    CAContextCommitTransaction   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    CATransactionCommit   (/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzC  ore)    -[NSView _setSuperview:]   (/System/Library/Frameworks/AppKit.framework/Versions/C/AppKit)    -[NSView addSubview:]   (/System/Library/Frameworks/AppKit.framework/Versions/C/AppKit)    -[TabController setIconView:] (/b/slave/chromium-dbg-mac-valgrind-  ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    -[TabStripController tabChangedWithContents:atIndex:loadingOnly:]   (/b/slave/chromium-dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    TabStripModelObserverBridge::TabChangedAt(TabContents*  int  bool)   (/b/slave/chromium-dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    TabStripModel::UpdateTabContentsStateAt(int  bool) (/b/slave/chromium-  dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    Browser::ScheduleUIUpdate(TabContents const*  unsigned int)   (/b/slave/chromium-dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    Browser::NavigationStateChanged(TabContents const*  unsigned int)   (/b/slave/chromium-dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    TabContents::NotifyNavigationStateChanged(unsigned int)   (/b/slave/chromium-dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)      NavigationController::NotifyNavigationEntryCommitted(NavigationControlle  r::LoadCommittedDetails*) (/b/slave/chromium-dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)      NavigationController::RendererDidNavigate(ViewHostMsg_FrameNavigate_P  arams const&amp;  NavigationController::LoadCommittedDetails*)   (/b/slave/chromium-dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    TabContents::DidNavigate(RenderViewHost*    ViewHostMsg_FrameNavigate_Params const&amp;) (/b/slave/chromium-dbg-  mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    RenderViewHost::OnMsgNavigate(IPC::Message const&amp;)   (/b/slave/chromium-dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    RenderViewHost::OnMessageReceived(IPC::Message const&amp;)   (/b/slave/chromium-dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    BrowserRenderProcessHost::OnMessageReceived(IPC::Message const&amp;)   (/b/slave/chromium-dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    IPC::ChannelProxy::Context::OnDispatchMessage(IPC::Message const&amp;)   (/b/slave/chromium-dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    void DispatchToMethod&lt;IPC::ChannelProxy::Context  void   (IPC::ChannelProxy::Context::*)(IPC::Message const&amp;)    IPC::Message&gt;(IPC::ChannelProxy::Context*  void   (IPC::ChannelProxy::Context::*)(IPC::Message const&amp;)    Tuple1&lt;IPC::Message&gt; const&amp;) (/b/slave/chromium-dbg-mac-valgrind-  ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    RunnableMethod&lt;IPC::ChannelProxy::Context  void   (IPC::ChannelProxy::Context::*)(IPC::Message const&amp;)    Tuple1&lt;IPC::Message&gt; &gt;::Run() (/b/slave/chromium-dbg-mac-valgrind-  ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    MessageLoop::RunTask(Task*) (/b/slave/chromium-dbg-mac-valgrind-  ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    MessageLoop::DeferOrRunPendingTask(MessageLoop::PendingTask   const&amp;) (/b/slave/chromium-dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)    MessageLoop::DoWork() (/b/slave/chromium-dbg-mac-valgrind-ui-  1/build/src/xcodebuild/Debug/Chromium.app/Contents/MacOS/Chromiu  m)   </pre>
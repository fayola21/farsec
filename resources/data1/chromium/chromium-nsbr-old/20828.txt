<title>Issue 20828 -   chromium -    ExtensionApiTest.Tabs is flaky - Project Hosting on Google Code</title> <pre> We have a test that uses chrome.tabs.update() to change the url of a tab   and select it  and then in the callback we use chrome.tabs.getSelected() to   verify that the new url comes back. Sometimes it doesn't  and the theory is   that this is because the callback can happen before navigation is complete    and also we return the current url instead of the pending url in   chrome.tabs.getSelected().    We discussed this a bit and one solution that seems easy is to return the   pending url if there is one. Rafael felt that that &quot;right&quot; thing to do is   actually wait to fire the update() callback until the navigation control   either commits or discards (in which case we'll set lastError for the   callback).     </pre>
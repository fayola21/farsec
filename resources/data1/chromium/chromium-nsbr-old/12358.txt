<title>Issue 12358 -   chromium -    Invalid read in ~LinuxWatcher - Project Hosting on Google Code</title> <pre> Tony's change to implement ProcessSingleton    <a href="http://codereview.chromium.org/115572">http://codereview.chromium.org/115572</a> aka <a href="/p/chromium/source/detail?r=16528">r16528</a>  seems to have exposed a shutdown problem in  the message loop on linux and maybe mac:    <a href="http://build.chromium.org/buildbot/waterfall.fyi/builders/Linux%20UI%201%20of%203%20">http://build.chromium.org/buildbot/waterfall.fyi/builders/Linux%20UI%201%20of%203%20</a>  (valgrind)/builds/779    Invalid read of size 4    event_del (third_party/libevent/event.c:786)      base::MessagePumpLibevent::FileDescriptorWatcher::StopWatchingFileDescriptor()   (base/message_pump_libevent.cc:78)      base::MessagePumpLibevent::FileDescriptorWatcher::~FileDescriptorWatcher()   (base/message_pump_libevent.cc:53)    ProcessSingleton::LinuxWatcher::~LinuxWatcher()   (chrome/browser/process_singleton_linux.cc:82)    ProcessSingleton::~ProcessSingleton() (base/ref_counted.h:107)    BrowserMain(MainFunctionParams const&amp;)   (chrome/browser/browser_main.cc:704)    ChromeMain (chrome/app/chrome_dll_main.cc:490)    main (chrome/app/chrome_exe_main_gtk.cc:33)  Address 0x4eb07e0 is 0 bytes inside a block of size 944 free'd    free   (ome/chrome-bot/valgrind/coregrind/m_replacemalloc/vg_replace_malloc.c:294)    event_base_free (third_party/libevent/event.c:268)    base::MessagePumpLibevent::~MessagePumpLibevent()   (base/message_pump_libevent.cc:143)    MessageLoop::~MessageLoop() (base/ref_counted.h:107)    base::Thread::ThreadMain() (base/thread.cc:166)    ThreadFunc(void*) (base/platform_thread_posix.cc:26)    start_thread (/lib/tls/i686/cmov/libpthread-2.7.so) </pre>
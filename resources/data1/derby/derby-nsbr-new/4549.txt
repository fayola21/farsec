NPE in JBitSet    A NPE occurs at org.apache.derby.iapi.util.JBitSet.or().A NPE occured at the same location before: http://issues.apache.org/jira/browse/DERBY-1574The bug was confirmed by Bryan Pendleton to show in the HEAD as well: http://mail-archives.apache.org/mod_mbox/db-derby-user/201002.mbox/%3C4B79F74E.1000005@amberpoint.com%3ETo reproduce:----------------------CREATE TABLE ABC (ID int PRIMARY KEY NOT NULL);CREATE TABLE DEF (ID int PRIMARY KEY NOT NULL);SELECT * FROM ABC t1WHERE (SELECT DISTINCT t2.ID FROM DEF t2)  IN (SELECT t3.ID FROM DEF t3) ----------------------Leads to error message: Error: DERBY SQL error: SQLCODE: -1  SQLSTATE: XJ001  SQLERRMC: java.lang.NullPointerExceptionXJ001.USQLState: XJ001ErrorCode: -1Stacktrace:java.lang.NullPointerException at org.apache.derby.iapi.util.JBitSet.or(Unknown Source) at org.apache.derby.impl.sql.compile.OptimizerImpl.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.sql.compile.Level2OptimizerImpl.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.sql.compile.Level2OptimizerFactoryImpl.getOptimizerImpl(Unknown Source) at org.apache.derby.impl.sql.compile.OptimizerFactoryImpl.getOptimizer(Unknown Source) at org.apache.derby.impl.sql.compile.ResultSetNode.getOptimizer(Unknown Source) at org.apache.derby.impl.sql.compile.SelectNode.optimize(Unknown Source) at org.apache.derby.impl.sql.compile.SubqueryNode.optimize(Unknown Source) at org.apache.derby.impl.sql.compile.SubqueryList.optimize(Unknown Source) at org.apache.derby.impl.sql.compile.SelectNode.optimize(Unknown Source) at org.apache.derby.impl.sql.compile.DMLStatementNode.optimizeStatement(Unknown Source) at org.apache.derby.impl.sql.compile.CursorNode.optimizeStatement(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement20.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement30.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement40.&lt;init&gt;(Unknown Source) at org.apache.derby.jdbc.Driver40.newEmbedPreparedStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Unknown Source) at org.apache.derby.impl.drda.DRDAStatement.prepare(Unknown Source) at org.apache.derby.impl.drda.DRDAStatement.explicitPrepare(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.parsePRPSQLSTT(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.processCommands(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.run(Unknown Source)Cleanup action completed   
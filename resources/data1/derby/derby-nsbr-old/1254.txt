XAConnection uses NetConnection as underlying physical connection for JDBC4/Java 1.6    When running under DerbyNetClient (using Derby network server) using Java 1.6  XAConnection.getConnection() returns a NetConnection instance instead of NetConnection40 instance for the underlying 'physical connection'. This causes AbstractMethod errors for calls in LogicalConnection40 (not yet committed). PooledConnection does the correct thing according to the test that revealed this problem.The XAConnection was obtained by using TestUtil.getXADataSource().getXAConnection(). The underlying connection object was then obtained with XAConnection.getConnection().A new ConnectionTest is on the way as part of DERBY-1180. It will be submitted/committed  but not enabled until this bug is fixed.   
Unknown page format  error  while doing recovery after a  a crash while doing  in place compress.    Crash was done manually when compress was almost in the end. Log trace before the crash:DEBUG LogTrace OUTPUT: Write log record: tranId=14527 instant: (23 6270154) length: 20BeginXact null transactionStatus 0DEBUG LogTrace OUTPUT: Write log record: tranId=14527 instant: (23 6270190) length: 25Page Operation: Page(0 Container(0  768)) pageVersion 9567 : CompressSpaceOperation: newHighestPage = 0;num_pages_truncated = 956 to Page(0 Container(0  768))DEBUG LogTrace OUTPUT: Flush log to 1350071DEBUG LogTrace OUTPUT: Write log record: tranId=Null instant: (23 6251544) length: 21Checksum Operation algorithm = 1 value = 3588488 data length= 18650DEBUG LogTrace OUTPUT: Begin log sync...DEBUG LogTrace OUTPUT: end log sync.DEBUG LogTrace OUTPUT: Flush log to 6270235DEBUG LogTrace OUTPUT: Begin log sync...DEBUG LogTrace OUTPUT: end log sync.DEBUG LogTrace OUTPUT: Write log record: tranId=14527 instant: (24 61) length: 17EndXact null Committed : transactionStatus = Committed&#8212;C:/suresht/databases&gt;java -Dij.protocol=jdbc:derby: org.apache.derby.tools.ijij version 10.1ij&gt; call SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE('APP'   'T1'   1   1  1) ;IJ ERROR: Unable to establish connectionij&gt; connect 'jdbc:derby:wombat';ERROR XJ040: Failed to start database 'wombat'  see the next exception for details.ERROR XSDB1: Unknown page format at page Page(102 Container(0  768))ij&gt;What was done on the DB :$ rm -rf wombat$ ijC:/suresht/databases&gt;rem set DERBY_INSTALL=C:/suresht/databases&gt;java -Dij.protocol=jdbc:derby: org.apache.derby.tools.ijij version 10.1ij&gt; Terminate batch job (Y/N)? ^C$ ijC:/suresht/databases&gt;rem set DERBY_INSTALL=C:/suresht/databases&gt;java -Dij.protocol=jdbc:derby: org.apache.derby.tools.ijij version 10.1ij&gt; connect 'jdbc:derby:wombat;create=true';ij&gt; create table t1(a int ) ;0 rows inserted/updated/deletedij&gt; insert into t1 values(1) ;1 row inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;1 row inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;2 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;4 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;8 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;16 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;32 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;64 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;128 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;256 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;512 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;1024 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;2048 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;4096 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;8192 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;16384 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;32768 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;65536 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;131072 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;262144 rows inserted/updated/deletedij&gt; commit ;ij&gt; delete from t1 ;524288 rows inserted/updated/deletedij&gt; select * from new org.apache.derby.diag.SpaceTable('T1') ;ERROR 42X01: Syntax error: Encountered '&lt;EOF&gt;' at line 1  column 57.ij&gt; select * from new org.apache.derby.diag.SpaceTable('T1') t ;CONGLOMERATENAMEISIND&amp;NUMALLOCATEDPAGES NUMFREEPAGES NUMUNFILLEDPAGES PAGESIZE ESTIMSPACESAVING---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------T10 1 3826 1 4096 156712961 row selectedij&gt; select NUMALLOCATEDPAGES from new org.apache.derby.diag.SpaceTable('T1') t ;NUMALLOCATEDPAGES--------------------11 row selectedij&gt; select NUMAFREEPAGES from new org.apache.derby.diag.SpaceTable('T1') t ;ERROR 42X04: Column 'NUMAFREEPAGES' is either not in any table in the FROM listor appears within a join specification and is outside the scope of the join specification or appears in a HAVING clause and is not in the GROUP BY list. If this is a CREATE or ALTER TABLE statement then 'NUMAFREEPAGES' is not a column in the target table.ij&gt; select NUMFREEPAGES from new org.apache.derby.diag.SpaceTable('T1') t ;NUMFREEPAGES--------------------38261 row selectedij&gt; call SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE('APP'   'T1'   1   1  1) ;0 rows inserted/updated/deletedij&gt; select NUMFREEPAGES from new org.apache.derby.diag.SpaceTable('T1') t ;NUMFREEPAGES--------------------01 row selectedij&gt; select * from new org.apache.derby.diag.SpaceTable('T1') t ;CONGLOMERATENAMEISIND&amp;NUMALLOCATEDPAGES NUMFREEPAGES NUMUNFILLEDPAGES PAGESIZE ESTIMSPACESAVING---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------T10 1 01 4096 01 row selectedij&gt; ^CTerminate batch job (Y/N)? ^C$ ij/&gt;$ ijC:/suresht/databases&gt;rem set DERBY_INSTALL=C:/suresht/databases&gt;java -Dij.protocol=jdbc:derby: org.apache.derby.tools.ijij version 10.1ij&gt; connect 'jdbc:derby:wombat';ij&gt; select * from t1 ;A-----------0 rows selectedij&gt; insert into t1 values(1) ;1 row inserted/updated/deletedij&gt; insert into t1 select * from t1 ;1 row inserted/updated/deletedij&gt; insert into t1 select * from t1 ;2 rows inserted/updated/deletedij&gt; insert into t1 select * from t1 ;4 rows inserted/updated/deletedij&gt; insert into t1 select a+1 from t1 ;8 rows inserted/updated/deletedij&gt; insert into t1 select a+1 from t1 ;16 rows inserted/updated/deletedij&gt; insert into t1 select a+1 from t1 ;32 rows inserted/updated/deletedij&gt; insert into t1 select a+1 from t1 ;64 rows inserted/updated/deletedij&gt; insert into t1 select a+1 from t1 ;128 rows inserted/updated/deletedij&gt; insert into t1 select a+1 from t1 ;256 rows inserted/updated/deletedij&gt; insert into t1 select a+1 from t1 ;512 rows inserted/updated/deletedij&gt; insert into t1 select a+1 from t1 ;1024 rows inserted/updated/deletedij&gt; insert into t1 select a+1 from t1 ;2048 rows inserted/updated/deletedij&gt; insert into t1 select a+1 from t1 ;4096 rows inserted/updated/deletedij&gt; insert into t1 select a+1 from t1 ;8192 rows inserted/updated/deletedij&gt; insert into t1 select a+1 from t1 ;16384 rows inserted/updated/deletedij&gt; insert into t1 select a+1 from t1 ;32768 rows inserted/updated/deletedij&gt; insert into t1 select a+1 from t1 ;65536 rows inserted/updated/deletedij&gt; delete from t1 ;131072 rows inserted/updated/deletedij&gt; select * from new org.apache.derby.diag.SpaceTable('T1') t ;CONGLOMERATENAMEISIND&amp;NUMALLOCATEDPAGES NUMFREEPAGES NUMUNFILLEDPAGES PAGESIZE ESTIMSPACESAVING---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------T10 1 9560 4096 39157761 row selectedij&gt; call SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE('APP'   'T1'   1   1  1) ;0 rows inserted/updated/deletedij&gt; Terminate batch job (Y/N)? ^C$ ijC:/suresht/databases&gt;rem set DERBY_INSTALL=C:/suresht/databases&gt;java -Dij.protocol=jdbc:derby: org.apache.derby.tools.ijij version 10.1ij&gt; call SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE('APP'   'T1'   1   1  1) ;IJ ERROR: Unable to establish connectionij&gt; connect 'jdbc:derby:wombat';ERROR XJ040: Failed to start database 'wombat'  see the next exception for details.ERROR XSDB1: Unknown page format at page Page(102 Container(0  768))ij&gt;Stacks: pageVersion 8611 : Change page allocation status of 102 to 1(undo 0) instant = (23 6494) logEnd = (23 6536) logIn at 22 available 4DEBUG LogTrace OUTPUT: scanned 12606 : Page Operation: Page(102 Container(0  768)) pageVersion 412 : Invalidate Page - it has been deallocated instant = (23 6536) logEnd = (23 6574) logIn at 18 available 4------------ BEGIN SHUTDOWN ERROR STACK -------------ERROR XSLA7: Cannot redo operation Page Operation: Page(102 Container(0  768)) pageVersion 412 : Invalidate Page - it has been deallocated in the log. at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:315) at org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1515) at org.apache.derby.impl.store.raw.log.LogToFile.recover(LogToFile.java:798) at org.apache.derby.impl.store.raw.RawStore.boot(RawStore.java:323) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1985) at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290) at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:539) at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:418) at org.apache.derby.impl.store.access.RAMAccessManager.boot(RAMAccessManager.java:994) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1985) at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290) at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:539) at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:418) at org.apache.derby.impl.db.BasicDatabase.bootStore(BasicDatabase.java:757) at org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:178) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1985) at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290) at org.apache.derby.impl.services.monitor.BaseMonitor.bootService(BaseMonitor.java:1832) at org.apache.derby.impl.services.monitor.BaseMonitor.startProviderService(BaseMonitor.java:1698) at org.apache.derby.impl.services.monitor.BaseMonitor.findProviderAndStartService(BaseMonitor.java:1577) at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:996) at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:988) at org.apache.derby.iapi.services.monitor.Monitor.startPersistentService(Monitor.java:533) at org.apache.derby.impl.jdbc.EmbedConnection.bootDatabase(EmbedConnection.java:1551) at org.apache.derby.impl.jdbc.EmbedConnection.&lt;init&gt;(EmbedConnection.java:196) at org.apache.derby.impl.jdbc.EmbedConnection30.&lt;init&gt;(EmbedConnection30.java:72) at org.apache.derby.jdbc.Driver30.getNewEmbedConnection(Driver30.java:73) at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:183) at java.sql.DriverManager.getConnection(DriverManager.java:512) at java.sql.DriverManager.getConnection(DriverManager.java:140) at org.apache.derby.impl.tools.ij.ij.dynamicConnection(ij.java:836) at org.apache.derby.impl.tools.ij.ij.ConnectStatement(ij.java:698) at org.apache.derby.impl.tools.ij.ij.ijStatement(ij.java:528) at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:289) at org.apache.derby.impl.tools.ij.Main.go(Main.java:203) at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:169) at org.apache.derby.impl.tools.ij.Main14.main(Main14.java:55) at org.apache.derby.tools.ij.main(ij.java:60)============= begin nested exception  level (1) ===========ERROR XSDB1: Unknown page format at page Page(102 Container(0  768)) at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:315) at org.apache.derby.impl.store.raw.data.CachedPage.changeInstanceTo(CachedPage.java:315) at org.apache.derby.impl.store.raw.data.CachedPage.setIdentity(CachedPage.java:195) at org.apache.derby.impl.services.cache.CachedItem.takeOnIdentity(CachedItem.java:235) at org.apache.derby.impl.services.cache.Clock.addEntry(Clock.java:798) at org.apache.derby.impl.services.cache.Clock.find(Clock.java:303) at org.apache.derby.impl.store.raw.data.FileContainer.getAnyPage(FileContainer.java:2430) at org.apache.derby.impl.store.raw.data.BaseContainer.getAnyPage(BaseContainer.java:473) at org.apache.derby.impl.store.raw.data.BaseContainerHandle.getAnyPage(BaseContainerHandle.java:590) at org.apache.derby.impl.store.raw.data.PageBasicOperation.findpage(PageBasicOperation.java:303) at org.apache.derby.impl.store.raw.data.PageBasicOperation.needsRedo(PageBasicOperation.java:159) at org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1394) at org.apache.derby.impl.store.raw.log.LogToFile.recover(LogToFile.java:798) at org.apache.derby.impl.store.raw.RawStore.boot(RawStore.java:323) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1985) at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290) at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:539) at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:418) at org.apache.derby.impl.store.access.RAMAccessManager.boot(RAMAccessManager.java:994) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1985) at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290) at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:539) at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:418) at org.apache.derby.impl.db.BasicDatabase.bootStore(BasicDatabase.java:757) at org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:178) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1985) at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290) at org.apache.derby.impl.services.monitor.BaseMonitor.bootService(BaseMonitor.java:1832) at org.apache.derby.impl.services.monitor.BaseMonitor.startProviderService(BaseMonitor.java:1698) at org.apache.derby.impl.services.monitor.BaseMonitor.findProviderAndStartService(BaseMonitor.java:1577) at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:996) at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:988) at org.apache.derby.iapi.services.monitor.Monitor.startPersistentService(Monitor.java:533) at org.apache.derby.impl.jdbc.EmbedConnection.bootDatabase(EmbedConnection.java:1551) at org.apache.derby.impl.jdbc.EmbedConnection.&lt;init&gt;(EmbedConnection.java:196) at org.apache.derby.impl.jdbc.EmbedConnection30.&lt;init&gt;(EmbedConnection30.java:72) at org.apache.derby.jdbc.Driver30.getNewEmbedConnection(Driver30.java:73) at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:183) at java.sql.DriverManager.getConnection(DriverManager.java:512) at java.sql.DriverManager.getConnection(DriverManager.java:140) at org.apache.derby.impl.tools.ij.ij.dynamicConnection(ij.java:836) at org.apache.derby.impl.tools.ij.ij.ConnectStatement(ij.java:698) at org.apache.derby.impl.tools.ij.ij.ijStatement(ij.java:528) at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:289) at org.apache.derby.impl.tools.ij.Main.go(Main.java:203) at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:169) at org.apache.derby.impl.tools.ij.Main14.main(Main14.java:55) at org.apache.derby.tools.ij.main(ij.java:60)============= end nested exception  level (1) ======================== begin nested exception  level (2) ===========ERROR XBM0U: No class was registered for identifier 0. at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:311) at org.apache.derby.impl.services.monitor.BaseMonitor.classFromIdentifier(BaseMonitor.java:648) at org.apache.derby.impl.services.monitor.BaseMonitor.newInstanceFromIdentifier(BaseMonitor.java:661) at org.apache.derby.iapi.services.monitor.Monitor.newInstanceFromIdentifier(Monitor.java:618) at org.apache.derby.impl.store.raw.data.CachedPage.changeInstanceTo(CachedPage.java:303) at org.apache.derby.impl.store.raw.data.CachedPage.setIdentity(CachedPage.java:195) at org.apache.derby.impl.services.cache.CachedItem.takeOnIdentity(CachedItem.java:235) at org.apache.derby.impl.services.cache.Clock.addEntry(Clock.java:798) at org.apache.derby.impl.services.cache.Clock.find(Clock.java:303)-More- at org.apache.derby.impl.store.raw.data.FileContainer.getAnyPage(FileContainer.java:2430) at org.apache.derby.impl.store.raw.data.BaseContainer.getAnyPage(BaseContainer.java:473) at org.apache.derby.impl.store.raw.data.BaseContainerHandle.getAnyPage(BaseContainerHandle.java:590) at org.apache.derby.impl.store.raw.data.PageBasicOperation.findpage(PageBasicOperation.java:303) at org.apache.derby.impl.store.raw.data.PageBasicOperation.needsRedo(PageBasicOperation.java:159) at org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1394) at org.apache.derby.impl.store.raw.log.LogToFile.recover(LogToFile.java:798) at org.apache.derby.impl.store.raw.RawStore.boot(RawStore.java:323) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1985) at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290) at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:539) at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:418) at org.apache.derby.impl.store.access.RAMAccessManager.boot(RAMAccessManager.java:994) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1985) at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290) at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:539) at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:418) at org.apache.derby.impl.db.BasicDatabase.bootStore(BasicDatabase.java:757) at org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:178) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1985) at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290) at org.apache.derby.impl.services.monitor.BaseMonitor.bootService(BaseMonitor.java:1832) at org.apache.derby.impl.services.monitor.BaseMonitor.startProviderService(BaseMonitor.java:1698) at org.apache.derby.impl.services.monitor.BaseMonitor.findProviderAndStartService(BaseMonitor.java:1577) at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:996) at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:988) at org.apache.derby.iapi.services.monitor.Monitor.startPersistentService(Monitor.java:533) at org.apache.derby.impl.jdbc.EmbedConnection.bootDatabase(EmbedConnection.java:1551) at org.apache.derby.impl.jdbc.EmbedConnection.&lt;init&gt;(EmbedConnection.java:196) at org.apache.derby.impl.jdbc.EmbedConnection30.&lt;init&gt;(EmbedConnection30.java:72) at org.apache.derby.jdbc.Driver30.getNewEmbedConnection(Driver30.java:73) at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:183) at java.sql.DriverManager.getConnection(DriverManager.java:512) at java.sql.DriverManager.getConnection(DriverManager.java:140) at org.apache.derby.impl.tools.ij.ij.dynamicConnection(ij.java:836) at org.apache.derby.impl.tools.ij.ij.ConnectStatement(ij.java:698) at org.apache.derby.impl.tools.ij.ij.ijStatement(ij.java:528) at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:289) at org.apache.derby.impl.tools.ij.Main.go(Main.java:203) at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:169) at org.apache.derby.impl.tools.ij.Main14.main(Main14.java:55) at org.apache.derby.tools.ij.main(ij.java:60)============= end nested exception  level (2) ===========-More-   